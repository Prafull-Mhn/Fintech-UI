import{a as P}from"./chunk-NBLQEEMX.js";import{a as A,b as M}from"./chunk-EM64PZW2.js";import{a as I}from"./chunk-G7UHNQID.js";import"./chunk-5GEWOZRP.js";import{a as C}from"./chunk-ME7WQYDW.js";import{c as F,i as k}from"./chunk-62M4YNQY.js";import{N as V}from"./chunk-XPN3NBIY.js";import"./chunk-CARY4E7O.js";import"./chunk-FXOCLQ3T.js";import{a as E}from"./chunk-EBTZRFCE.js";import{Ab as m,Bb as s,Ca as p,Cb as T,Da as f,Gb as u,Jb as d,Lb as o,Nc as H,Ub as D,Xa as c,Ya as l,Yc as N,a as b,ac as x,bc as v,dc as y,dd as w,nb as h,pb as n,ta as R,vb as g,yc as S}from"./chunk-IZBYZ66D.js";var q=i=>({"ti-btn-primary":i});function O(i,_){if(i&1){let e=u();m(0,"app-data-grid",9),d("buttonAction",function(r){p(e);let a=o(2);return f(a.printReceipt(r))}),s()}if(i&2){let e=o(2);n("tableDataSet",e.rechargeDetails)("tableConfig",e.tableConfig)("tableWidth",100)("formName","DTH Recharges Details")}}function B(i,_){if(i&1&&(T(0,"app-dynamic-form",7),h(1,O,1,4,"app-data-grid",8)),i&2){let e=o();n("formConfig",e.formConfig)("formName","Search")("columnCount",3),c(),g(1,e.rechargeDetails.length>0?1:-1)}}function W(i,_){if(i&1){let e=u();m(0,"app-show-details",12),d("action",function(){p(e);let r=o(2);return f(r.doRecharge())}),s()}if(i&2){let e=o(2);n("formValue",e.dthInfo[0])("formName","Pay DTH Bill")("displayFields",e.DTHShowFormConfig)}}function L(i,_){if(i&1){let e=u();m(0,"app-dynamic-form",10),d("action",function(r){p(e);let a=o();return f(a.getRechargeDetails(r.form))}),s(),h(1,W,1,3,"app-show-details",11)}if(i&2){let e=o();n("formConfig",e.dthFormConfig)("formName","DTH Recharge")("columnCount",3),c(),g(1,e.dthInfo.length>0?1:-1)}}var oe=(()=>{class i{constructor(e,t,r,a,j){this.apiService=e,this.utilityService=t,this.dialog=r,this.cdr=a,this.messageNotificationService=j,this.rechargeDetails=[],this.tableConfig={tableHeading:"Service Details",columns:[{name:"ReferenceID",field:"referenceID",width:"120"},{name:"Customer Number",field:"canumber",width:"120"},{name:"Status",field:"status",width:"120",type:"highlight"},{name:"Recharge Date",field:"transactionDate",width:"120",type:"date"},{name:"Price",field:"amount",width:"120"}],config:{sorting:{column:"price",order:"desc"},pageSizeOptions:[5,10],pageSize:7},handlers:[{text:"Print Receipt",title:"Print Receipt",type:"print",color:"primary"}],isRowClickable:!1,isSearchable:!0},this.formConfig={fields:[{type:"text",label:"Customer Number",placeholder:"Enter Customer Number",class:"form-control",id:"custNumber",validators:[{isRequired:!1}]},{type:"dropdown",id:"operatorId",label:"Operator List",options:[],class:"form-control",validators:[{isRequired:!1}]},{type:"text",id:"rechargeAmount",label:"Recharge Amount",placeholder:"Enter Recharge Amount",class:"form-control",validators:[{isRequired:!1}]}]},this.dthFormConfig={fields:[{type:"text",label:"Customer Number",placeholder:"Enter Customer Number",class:"form-control",id:"number",validators:[{isRequired:!0,message:"Customer Number is required"}]},{type:"dropdownWithID",id:"operatorId",label:"Operator List",options:[],class:"form-control",validators:[{isRequired:!0,message:"Operator is required"}]}]},this.DTHShowFormConfig={fields:[{key:"customerName",name:"Customer Name"},{key:"Balance",name:"Balance"},{key:"MonthlyRecharge",name:"Monthly Recharge"},{key:"NextRechargeDate",name:"Next Recharge Date"},{key:"status",name:"Status"},{key:"planname",name:"Plan",type:"line"}]},this.selectedTab="DTH Recharge",this.dthInfo=[]}ngOnInit(){this.utilityService.operatorList$.subscribe(()=>{let e=this.utilityService.filterByCategory("DTH");this.formConfig.fields[1].options=e,this.dthFormConfig.fields[1].options=e})}getRechargeDetails(e){e.type="DTH",this.apiService.checkCircleDetails(e).subscribe({next:t=>{t.status?(e.circle=t.info.circle,e.op=t.info.operator,e.canumber=e.number,this.getDTHInfo(e)):this.messageNotificationService.error(t.message,"error")},error:t=>{this.messageNotificationService.error("Unable to Find DTH Info","error"),console.error("Error fetching data:",t)}})}getDTHInfo(e){this.dthInfo=[],this.apiService.getDTHInfo(e).subscribe({next:t=>{t.status?(e.amount=t.info[0].MonthlyRecharge,this.dthInfo.push(b(b({},t.info[0]),e))):this.messageNotificationService.error(t.message,"error")},error:t=>{this.messageNotificationService.error("Unable to Find DTH Info","error"),console.error("Error fetching data:",t)}})}doRecharge(){this.dialog.open(M,{data:"Confirmation"}).afterClosed().subscribe(t=>{t==="submit"&&this.doPayment()})}doPayment(){this.apiService.doRecharge(this.dthInfo[0]).subscribe({next:e=>{e.status?this.messageNotificationService.success(e.message,"success",5e3):this.messageNotificationService.error(e.message,"error",5e3)},error:e=>{console.error("Error fetching data:",e)}})}getTransactionDetails(){let e={transactionType:"DTH_RECHARGE"};this.apiService.getTransactionDetails(e).subscribe({next:t=>{t[0].status?this.rechargeDetails=t:this.messageNotificationService.error(t.message,"error",5e3)},error:t=>{console.error("Error fetching data:",t)}})}tabChangeEvent(e){switch(this.selectedTab=e,e){case"Recharge Details":this.getTransactionDetails();break}}printReceipt(e){e.rechargeType="DTH",this.dialog.open(P,{data:e})}static{this.\u0275fac=function(t){return new(t||i)(l(C),l(I),l(F),l(S),l(E))}}static{this.\u0275cmp=R({type:i,selectors:[["app-dth-recharge"]],standalone:!0,features:[x([C]),v],decls:12,vars:7,consts:[[1,"grid","grid-cols-12","gap-6"],[1,"xl:col-span-12","col-span-12"],[1,"box","box-body","!p-0"],[1,"md:flex","px-4","py-6","items-center","justify-between"],[1,"mt-2","md:mt-0"],[1,"-mb-0.5","sm:flex","sm:space-x-6","rtl:space-x-reverse","flex-wrap"],[1,"w-full","flex","sm:w-auto","hs-tab-active:font-semibold","hs-tab-active:text-primary","hs-tab-active:bg-primary/10","rounded-md","py-2","px-3","text-sm","cursor-pointer",3,"click","ngClass"],[3,"formConfig","formName","columnCount"],[3,"tableDataSet","tableConfig","tableWidth","formName"],[3,"buttonAction","tableDataSet","tableConfig","tableWidth","formName"],[3,"action","formConfig","formName","columnCount"],[3,"formValue","formName","displayFields"],[3,"action","formValue","formName","displayFields"]],template:function(t,r){t&1&&(m(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"nav",5)(6,"a",6),d("click",function(){return r.tabChangeEvent("Recharge Details")}),D(7," Recharge Details "),s(),m(8,"a",6),d("click",function(){return r.tabChangeEvent("DTH Recharge"),r.dthInfo=[]}),D(9," DTH Recharge "),s()()()()(),h(10,B,2,4)(11,L,2,4),s()()),t&2&&(c(6),n("ngClass",y(3,q,r.selectedTab==="Recharge Details")),c(2),n("ngClass",y(5,q,r.selectedTab==="DTH Recharge")),c(2),g(10,r.selectedTab==="Recharge Details"?10:11))},dependencies:[k,V,N,H,w,A]})}}return i})();export{oe as DTHRechargeComponent};
