import{A as $,B as ht,C as Le,D as Th,E as hy,F as to,G as ne,H as gt,I as ul,J as Eh,K as bt,L as qn,M as Ri,N as hl,O as dy,P as Mt,Q as Ue,a as O,b as yr,c as sl,d as ny,e as iy,f as Ge,g as ol,h as Zs,i as yh,j as ry,k as Ht,l as vh,m as al,n as sy,o as oy,p as ll,q as ke,r as ay,s as ly,t as Ct,u as Bn,v as cl,w as eo,x as wh,y as cy,z as uy}from"./chunk-6LIFATZG.js";import{c as ty,d as gh,g as il,h as rl,j as _h}from"./chunk-CARY4E7O.js";import{b as ph,k as mh,s as nl,y as ey}from"./chunk-FB5GXQ5S.js";import{$ as Xa,Aa as Q_,Db as Qs,E as zs,Eb as Hs,F as Ws,Fb as rt,Ga as oh,Gb as Ys,Ha as ah,Ib as gn,Jc as X_,Kc as Z_,Ma as el,Q as Ya,Qc as tl,Rb as Ot,S as j_,Sb as _n,Tb as Js,Tc as fh,Ua as Un,Ub as ch,V as Ja,Vb as uh,W as Ci,X as G_,Xb as hh,Y as ih,Zb as J_,_ as K_,aa as mn,ba as rh,bc as Xs,c as Fn,dc as mt,dd as At,ea as z_,eb as H_,f as zt,fa as W_,fb as lh,ga as $s,ha as Za,j as mr,k as q_,la as It,lb as Fe,ma as $t,mb as bi,mc as yn,n as Ai,o as gr,oa as Ne,oc as Si,p as Ln,q as Wt,qa as K,qb as Y_,ra as _r,sa as $_,u as Ae,ub as pt,uc as dh,wa as sh,xa as Qt}from"./chunk-XWBH5M2L.js";import{a as je,b as Vt,i as nh,j as N}from"./chunk-5VBBBU7A.js";At();At();At();At();var gA="firebase",_A="10.14.1";Mt(gA,_A,"app");$s();Za();var wn=new X_("ANGULARFIRE2_VERSION");var yA=(n,e)=>{let t=e?[e]:dy(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},vn=class{constructor(){return yA(vA)}},vA="app-check";function Ih(){}var dl=class{zone;delegate;constructor(e,t=q_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},Ah=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ih,{},Ih,Ih)),t.pipe(z_({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},vr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new dl(Zone.current)),this.insideAngular=t.run(()=>new dl(Zone.current,mr)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(K(pt))};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function wA(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function be(n){return TA(wA())(n)}function TA(n){return function(t){return t=t.lift(new Ah(n.ngZone)),t.pipe(gr(n.outsideAngular),Ai(n.insideAngular))}}var EA="firebase",IA="10.14.1";Ue.registerVersion(EA,IA,"app-compat");var AA=["ngOnDestroy"],py=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(AA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return i?.spy?.apply&&i.spy.apply(s,u,p),p})})})});var fl=class{constructor(e){return e}},jn=new Ne("angularfire2.app.options"),Gn=new Ne("angularfire2.app.name");function Pi(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=Ue.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>Ue.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;CA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new fl(o)}var CA=(n,...e)=>{fh()&&typeof console<"u"&&console[n](...e)},bA={provide:fl,useFactory:Pi,deps:[jn,pt,[new $_,Gn]]},Qx=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:jn,useValue:t},{provide:Gn,useValue:i}]}}constructor(t){Ue.registerVersion("angularfire",wn.full,"core"),Ue.registerVersion("angularfire",wn.full,"app-compat"),Ue.registerVersion("angular",Z_.full,t.toString())}static \u0275fac=function(i){return new(i||n)(K(Un))};static \u0275mod=Qt({type:n});static \u0275inj=$t({providers:[bA]})}return n})();function wr(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return SA(r,o)||(fy("error",`${e} was already initialized on the ${t} Firebase App with different settings.${RA?" You may need to reload as Firebase is not HMR aware.":""}`),fy("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function SA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var RA=typeof module<"u"&&!!module.hot,fy=(n,...e)=>{fh()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];At();At();var PA=new Map,xA={activated:!1,tokenObservers:[]},NA={initialized:!1,enabled:!1};function Ft(n){return PA.get(n)||Object.assign({},xA)}function Ty(){return NA}var kA="https://content-firebaseappcheck.googleapis.com/v1";var DA="exchangeDebugToken",my={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},rN=24*60*60*1e3;var Sh=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return N(this,null,function*(){this.stop();try{this.pending=new Ge,this.pending.promise.catch(t=>{}),yield VA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ge,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function VA(n){return new Promise(e=>{setTimeout(e,n)})}var OA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Kn=new oy("appCheck","AppCheck",OA);function Ey(n){if(!Ft(n).activated)throw Kn.create("use-before-activation",{appName:n.name})}function Iy(i,r){return N(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw Kn.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw Kn.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(y){throw Kn.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=u.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Kn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let p=Number(d[1])*1e3,m=Date.now();return{token:u.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function Ay(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${kA}/projects/${t}/apps/${i}:${DA}?key=${r}`,body:{debug_token:e}}}var MA="firebase-app-check-database",FA=1,Rh="firebase-app-check-store";var pl=null;function LA(){return pl||(pl=new Promise((n,e)=>{try{let t=indexedDB.open(MA,FA);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Kn.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Rh,{keyPath:"compositeKey"})}}}catch(t){e(Kn.create("storage-open",{originalErrorMessage:t?.message}))}}),pl)}function UA(n,e){return BA(qA(n),e)}function BA(n,e){return N(this,null,function*(){let i=(yield LA()).transaction(Rh,"readwrite"),s=i.objectStore(Rh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var u;a(Kn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function qA(n){return`${n.options.appId}-${n.name}`}var Ph=new qn("@firebase/app-check");function bh(n,e){return al()?UA(n,e).catch(t=>{Ph.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Cy(){return Ty().enabled}function by(){return N(this,null,function*(){let n=Ty();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var jA={error:"UNKNOWN_ERROR"};function GA(n){return sl.encodeString(JSON.stringify(n),!1)}function xh(n,e=!1){return N(this,null,function*(){let t=n.app;Ey(t);let i=Ft(t),r=i.token,s;if(r&&!io(r)&&(i.token=void 0,r=void 0),!r){let c=yield i.cachedTokenPromise;c&&(io(c)?r=c:yield bh(t,void 0))}if(!e&&r&&io(r))return{token:r.token};let o=!1;if(Cy()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Iy(Ay(t,yield by()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let c=yield i.exchangeTokenPromise;return yield bh(t,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Ft(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Ph.warn(c.message):Ph.error(c),s=c}let a;return r?s?io(r)?a={token:r.token,internalError:s}:a=_y(s):(a={token:r.token},i.token=r,yield bh(t,r)):a=_y(s),o&&$A(t,a),a})}function KA(n){return N(this,null,function*(){let e=n.app;Ey(e);let{provider:t}=Ft(e);if(Cy()){let i=yield by(),{token:r}=yield Iy(Ay(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function zA(n,e,t,i){let{app:r}=n,s=Ft(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&io(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),gy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>gy(n))}function Sy(n,e){let t=Ft(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function gy(n){let{app:e}=n,t=Ft(e),i=t.tokenRefresher;i||(i=WA(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function WA(n){let{app:e}=n;return new Sh(()=>N(this,null,function*(){let t=Ft(e),i;if(t.token?i=yield xh(n,!0):i=yield xh(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Ft(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},my.RETRIAL_MIN_WAIT,my.RETRIAL_MAX_WAIT)}function $A(n,e){let t=Ft(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function io(n){return n.expireTimeMillis-Date.now()>0}function _y(n){return{token:GA(jA),error:n}}var Nh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ft(this.app);for(let t of e)Sy(this.app,t.next);return Promise.resolve()}};function QA(n,e){return new Nh(n,e)}function HA(n){return{getToken:e=>xh(n,e),getLimitedUseToken:()=>KA(n),addTokenListener:e=>zA(n,"INTERNAL",e),removeTokenListener:e=>Sy(n.app,e)}}var YA="@firebase/app-check",JA="0.8.8";var XA="app-check",yy="app-check-internal";function ZA(){Ri(new gt(XA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return QA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(yy).initialize()})),Ri(new gt(yy,n=>{let e=n.getProvider("app-check").getImmediate();return HA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Mt(YA,JA)}ZA();var eC=["localhost","0.0.0.0","127.0.0.1"],gN=typeof window<"u"&&eC.includes(window.location.hostname);$s();Za();var ro=new Ne("angularfire2.auth.use-emulator"),so=new Ne("angularfire2.auth.settings"),oo=new Ne("angularfire2.auth.tenant-id"),ao=new Ne("angularfire2.auth.langugage-code"),lo=new Ne("angularfire2.auth.use-device-language"),co=new Ne("angularfire.auth.persistence"),uo=(n,e,t,i,r,s,o,a)=>wr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),i&&(c.tenantId=i),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,i,r,s,o,a]),ho=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,c,u,d,p,m,y){let C=new zt,x=Wt(void 0).pipe(Ai(o.outsideAngular),mn(()=>s.runOutsideAngular(()=>import("./chunk-2LPVEUSD.js"))),Ae(()=>Pi(t,s,i)),Ae(k=>uo(k,s,a,u,d,p,c,m)),ih({bufferSize:1,refCount:!1}));if(nl(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Wt(null);else{x.pipe(j_()).subscribe();let k=x.pipe(mn(M=>M.getRedirectResult().then(W=>W,()=>null)),be,ih({bufferSize:1,refCount:!1})),q=x.pipe(mn(M=>new Fn(W=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(H=>W.next(H),H=>W.error(H),()=>W.complete()))})))),j=x.pipe(mn(M=>new Fn(W=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(H=>W.next(H),H=>W.error(H),()=>W.complete()))}))));this.authState=k.pipe(rh(q),gr(o.outsideAngular),Ai(o.insideAngular)),this.user=k.pipe(rh(j),gr(o.outsideAngular),Ai(o.insideAngular)),this.idToken=this.user.pipe(mn(M=>M?Ln(M.getIdToken()):Wt(null))),this.idTokenResult=this.user.pipe(mn(M=>M?Ln(M.getIdTokenResult()):Wt(null))),this.credential=zs(k,C,this.authState.pipe(Ws(M=>!M))).pipe(Ae(M=>M?.user?M:null),gr(o.outsideAngular),Ai(o.insideAngular))}return py(this,x,s,{spy:{apply:(k,q,j)=>{(k.startsWith("signIn")||k.startsWith("createUser"))&&j.then(M=>C.next(M))}}})}static \u0275fac=function(i){return new(i||n)(K(jn),K(Gn,8),K(Un),K(pt),K(vr),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(co,8),K(vn,8))};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),kN=(()=>{class n{constructor(){Ue.registerVersion("angularfire",wn.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Qt({type:n});static \u0275inj=$t({providers:[ho]})}return n})();At();At();$s();Za();var Py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},xy={};var zn,Dh;(function(){var n;function e(T,_){function w(){}w.prototype=_.prototype,T.D=_.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(E,I,b){for(var v=Array(arguments.length-2),dn=2;dn<arguments.length;dn++)v[dn-2]=arguments[dn];return _.prototype[I].apply(E,v)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(T,_,w){w||(w=0);var E=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)E[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)E[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=T.g[0],w=T.g[1],I=T.g[2];var b=T.g[3],v=_+(b^w&(I^b))+E[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[2]+606105819&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[6]+2821735955&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[10]+4294925233&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+E[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+E[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+E[14]+2792965006&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+E[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^b&(w^I))+E[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[11]+643717713&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[15]+3634488961&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[3]+4107603335&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+E[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+E[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+E[7]+1735328473&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+E[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^b)+E[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[11]+1839030562&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[7]+4139469664&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[3]+3572445317&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+E[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+E[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+E[15]+530742520&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+E[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~b))+E[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[14]+2878612391&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[10]+4293915773&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[6]+2734768916&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+E[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+E[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+E[2]+718787259&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+b&4294967295}i.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var w=_-this.blockSize,E=this.B,I=this.h,b=0;b<_;){if(I==0)for(;b<=w;)r(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<_;)if(E[I++]=T.charCodeAt(b++),I==this.blockSize){r(this,E),I=0;break}}else for(;b<_;)if(E[I++]=T[b++],I==this.blockSize){r(this,E),I=0;break}}this.h=I,this.o+=_},i.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var w=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=w&255,w/=256;for(this.u(T),T=Array(16),_=w=0;4>_;++_)for(var E=0;32>E;E+=8)T[w++]=this.g[_]>>>E&255;return T};function s(T,_){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=_(T)}function o(T,_){this.h=_;for(var w=[],E=!0,I=T.length-1;0<=I;I--){var b=T[I]|0;E&&b==_||(w[I]=b,E=!1)}this.g=w}var a={};function c(T){return-128<=T&&128>T?s(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return p;if(0>T)return k(u(-T));for(var _=[],w=1,E=0;T>=w;E++)_[E]=T/w|0,w*=4294967296;return new o(_,0)}function d(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return k(d(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),E=p,I=0;I<T.length;I+=8){var b=Math.min(8,T.length-I),v=parseInt(T.substring(I,I+b),_);8>b?(b=u(Math.pow(_,b)),E=E.j(b).add(u(v))):(E=E.j(w),E=E.add(u(v)))}return E}var p=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(x(this))return-k(this).m();for(var T=0,_=1,w=0;w<this.g.length;w++){var E=this.i(w);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(x(this))return"-"+k(this).toString(T);for(var _=u(Math.pow(T,6)),w=this,E="";;){var I=W(w,_).g;w=q(w,I.j(_));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=I,C(w))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function C(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=q(this,T),x(T)?-1:C(T)?0:1};function k(T){for(var _=T.g.length,w=[],E=0;E<_;E++)w[E]=~T.g[E];return new o(w,~T.h).add(m)}n.abs=function(){return x(this)?k(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0,I=0;I<=_;I++){var b=E+(this.i(I)&65535)+(T.i(I)&65535),v=(b>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);E=v>>>16,b&=65535,v&=65535,w[I]=v<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(T,_){return T.add(k(_))}n.j=function(T){if(C(this)||C(T))return p;if(x(this))return x(T)?k(this).j(k(T)):k(k(this).j(T));if(x(T))return k(this.j(k(T)));if(0>this.l(y)&&0>T.l(y))return u(this.m()*T.m());for(var _=this.g.length+T.g.length,w=[],E=0;E<2*_;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<T.g.length;I++){var b=this.i(E)>>>16,v=this.i(E)&65535,dn=T.i(I)>>>16,bs=T.i(I)&65535;w[2*E+2*I]+=v*bs,j(w,2*E+2*I),w[2*E+2*I+1]+=b*bs,j(w,2*E+2*I+1),w[2*E+2*I+1]+=v*dn,j(w,2*E+2*I+1),w[2*E+2*I+2]+=b*dn,j(w,2*E+2*I+2)}for(E=0;E<_;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=_;E<2*_;E++)w[E]=0;return new o(w,0)};function j(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function M(T,_){this.g=T,this.h=_}function W(T,_){if(C(_))throw Error("division by zero");if(C(T))return new M(p,p);if(x(T))return _=W(k(T),_),new M(k(_.g),k(_.h));if(x(_))return _=W(T,k(_)),new M(k(_.g),_.h);if(30<T.g.length){if(x(T)||x(_))throw Error("slowDivide_ only works with positive integers.");for(var w=m,E=_;0>=E.l(T);)w=H(w),E=H(E);var I=Y(w,1),b=Y(E,1);for(E=Y(E,2),w=Y(w,2);!C(E);){var v=b.add(E);0>=v.l(T)&&(I=I.add(w),b=v),E=Y(E,1),w=Y(w,1)}return _=q(T,I.j(_)),new M(I,_)}for(I=p;0<=T.l(_);){for(w=Math.max(1,Math.floor(T.m()/_.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=u(w),v=b.j(_);x(v)||0<v.l(T);)w-=E,b=u(w),v=b.j(_);C(b)&&(b=m),I=I.add(b),T=q(T,v)}return new M(I,T)}n.A=function(T){return W(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)&T.i(E);return new o(w,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)|T.i(E);return new o(w,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)^T.i(E);return new o(w,this.h^T.h)};function H(T){for(var _=T.g.length+1,w=[],E=0;E<_;E++)w[E]=T.i(E)<<1|T.i(E-1)>>>31;return new o(w,T.h)}function Y(T,_){var w=_>>5;_%=32;for(var E=T.g.length-w,I=[],b=0;b<E;b++)I[b]=0<_?T.i(b+w)>>>_|T.i(b+w+1)<<32-_:T.i(b+w);return new o(I,T.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,Dh=xy.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,zn=xy.Integer=o}).apply(typeof Py<"u"?Py:typeof self<"u"?self:typeof window<"u"?window:{});var ml=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tn={};var Vh,tC,Tr,Oh,fo,gl,Mh,Fh,Lh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof ml=="object"&&ml];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var i=t(this);function r(l,h){if(h)e:{var f=i;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in f))break e;f=f[A]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,A={next:function(){if(!g&&f<l.length){var R=f++;return{value:h(R,l[R]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}r("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function m(l,h,f){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function C(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,A,R){for(var F=Array(arguments.length-2),he=2;he<arguments.length;he++)F[he-2]=arguments[he];return h.prototype[A].apply(g,F)}}function x(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function k(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(c(g)){let A=l.length||0,R=g.length||0;l.length=A+R;for(let F=0;F<R;F++)l[A+F]=g[F]}else l.push(g)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function M(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function W(l){return W[" "](l),l}W[" "]=function(){};var H=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Y(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function T(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(l,h){let f,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(f in g)l[f]=g[f];for(let R=0;R<w.length;R++)f=w[R],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function b(l){a.setTimeout(()=>{throw l},0)}function v(){var l=Nu;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class dn{constructor(){this.h=this.g=null}add(h,f){let g=bs.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var bs=new q(()=>new M0,l=>l.reset());class M0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ss,Rs=!1,Nu=new dn,Bg=()=>{let l=a.Promise.resolve(void 0);Ss=()=>{l.then(F0)}};var F0=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){b(f)}var h=bs;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Rs=!1};function Dn(){this.s=this.s,this.C=this.C}Dn.prototype.s=!1,Dn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Dn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function He(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}He.prototype.h=function(){this.defaultPrevented=!0};var L0=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function Ps(l,h){if(He.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(H){e:{try{W(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:U0[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Ps.aa.h.call(this)}}C(Ps,He);var U0={2:"touch",3:"pen",4:"mouse"};Ps.prototype.h=function(){Ps.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var xs="closure_listenable_"+(1e6*Math.random()|0),B0=0;function q0(l,h,f,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=A,this.key=++B0,this.da=this.fa=!1}function Da(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Va(l){this.src=l,this.g={},this.h=0}Va.prototype.add=function(l,h,f,g,A){var R=l.toString();l=this.g[R],l||(l=this.g[R]=[],this.h++);var F=Du(l,h,g,A);return-1<F?(h=l[F],f||(h.fa=!1)):(h=new q0(h,this.src,R,!!g,A),h.fa=f,l.push(h)),h};function ku(l,h){var f=h.type;if(f in l.g){var g=l.g[f],A=Array.prototype.indexOf.call(g,h,void 0),R;(R=0<=A)&&Array.prototype.splice.call(g,A,1),R&&(Da(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function Du(l,h,f,g){for(var A=0;A<l.length;++A){var R=l[A];if(!R.da&&R.listener==h&&R.capture==!!f&&R.ha==g)return A}return-1}var Vu="closure_lm_"+(1e6*Math.random()|0),Ou={};function qg(l,h,f,g,A){if(g&&g.once)return Gg(l,h,f,g,A);if(Array.isArray(h)){for(var R=0;R<h.length;R++)qg(l,h[R],f,g,A);return null}return f=Uu(f),l&&l[xs]?l.K(h,f,u(g)?!!g.capture:!!g,A):jg(l,h,f,!1,g,A)}function jg(l,h,f,g,A,R){if(!h)throw Error("Invalid event type");var F=u(A)?!!A.capture:!!A,he=Fu(l);if(he||(l[Vu]=he=new Va(l)),f=he.add(h,f,g,F,R),f.proxy)return f;if(g=j0(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)L0||(A=F),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(zg(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function j0(){function l(f){return h.call(l.src,l.listener,f)}let h=G0;return l}function Gg(l,h,f,g,A){if(Array.isArray(h)){for(var R=0;R<h.length;R++)Gg(l,h[R],f,g,A);return null}return f=Uu(f),l&&l[xs]?l.L(h,f,u(g)?!!g.capture:!!g,A):jg(l,h,f,!0,g,A)}function Kg(l,h,f,g,A){if(Array.isArray(h))for(var R=0;R<h.length;R++)Kg(l,h[R],f,g,A);else g=u(g)?!!g.capture:!!g,f=Uu(f),l&&l[xs]?(l=l.i,h=String(h).toString(),h in l.g&&(R=l.g[h],f=Du(R,f,g,A),-1<f&&(Da(R[f]),Array.prototype.splice.call(R,f,1),R.length==0&&(delete l.g[h],l.h--)))):l&&(l=Fu(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Du(h,f,g,A)),(f=-1<l?h[l]:null)&&Mu(f))}function Mu(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[xs])ku(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(zg(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=Fu(h))?(ku(f,l),f.h==0&&(f.src=null,h[Vu]=null)):Da(l)}}}function zg(l){return l in Ou?Ou[l]:Ou[l]="on"+l}function G0(l,h){if(l.da)l=!0;else{h=new Ps(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&Mu(l),l=f.call(g,h)}return l}function Fu(l){return l=l[Vu],l instanceof Va?l:null}var Lu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Uu(l){return typeof l=="function"?l:(l[Lu]||(l[Lu]=function(h){return l.handleEvent(h)}),l[Lu])}function Ye(){Dn.call(this),this.i=new Va(this),this.M=this,this.F=null}C(Ye,Dn),Ye.prototype[xs]=!0,Ye.prototype.removeEventListener=function(l,h,f,g){Kg(this,l,h,f,g)};function nt(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new He(h,l);else if(h instanceof He)h.target=h.target||l;else{var A=h;h=new He(g,l),E(h,A)}if(A=!0,f)for(var R=f.length-1;0<=R;R--){var F=h.g=f[R];A=Oa(F,g,!0,h)&&A}if(F=h.g=l,A=Oa(F,g,!0,h)&&A,A=Oa(F,g,!1,h)&&A,f)for(R=0;R<f.length;R++)F=h.g=f[R],A=Oa(F,g,!1,h)&&A}Ye.prototype.N=function(){if(Ye.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)Da(f[g]);delete l.g[h],l.h--}}this.F=null},Ye.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},Ye.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function Oa(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,R=0;R<h.length;++R){var F=h[R];if(F&&!F.da&&F.capture==f){var he=F.listener,We=F.ha||F.src;F.fa&&ku(l.i,F),A=he.call(We,g)!==!1&&A}}return A&&!g.defaultPrevented}function Wg(l,h,f){if(typeof l=="function")f&&(l=m(l,f));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function $g(l){l.g=Wg(()=>{l.g=null,l.i&&(l.i=!1,$g(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class K0 extends Dn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:$g(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ns(l){Dn.call(this),this.h=l,this.g={}}C(Ns,Dn);var Qg=[];function Hg(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&Mu(h)},l),l.g={}}Ns.prototype.N=function(){Ns.aa.N.call(this),Hg(this)},Ns.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Bu=a.JSON.stringify,z0=a.JSON.parse,W0=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function qu(){}qu.prototype.h=null;function Yg(l){return l.h||(l.h=l.i())}function Jg(){}var ks={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ju(){He.call(this,"d")}C(ju,He);function Gu(){He.call(this,"c")}C(Gu,He);var wi={},Xg=null;function Ma(){return Xg=Xg||new Ye}wi.La="serverreachability";function Zg(l){He.call(this,wi.La,l)}C(Zg,He);function Ds(l){let h=Ma();nt(h,new Zg(h))}wi.STAT_EVENT="statevent";function e_(l,h){He.call(this,wi.STAT_EVENT,l),this.stat=h}C(e_,He);function it(l){let h=Ma();nt(h,new e_(h,l))}wi.Ma="timingevent";function t_(l,h){He.call(this,wi.Ma,l),this.size=h}C(t_,He);function Vs(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Os(){this.g=!0}Os.prototype.xa=function(){this.g=!1};function $0(l,h,f,g,A,R){l.info(function(){if(l.g)if(R)for(var F="",he=R.split("&"),We=0;We<he.length;We++){var ae=he[We].split("=");if(1<ae.length){var Je=ae[0];ae=ae[1];var Xe=Je.split("_");F=2<=Xe.length&&Xe[1]=="type"?F+(Je+"="+ae+"&"):F+(Je+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+f+`
`+F})}function Q0(l,h,f,g,A,R,F){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+f+`
`+R+" "+F})}function hr(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+Y0(l,f)+(g?" "+g:"")})}function H0(l,h){l.info(function(){return"TIMEOUT: "+h})}Os.prototype.info=function(){};function Y0(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return Bu(f)}catch{return h}}var Fa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},n_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ku;function La(){}C(La,qu),La.prototype.g=function(){return new XMLHttpRequest},La.prototype.i=function(){return{}},Ku=new La;function Vn(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new Ns(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new i_}function i_(){this.i=null,this.g="",this.h=!1}var r_={},zu={};function Wu(l,h,f){l.L=1,l.v=ja(fn(h)),l.m=f,l.P=!0,s_(l,null)}function s_(l,h){l.F=Date.now(),Ua(l),l.A=fn(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),v_(f.i,"t",g),l.C=0,f=l.j.J,l.h=new i_,l.g=F_(l.j,f?h:null,!l.m),0<l.O&&(l.M=new K0(m(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(Qg[0]=A.toString()),A=Qg);for(var R=0;R<A.length;R++){var F=qg(f,A[R],g||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Ds(),$0(l.i,l.u,l.A,l.l,l.R,l.m)}Vn.prototype.ca=function(l){l=l.target;let h=this.M;h&&pn(l)==3?h.j():this.Y(l)},Vn.prototype.Y=function(l){try{if(l==this.g)e:{let Xe=pn(this.g);var h=this.g.Ba();let pr=this.g.Z();if(!(3>Xe)&&(Xe!=3||this.g&&(this.h.h||this.g.oa()||b_(this.g)))){this.J||Xe!=4||h==7||(h==8||0>=pr?Ds(3):Ds(2)),$u(this);var f=this.g.Z();this.X=f;t:if(o_(this)){var g=b_(this.g);l="";var A=g.length,R=pn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ti(this),Ms(this);var F="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(R&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=f==200,Q0(this.i,this.u,this.A,this.l,this.R,Xe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var he,We=this.g;if((he=We.g?We.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(he)){var ae=he;break t}}ae=null}if(f=ae)hr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qu(this,f);else{this.o=!1,this.s=3,it(12),Ti(this),Ms(this);break e}}if(this.P){f=!0;let Dt;for(;!this.J&&this.C<F.length;)if(Dt=J0(this,F),Dt==zu){Xe==4&&(this.s=4,it(14),f=!1),hr(this.i,this.l,null,"[Incomplete Response]");break}else if(Dt==r_){this.s=4,it(15),hr(this.i,this.l,F,"[Invalid Chunk]"),f=!1;break}else hr(this.i,this.l,Dt,null),Qu(this,Dt);if(o_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xe!=4||F.length!=0||this.h.h||(this.s=1,it(16),f=!1),this.o=this.o&&f,!f)hr(this.i,this.l,F,"[Invalid Chunked Response]"),Ti(this),Ms(this);else if(0<F.length&&!this.W){this.W=!0;var Je=this.j;Je.g==this&&Je.ba&&!Je.M&&(Je.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),eh(Je),Je.M=!0,it(11))}}else hr(this.i,this.l,F,null),Qu(this,F);Xe==4&&Ti(this),this.o&&!this.J&&(Xe==4?D_(this.j,this):(this.o=!1,Ua(this)))}else pA(this.g),f==400&&0<F.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),Ti(this),Ms(this)}}}catch{}finally{}};function o_(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function J0(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?zu:(f=Number(h.substring(f,g)),isNaN(f)?r_:(g+=1,g+f>h.length?zu:(h=h.slice(g,g+f),l.C=g+f,h)))}Vn.prototype.cancel=function(){this.J=!0,Ti(this)};function Ua(l){l.S=Date.now()+l.I,a_(l,l.I)}function a_(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Vs(m(l.ba,l),h)}function $u(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Vn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(H0(this.i,this.A),this.L!=2&&(Ds(),it(17)),Ti(this),this.s=2,Ms(this)):a_(this,this.S-l)};function Ms(l){l.j.G==0||l.J||D_(l.j,l)}function Ti(l){$u(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,Hg(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Qu(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Hu(f.h,l))){if(!l.K&&Hu(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)$a(f),za(f);else break e;Zu(f),it(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=Vs(m(f.Za,f),6e3));if(1>=u_(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Ii(f,11)}else if((l.K||f.g==l)&&$a(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let Je=ae[3];Je!=null&&(f.la=Je,f.j.info("VER="+f.la));let Xe=ae[4];Xe!=null&&(f.Aa=Xe,f.j.info("SVER="+f.Aa));let pr=ae[5];pr!=null&&typeof pr=="number"&&0<pr&&(g=1.5*pr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Dt=l.g;if(Dt){let Ha=Dt.g?Dt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ha){var R=g.h;R.g||Ha.indexOf("spdy")==-1&&Ha.indexOf("quic")==-1&&Ha.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Yu(R,R.h),R.h=null))}if(g.D){let th=Dt.g?Dt.g.getResponseHeader("X-HTTP-Session-Id"):null;th&&(g.ya=th,ge(g.I,g.D,th))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var F=l;if(g.qa=M_(g,g.J?g.ia:null,g.W),F.K){h_(g.h,F);var he=F,We=g.L;We&&(he.I=We),he.B&&($u(he),Ua(he)),g.g=F}else N_(g);0<f.i.length&&Wa(f)}else ae[0]!="stop"&&ae[0]!="close"||Ii(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?Ii(f,7):Xu(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}Ds(4)}catch{}}var X0=class{constructor(l,h){this.g=l,this.map=h}};function l_(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function c_(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function u_(l){return l.h?1:l.g?l.g.size:0}function Hu(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Yu(l,h){l.g?l.g.add(h):l.h=h}function h_(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}l_.prototype.cancel=function(){if(this.i=d_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function d_(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return x(l.i)}function Z0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function eA(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function f_(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=eA(l),g=Z0(l),A=g.length,R=0;R<A;R++)h.call(void 0,g[R],f&&f[R],l)}var p_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tA(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),A=null;if(0<=g){var R=l[f].substring(0,g);A=l[f].substring(g+1)}else R=l[f];h(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Ei(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Ei){this.h=l.h,Ba(this,l.j),this.o=l.o,this.g=l.g,qa(this,l.s),this.l=l.l;var h=l.i,f=new Us;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),m_(this,f),this.m=l.m}else l&&(h=String(l).match(p_))?(this.h=!1,Ba(this,h[1]||"",!0),this.o=Fs(h[2]||""),this.g=Fs(h[3]||"",!0),qa(this,h[4]),this.l=Fs(h[5]||"",!0),m_(this,h[6]||"",!0),this.m=Fs(h[7]||"")):(this.h=!1,this.i=new Us(null,this.h))}Ei.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Ls(h,g_,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Ls(h,g_,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Ls(f,f.charAt(0)=="/"?rA:iA,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Ls(f,oA)),l.join("")};function fn(l){return new Ei(l)}function Ba(l,h,f){l.j=f?Fs(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function qa(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function m_(l,h,f){h instanceof Us?(l.i=h,aA(l.i,l.h)):(f||(h=Ls(h,sA)),l.i=new Us(h,l.h))}function ge(l,h,f){l.i.set(h,f)}function ja(l){return ge(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Fs(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ls(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,nA),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function nA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var g_=/[#\/\?@]/g,iA=/[#\?:]/g,rA=/[#\?]/g,sA=/[#\?@]/g,oA=/#/g;function Us(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function On(l){l.g||(l.g=new Map,l.h=0,l.i&&tA(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=Us.prototype,n.add=function(l,h){On(this),this.i=null,l=dr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function __(l,h){On(l),h=dr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function y_(l,h){return On(l),h=dr(l,h),l.g.has(h)}n.forEach=function(l,h){On(this),this.g.forEach(function(f,g){f.forEach(function(A){l.call(h,A,g,this)},this)},this)},n.na=function(){On(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let A=l[g];for(let R=0;R<A.length;R++)f.push(h[g])}return f},n.V=function(l){On(this);let h=[];if(typeof l=="string")y_(this,l)&&(h=h.concat(this.g.get(dr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return On(this),this.i=null,l=dr(this,l),y_(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function v_(l,h,f){__(l,h),0<f.length&&(l.i=null,l.g.set(dr(l,h),x(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let R=encodeURIComponent(String(g)),F=this.V(g);for(g=0;g<F.length;g++){var A=R;F[g]!==""&&(A+="="+encodeURIComponent(String(F[g]))),l.push(A)}}return this.i=l.join("&")};function dr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function aA(l,h){h&&!l.j&&(On(l),l.i=null,l.g.forEach(function(f,g){var A=g.toLowerCase();g!=A&&(__(this,g),v_(this,A,f))},l)),l.j=h}function lA(l,h){let f=new Os;if(a.Image){let g=new Image;g.onload=y(Mn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(Mn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(Mn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(Mn,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function cA(l,h){let f=new Os,g=new AbortController,A=setTimeout(()=>{g.abort(),Mn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(R=>{clearTimeout(A),R.ok?Mn(f,"TestPingServer: ok",!0,h):Mn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),Mn(f,"TestPingServer: error",!1,h)})}function Mn(l,h,f,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(f)}catch{}}function uA(){this.g=new W0}function hA(l,h,f){let g=f||"";try{f_(l,function(A,R){let F=A;u(A)&&(F=Bu(A)),h.push(g+R+"="+encodeURIComponent(F))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function Bs(l){this.l=l.Ub||null,this.j=l.eb||!1}C(Bs,qu),Bs.prototype.g=function(){return new Ga(this.l,this.j)},Bs.prototype.i=function(l){return function(){return l}}({});function Ga(l,h){Ye.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Ga,Ye),n=Ga.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,js(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qs(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,js(this)),this.g&&(this.readyState=3,js(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;w_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function w_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?qs(this):js(this),this.readyState==3&&w_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,qs(this))},n.Qa=function(l){this.g&&(this.response=l,qs(this))},n.ga=function(){this.g&&qs(this)};function qs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,js(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function js(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ga.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function T_(l){let h="";return Y(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Ju(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=T_(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):ge(l,h,f))}function Ie(l){Ye.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Ie,Ye);var dA=/^https?$/i,fA=["POST","PUT"];n=Ie.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ku.g(),this.v=this.o?Yg(this.o):Yg(Ku),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(R){E_(this,R);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)f.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let R of g.keys())f.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(fA,h,void 0))||g||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,F]of f)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{C_(this),this.u=!0,this.g.send(l),this.u=!1}catch(R){E_(this,R)}};function E_(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,I_(l),Ka(l)}function I_(l){l.A||(l.A=!0,nt(l,"complete"),nt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,nt(this,"complete"),nt(this,"abort"),Ka(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ka(this,!0)),Ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?A_(this):this.bb())},n.bb=function(){A_(this)};function A_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||pn(l)!=4||l.Z()!=2)){if(l.u&&pn(l)==4)Wg(l.Ea,0,l);else if(nt(l,"readystatechange"),pn(l)==4){l.h=!1;try{let F=l.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=F===0){var A=String(l.D).match(p_)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!dA.test(A?A.toLowerCase():"")}f=g}if(f)nt(l,"complete"),nt(l,"success");else{l.m=6;try{var R=2<pn(l)?l.g.statusText:""}catch{R=""}l.l=R+" ["+l.Z()+"]",I_(l)}}finally{Ka(l)}}}}function Ka(l,h){if(l.g){C_(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||nt(l,"ready");try{f.onreadystatechange=g}catch{}}}function C_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function pn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<pn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),z0(h)}};function b_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function pA(l){let h={};l=(l.g&&2<=pn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(j(l[g]))continue;var f=I(l[g]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let R=h[A]||[];h[A]=R,R.push(f)}T(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function S_(l){this.Aa=0,this.i=[],this.j=new Os,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gs("baseRetryDelayMs",5e3,l),this.cb=Gs("retryDelaySeedMs",1e4,l),this.Wa=Gs("forwardChannelMaxRetries",2,l),this.wa=Gs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new l_(l&&l.concurrentRequestLimit),this.Da=new uA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=S_.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){it(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=M_(this,null,this.W),Wa(this)};function Xu(l){if(R_(l),l.G==3){var h=l.U++,f=fn(l.I);if(ge(f,"SID",l.K),ge(f,"RID",h),ge(f,"TYPE","terminate"),Ks(l,f),h=new Vn(l,l.j,h),h.L=2,h.v=ja(fn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=F_(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ua(h)}O_(l)}function za(l){l.g&&(eh(l),l.g.cancel(),l.g=null)}function R_(l){za(l),l.u&&(a.clearTimeout(l.u),l.u=null),$a(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Wa(l){if(!c_(l.h)&&!l.s){l.s=!0;var h=l.Ga;Ss||Bg(),Rs||(Ss(),Rs=!0),Nu.add(h,l),l.B=0}}function mA(l,h){return u_(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Vs(m(l.Ga,l,h),V_(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new Vn(this,this.j,l),R=this.o;if(this.S&&(R?(R=_(R),E(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=x_(this,A,h),f=fn(this.I),ge(f,"RID",l),ge(f,"CVER",22),this.D&&ge(f,"X-HTTP-Session-Id",this.D),Ks(this,f),R&&(this.O?h="headers="+encodeURIComponent(String(T_(R)))+"&"+h:this.m&&Ju(f,this.m,R)),Yu(this.h,A),this.Ua&&ge(f,"TYPE","init"),this.P?(ge(f,"$req",h),ge(f,"SID","null"),A.T=!0,Wu(A,f,null)):Wu(A,f,h),this.G=2}}else this.G==3&&(l?P_(this,l):this.i.length==0||c_(this.h)||P_(this))};function P_(l,h){var f;h?f=h.l:f=l.U++;let g=fn(l.I);ge(g,"SID",l.K),ge(g,"RID",f),ge(g,"AID",l.T),Ks(l,g),l.m&&l.o&&Ju(g,l.m,l.o),f=new Vn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=x_(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Yu(l.h,f),Wu(f,g,h)}function Ks(l,h){l.H&&Y(l.H,function(f,g){ge(h,g,f)}),l.l&&f_({},function(f,g){ge(h,g,f)})}function x_(l,h,f){f=Math.min(l.i.length,f);var g=l.l?m(l.l.Na,l.l,l):null;e:{var A=l.i;let R=-1;for(;;){let F=["count="+f];R==-1?0<f?(R=A[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let he=!0;for(let We=0;We<f;We++){let ae=A[We].g,Je=A[We].map;if(ae-=R,0>ae)R=Math.max(0,A[We].g-100),he=!1;else try{hA(Je,F,"req"+ae+"_")}catch{g&&g(Je)}}if(he){g=F.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function N_(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Ss||Bg(),Rs||(Ss(),Rs=!0),Nu.add(h,l),l.v=0}}function Zu(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Vs(m(l.Fa,l),V_(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,k_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Vs(m(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,it(10),za(this),k_(this))};function eh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function k_(l){l.g=new Vn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=fn(l.qa);ge(h,"RID","rpc"),ge(h,"SID",l.K),ge(h,"AID",l.T),ge(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&ge(h,"TO",l.ja),ge(h,"TYPE","xmlhttp"),Ks(l,h),l.m&&l.o&&Ju(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=ja(fn(h)),f.m=null,f.P=!0,s_(f,l)}n.Za=function(){this.C!=null&&(this.C=null,za(this),Zu(this),it(19))};function $a(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function D_(l,h){var f=null;if(l.g==h){$a(l),eh(l),l.g=null;var g=2}else if(Hu(l.h,h))f=h.D,h_(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=Ma(),nt(g,new t_(g,f)),Wa(l)}else N_(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&mA(l,h)||g==2&&Zu(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:Ii(l,5);break;case 4:Ii(l,10);break;case 3:Ii(l,6);break;default:Ii(l,2)}}}function V_(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Ii(l,h){if(l.j.info("Error code "+h),h==2){var f=m(l.fb,l),g=l.Xa;let A=!g;g=new Ei(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ba(g,"https"),ja(g),A?lA(g.toString(),f):cA(g.toString(),f)}else it(2);l.G=0,l.l&&l.l.sa(h),O_(l),R_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),it(2)):(this.j.info("Failed to ping google.com"),it(1))};function O_(l){if(l.G=0,l.ka=[],l.l){let h=d_(l.h);(h.length!=0||l.i.length!=0)&&(k(l.ka,h),k(l.ka,l.i),l.h.i.length=0,x(l.i),l.i.length=0),l.l.ra()}}function M_(l,h,f){var g=f instanceof Ei?fn(f):new Ei(f);if(g.g!="")h&&(g.g=h+"."+g.g),qa(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var R=new Ei(null);g&&Ba(R,g),h&&(R.g=h),A&&qa(R,A),f&&(R.l=f),g=R}return f=l.D,h=l.ya,f&&h&&ge(g,f,h),ge(g,"VER",l.la),Ks(l,g),g}function F_(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ie(new Bs({eb:f})):new Ie(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function L_(){}n=L_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Qa(){}Qa.prototype.g=function(l,h){return new ft(l,h)};function ft(l,h){Ye.call(this),this.g=new S_(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new fr(this)}C(ft,Ye),ft.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ft.prototype.close=function(){Xu(this.g)},ft.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=Bu(l),l=f);h.i.push(new X0(h.Ya++,l)),h.G==3&&Wa(h)},ft.prototype.N=function(){this.g.l=null,delete this.j,Xu(this.g),delete this.g,ft.aa.N.call(this)};function U_(l){ju.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(U_,ju);function B_(){Gu.call(this),this.status=1}C(B_,Gu);function fr(l){this.g=l}C(fr,L_),fr.prototype.ua=function(){nt(this.g,"a")},fr.prototype.ta=function(l){nt(this.g,new U_(l))},fr.prototype.sa=function(l){nt(this.g,new B_)},fr.prototype.ra=function(){nt(this.g,"b")},Qa.prototype.createWebChannel=Qa.prototype.g,ft.prototype.send=ft.prototype.o,ft.prototype.open=ft.prototype.m,ft.prototype.close=ft.prototype.close,Lh=Tn.createWebChannelTransport=function(){return new Qa},Fh=Tn.getStatEventTarget=function(){return Ma()},Mh=Tn.Event=wi,gl=Tn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fa.NO_ERROR=0,Fa.TIMEOUT=8,Fa.HTTP_ERROR=6,fo=Tn.ErrorCode=Fa,n_.COMPLETE="complete",Oh=Tn.EventType=n_,Jg.EventType=ks,ks.OPEN="a",ks.CLOSE="b",ks.ERROR="c",ks.MESSAGE="d",Ye.prototype.listen=Ye.prototype.K,Tr=Tn.WebChannel=Jg,tC=Tn.FetchXmlHttpFactory=Bs,Ie.prototype.listenOnce=Ie.prototype.L,Ie.prototype.getLastError=Ie.prototype.Ka,Ie.prototype.getLastErrorCode=Ie.prototype.Ba,Ie.prototype.getStatus=Ie.prototype.Z,Ie.prototype.getResponseJson=Ie.prototype.Oa,Ie.prototype.getResponseText=Ie.prototype.oa,Ie.prototype.send=Ie.prototype.ea,Ie.prototype.setWithCredentials=Ie.prototype.Ha,Vh=Tn.XhrIo=Ie}).apply(typeof ml<"u"?ml:typeof self<"u"?self:typeof window<"u"?window:{});var Ny="@firebase/firestore";var Oe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");var Xr="10.14.0";var Xn=new qn("@firebase/firestore");function br(){return Xn.logLevel}function Vv(n){Xn.setLogLevel(n)}function V(n,...e){if(Xn.logLevel<=bt.DEBUG){let t=e.map(Kf);Xn.debug(`Firestore (${Xr}): ${n}`,...t)}}function Se(n,...e){if(Xn.logLevel<=bt.ERROR){let t=e.map(Kf);Xn.error(`Firestore (${Xr}): ${n}`,...t)}}function Lt(n,...e){if(Xn.logLevel<=bt.WARN){let t=e.map(Kf);Xn.warn(`Firestore (${Xr}): ${n}`,...t)}}function Kf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${Xr}) INTERNAL ASSERTION FAILED: `+n;throw Se(e),new Error(e)}function G(n,e){n||B()}function Ov(n,e){n||B()}function L(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends sy{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Be=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var bl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Kh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Oe.UNAUTHENTICATED))}shutdown(){}},zh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Wh=class{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let i=this.i,r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve(),s=new Be;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Be,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>N(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Be)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(G(typeof i.accessToken=="string"),new bl(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Oe(e)}},$h=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Qh=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new $h(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Oe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Hh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Yh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let i=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new Hh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function iC(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var Sl=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="";for(;i.length<20;){let r=iC(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}};function Q(n,e){return n<e?-1:n>e?1:0}function Or(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function Mv(n){return n+"\0"}var we=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new we(0,0))}static max(){return new n(new we(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Rl=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&B(),i===void 0?i=e.length-t:i>e.length-t&&B(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends Rl{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},rC=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Re=class n extends Rl{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return rC.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new D(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new D(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Mr=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};function Jh(n){return n.fields.find(e=>e.kind===2)}function Ni(n){return n.fields.filter(e=>e.kind!==2)}Mr.UNKNOWN_ID=-1;var kr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Co=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Rt.min())}};function Fv(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=z.fromTimestamp(i===1e9?new we(t+1,0):new we(t,i));return new Rt(r,U.empty(),e)}function Lv(n){return new Rt(n.readTime,n.key,-1)}var Rt=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(z.min(),U.empty(),-1)}static max(){return new n(z.max(),U.empty(),-1)}};function zf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var Uv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Pl=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function li(n){return N(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==Uv)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var S=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var xl=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Be,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Fi(e,t.error)):this.V.resolve()},this.transaction.onerror=i=>{let r=Wf(i.target.error);this.V.reject(new Fi(e,r))}}static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new Fi(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Zh(t)}},Zn=class n{constructor(e,t,i){this.name=e,this.version=t,this.p=i,n.S(Zs())===12.2&&Se("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),ki(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!al())return!1;if(n.v())return!0;let e=Zs(),t=n.S(e),i=0<t&&t<10,r=Bv(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}M(e){return N(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new Fi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new D(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new D(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Fi(e,o))},r.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,r.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return N(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=xl.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),S.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Bv(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Xh=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ki(this.B.delete())}},Fi=class extends D{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ci(n){return n.name==="IndexedDbTransactionError"}var Zh=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),ki(i)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),ki(this.store.add(e))}get(e){return ki(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),ki(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),ki(this.store.count())}U(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new S((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(i),o=[];return this.W(s,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new S((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let i=this.options(e,t);i.H=!1;let r=this.cursor(i);return this.W(r,(s,o,a)=>a.delete())}J(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.W(r,t)}Y(e){let t=this.cursor({});return new S((i,r)=>{t.onerror=s=>{let o=Wf(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}W(e,t){let i=[];return new S((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let c=new Xh(a),u=t(a.primaryKey,a.value,c);if(u instanceof S){let d=u.catch(p=>(c.done(),S.reject(p)));i.push(d)}c.isDone?r():c.K===null?a.continue():a.continue(c.K)}}).next(()=>S.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.H?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ki(n){return new S((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=Wf(i.target.error);t(r)}})}var ky=!1;function Wf(n){let e=Zn.S(Zs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ky||(ky=!0,setTimeout(()=>{throw i},0)),i}}return n}var ed=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ci(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield li(t)}yield this.X(6e4)}))}},td=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let i=new Set,r=t,s=!0;return S.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}ne(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=Lv(s);zf(o,i)>0&&(i=o)}),new Rt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var _t=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ie(r),this.se=r=>i.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Wo(n){return n==null}function bo(n){return n===0&&1/n==-1/0}function qv(n){return typeof n=="number"&&Number.isInteger(n)&&!bo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function st(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dy(e)),e=sC(n.get(t),e);return Dy(e)}function sC(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Dy(n){return n+""}function Yt(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),se.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:B()}s=o+2}return new se(i)}var Vy=["userId","batchId"];function Tl(n,e){return[n,st(e)]}function jv(n,e,t){return[n,st(e),t]}var oC={},aC=["prefixPath","collectionGroup","readTime","documentId"],lC=["prefixPath","collectionGroup","documentId"],cC=["collectionGroup","readTime","prefixPath","documentId"],uC=["canonicalId","targetId"],hC=["targetId","path"],dC=["path","targetId"],fC=["collectionId","parent"],pC=["indexId","uid"],mC=["uid","sequenceNumber"],gC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],_C=["indexId","uid","orderedDocumentKey"],yC=["userId","collectionPath","documentId"],vC=["userId","collectionPath","largestBatchId"],wC=["userId","collectionGroup","largestBatchId"],Gv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],TC=[...Gv,"documentOverlays"],Kv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],zv=Kv,$f=[...zv,"indexConfiguration","indexState","indexEntries"],EC=$f,IC=[...$f,"globals"];var So=class extends Pl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function qe(n,e){let t=L(n);return Zn.F(t._e,e)}function Oy(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Wv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||Xt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nr(this.root,e,this.comparator,!0)}},Nr=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Xt=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};Xt.EMPTY=null,Xt.RED=!0,Xt.BLACK=!1;Xt.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,i,r,s){return this}insert(e,t,i){return new Xt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var de=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Nl(this.data.getIterator())}getIteratorFrom(e){return new Nl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Nl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Er(n){return n.hasNext()?n.getNext():void 0}var yt=class n{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new n([])}unionWith(e){let t=new de(Re.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Or(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var kl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function $v(){return typeof atob<"u"}var xe=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new kl("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};xe.EMPTY_BYTE_STRING=new xe("");var AC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function An(n){if(G(!!n),typeof n=="string"){let e=0,t=AC.exec(n);if(G(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ei(n){return typeof n=="string"?xe.fromBase64String(n):xe.fromUint8Array(n)}function Ic(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Qf(n){let e=n.mapValue.fields.__previous_value__;return Ic(e)?Qf(e):e}function Ro(n){let e=An(n.mapValue.fields.__local_write_time__.timestampValue);return new we(e.seconds,e.nanos)}var nd=class{constructor(e,t,i,r,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},ti=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Yn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},El={nullValue:"NULL_VALUE"};function Li(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ic(n)?4:Qv(n)?9007199254740991:Ac(n)?10:11:B()}function tn(n,e){if(n===e)return!0;let t=Li(n);if(t!==Li(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ro(n).isEqual(Ro(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=An(r.timestampValue),a=An(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return ei(r.bytesValue).isEqual(ei(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ye(r.geoPointValue.latitude)===ye(s.geoPointValue.latitude)&&ye(r.geoPointValue.longitude)===ye(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ye(r.integerValue)===ye(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=ye(r.doubleValue),a=ye(s.doubleValue);return o===a?bo(o)===bo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Or(n.arrayValue.values||[],e.arrayValue.values||[],tn);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(Oy(o)!==Oy(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!tn(o[c],a[c])))return!1;return!0}(n,e);default:return B()}}function Po(n,e){return(n.values||[]).find(t=>tn(t,e))!==void 0}function ni(n,e){if(n===e)return 0;let t=Li(n),i=Li(e);if(t!==i)return Q(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ye(s.integerValue||s.doubleValue),c=ye(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return My(n.timestampValue,e.timestampValue);case 4:return My(Ro(n),Ro(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let a=ei(s),c=ei(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=Q(a[u],c[u]);if(d!==0)return d}return Q(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Q(ye(s.latitude),ye(o.latitude));return a!==0?a:Q(ye(s.longitude),ye(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Fy(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,u,d;let p=s.fields||{},m=o.fields||{},y=(a=p.value)===null||a===void 0?void 0:a.arrayValue,C=(c=m.value)===null||c===void 0?void 0:c.arrayValue,x=Q(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=C?.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:Fy(y,C)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Yn.mapValue&&o===Yn.mapValue)return 0;if(s===Yn.mapValue)return 1;if(o===Yn.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let m=Q(c[p],d[p]);if(m!==0)return m;let y=ni(a[c[p]],u[d[p]]);if(y!==0)return y}return Q(c.length,d.length)}(n.mapValue,e.mapValue);default:throw B()}}function My(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=An(n),i=An(e),r=Q(t.seconds,i.seconds);return r!==0?r:Q(t.nanos,i.nanos)}function Fy(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=ni(t[r],i[r]);if(s)return s}return Q(t.length,i.length)}function Fr(n){return id(n)}function id(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=An(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ei(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=id(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${id(t.fields[o])}`;return r+"}"}(n.mapValue):B()}function Ui(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function rd(n){return!!n&&"integerValue"in n}function xo(n){return!!n&&"arrayValue"in n}function Ly(n){return!!n&&"nullValue"in n}function Uy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Il(n){return!!n&&"mapValue"in n}function Ac(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function wo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Hi(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=wo(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Qv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Hv={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function CC(n){return"nullValue"in n?El:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ui(ti.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ac(n)?Hv:{mapValue:{}}:B()}function bC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ui(ti.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Hv:"mapValue"in n?Ac(n)?{mapValue:{}}:Yn:B()}function By(n,e){let t=ni(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function qy(n,e){let t=ni(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var et=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Il(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wo(t)}setAll(e){let t=Re.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=wo(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());Il(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Il(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Hi(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(wo(this.value))}};function Yv(n){let e=[];return Hi(n.fields,(t,i)=>{let r=new Re([t]);if(Il(i)){let s=Yv(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new yt(e)}var Me=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),et.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,z.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),et.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var nn=class{constructor(e,t){this.position=e,this.inclusive=t}};function jy(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=U.comparator(U.fromName(o.referenceValue),t.key):i=ni(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function Gy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!tn(n.position[t],e.position[t]))return!1;return!0}var Bi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function SC(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Dl=class{},ie=class n extends Dl{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new ad(e,t,i):t==="array-contains"?new ud(e,i):t==="in"?new Vl(e,i):t==="not-in"?new hd(e,i):t==="array-contains-any"?new dd(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new ld(e,i):new cd(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ni(t,this.value)):t!==null&&Li(this.value)===Li(t)&&this.matchesComparison(ni(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends Dl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Lr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Lr(n){return n.op==="and"}function sd(n){return n.op==="or"}function Hf(n){return Jv(n)&&Lr(n)}function Jv(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function od(n){if(n instanceof ie)return n.field.canonicalString()+n.op.toString()+Fr(n.value);if(Hf(n))return n.filters.map(e=>od(e)).join(",");{let e=n.filters.map(t=>od(t)).join(",");return`${n.op}(${e})`}}function Xv(n,e){return n instanceof ie?function(i,r){return r instanceof ie&&i.op===r.op&&i.field.isEqual(r.field)&&tn(i.value,r.value)}(n,e):n instanceof ue?function(i,r){return r instanceof ue&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&Xv(o,r.filters[a]),!0):!1}(n,e):void B()}function Zv(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function ew(n){return n instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${Fr(t.value)}`}(n):n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(ew).join(" ,")+"}"}(n):"Filter"}var ad=class extends ie{constructor(e,t,i){super(e,t,i),this.key=U.fromName(i.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},ld=class extends ie{constructor(e,t){super(e,"in",t),this.keys=tw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},cd=class extends ie{constructor(e,t){super(e,"not-in",t),this.keys=tw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function tw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>U.fromName(i.referenceValue))}var ud=class extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return xo(t)&&Po(t.arrayValue,this.value)}},Vl=class extends ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Po(this.value.arrayValue,t)}},hd=class extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(Po(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Po(this.value.arrayValue,t)}},dd=class extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!xo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Po(this.value.arrayValue,i))}};var fd=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function pd(n,e=null,t=[],i=[],r=null,s=null,o=null){return new fd(n,e,t,i,r,s,o)}function qi(n){let e=L(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>od(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Wo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Fr(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Fr(i)).join(",")),e.ue=t}return e.ue}function $o(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!SC(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Xv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Gy(n.startAt,e.startAt)&&Gy(n.endAt,e.endAt)}function Ol(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ml(n,e){return n.filters.filter(t=>t instanceof ie&&t.field.isEqual(e))}function Ky(n,e,t){let i=El,r=!0;for(let s of Ml(n,e)){let o=El,a=!0;switch(s.op){case"<":case"<=":o=CC(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=El}By({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];By({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function zy(n,e,t){let i=Yn,r=!0;for(let s of Ml(n,e)){let o=Yn,a=!0;switch(s.op){case">=":case">":o=bC(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Yn}qy({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];qy({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}var Ut=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function nw(n,e,t,i,r,s,o,a){return new Ut(n,e,t,i,r,s,o,a)}function Zr(n){return new Ut(n)}function Wy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Yf(n){return n.collectionGroup!==null}function Dr(n){let e=L(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new de(Re.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Bi(s,i))}),t.has(Re.keyField().canonicalString())||e.ce.push(new Bi(Re.keyField(),i))}return e.ce}function ot(n){let e=L(n);return e.le||(e.le=RC(e,Dr(n))),e.le}function RC(n,e){if(n.limitType==="F")return pd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Bi(r.field,s)});let t=n.endAt?new nn(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new nn(n.startAt.position,n.startAt.inclusive):null;return pd(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function md(n,e){let t=n.filters.concat([e]);return new Ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Fl(n,e,t){return new Ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Qo(n,e){return $o(ot(n),ot(e))&&n.limitType===e.limitType}function iw(n){return`${qi(ot(n))}|lt:${n.limitType}`}function Sr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>ew(r)).join(", ")}]`),Wo(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Fr(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Fr(r)).join(",")),`Target(${i})`}(ot(n))}; limitType=${n.limitType})`}function Ho(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):U.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of Dr(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,c){let u=jy(o,a,c);return o.inclusive?u<=0:u<0}(i.startAt,Dr(i),r)||i.endAt&&!function(o,a,c){let u=jy(o,a,c);return o.inclusive?u>=0:u>0}(i.endAt,Dr(i),r))}(n,e)}function rw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sw(n){return(e,t)=>{let i=!1;for(let r of Dr(n)){let s=PC(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function PC(n,e,t){let i=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?ni(c,u):B()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return B()}}var rn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Hi(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return Wv(this.inner)}size(){return this.innerSize}};var xC=new _e(U.comparator);function dt(){return xC}var ow=new _e(U.comparator);function yo(...n){let e=ow;for(let t of n)e=e.insert(t.key,t);return e}function aw(n){let e=ow;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Jt(){return To()}function lw(){return To()}function To(){return new rn(n=>n.toString(),(n,e)=>n.isEqual(e))}var NC=new _e(U.comparator),kC=new de(U.comparator);function X(...n){let e=kC;for(let t of n)e=e.add(t);return e}var DC=new de(Q);function Jf(){return DC}function Xf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bo(e)?"-0":e}}function cw(n){return{integerValue:""+n}}function uw(n,e){return qv(e)?cw(e):Xf(n,e)}var Ur=class{constructor(){this._=void 0}};function VC(n,e,t){return n instanceof ii?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&Ic(s)&&(s=Qf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Cn?dw(n,e):n instanceof bn?fw(n,e):function(r,s){let o=hw(r,s),a=$y(o)+$y(r.Pe);return rd(o)&&rd(r.Pe)?cw(a):Xf(r.serializer,a)}(n,e)}function OC(n,e,t){return n instanceof Cn?dw(n,e):n instanceof bn?fw(n,e):t}function hw(n,e){return n instanceof ri?function(i){return rd(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var ii=class extends Ur{},Cn=class extends Ur{constructor(e){super(),this.elements=e}};function dw(n,e){let t=pw(e);for(let i of n.elements)t.some(r=>tn(r,i))||t.push(i);return{arrayValue:{values:t}}}var bn=class extends Ur{constructor(e){super(),this.elements=e}};function fw(n,e){let t=pw(e);for(let i of n.elements)t=t.filter(r=>!tn(r,i));return{arrayValue:{values:t}}}var ri=class extends Ur{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function $y(n){return ye(n.integerValue||n.doubleValue)}function pw(n){return xo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var ji=class{constructor(e,t){this.field=e,this.transform=t}};function MC(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Cn&&r instanceof Cn||i instanceof bn&&r instanceof bn?Or(i.elements,r.elements,tn):i instanceof ri&&r instanceof ri?tn(i.Pe,r.Pe):i instanceof ii&&r instanceof ii}(n.transform,e.transform)}var gd=class{constructor(e,t){this.version=e,this.transformResults=t}},Ce=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Al(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Br=class{};function mw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new oi(n.key,Ce.none()):new si(n.key,n.data,Ce.none());{let t=n.data,i=et.empty(),r=new de(Re.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Bt(n.key,i,new yt(r.toArray()),Ce.none())}}function FC(n,e,t){n instanceof si?function(r,s,o){let a=r.value.clone(),c=Hy(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Bt?function(r,s,o){if(!Al(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Hy(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(gw(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Eo(n,e,t,i){return n instanceof si?function(s,o,a,c){if(!Al(s.precondition,o))return a;let u=s.value.clone(),d=Yy(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Bt?function(s,o,a,c){if(!Al(s.precondition,o))return a;let u=Yy(s.fieldTransforms,c,o),d=o.data;return d.setAll(gw(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,i):function(s,o,a){return Al(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function LC(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=hw(i.transform,r||null);s!=null&&(t===null&&(t=et.empty()),t.set(i.field,s))}return t||null}function Qy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Or(i,r,(s,o)=>MC(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var si=class extends Br{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Bt=class extends Br{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function gw(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function Hy(n,e,t){let i=new Map;G(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,OC(o,a,t[r]))}return i}function Yy(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,VC(s,o,e))}return i}var oi=class extends Br{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},No=class extends Br{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ko=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&FC(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=Eo(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=Eo(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=lw();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let c=mw(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(z.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&Or(this.mutations,e.mutations,(t,i)=>Qy(t,i))&&Or(this.baseMutations,e.baseMutations,(t,i)=>Qy(t,i))}},_d=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){G(e.mutations.length===i.length);let r=function(){return NC}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var Do=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var yd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var De,re;function _w(n){switch(n){default:return B();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function yw(n){if(n===void 0)return Se("GRPC error has no .code"),P.UNKNOWN;switch(n){case De.OK:return P.OK;case De.CANCELLED:return P.CANCELLED;case De.UNKNOWN:return P.UNKNOWN;case De.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case De.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case De.INTERNAL:return P.INTERNAL;case De.UNAVAILABLE:return P.UNAVAILABLE;case De.UNAUTHENTICATED:return P.UNAUTHENTICATED;case De.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case De.NOT_FOUND:return P.NOT_FOUND;case De.ALREADY_EXISTS:return P.ALREADY_EXISTS;case De.PERMISSION_DENIED:return P.PERMISSION_DENIED;case De.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case De.ABORTED:return P.ABORTED;case De.OUT_OF_RANGE:return P.OUT_OF_RANGE;case De.UNIMPLEMENTED:return P.UNIMPLEMENTED;case De.DATA_LOSS:return P.DATA_LOSS;default:return B()}}(re=De||(De={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";var Jy=null;function vw(){return new TextEncoder}var UC=new zn([4294967295,4294967295],0);function Xy(n){let e=vw().encode(n),t=new Dh;return t.update(e),new Uint8Array(t.digest())}function Zy(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new zn([t,i],0),new zn([r,s],0)]}var vd=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Mi(`Invalid padding: ${t}`);if(i<0)throw new Mi(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Mi(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Mi(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=zn.fromNumber(this.Ie)}Ee(e,t,i){let r=e.add(t.multiply(zn.fromNumber(i)));return r.compare(UC)===1&&(r=new zn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Xy(e),[i,r]=Zy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);if(!this.de(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=Xy(e),[i,r]=Zy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Mi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vo=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,Oo.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(z.min(),r,new _e(Q),dt(),X())}},Oo=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,X(),X(),X())}};var Vr=class{constructor(e,t,i,r){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=r}},Ll=class{constructor(e,t){this.targetId=e,this.me=t}},Ul=class{constructor(e,t,i=xe.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},Bl=class{constructor(){this.fe=0,this.ge=tv(),this.pe=xe.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),i=X();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:B()}}),new Oo(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=tv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},wd=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=dt(),this.qe=ev(),this.Qe=new _e(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((i,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,i=e.me.count,r=this.Je(t);if(r){let s=r.target;if(Ol(s))if(i===0){let o=new U(s.path);this.Ue(t,o,Me.newNoDocument(o,z.min()))}else G(i===1);else{let o=this.Ye(t);if(o!==i){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}Jy?.et(function(d,p,m,y,C){var x,k,q,j,M,W;let H={localCacheCount:d,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},Y=p.unchangedNames;return Y&&(H.bloomFilter={applied:C===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=(q=(k=Y?.bits)===null||k===void 0?void 0:k.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(W=(M=Y?.bits)===null||M===void 0?void 0:M.padding)!==null&&W!==void 0?W:0,mightContain:T=>{var _;return(_=y?.mightContain(T))!==null&&_!==void 0&&_}}),H}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=ei(i).toUint8Array()}catch(c){if(c instanceof kl)return Lt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new vd(o,r,s)}catch(c){return Lt(c instanceof Mi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){let i=this.Le.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Ol(a.target)){let c=new U(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Me.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let i=X();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new Vo(e,t,this.Qe,this.ke,i);return this.ke=dt(),this.qe=ev(),this.Qe=new _e(Q),r}$e(e,t){if(!this.ze(e))return;let i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Bl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new de(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Bl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function ev(){return new _e(U.comparator)}function tv(){return new _e(U.comparator)}var BC={asc:"ASCENDING",desc:"DESCENDING"},qC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jC={and:"AND",or:"OR"},Td=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Ed(n,e){return n.useProto3Json||Wo(e)?e:{value:e}}function qr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ww(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function GC(n,e){return qr(n,e.toTimestamp())}function Pe(n){return G(!!n),z.fromTimestamp(function(t){let i=An(t);return new we(i.seconds,i.nanos)}(n))}function Zf(n,e){return Id(n,e).canonicalString()}function Id(n,e){let t=function(r){return new se(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Tw(n){let e=se.fromString(n);return G(Nw(e)),e}function Mo(n,e){return Zf(n.databaseId,e.path)}function Zt(n,e){let t=Tw(e);if(t.get(1)!==n.databaseId.projectId)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(Aw(t))}function Ew(n,e){return Zf(n.databaseId,e)}function Iw(n){let e=Tw(n);return e.length===4?se.emptyPath():Aw(e)}function Ad(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Aw(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function nv(n,e,t){return{name:Mo(n,e),fields:t.value.mapValue.fields}}function Cw(n,e,t){let i=Zt(n,e.name),r=Pe(e.updateTime),s=e.createTime?Pe(e.createTime):z.min(),o=new et({mapValue:{fields:e.fields}}),a=Me.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function KC(n,e){return"found"in e?function(i,r){G(!!r.found),r.found.name,r.found.updateTime;let s=Zt(i,r.found.name),o=Pe(r.found.updateTime),a=r.found.createTime?Pe(r.found.createTime):z.min(),c=new et({mapValue:{fields:r.found.fields}});return Me.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(i,r){G(!!r.missing),G(!!r.readTime);let s=Zt(i,r.missing),o=Pe(r.readTime);return Me.newNoDocument(s,o)}(n,e):B()}function zC(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(G(d===void 0||typeof d=="string"),xe.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),xe.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?P.UNKNOWN:yw(u.code);return new D(d,u.message||"")}(o);t=new Ul(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=Zt(n,i.document.name),s=Pe(i.document.updateTime),o=i.document.createTime?Pe(i.document.createTime):z.min(),a=new et({mapValue:{fields:i.document.fields}}),c=Me.newFoundDocument(r,s,o,a),u=i.targetIds||[],d=i.removedTargetIds||[];t=new Vr(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=Zt(n,i.document),s=i.readTime?Pe(i.readTime):z.min(),o=Me.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Vr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=Zt(n,i.document),s=i.removedTargetIds||[];t=new Vr([],s,r,null)}else{if(!("filter"in e))return B();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new yd(r,s),a=i.targetId;t=new Ll(a,o)}}return t}function Fo(n,e){let t;if(e instanceof si)t={update:nv(n,e.key,e.value)};else if(e instanceof oi)t={delete:Mo(n,e.key)};else if(e instanceof Bt)t={update:nv(n,e.key,e.data),updateMask:JC(e.fieldMask)};else{if(!(e instanceof No))return B();t={verify:Mo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof ii)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Cn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof bn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ri)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw B()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:GC(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function Cd(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Ce.updateTime(Pe(s.updateTime)):s.exists!==void 0?Ce.exists(s.exists):Ce.none()}(e.currentDocument):Ce.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(o,a){let c=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),c=new ii;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new Cn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new bn(d)}else"increment"in a?c=new ri(o,a.increment):B();let u=Re.fromServerFormat(a.fieldPath);return new ji(u,c)}(n,r)):[];if(e.update){e.update.name;let r=Zt(n,e.update.name),s=new et({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new yt(u.map(d=>Re.fromServerFormat(d)))}(e.updateMask);return new Bt(r,s,o,t,i)}return new si(r,s,t,i)}if(e.delete){let r=Zt(n,e.delete);return new oi(r,t)}if(e.verify){let r=Zt(n,e.verify);return new No(r,t)}return B()}function WC(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?Pe(r.updateTime):Pe(s);return o.isEqual(z.min())&&(o=Pe(s)),new gd(o,r.transformResults||[])}(t,e))):[]}function bw(n,e){return{documents:[Ew(n,e.path)]}}function Sw(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=Ew(n,r);let s=function(u){if(u.length!==0)return xw(ue.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:Rr(m.field),direction:QC(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Ed(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:r}}function Rw(n){let e=Iw(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){G(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(p){let m=Pw(p);return m instanceof ue&&Hf(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(C){return new Bi(Pr(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,Wo(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(p){let m=!!p.before,y=p.values||[];return new nn(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(p){let m=!p.before,y=p.values||[];return new nn(y,m)}(t.endAt)),nw(e,r,o,s,a,"F",c,u)}function $C(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pw(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=Pr(t.unaryFilter.field);return ie.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Pr(t.unaryFilter.field);return ie.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Pr(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Pr(t.unaryFilter.field);return ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return ie.create(Pr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(i=>Pw(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function QC(n){return BC[n]}function HC(n){return qC[n]}function YC(n){return jC[n]}function Rr(n){return{fieldPath:n.canonicalString()}}function Pr(n){return Re.fromServerFormat(n.fieldPath)}function xw(n){return n instanceof ie?function(t){if(t.op==="=="){if(Uy(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NAN"}};if(Ly(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Uy(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NOT_NAN"}};if(Ly(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rr(t.field),op:HC(t.op),value:t.value}}}(n):n instanceof ue?function(t){let i=t.getFilters().map(r=>xw(r));return i.length===1?i[0]:{compositeFilter:{op:YC(t.op),filters:i}}}(n):B()}function JC(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Nw(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var jr=class n{constructor(e,t,i,r,s=z.min(),o=z.min(),a=xe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var ql=class{constructor(e){this.ct=e}};function XC(n,e){let t;if(e.document)t=Cw(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=U.fromSegments(e.noDocument.path),r=Ki(e.noDocument.readTime);t=Me.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{let i=U.fromSegments(e.unknownDocument.path),r=Ki(e.unknownDocument.version);t=Me.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){let s=new we(r[0],r[1]);return z.fromTimestamp(s)}(e.readTime)),t}function iv(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:jl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,o){return{name:Mo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:qr(s,o.version.toTimestamp()),createTime:qr(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Gi(e.version)};else{if(!e.isUnknownDocument())return B();i.unknownDocument={path:t.path.toArray(),version:Gi(e.version)}}return i}function jl(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Gi(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ki(n){let e=new we(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function Di(n,e){let t=(e.baseMutations||[]).map(s=>Cd(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>Cd(n.ct,s)),r=we.fromMillis(e.localWriteTimeMs);return new ko(e.batchId,r,t,i)}function vo(n){let e=Ki(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ki(n.lastLimboFreeSnapshotVersion):z.min(),i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),ot(Zr(Iw(s.documents[0])))}(n.query):function(s){return ot(Rw(s))}(n.query),new jr(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,xe.fromBase64String(n.resumeToken))}function kw(n,e){let t=Gi(e.snapshotVersion),i=Gi(e.lastLimboFreeSnapshotVersion),r;r=Ol(e.target)?bw(n.ct,e.target):Sw(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ep(n){let e=Rw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fl(e,e.limit,"L"):e}function Uh(n,e){return new Do(e.largestBatchId,Cd(n.ct,e.overlayMutation))}function rv(n,e){let t=e.path.lastSegment();return[n,st(e.path.popLast()),t]}function sv(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Gi(i.readTime),documentKey:st(i.documentKey.path),largestBatchId:i.largestBatchId}}var bd=class{getBundleMetadata(e,t){return ov(e).get(t).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:Ki(s.createTime),version:s.version}}(i)})}saveBundleMetadata(e,t){return ov(e).put(function(r){return{bundleId:r.id,createTime:Gi(Pe(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return av(e).get(t).next(i=>{if(i)return function(s){return{name:s.name,query:ep(s.bundledQuery),readTime:Ki(s.readTime)}}(i)})}saveNamedQuery(e,t){return av(e).put(function(r){return{name:r.name,readTime:Gi(Pe(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function ov(n){return qe(n,"bundles")}function av(n){return qe(n,"namedQueries")}var Gl=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return po(e).get(rv(this.userId,t)).next(i=>i?Uh(this.serializer,i):null)}getOverlays(e,t){let i=Jt();return S.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new Do(t,o);r.push(this.ht(e,a))}),S.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(st(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(po(e).j("collectionPathOverlayIndex",a))}),S.waitFor(s)}getOverlaysForCollection(e,t,i){let r=Jt(),s=st(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return po(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=Uh(this.serializer,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=Jt(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return po(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let p=Uh(this.serializer,u);s.size()<r||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return po(e).put(function(r,s,o){let[a,c,u]=rv(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Fo(r.ct,o.mutation)}}(this.serializer,this.userId,t))}};function po(n){return qe(n,"documentOverlays")}var Sd=class{Pt(e){return qe(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let i=t?.value;return i?xe.fromUint8Array(i):xe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var En=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ye(e.integerValue));else if("doubleValue"in e){let i=ye(e.doubleValue);isNaN(i)?this.dt(t,13):(this.dt(t,15),bo(i)?t.At(0):t.At(i))}else if("timestampValue"in e){let i=e.timestampValue;this.dt(t,20),typeof i=="string"&&(i=An(i)),t.Rt(`${i.seconds||""}`),t.At(i.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ei(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.dt(t,45),t.At(i.latitude||0),t.At(i.longitude||0)}else"mapValue"in e?Qv(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ac(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let i=e.fields||{};this.dt(t,55);for(let r of Object.keys(i))this.Vt(r,t),this.Tt(i[r],t)}wt(e,t){var i,r;let s=e.fields||{};this.dt(t,53);let o="value",a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(ye(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let i=e.values||[];this.dt(t,50);for(let r of i)this.Tt(r,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(i=>{this.dt(t,60),this.Dt(i,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};En.vt=new En;function ZC(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function lv(n){let e=64-function(i){let r=0;for(let s=0;s<8;++s){let o=ZC(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}var Rd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Ft(i.value),i=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Ot(i.value),i=t.next();this.Nt()}Lt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Ft(i);else if(i<2048)this.Ft(960|i>>>6),this.Ft(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i);else{let r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Ot(i);else if(i<2048)this.Ot(960|i>>>6),this.Ot(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i);else{let r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){let t=this.qt(e),i=lv(t);this.Qt(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){let t=this.qt(e),i=lv(t);this.Qt(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},Pd=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},xd=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Vi=class{constructor(){this.jt=new Rd,this.Ht=new Pd(this.jt),this.Jt=new xd(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Oi=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function Wn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=cv(n.arrayValue,e.arrayValue),t!==0?t:(t=cv(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function cv(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var Kl=class{constructor(e){this.Xt=new de((t,i)=>Re.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let i=t;i.isInequality()?this.Xt=this.Xt.add(i):this.tn.push(i)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Jh(e);if(t!==void 0&&!this.sn(t))return!1;let i=Ni(e),r=new Set,s=0,o=0;for(;s<i.length&&this.sn(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!r.has(a.field.canonicalString())){let c=i[s];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new de(Re.comparator),t=[];for(let i of this.tn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new kr(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new kr(i.field,0))}for(let i of this.en)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new kr(i.field,i.dir==="asc"?0:1)));return new Mr(Mr.UNKNOWN_ID,this.collectionId,t,Co.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function Dw(n){var e,t;if(G(n instanceof ie||n instanceof ue),n instanceof ie){if(n instanceof Vl){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ie.create(n.field,"==",s)))||[];return ue.create(r,"or")}return n}let i=n.filters.map(r=>Dw(r));return ue.create(i,n.op)}function eb(n){if(n.getFilters().length===0)return[];let e=Dd(Dw(n));return G(Vw(e)),Nd(e)||kd(e)?[e]:e.getFilters()}function Nd(n){return n instanceof ie}function kd(n){return n instanceof ue&&Hf(n)}function Vw(n){return Nd(n)||kd(n)||function(t){if(t instanceof ue&&sd(t)){for(let i of t.getFilters())if(!Nd(i)&&!kd(i))return!1;return!0}return!1}(n)}function Dd(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;if(n.filters.length===1)return Dd(n.filters[0]);let e=n.filters.map(i=>Dd(i)),t=ue.create(e,n.op);return t=zl(t),Vw(t)?t:(G(t instanceof ue),G(Lr(t)),G(t.filters.length>1),t.filters.reduce((i,r)=>tp(i,r)))}function tp(n,e){let t;return G(n instanceof ie||n instanceof ue),G(e instanceof ie||e instanceof ue),t=n instanceof ie?e instanceof ie?function(r,s){return ue.create([r,s],"and")}(n,e):uv(n,e):e instanceof ie?uv(e,n):function(r,s){if(G(r.filters.length>0&&s.filters.length>0),Lr(r)&&Lr(s))return Zv(r,s.getFilters());let o=sd(r)?r:s,a=sd(r)?s:r,c=o.filters.map(u=>tp(u,a));return ue.create(c,"or")}(n,e),zl(t)}function uv(n,e){if(Lr(e))return Zv(e,n.getFilters());{let t=e.filters.map(i=>tp(n,i));return ue.create(t,"or")}}function zl(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;let e=n.getFilters();if(e.length===1)return zl(e[0]);if(Jv(n))return n;let t=e.map(r=>zl(r)),i=[];return t.forEach(r=>{r instanceof ie?i.push(r):r instanceof ue&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ue.create(i,n.op)}var Vd=class{constructor(){this.un=new Lo}addToCollectionParentIndex(e,t){return this.un.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(Rt.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(Rt.min())}updateCollectionGroup(e,t,i){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},Lo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new de(se.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new de(se.comparator)).toArray()}};var _l=new Uint8Array(0),Od=class{constructor(e,t){this.databaseId=t,this.cn=new Lo,this.ln=new rn(i=>qi(i),(i,r)=>$o(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:i,parent:st(r)};return hv(e).put(s)}return S.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[Mv(t),""],!1,!0);return hv(e).U(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(Yt(o.parent))}return i})}addFieldIndex(e,t){let i=mo(e),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=Ar(e);return s.next(a=>{o.put(sv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let i=mo(e),r=Ar(e),s=Ir(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=mo(e),i=Ir(e),r=Ar(e);return t.j().next(()=>i.j()).next(()=>r.j())}createTargetIndexes(e,t){return S.forEach(this.hn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let s=new Kl(i).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let i=Ir(e),r=!0,s=new Map;return S.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=X(),a=[];return S.forEach(s,(c,u)=>{V("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${qi(t)}`);let d=function(M,W){let H=Jh(W);if(H===void 0)return null;for(let Y of Ml(M,H.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(u,c),p=function(M,W){let H=new Map;for(let Y of Ni(W))for(let T of Ml(M,Y.fieldPath))switch(T.op){case"==":case"in":H.set(Y.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return H.set(Y.fieldPath.canonicalString(),T.value),Array.from(H.values())}return null}(u,c),m=function(M,W){let H=[],Y=!0;for(let T of Ni(W)){let _=T.kind===0?Ky(M,T.fieldPath,M.startAt):zy(M,T.fieldPath,M.startAt);H.push(_.value),Y&&(Y=_.inclusive)}return new nn(H,Y)}(u,c),y=function(M,W){let H=[],Y=!0;for(let T of Ni(W)){let _=T.kind===0?zy(M,T.fieldPath,M.endAt):Ky(M,T.fieldPath,M.endAt);H.push(_.value),Y&&(Y=_.inclusive)}return new nn(H,Y)}(u,c),C=this.In(c,u,m),x=this.In(c,u,y),k=this.Tn(c,u,p),q=this.En(c.indexId,d,C,m.inclusive,x,y.inclusive,k);return S.forEach(q,j=>i.G(j,t.limit).next(M=>{M.forEach(W=>{let H=U.fromSegments(W.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return S.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=eb(ue.create(e.filters,"and")).map(i=>pd(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,i,r,s,o,a){let c=(t!=null?t.length:1)*Math.max(i.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let m=t?this.dn(t[p/u]):_l,y=this.An(e,m,i[p%u],r),C=this.Rn(e,m,s[p%u],o),x=a.map(k=>this.An(e,m,k,!0));d.push(...this.createRange(y,C,x))}return d}An(e,t,i,r){let s=new Oi(e,U.empty(),t,i);return r?s:s.Zt()}Rn(e,t,i,r){let s=new Oi(e,U.empty(),t,i);return r?s.Zt():s}Pn(e,t){let i=new Kl(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.hn(t);return S.forEach(r,s=>this.Pn(e,s).next(o=>{o?i!==0&&o.fields.length<function(c){let u=new de(Re.comparator),d=!1;for(let p of c.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&i===2?1:i)}Vn(e,t){let i=new Vi;for(let r of Ni(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.Yt(r.kind);En.vt.It(s,o)}return i.zt()}dn(e){let t=new Vi;return En.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let i=new Vi;return En.vt.It(Ui(this.databaseId,t),i.Yt(function(s){let o=Ni(s);return o.length===0?0:o[o.length-1].kind}(e))),i.zt()}Tn(e,t,i){if(i===null)return[];let r=[];r.push(new Vi);let s=0;for(let o of Ni(e)){let a=i[s++];for(let c of r)if(this.fn(t,o.fieldPath)&&xo(a))r=this.gn(r,o,a);else{let u=c.Yt(o.kind);En.vt.It(a,u)}}return this.pn(r)}In(e,t,i){return this.Tn(e,t,i.position)}pn(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].zt();return t}gn(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let c=new Vi;c.seed(a.zt()),En.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(i=>i instanceof ie&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=mo(e),r=Ar(e);return(t?i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.U()).next(s=>{let o=[];return S.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(d,p){let m=p?new Co(p.sequenceNumber,new Rt(Ki(p.readTime),new U(Yt(p.documentKey)),p.largestBatchId)):Co.empty(),y=d.fields.map(([C,x])=>new kr(Re.fromServerFormat(C),x));return new Mr(d.indexId,d.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:Q(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=mo(e),s=Ar(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>S.forEach(a,c=>s.put(sv(c.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return S.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),S.forEach(a,c=>this.wn(e,r,c).next(u=>{let d=this.Sn(s,c);return u.isEqual(d)?S.resolve():this.bn(e,s,c,u,d)}))))})}Dn(e,t,i,r){return Ir(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(i,t.key),documentKey:t.key.path.toArray()})}vn(e,t,i,r){return Ir(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(i,t.key),t.key.path.toArray()])}wn(e,t,i){let r=Ir(e),s=new de(Wn);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.mn(i,t)])},(o,a)=>{s=s.add(new Oi(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let i=new de(Wn),r=this.Vn(t,e);if(r==null)return i;let s=Jh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(xo(o))for(let a of o.arrayValue.values||[])i=i.add(new Oi(t.indexId,e.key,this.dn(a),r))}else i=i.add(new Oi(t.indexId,e.key,_l,r));return i}bn(e,t,i,r,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,p,m){let y=c.getIterator(),C=u.getIterator(),x=Er(y),k=Er(C);for(;x||k;){let q=!1,j=!1;if(x&&k){let M=d(x,k);M<0?j=!0:M>0&&(q=!0)}else x!=null?j=!0:q=!0;q?(p(k),k=Er(C)):j?(m(x),x=Er(y)):(x=Er(y),k=Er(C))}}(r,s,Wn,a=>{o.push(this.Dn(e,t,i,a))},a=>{o.push(this.vn(e,t,i,a))}),S.waitFor(o)}yn(e){let t=1;return Ar(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Wn(o,a)).filter((o,a,c)=>!a||Wn(o,c[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=Wn(o,e),c=Wn(o,t);if(a===0)r[0]=e.Zt();else if(a>0&&c<0)r.push(o),r.push(o.Zt());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,_l,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,_l,[]];s.push(IDBKeyRange.bound(a,c))}return s}Cn(e,t){return Wn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dv)}getMinOffset(e,t){return S.mapArray(this.hn(t),i=>this.Pn(e,i).next(r=>r||B())).next(dv)}};function hv(n){return qe(n,"collectionParents")}function Ir(n){return qe(n,"indexEntries")}function mo(n){return qe(n,"indexConfiguration")}function Ar(n){return qe(n,"indexState")}function dv(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;zf(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Rt(e.readTime,e.documentKey,t)}var fv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},St=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Ow(n,e,t){let i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=i.J({range:o},(d,p,m)=>(a++,m.delete()));s.push(c.next(()=>{G(a===1)}));let u=[];for(let d of t.mutations){let p=jv(e,d.key.path,t.batchId);s.push(r.delete(p)),u.push(d.key)}return S.waitFor(s).next(()=>u)}function Wl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}St.DEFAULT_COLLECTION_PERCENTILE=10,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,St.DEFAULT=new St(41943040,St.DEFAULT_COLLECTION_PERCENTILE,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),St.DISABLED=new St(-1,0,0);var $l=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.Fn={}}static lt(e,t,i,r){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $n(e).J({index:"userMutationsIndex",range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=xr(e),o=$n(e);return o.add({}).next(a=>{G(typeof a=="number");let c=new ko(a,t,i,r),u=function(y,C,x){let k=x.baseMutations.map(j=>Fo(y.ct,j)),q=x.mutations.map(j=>Fo(y.ct,j));return{userId:C,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:k,mutations:q}}(this.serializer,this.userId,c),d=[],p=new de((m,y)=>Q(m.canonicalString(),y.canonicalString()));for(let m of r){let y=jv(this.userId,m.key.path,a);p=p.add(m.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,oC))}return p.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),S.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return $n(e).get(t).next(i=>i?(G(i.userId===this.userId),Di(this.serializer,i)):null)}Mn(e,t){return this.Fn[t]?S.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return $n(e).J({index:"userMutationsIndex",range:r},(o,a,c)=>{a.userId===this.userId&&(G(a.batchId>=i),s=Di(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=-1;return $n(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $n(e).U("userMutationsIndex",t).next(i=>i.map(r=>Di(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=Tl(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return xr(e).J({range:r},(o,a,c)=>{let[u,d,p]=o,m=Yt(d);if(u===this.userId&&t.path.isEqual(m))return $n(e).get(p).next(y=>{if(!y)throw B();G(y.userId===this.userId),s.push(Di(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new de(Q),r=[];return t.forEach(s=>{let o=Tl(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=xr(e).J({range:a},(u,d,p)=>{let[m,y,C]=u,x=Yt(y);m===this.userId&&s.path.isEqual(x)?i=i.add(C):p.done()});r.push(c)}),S.waitFor(r).next(()=>this.xn(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=Tl(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new de(Q);return xr(e).J({range:o},(c,u,d)=>{let[p,m,y]=c,C=Yt(m);p===this.userId&&i.isPrefixOf(C)?C.length===r&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let i=[],r=[];return t.forEach(s=>{r.push($n(e).get(s).next(o=>{if(o===null)throw B();G(o.userId===this.userId),i.push(Di(this.serializer,o))}))}),S.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return Ow(e._e,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),S.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return xr(e).J({range:i},(s,o,a)=>{if(s[0]===this.userId){let c=Yt(s[1]);r.push(c)}else a.done()}).next(()=>{G(r.length===0)})})}containsKey(e,t){return Mw(e,this.userId,t)}Nn(e){return Fw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Mw(n,e,t){let i=Tl(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return xr(n).J({range:s,H:!0},(a,c,u)=>{let[d,p,m]=a;d===e&&p===r&&(o=!0),u.done()}).next(()=>o)}function $n(n){return qe(n,"mutations")}function xr(n){return qe(n,"documentMutations")}function Fw(n){return qe(n,"mutationQueues")}var Gr=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Md=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let i=new Gr(t.highestTargetId);return t.highestTargetId=i.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>z.fromTimestamp(new we(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(i=>(i.targetCount+=1,this.$n(t,i),this.Qn(e,i))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Cr(e).delete(t.targetId)).next(()=>this.qn(e)).next(i=>(G(i.targetCount>0),i.targetCount-=1,this.Qn(e,i)))}removeTargets(e,t,i){let r=0,s=[];return Cr(e).J((o,a)=>{let c=vo(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>S.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Cr(e).J((i,r)=>{let s=vo(r);t(s)})}qn(e){return pv(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return pv(e).put("targetGlobalKey",t)}Kn(e,t){return Cr(e).put(kw(this.serializer,t))}$n(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let i=qi(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return Cr(e).J({range:r,index:"queryTargetsIndex"},(o,a,c)=>{let u=vo(a);$o(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=Qn(e);return t.forEach(o=>{let a=st(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),S.waitFor(r)}removeMatchingKeys(e,t,i){let r=Qn(e);return S.forEach(t,s=>{let o=st(s.path);return S.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=Qn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Qn(e),s=X();return r.J({range:i,H:!0},(o,a,c)=>{let u=Yt(o[1]),d=new U(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let i=st(t.path),r=IDBKeyRange.bound([i],[Mv(i)],!1,!0),s=0;return Qn(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}ot(e,t){return Cr(e).get(t).next(i=>i?vo(i):null)}};function Cr(n){return qe(n,"targets")}function pv(n){return qe(n,"targetGlobal")}function Qn(n){return qe(n,"targetDocuments")}function mv([n,e],[t,i]){let r=Q(n,t);return r===0?Q(e,i):r}var Fd=class{constructor(e){this.Un=e,this.buffer=new de(mv),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();mv(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ld=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ci(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield li(t)}yield this.Hn(3e5)}))}},Ud=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return S.resolve(_t.oe);let i=new Fd(t);return this.Jn.forEachTarget(e,r=>i.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>i.zn(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Jn.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(fv)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let i,r,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(i=p,a=Date.now(),this.removeTargets(e,i,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(p=>(u=Date.now(),br()<=bt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p})))}};function tb(n,e){return new Ud(n,e)}var Bd=class{constructor(e,t){this.db=e,this.garbageCollector=tb(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}er(e){let t=0;return this.Zn(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(i,r)=>t(r))}addReference(e,t,i){return yl(e,i)}removeReference(e,t,i){return yl(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return yl(e,t)}nr(e,t){return function(r,s){let o=!1;return Fw(r).Y(a=>Mw(r,a,s).next(c=>(c&&(o=!0),S.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,z.min()),Qn(e).delete(function(p){return[0,st(p.path)]}(o))))});r.push(c)}}).next(()=>S.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return yl(e,t)}tr(e,t){let i=Qn(e),r,s=_t.oe;return i.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==_t.oe&&t(new U(Yt(r)),s),s=u,r=c):s=_t.oe}).next(()=>{s!==_t.oe&&t(new U(Yt(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function yl(n,e){return Qn(n).put(function(i,r){return{targetId:0,path:st(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}var Ql=class{constructor(){this.changes=new rn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?S.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var qd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return xi(e).put(i)}removeEntry(e,t,i){return xi(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],jl(o),a[a.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.rr(e,i)))}getEntry(e,t){let i=Me.newInvalidDocument(t);return xi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(r,s)=>{i=this.ir(t,s)}).next(()=>i)}sr(e,t){let i={size:0,document:Me.newInvalidDocument(t)};return xi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(r,s)=>{i={document:this.ir(t,s),size:Wl(s)}}).next(()=>i)}getEntries(e,t){let i=dt();return this._r(e,t,(r,s)=>{let o=this.ir(r,s);i=i.insert(r,o)}).next(()=>i)}ar(e,t){let i=dt(),r=new _e(U.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);i=i.insert(s,a),r=r.insert(s,Wl(o))}).next(()=>({documents:i,ur:r}))}_r(e,t,i){if(t.isEmpty())return S.resolve();let r=new de(yv);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(go(r.first()),go(r.last())),o=r.getIterator(),a=o.getNext();return xi(e).J({index:"documentKeyIndex",range:s},(c,u,d)=>{let p=U.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&yv(a,p)<0;)i(a,null),a=o.getNext();a&&a.isEqual(p)&&(i(a,u),a=o.hasNext()?o.getNext():null),a?d.$(go(a)):d.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),jl(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xi(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=dt();for(let p of u){let m=this.ir(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(Ho(t,m)||r.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,i,r){let s=dt(),o=_v(t,i),a=_v(t,Rt.max());return xi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.ir(U.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===r&&d.done()}).next(()=>s)}newChangeBuffer(e){return new jd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return gv(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return gv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let i=XC(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(z.min())))return i}return Me.newInvalidDocument(e)}};function Lw(n){return new qd(n)}var jd=class extends Ql{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new rn(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new de((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=iv(this.cr.serializer,o);r=r.add(s.path.popLast());let u=Wl(c);i+=u-a.size,t.push(this.cr.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){let c=iv(this.cr.serializer,o.convertToNoDocument(z.min()));t.push(this.cr.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,i)),S.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(i=>(this.lr.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:i,ur:r})=>(r.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function gv(n){return qe(n,"remoteDocumentGlobal")}function xi(n){return qe(n,"remoteDocumentsV14")}function go(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function _v(n,e){let t=e.documentKey.path.toArray();return[n,jl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function yv(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=Q(t[s],i[s]),r)return r;return r=Q(t.length,i.length),r||(r=Q(t[t.length-2],i[i.length-2]),r||Q(t[t.length-1],i[i.length-1]))}var Gd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Hl=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Eo(i.mutation,r,yt.empty(),we.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,X()).next(()=>i))}getLocalViewOfDocuments(e,t,i=X()){let r=Jt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=yo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=Jt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,X()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=dt(),o=To(),a=function(){return To()}();return t.forEach((c,u)=>{let d=i.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof Bt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),Eo(d.mutation,u,d.mutation.getFieldMask(),we.now())):o.set(u.key,yt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new Gd(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let i=To(),r=new _e((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=i.get(c)||yt.empty();d=a.applyToLocalView(u,d),i.set(c,d);let p=(r.get(a.batchId)||X()).add(c);r=r.insert(a.batchId,p)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=lw();d.forEach(m=>{if(!s.has(m)){let y=mw(t.get(m),i.get(m));y!==null&&p.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return S.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):S.resolve(Jt()),a=-1,c=s;return o.next(u=>S.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?S.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,X())).next(d=>({batchId:a,changes:aw(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(i=>{let r=yo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=yo();return this.indexManager.getCollectionParents(e,s).next(a=>S.forEach(a,c=>{let u=function(p,m){return new Ut(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Me.newInvalidDocument(d)))});let a=yo();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&Eo(d.mutation,u,yt.empty(),we.now()),Ho(t,u)&&(a=a.insert(c,u))}),a})}};var Kd=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return S.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Pe(r.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:ep(r.bundledQuery),readTime:Pe(r.readTime)}}(t)),S.resolve()}};var zd=class{constructor(){this.overlays=new _e(U.comparator),this.Ir=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let i=Jt();return S.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.ht(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.Ir.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(i)),S.resolve()}getOverlaysForCollection(e,t,i){let r=Jt(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return S.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);d===null&&(d=Jt(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Jt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return S.resolve(a)}ht(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(i.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Do(t,i));let s=this.Ir.get(t);s===void 0&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(i.key))}};var Wd=class{constructor(){this.sessionToken=xe.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};var Uo=class{constructor(){this.Tr=new de(Ve.Er),this.dr=new de(Ve.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let i=new Ve(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Vr(new Ve(e,t))}mr(e,t){e.forEach(i=>this.removeReference(i,t))}gr(e){let t=new U(new se([])),i=new Ve(t,e),r=new Ve(t,e+1),s=[];return this.dr.forEachInRange([i,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new se([])),i=new Ve(t,e),r=new Ve(t,e+1),s=X();return this.dr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ve(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Ve=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||U.comparator(e.key,t.key)}};var $d=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new de(Ve.Er)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ko(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.br=this.br.add(new Ve(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.vr(i),s=r<0?0:r;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Ve(t,0),r=new Ve(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([i,r],o=>{let a=this.Dr(o.wr);s.push(a)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new de(Q);return t.forEach(r=>{let s=new Ve(r,0),o=new Ve(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{i=i.add(a.wr)})}),S.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;U.isDocumentKey(s)||(s=s.child(""));let o=new Ve(new U(s),0),a=new de(Q);return this.br.forEachWhile(c=>{let u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(c.wr)),!0)},o),S.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(i=>{let r=this.Dr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return S.forEach(t.mutations,r=>{let s=new Ve(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=i})}On(e){}containsKey(e,t){let i=new Ve(t,0),r=this.br.firstAfterOrEqual(i);return S.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Qd=class{constructor(e){this.Mr=e,this.docs=function(){return new _e(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return S.resolve(i?i.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let i=dt();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Me.newInvalidDocument(r))}),S.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=dt(),o=t.path,a=new U(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||zf(Lv(d),i)<=0||(r.has(d.key)||Ho(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,i,r){B()}Or(e,t){return S.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Hd(this)}getSize(e){return S.resolve(this.size)}},Hd=class extends Ql{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(i)}),S.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Yd=class{constructor(e){this.persistence=e,this.Nr=new rn(t=>qi(t),$o),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Uo,this.targetCount=0,this.kr=Gr.Bn()}forEachTarget(e,t){return this.Nr.forEach((i,r)=>t(r)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),S.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Gr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.Kn(t),S.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),S.waitFor(s).next(()=>r)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let i=this.Nr.get(t)||null;return S.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),S.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),S.resolve()}getMatchingKeysForTargetId(e,t){let i=this.Br.yr(t);return S.resolve(i)}containsKey(e,t){return S.resolve(this.Br.containsKey(t))}};var Yl=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new _t(0),this.Kr=!1,this.Kr=!0,this.$r=new Wd,this.referenceDelegate=e(this),this.Ur=new Yd(this),this.indexManager=new Vd,this.remoteDocumentCache=function(r){return new Qd(r)}(i=>this.referenceDelegate.Wr(i)),this.serializer=new ql(t),this.Gr=new Kd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new zd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new $d(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){V("MemoryPersistence","Starting transaction:",e);let r=new Jd(this.Qr.next());return this.referenceDelegate.zr(),i(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return S.or(Object.values(this.qr).map(i=>()=>i.containsKey(e,t)))}},Jd=class extends Pl{constructor(e){super(),this.currentSequenceNumber=e}},Jl=class n{constructor(e){this.persistence=e,this.Jr=new Uo,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),S.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),S.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.Xr,i=>{let r=U.fromPath(i);return this.ei(e,r).next(s=>{s||t.removeEntry(r,z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return S.or([()=>S.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Xd=class{constructor(e){this.serializer=e}O(e,t,i,r){let s=new xl("createOrUpgrade",t);i<1&&r>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vy,{unique:!0}),c.createObjectStore("documentMutations")}(e),vv(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=S.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),vv(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vy,{unique:!0});let p=u.store("mutations"),m=d.map(y=>p.put(y));return S.waitFor(m)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.ni(s))),i<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),i<7&&r>=7&&(o=o.next(()=>this.ii(s))),i<8&&r>=8&&(o=o.next(()=>this.si(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.oi(s))),i<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:yC});u.createIndex("collectionPathOverlayIndex",vC,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",wC,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:aC});u.createIndex("documentKeyIndex",lC),u.createIndex("collectionGroupIndex",cC)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.ai(e,s))),i<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:pC}).createIndex("sequenceNumberIndex",mC,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:gC}).createIndex("documentKeyIndex",_C,{unique:!1})}(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),i<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((i,r)=>{t+=Wl(r)}).next(()=>{let i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}ni(e){let t=e.store("mutationQueues"),i=e.store("mutations");return t.U().next(r=>S.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.U("userMutationsIndex",o).next(a=>S.forEach(a,c=>{G(c.userId===s.userId);let u=Di(this.serializer,c);return Ow(e,s.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return i.J((o,a)=>{let c=new se(o),u=function(p){return[0,st(p)]}(c);s.push(t.get(u).next(d=>d?S.resolve():(p=>t.put({targetId:0,path:st(p),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>S.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:fC});let i=t.store("collectionParents"),r=new Lo,s=o=>{if(r.add(o)){let a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:st(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new se(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=Yt(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((i,r)=>{let s=vo(r),o=kw(this.serializer,s);return t.put(o)})}_i(e,t){let i=t.store("remoteDocuments"),r=[];return i.J((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(p){return p.document?new U(se.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):B()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))}).next(()=>S.waitFor(r))}ai(e,t){let i=t.store("mutations"),r=Lw(this.serializer),s=new Yl(Jl.Zr,this.serializer.ct);return i.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:X();Di(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),S.forEach(a,(c,u)=>{let d=new Oe(u),p=Gl.lt(this.serializer,d),m=s.getIndexManager(d),y=$l.lt(d,this.serializer,m,s.referenceDelegate);return new Hl(r,y,p,m).recalculateAndSaveOverlaysForDocumentKeys(new So(t,_t.oe),c).next()})})}};function vv(n){n.createObjectStore("targetDocuments",{keyPath:hC}).createIndex("documentTargetsIndex",dC,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",uC,{unique:!0}),n.createObjectStore("targetGlobal")}var Bh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zd=class n{constructor(e,t,i,r,s,o,a,c,u,d,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.ui=s,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!n.D())throw new D(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Bd(this,r),this.Ai=t+"main",this.serializer=new ql(c),this.Ri=new Zn(this.Ai,this.hi,new Xd(this.serializer)),this.$r=new Sd,this.Ur=new Md(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Lw(this.serializer),this.Gr=new bd,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Se("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Bh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new _t(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>vl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ci(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return _o(e).get("owner").next(t=>S.resolve(this.vi(t)))}Ci(e){return vl(e).delete(this.clientId)}Fi(){return N(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=qe(t,"clientMetadata");return i.U().next(r=>{let s=this.xi(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return S.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?S.resolve(!0):_o(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Bh);return!1}}return!(!this.networkEnabled||!this.inForeground)||vl(e).U().next(i=>this.xi(i,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new So(e,_t.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(i=>this.Mi(i.updateTimeMs,t)&&!this.Ni(i.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>vl(e).U().next(t=>this.xi(t,18e5).map(i=>i.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return $l.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Od(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Gl.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,i){V("IndexedDbPersistence","Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?IC:c===16?EC:c===15?$f:c===14?zv:c===13?Kv:c===12?TC:c===11?Gv:void B()}(this.hi),o;return this.Ri.runTransaction(e,r,s,a=>(o=new So(a,this.Qr?this.Qr.next():_t.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Se(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(P.FAILED_PRECONDITION,Uv);return i(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return _o(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(P.FAILED_PRECONDITION,Bh)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _o(e).put("owner",t)}static D(){return Zn.D()}bi(e){let t=_o(e);return t.get("owner").next(i=>this.vi(i)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):S.resolve())}Mi(e,t){let i=Date.now();return!(e<i-t)&&(!(e>i)||(Se(`Detected an update time that is in the future: ${e} > ${i}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;vh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let i=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Se("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Se("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function _o(n){return qe(n,"owner")}function vl(n){return qe(n,"clientMetadata")}function np(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var ef=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=r}static Wi(e,t){let i=X(),r=X();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var tf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Xl=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return vh()?8:Bv(Zs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new tf;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,i,r){return i.documentReadCount<this.ji?(br()<=bt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),S.resolve()):(br()<=bt.DEBUG&&V("QueryEngine","Query:",Sr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Hi*r?(br()<=bt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ot(t))):S.resolve())}Yi(e,t){if(Wy(t))return S.resolve(null);let i=ot(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Fl(t,null,"F"),i=ot(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=X(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,Fl(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,i,r){return Wy(t)||r.isEqual(z.min())?S.resolve(null):this.Ji.getDocuments(e,i).next(s=>{let o=this.ts(t,s);return this.ns(t,o,i,r)?S.resolve(null):(br()<=bt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Sr(t)),this.rs(e,o,t,Fv(r,-1)).next(a=>a))})}ts(e,t){let i=new de(sw(e));return t.forEach((r,s)=>{Ho(e,s)&&(i=i.add(s))}),i}ns(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,i){return br()<=bt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Rt.min(),i)}rs(e,t,i,r){return this.Ji.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var nf=class{constructor(e,t,i,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new _e(Q),this._s=new rn(s=>qi(s),$o),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Uw(n,e,t,i){return new nf(n,e,t,i)}function Bw(n,e){return N(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=X();for(let u of r){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function nb(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let p=u.batch,m=p.keys(),y=S.resolve();return m.forEach(C=>{y=y.next(()=>d.getEntry(c,C)).next(x=>{let k=u.docVersions.get(C);G(k!==null),x.version.compareTo(k)<0&&(p.applyToRemoteDocument(x,u),x.isValidDocument()&&(x.setReadTime(u.commitVersion),d.addEntry(x)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=X();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function qw(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ib(n,e){let t=L(n),i=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let a=[];e.targetChanges.forEach((d,p)=>{let m=r.get(p);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,p)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(xe.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(p,y),function(x,k,q){return x.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let c=dt(),u=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(jw(s,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!i.isEqual(z.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return S.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.os=r,s))}function jw(n,e,t){let i=X(),r=X();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=dt();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(z.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:r}})}function rb(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Kr(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Ur.getTargetData(i,e).next(s=>s?(r=s,S.resolve(r)):t.Ur.allocateTargetId(i).next(o=>(r=new jr(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.os.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i})}function zr(n,e,t){return N(this,null,function*(){let i=L(n),r=i.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!ci(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.os=i.os.remove(e),i._s.delete(r.target)})}function Zl(n,e,t){let i=L(n),r=z.min(),s=X();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let p=L(c),m=p._s.get(d);return m!==void 0?S.resolve(p.os.get(m)):p.Ur.getTargetData(u,d)}(i,o,ot(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.ss.getDocumentsMatchingQuery(o,e,t?r:z.min(),t?s:X())).next(a=>(zw(i,rw(e),a),{documents:a,Ts:s})))}function Gw(n,e){let t=L(n),i=L(t.Ur),r=t.os.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ot(s,e).next(o=>o?o.target:null))}function Kw(n,e){let t=L(n),i=t.us.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.cs.getAllFromCollectionGroup(r,e,Fv(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(zw(t,e,r),r))}function zw(n,e,t){let i=n.us.get(e)||z.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.us.set(e,i)}function sb(n,e,t,i){return N(this,null,function*(){let r=L(n),s=X(),o=dt();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(s=s.add(d));let p=e.ds(u);p.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,p)}let a=r.cs.newChangeBuffer({trackRemovals:!0}),c=yield Kr(r,function(d){return ot(Zr(se.fromString(`__bundle__/docs/${d}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",u=>jw(u,a,o).next(d=>(a.apply(u),d)).next(d=>r.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>r.Ur.addMatchingKeys(u,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function ob(i,r){return N(this,arguments,function*(n,e,t=X()){let s=yield Kr(n,ot(ep(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=Pe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=s.withResumeToken(xe.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function wv(n,e){return`firestore_clients_${n}_${e}`}function Tv(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function qh(n,e){return`firestore_targets_${n}_${e}`}var ec=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Rs(e,t,i){let r=JSON.parse(i),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new n(e,t,r.state,s):(Se("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Io=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Rs(e,t){let i=JSON.parse(t),r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new D(i.error.code,i.error.message))),s?new n(e,i.state,r):(Se("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},tc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Jf();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=qv(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Se("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},rf=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Se("SharedClientState",`Failed to parse online state: ${e}`),null)}},Bo=class{constructor(){this.activeTargetIds=Jf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ao=class{constructor(e,t,i,r,s){this.window=e,this.ui=t,this.persistenceKey=i,this.ps=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new _e(Q),this.started=!1,this.bs=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=wv(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Bo),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.Qi();for(let i of e){if(i===this.ps)continue;let r=this.getItem(wv(this.persistenceKey,i));if(r){let s=tc.Rs(i,r);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let i=this.Ls(t);i&&this.Bs(i)}for(let i of this.bs)this.ws(i);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,i){this.qs(e,t,i),this.Qs(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(qh(this.persistenceKey,e));if(r){let s=Io.Rs(e,r);s&&(i=s.state)}}return t&&this.Ks.fs(e),this.Ns(),i}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(qh(this.persistenceKey,e))}updateQueryState(e,t,i){this.$s(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Qs(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Se("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let i=this.Gs(t.key);return this.zs(i,null)}{let i=this.js(t.key,t.newValue);if(i)return this.zs(i.clientId,i)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let i=this.Hs(t.key,t.newValue);if(i)return this.Js(i)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let i=this.Ys(t.key,t.newValue);if(i)return this.Zs(i)}}else if(t.key===this.xs){if(t.newValue!==null){let i=this.Ls(t.newValue);if(i)return this.Bs(i)}}else if(t.key===this.vs){let i=function(s){let o=_t.oe;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){Se("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);i!==_t.oe&&this.sequenceNumberHandler(i)}else if(t.key===this.Os){let i=this.Xs(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.eo(r)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,i){let r=new ec(this.currentUser,e,t,i),s=Tv(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Vs())}Qs(e){let t=Tv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,i){let r=qh(this.persistenceKey,e),s=new Io(e,t,i);this.setItem(r,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let i=this.Gs(e);return tc.Rs(i,t)}Hs(e,t){let i=this.Fs.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return ec.Rs(new Oe(s),r,t)}Ys(e,t){let i=this.Ms.exec(e),r=Number(i[1]);return Io.Rs(r,t)}Ls(e){return rf.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let i=t?this.Ss.insert(e,t):this.Ss.remove(e),r=this.ks(this.Ss),s=this.ks(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=i})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Jf();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},nc=class{constructor(){this.so=new Bo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Bo,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sf=class{_o(e){}shutdown(){}};var ic=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var wl=null;function jh(){return wl===null?wl=function(){return 268435456+Math.round(2147483648*Math.random())}():wl++,"0x"+wl.toString(16)}var ab={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var of=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ze="WebChannelConnection",af=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,i,r,s,o){let a=jh(),c=this.xo(t,i.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,c,r);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,c,u,r).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Lt("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",r),d})}Lo(t,i,r,s,o,a){return this.Mo(t,i,r,s,o)}Oo(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,i){let r=ab[t];return`${this.Do}/v1/${i}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,r){let s=jh();return new Promise((o,a)=>{let c=new Vh;c.setWithCredentials(!0),c.listenOnce(Oh.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case fo.NO_ERROR:let d=c.getResponseJson();V(Ze,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case fo.TIMEOUT:V(Ze,`RPC '${e}' ${s} timed out`),a(new D(P.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:let p=c.getStatus();if(V(Ze,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let C=function(k){let q=k.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(y.status);a(new D(C,y.message))}else a(new D(P.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new D(P.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(Ze,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);V(Ze,`RPC '${e}' ${s} sending request:`,r),c.send(t,"POST",u,i,15)})}Bo(e,t,i){let r=jh(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Lh(),a=Fh(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;let d=s.join("");V(Ze,`Creating RPC '${e}' stream ${r}: ${d}`,c);let p=o.createWebChannel(d,c),m=!1,y=!1,C=new of({Io:k=>{y?V(Ze,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(m||(V(Ze,`Opening RPC '${e}' stream ${r} transport.`),p.open(),m=!0),V(Ze,`RPC '${e}' stream ${r} sending:`,k),p.send(k))},To:()=>p.close()}),x=(k,q,j)=>{k.listen(q,M=>{try{j(M)}catch(W){setTimeout(()=>{throw W},0)}})};return x(p,Tr.EventType.OPEN,()=>{y||(V(Ze,`RPC '${e}' stream ${r} transport opened.`),C.yo())}),x(p,Tr.EventType.CLOSE,()=>{y||(y=!0,V(Ze,`RPC '${e}' stream ${r} transport closed`),C.So())}),x(p,Tr.EventType.ERROR,k=>{y||(y=!0,Lt(Ze,`RPC '${e}' stream ${r} transport errored:`,k),C.So(new D(P.UNAVAILABLE,"The operation could not be completed")))}),x(p,Tr.EventType.MESSAGE,k=>{var q;if(!y){let j=k.data[0];G(!!j);let M=j,W=M.error||((q=M[0])===null||q===void 0?void 0:q.error);if(W){V(Ze,`RPC '${e}' stream ${r} received error:`,W);let H=W.status,Y=function(w){let E=De[w];if(E!==void 0)return yw(E)}(H),T=W.message;Y===void 0&&(Y=P.INTERNAL,T="Unknown error status: "+H+" with message "+W.message),y=!0,C.So(new D(Y,T)),p.close()}else V(Ze,`RPC '${e}' stream ${r} received:`,j),C.bo(j)}}),x(a,Mh.STAT_EVENT,k=>{k.stat===gl.PROXY?V(Ze,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===gl.NOPROXY&&V(Ze,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}};function Ww(){return typeof window<"u"?window:null}function Cl(){return typeof document<"u"?document:null}function Yo(n){return new Td(n,!0)}var qo=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-i);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var rc=class{constructor(e,t,i,r,s,o,a,c){this.ui=e,this.Ho=i,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new qo(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return N(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return N(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return N(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Se(t.toString()),Se("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Yo===t&&this.P_(i,r)},i=>{e(()=>{let r=new D(P.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(r)})})}P_(e,t){let i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{i(()=>this.listener.Eo())}),this.stream.Ro(()=>{i(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{i(()=>this.I_(r))}),this.stream.onMessage(r=>{i(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>N(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},lf=class extends rc{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=zC(this.serializer,e),i=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?Pe(o.readTime):z.min()}(e);return this.listener.d_(t,i)}A_(e){let t={};t.database=Ad(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=Ol(c)?{documents:bw(s,c)}:{query:Sw(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ww(s,o.resumeToken);let u=Ed(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(z.min())>0){a.readTime=qr(s,o.snapshotVersion.toTimestamp());let u=Ed(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let i=$C(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){let t={};t.database=Ad(this.serializer),t.removeTarget=e,this.a_(t)}},cf=class extends rc{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=WC(e.writeResults,e.commitTime),i=Pe(e.commitTime);return this.listener.g_(i,t)}p_(){let e={};e.database=Ad(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>Fo(this.serializer,i))};this.a_(t)}};var uf=class extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Id(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(P.UNKNOWN,s.toString())})}Lo(e,t,i,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Id(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(P.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},hf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Se(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var df=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{i.enqueueAndForget(()=>N(this,null,function*(){ui(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return N(this,null,function*(){let u=L(c);u.L_.add(4),yield es(u),u.q_.set("Unknown"),u.L_.delete(4),yield Jo(u)})}(this))}))}),this.q_=new hf(i,r)}};function Jo(n){return N(this,null,function*(){if(ui(n))for(let e of n.B_)yield e(!0)})}function es(n){return N(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Cc(n,e){let t=L(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),sp(t)?rp(t):ns(t).r_()&&ip(t,e))}function Wr(n,e){let t=L(n),i=ns(t);t.N_.delete(e),i.r_()&&$w(t,e),t.N_.size===0&&(i.r_()?i.o_():ui(t)&&t.q_.set("Unknown"))}function ip(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ns(n).A_(e)}function $w(n,e){n.Q_.xe(e),ns(n).R_(e)}function rp(n){n.Q_=new wd({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ns(n).start(),n.q_.v_()}function sp(n){return ui(n)&&!ns(n).n_()&&n.N_.size>0}function ui(n){return L(n).L_.size===0}function Qw(n){n.Q_=void 0}function lb(n){return N(this,null,function*(){n.q_.set("Online")})}function cb(n){return N(this,null,function*(){n.N_.forEach((e,t)=>{ip(n,e)})})}function ub(n,e){return N(this,null,function*(){Qw(n),sp(n)?(n.q_.M_(e),rp(n)):n.q_.set("Unknown")})}function hb(n,e,t){return N(this,null,function*(){if(n.q_.set("Online"),e instanceof Ul&&e.state===2&&e.cause)try{yield function(r,s){return N(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.N_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.N_.delete(a),r.Q_.removeTarget(a))})}(n,e)}catch(i){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield sc(n,i)}else if(e instanceof Vr?n.Q_.Ke(e):e instanceof Ll?n.Q_.He(e):n.Q_.We(e),!t.isEqual(z.min()))try{let i=yield qw(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.N_.get(c);if(!d)return;s.N_.set(c,d.withResumeToken(xe.EMPTY_BYTE_STRING,d.snapshotVersion)),$w(s,c);let p=new jr(d.target,c,u,d.sequenceNumber);ip(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){V("RemoteStore","Failed to raise snapshot:",i),yield sc(n,i)}})}function sc(n,e,t){return N(this,null,function*(){if(!ci(e))throw e;n.L_.add(1),yield es(n),n.q_.set("Offline"),t||(t=()=>qw(n.localStore)),n.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Jo(n)}))})}function Hw(n,e){return e().catch(t=>sc(n,t,e))}function ts(n){return N(this,null,function*(){let e=L(n),t=ai(e),i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;db(e);)try{let r=yield rb(e.localStore,i);if(r===null){e.O_.length===0&&t.o_();break}i=r.batchId,fb(e,r)}catch(r){yield sc(e,r)}Yw(e)&&Jw(e)})}function db(n){return ui(n)&&n.O_.length<10}function fb(n,e){n.O_.push(e);let t=ai(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Yw(n){return ui(n)&&!ai(n).n_()&&n.O_.length>0}function Jw(n){ai(n).start()}function pb(n){return N(this,null,function*(){ai(n).p_()})}function mb(n){return N(this,null,function*(){let e=ai(n);for(let t of n.O_)e.m_(t.mutations)})}function gb(n,e,t){return N(this,null,function*(){let i=n.O_.shift(),r=_d.from(i,e,t);yield Hw(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield ts(n)})}function _b(n,e){return N(this,null,function*(){e&&ai(n).V_&&(yield function(i,r){return N(this,null,function*(){if(function(o){return _w(o)&&o!==P.ABORTED}(r.code)){let s=i.O_.shift();ai(i).s_(),yield Hw(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield ts(i)}})}(n,e)),Yw(n)&&Jw(n)})}function Ev(n,e){return N(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let i=ui(t);t.L_.add(3),yield es(t),i&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Jo(t)})}function ff(n,e){return N(this,null,function*(){let t=L(n);e?(t.L_.delete(2),yield Jo(t)):e||(t.L_.add(2),yield es(t),t.q_.set("Unknown"))})}function ns(n){return n.K_||(n.K_=function(t,i,r){let s=L(t);return s.w_(),new lf(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:lb.bind(null,n),Ro:cb.bind(null,n),mo:ub.bind(null,n),d_:hb.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.K_.s_(),sp(n)?rp(n):n.q_.set("Unknown")):(yield n.K_.stop(),Qw(n))}))),n.K_}function ai(n){return n.U_||(n.U_=function(t,i,r){let s=L(t);return s.w_(),new cf(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:pb.bind(null,n),mo:_b.bind(null,n),f_:mb.bind(null,n),g_:gb.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.U_.s_(),yield ts(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var pf=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Be,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function is(n,e){if(Se("AsyncQueue",`${e}: ${n}`),ci(n))return new D(P.UNAVAILABLE,`${e}: ${n}`);throw n}var oc=class n{constructor(e){this.comparator=e?(t,i)=>e(t,i)||U.comparator(t.key,i.key):(t,i)=>U.comparator(t.key,i.key),this.keyedMap=yo(),this.sortedSet=new _e(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var ac=class{constructor(){this.W_=new _e(U.comparator)}track(e){let t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,i)=>{e.push(i)}),e}},$r=class n{constructor(e,t,i,r,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,oc.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var mf=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},gf=class{constructor(){this.queries=Iv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){let r=L(t),s=r.queries;r.queries=Iv(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(i)})})(this,new D(P.ABORTED,"Firestore shutting down"))}};function Iv(){return new rn(n=>iw(n),Qo)}function op(n,e){return N(this,null,function*(){let t=L(n),i=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(i=2):(s=new mf,i=e.J_()?0:1);try{switch(i){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=is(o,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&lp(t)})}function ap(n,e){return N(this,null,function*(){let t=L(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function yb(n,e){let t=L(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(r)&&(i=!0);o.z_=r}}i&&lp(t)}function vb(n,e,t){let i=L(n),r=i.queries.get(e);if(r)for(let s of r.j_)s.onError(t);i.queries.delete(e)}function lp(n){n.Y_.forEach(e=>{e.next()})}var _f,Av;(Av=_f||(_f={})).ea="default",Av.Cache="cache";var jo=class{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new $r(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=$r.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_f.Cache}};var yf=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var lc=class{constructor(e){this.serializer=e}Es(e){return Zt(this.serializer,e)}ds(e){return e.metadata.exists?Cw(this.serializer,e.document,!1):Me.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Pe(e)}},vf=class{constructor(e,t,i){this.ca=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Xw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let i=se.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,i=new lc(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.Es(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){return N(this,null,function*(){let e=yield sb(this.localStore,new lc(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let i of this.queries)yield ob(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function Xw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var cc=class{constructor(e){this.key=e}},uc=class{constructor(e){this.key=e}},hc=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=sw(e),this.Ra=new oc(this.Aa)}get Va(){return this.Ta}ma(e,t){let i=t?t.fa:new ac,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,p)=>{let m=r.get(d),y=Ho(this.query,p)?p:null,C=!!m&&this.mutatedKeys.has(m.key),x=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),k=!1;m&&y?m.data.isEqual(y.data)?C!==x&&(i.track({type:3,doc:y}),k=!0):this.ga(m,y)||(i.track({type:2,doc:y}),k=!0,(c&&this.Aa(y,c)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!m&&y?(i.track({type:0,doc:y}),k=!0):m&&!y&&(i.track({type:1,doc:m}),k=!0,(c||u)&&(a=!0)),k&&(y?(o=o.add(y),s=x?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{Ra:o,fa:i,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,p)=>function(y,C){let x=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return x(y)-x(C)}(d.type,p.type)||this.Aa(d.doc,p.doc)),this.pa(i),r=r!=null&&r;let a=t&&!r?this.ya():[],c=this.da.size===0&&this.current&&!r?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new $r(this.query,e.Ra,s,o,e.mutatedKeys,c===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ac,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=X(),this.Ra.forEach(i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))});let t=[];return e.forEach(i=>{this.da.has(i)||t.push(new uc(i))}),this.da.forEach(i=>{e.has(i)||t.push(new cc(i))}),t}ba(e){this.Ta=e.Ts,this.da=X();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return $r.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},wf=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},Tf=class{constructor(e){this.key=e,this.va=!1}},Ef=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new rn(a=>iw(a),Qo),this.Ma=new Map,this.xa=new Set,this.Oa=new _e(U.comparator),this.Na=new Map,this.La=new Uo,this.Ba={},this.ka=new Map,this.qa=Gr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function wb(n,e,t=!0){return N(this,null,function*(){let i=bc(n),r,s=i.Fa.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield Zw(i,e,t,!0),r})}function Tb(n,e){return N(this,null,function*(){let t=bc(n);yield Zw(t,e,!0,!1)})}function Zw(n,e,t,i){return N(this,null,function*(){let r=yield Kr(n.localStore,ot(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield cp(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Cc(n.remoteStore,r),a})}function cp(n,e,t,i,r){return N(this,null,function*(){n.Ka=(p,m,y)=>function(x,k,q,j){return N(this,null,function*(){let M=k.view.ma(q);M.ns&&(M=yield Zl(x.localStore,k.query,!1).then(({documents:T})=>k.view.ma(T,M)));let W=j&&j.targetChanges.get(k.targetId),H=j&&j.targetMismatches.get(k.targetId)!=null,Y=k.view.applyChanges(M,x.isPrimaryClient,W,H);return If(x,k.targetId,Y.wa),Y.snapshot})}(n,p,m,y);let s=yield Zl(n.localStore,e,!0),o=new hc(e,s.Ts),a=o.ma(s.documents),c=Oo.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,c);If(n,t,u.wa);let d=new wf(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function Eb(n,e,t){return N(this,null,function*(){let i=L(n),r=i.Fa.get(e),s=i.Ma.get(r.targetId);if(s.length>1)return i.Ma.set(r.targetId,s.filter(o=>!Qo(o,e))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield zr(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&Wr(i.remoteStore,r.targetId),Qr(i,r.targetId)}).catch(li))):(Qr(i,r.targetId),yield zr(i.localStore,r.targetId,!0))})}function Ib(n,e){return N(this,null,function*(){let t=L(n),i=t.Fa.get(e),r=t.Ma.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Wr(t.remoteStore,i.targetId))})}function Ab(n,e,t){return N(this,null,function*(){let i=fp(n);try{let r=yield function(o,a){let c=L(o),u=we.now(),d=a.reduce((y,C)=>y.add(C.key),X()),p,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=dt(),x=X();return c.cs.getEntries(y,d).next(k=>{C=k,C.forEach((q,j)=>{j.isValidDocument()||(x=x.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,C)).next(k=>{p=k;let q=[];for(let j of a){let M=LC(j,p.get(j.key).overlayedDocument);M!=null&&q.push(new Bt(j.key,M,Yv(M.value.mapValue),Ce.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(k=>{m=k;let q=k.applyToLocalDocumentSet(p,x);return c.documentOverlayCache.saveOverlays(y,k.batchId,q)})}).then(()=>({batchId:m.batchId,changes:aw(p)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new _e(Q)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(i,r.batchId,t),yield Pn(i,r.changes),yield ts(i.remoteStore)}catch(r){let s=is(r,"Failed to persist write");t.reject(s)}})}function eT(n,e){return N(this,null,function*(){let t=L(n);try{let i=yield ib(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?G(o.va):r.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield Pn(t,i,e)}catch(i){yield li(i)}})}function Cv(n,e,t){let i=L(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let m of p.j_)m.Z_(a)&&(u=!0)}),u&&lp(c)}(i.eventManager,e),r.length&&i.Ca.d_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function Cb(n,e,t){return N(this,null,function*(){let i=L(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.Na.get(e),s=r&&r.key;if(s){let o=new _e(U.comparator);o=o.insert(s,Me.newNoDocument(s,z.min()));let a=X().add(s),c=new Vo(z.min(),new Map,new _e(Q),o,a);yield eT(i,c),i.Oa=i.Oa.remove(s),i.Na.delete(e),dp(i)}else yield zr(i.localStore,e,!1).then(()=>Qr(i,e,t)).catch(li)})}function bb(n,e){return N(this,null,function*(){let t=L(n),i=e.batch.batchId;try{let r=yield nb(t.localStore,e);hp(t,i,null),up(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Pn(t,r)}catch(r){yield li(r)}})}function Sb(n,e,t){return N(this,null,function*(){let i=L(n);try{let r=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(G(p!==null),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(i.localStore,e);hp(i,e,t),up(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Pn(i,r)}catch(r){yield li(r)}})}function Rb(n,e){return N(this,null,function*(){let t=L(n);ui(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(i===-1)return void e.resolve();let r=t.ka.get(i)||[];r.push(e),t.ka.set(i,r)}catch(i){let r=is(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function up(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function hp(n,e,t){let i=L(n),r=i.Ba[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Ba[i.currentUser.toKey()]=r}}function Qr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(i=>{n.La.containsKey(i)||tT(n,i)})}function tT(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Wr(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),dp(n))}function If(n,e,t){for(let i of t)i instanceof cc?(n.La.addReference(i.key,e),Pb(n,i)):i instanceof uc?(V("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||tT(n,i.key)):B()}function Pb(n,e){let t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(i),dp(n))}function dp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new U(se.fromString(e)),i=n.qa.next();n.Na.set(i,new Tf(t)),n.Oa=n.Oa.insert(t,i),Cc(n.remoteStore,new jr(ot(Zr(t.path)),i,"TargetPurposeLimboResolution",_t.oe))}}function Pn(n,e,t){return N(this,null,function*(){let i=L(n),r=[],s=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach((a,c)=>{o.push(i.Ka(c,e,t).then(u=>{var d;if((u||t)&&i.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){r.push(u);let p=ef.Wi(c.targetId,u);s.push(p)}}))}),yield Promise.all(o),i.Ca.d_(r),yield function(c,u){return N(this,null,function*(){let d=L(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>S.forEach(u,m=>S.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>S.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!ci(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of u){let m=p.targetId;if(!p.fromCache){let y=d.os.get(m),C=y.snapshotVersion,x=y.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(m,x)}}})}(i.localStore,s))})}function xb(n,e){return N(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let i=yield Bw(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new D(P.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Pn(t,i.hs)}})}function Nb(n,e){let t=L(n),i=t.Na.get(e);if(i&&i.va)return X().add(i.key);{let r=X(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let a=t.Fa.get(o);r=r.unionWith(a.view.Va)}return r}}function kb(n,e){return N(this,null,function*(){let t=L(n),i=yield Zl(t.localStore,e.query,!0),r=e.view.ba(i);return t.isPrimaryClient&&If(t,e.targetId,r.wa),r})}function Db(n,e){return N(this,null,function*(){let t=L(n);return Kw(t.localStore,e).then(i=>Pn(t,i))})}function Vb(n,e,t,i){return N(this,null,function*(){let r=L(n),s=yield function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Mn(p,c).next(m=>m?u.localDocuments.getDocuments(p,m):S.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield ts(r.remoteStore):t==="acknowledged"||t==="rejected"?(hp(r,e,i||null),up(r,e),function(a,c){L(L(a).mutationQueue).On(c)}(r.localStore,e)):B(),yield Pn(r,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function Ob(n,e){return N(this,null,function*(){let t=L(n);if(bc(t),fp(t),e===!0&&t.Qa!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield bv(t,i.toArray());t.Qa=!0,yield ff(t.remoteStore,!0);for(let s of r)Cc(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let i=[],r=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(Qr(t,o),zr(t.localStore,o,!0))),Wr(t.remoteStore,o)}),yield r,yield bv(t,i),function(o){let a=L(o);a.Na.forEach((c,u)=>{Wr(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new _e(U.comparator)}(t),t.Qa=!1,yield ff(t.remoteStore,!1)}})}function bv(n,e,t){return N(this,null,function*(){let i=L(n),r=[],s=[];for(let o of e){let a,c=i.Ma.get(o);if(c&&c.length!==0){a=yield Kr(i.localStore,ot(c[0]));for(let u of c){let d=i.Fa.get(u),p=yield kb(i,d);p.snapshot&&s.push(p.snapshot)}}else{let u=yield Gw(i.localStore,o);a=yield Kr(i.localStore,u),yield cp(i,nT(u),o,!1,a.resumeToken)}r.push(a)}return i.Ca.d_(s),r})}function nT(n){return nw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Mb(n){return function(t){return L(L(t).persistence).Qi()}(L(n).localStore)}function Fb(n,e,t,i){return N(this,null,function*(){let r=L(n);if(r.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=r.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Kw(r.localStore,rw(s[0])),a=Vo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",xe.EMPTY_BYTE_STRING);yield Pn(r,o,a);break}case"rejected":yield zr(r.localStore,e,!0),Qr(r,e,i);break;default:B()}})}function Lb(n,e,t){return N(this,null,function*(){let i=bc(n);if(i.Qa){for(let r of e){if(i.Ma.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){V("SyncEngine","Adding an already active target "+r);continue}let s=yield Gw(i.localStore,r),o=yield Kr(i.localStore,s);yield cp(i,nT(s),o.targetId,!1,o.resumeToken),Cc(i.remoteStore,o)}for(let r of t)i.Ma.has(r)&&(yield zr(i.localStore,r,!1).then(()=>{Wr(i.remoteStore,r),Qr(i,r)}).catch(li))}})}function bc(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=eT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nb.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Cb.bind(null,e),e.Ca.d_=yb.bind(null,e.eventManager),e.Ca.$a=vb.bind(null,e.eventManager),e}function fp(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bb.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Sb.bind(null,e),e}function Ub(n,e,t){let i=L(n);(function(s,o,a){return N(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,C){let x=L(y),k=Pe(C.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",q=>x.Gr.getBundleMetadata(q,C.id)).then(q=>!!q&&q.createTime.compareTo(k)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(Xw(c));let u=new vf(c,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield u.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let p=yield u.complete();return yield Pn(s,p.Ia,void 0),yield function(y,C){let x=L(y);return x.persistence.runTransaction("Save bundle","readwrite",k=>x.Gr.saveBundleMetadata(k,C))}(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return Lt("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}var Af=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return N(this,null,function*(){this.serializer=Yo(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,i){return null}Ha(t,i){return null}za(t){return Uw(this.persistence,new Xl,t.initialUser,this.serializer)}Ga(t){return new Yl(Jl.Zr,this.serializer)}Wa(t){return new nc}terminate(){return N(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var dc=class n extends Af{constructor(e,t,i){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield nh(n.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield fp(this.Ja.syncEngine),yield ts(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return Uw(this.persistence,new Xl,e.initialUser,this.serializer)}ja(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new Ld(i,e.asyncQueue,t)}Ha(e,t){let i=new td(t,this.persistence);return new ed(e.asyncQueue,i)}Ga(e){let t=np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?St.withCacheSize(this.cacheSizeBytes):St.DEFAULT;return new Zd(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Ww(),Cl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new nc}},Cf=class n extends dc{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield nh(n.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof Ao&&(this.sharedClientState.syncEngine={no:Vb.bind(null,t),ro:Fb.bind(null,t),io:Lb.bind(null,t),Qi:Mb.bind(null,t),eo:Db.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(i=>N(this,null,function*(){yield Ob(this.Ja.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=Ww();if(!Ao.D(t))throw new D(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ao(t,e.asyncQueue,i,e.clientId,e.initialUser)}},pp=(()=>{class n{initialize(t,i){return N(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Cv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=xb.bind(null,this.syncEngine),yield ff(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new gf}()}createDatastore(t){let i=Yo(t.databaseInfo.databaseId),r=function(o){return new af(o)}(t.databaseInfo);return function(o,a,c,u){return new uf(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,c){return new df(r,s,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,i=>Cv(this.syncEngine,i,0),function(){return ic.D()?new ic:new sf}())}createSyncEngine(t,i){return function(s,o,a,c,u,d,p){let m=new Ef(s,o,a,c,u,d);return p&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return N(this,null,function*(){var t,i;yield function(s){return N(this,null,function*(){let o=L(s);V("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield es(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();function Sv(n,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Hr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Se("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var bf=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Be,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(i=>{i&&i.ua()?this.metadata.resolve(i.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.aa)}`))},i=>this.metadata.reject(i))}close(){return this.Xa.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ua(){return N(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return N(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),i=Number(t);isNaN(i)&&this.ru(`length string (${t}) is not valid number`);let r=yield this.iu(i);return new yf(JSON.parse(r),e.length+i)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return N(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return N(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Sf=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return N(this,null,function*(){let o=L(r),a={documents:s.map(p=>Mo(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let m=KC(o.serializer,p);u.set(m.key.toString(),m)});let d=[];return s.forEach(p=>{let m=u.get(p.toString());G(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new oi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=U.fromPath(i);this.mutations.push(new No(r,this.precondition(r)))}),yield function(i,r){return N(this,null,function*(){let s=L(i),o={writes:r.map(a=>Fo(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=z.min()}let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new D(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?Ce.exists(!1):Ce.updateTime(t):Ce.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new D(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ce.updateTime(t)}return Ce.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Rf=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this._u=i.maxAttempts,this.t_=new qo(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>N(this,null,function*(){let e=new Sf(this.datastore),t=this.cu(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.lu(r)}))}).catch(i=>{this.lu(i)})}))}cu(e){try{let t=this.updateFunction(e);return!Wo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!_w(t)}return!1}};var Pf=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Oe.UNAUTHENTICATED,this.clientId=Sl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>N(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Be;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=is(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function Gh(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>N(this,null,function*(){i.isEqual(r)||(yield Bw(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Rv(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield mp(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>Ev(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>Ev(e.remoteStore,r)),n._onlineComponents=e})}function mp(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Gh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===P.FAILED_PRECONDITION||r.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Lt("Error using user provided cache. Falling back to memory cache: "+t),yield Gh(n,new Af)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Gh(n,new Af);return n._offlineComponents})}function Sc(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Rv(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Rv(n,new pp))),n._onlineComponents})}function iT(n){return mp(n).then(e=>e.persistence)}function gp(n){return mp(n).then(e=>e.localStore)}function rT(n){return Sc(n).then(e=>e.remoteStore)}function _p(n){return Sc(n).then(e=>e.syncEngine)}function Bb(n){return Sc(n).then(e=>e.datastore)}function Yr(n){return N(this,null,function*(){let e=yield Sc(n),t=e.eventManager;return t.onListen=wb.bind(null,e.syncEngine),t.onUnlisten=Eb.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Tb.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Ib.bind(null,e.syncEngine),t})}function qb(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield iT(n),t=yield rT(n);return e.setNetworkEnabled(!0),function(r){let s=L(r);return s.L_.delete(0),Jo(s)}(t)}))}function jb(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield iT(n),t=yield rT(n);return e.setNetworkEnabled(!1),function(r){return N(this,null,function*(){let s=L(r);s.L_.add(0),yield es(s),s.q_.set("Offline")})}(t)}))}function Gb(n,e){let t=new Be;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,d))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=is(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield gp(n),e,t)})),t.promise}function sT(n,e,t={}){let i=new Be;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new Hr({next:m=>{d.Za(),o.enqueueAndForget(()=>ap(s,p));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new D(P.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new jo(Zr(a.path),d,{includeMetadataChanges:!0,_a:!0});return op(s,p)}(yield Yr(n),n.asyncQueue,e,t,i)})),i.promise}function Kb(n,e){let t=new Be;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s,o){return N(this,null,function*(){try{let a=yield Zl(r,s,!0),c=new hc(s,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=is(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield gp(n),e,t)})),t.promise}function oT(n,e,t={}){let i=new Be;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,a,c,u){let d=new Hr({next:m=>{d.Za(),o.enqueueAndForget(()=>ap(s,p)),m.fromCache&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new jo(a,d,{includeMetadataChanges:!0,_a:!0});return op(s,p)}(yield Yr(n),n.asyncQueue,e,t,i)})),i.promise}function zb(n,e){let t=new Hr(e);return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){L(r).Y_.add(s),s.next()}(yield Yr(n),t)})),()=>{t.Za(),n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,s){L(r).Y_.delete(s)}(yield Yr(n),t)}))}}function Wb(n,e,t,i){let r=function(o,a){let c;return c=typeof o=="string"?vw().encode(o):o,function(d,p){return new bf(d,p)}(function(d,p){if(d instanceof Uint8Array)return Sv(d,p);if(d instanceof ArrayBuffer)return Sv(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Yo(e));n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){Ub(yield _p(n),r,i)}))}function $b(n,e){return n.asyncQueue.enqueue(()=>N(this,null,function*(){return function(i,r){let s=L(i);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,r))}(yield gp(n),e)}))}function aT(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Pv=new Map;function yp(n,e,t){if(!t)throw new D(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function vp(n,e,t,i){if(e===!0&&i===!0)throw new D(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xv(n){if(!U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Nv(n){if(U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Rc(n);throw new D(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function lT(n,e){if(e<=0)throw new D(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var fc=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new D(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aT((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},zi=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fc(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Kh;switch(i.type){case"firstParty":return new Qh(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new D(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return N(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=Pv.get(t);i&&(V("ComponentProvider","Removing Datastore"),Pv.delete(t),i.terminate())}(this),Promise.resolve()}};function cT(n,e,t,i={}){var r;let s=(n=oe(n,zi))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Lt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=Oe.MOCK_USER;else{a=ol(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new D(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Oe(u)}n._authCredentials=new zh(new bl(a,c))}}var $e=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},pe=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new en(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},en=class n extends $e{constructor(e,t,i){super(e,t,Zr(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function wp(n,e,...t){if(n=ne(n),yp("collection","path",e),n instanceof zi){let i=se.fromString(e,...t);return Nv(i),new en(n,null,i)}{if(!(n instanceof pe||n instanceof en))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return Nv(i),new en(n.firestore,null,i)}}function uT(n,e){if(n=oe(n,zi),yp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $e(n,null,function(i){return new Ut(se.emptyPath(),i)}(e))}function Xo(n,e,...t){if(n=ne(n),arguments.length===1&&(e=Sl.newId()),yp("doc","path",e),n instanceof zi){let i=se.fromString(e,...t);return xv(i),new pe(n,null,new U(i))}{if(!(n instanceof pe||n instanceof en))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return xv(i),new pe(n.firestore,n instanceof en?n.converter:null,new U(i))}}function Tp(n,e){return n=ne(n),e=ne(e),(n instanceof pe||n instanceof en)&&(e instanceof pe||e instanceof en)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ep(n,e){return n=ne(n),e=ne(e),n instanceof $e&&e instanceof $e&&n.firestore===e.firestore&&Qo(n._query,e._query)&&n.converter===e.converter}var pc=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new qo(this,"async_queue_retry"),this.Vu=()=>{let i=Cl();i&&V("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;let t=Cl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Cl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new Be;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return N(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ci(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(i=>{this.Eu=i,this.du=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Se("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.du=!1,i))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=pf.createAndSchedule(this,e,t,i,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&B()}verifyOperationInProgress(){}wu(){return N(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function xf(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Nf=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Be,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var hT=-1,Te=class extends zi{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new pc,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return N(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new pc(e),this._firestoreClient=void 0,yield e}})}};function Qe(n){if(n._terminated)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dT(n),n._firestoreClient}function dT(n){var e,t,i;let r=n._freezeSettings(),s=function(a,c,u,d){return new nd(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,aT(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new Pf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}function fT(n,e){Lt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return mT(n,pp.provider,{build:i=>new dc(i,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function pT(n){return N(this,null,function*(){Lt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();mT(n,pp.provider,{build:t=>new Cf(t,e.cacheSizeBytes)})})}function mT(n,e,t){if((n=oe(n,Te))._firestoreClient||n._terminated)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(P.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},dT(n)}function gT(n){if(n._initialized&&!n._terminated)throw new D(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Be;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(i){return N(this,null,function*(){if(!Zn.D())return Promise.resolve();let r=i+"main";yield Zn.delete(r)})}(np(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function _T(n){return function(t){let i=new Be;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return Rb(yield _p(t),i)})),i.promise}(Qe(n=oe(n,Te)))}function yT(n){return qb(Qe(n=oe(n,Te)))}function vT(n){return jb(Qe(n=oe(n,Te)))}function wT(n,e){let t=Qe(n=oe(n,Te)),i=new Nf;return Wb(t,n._databaseId,e,i),i}function TT(n,e){return $b(Qe(n=oe(n,Te)),e).then(t=>t?new $e(n,null,t.query):null)}var sn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(xe.fromBase64String(e))}catch(t){throw new D(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var qt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Sn=class{constructor(e){this._methodName=e}};var Wi=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var Go=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var Qb=/^__.*__$/,kf=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms):new si(e,this.data,t,this.fieldTransforms)}},mc=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ET(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var gc=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.Ou(e),r}Nu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return _c(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(ET(this.Cu)&&Qb.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Df=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Yo(e)}Qu(e,t,i,r=!1){return new gc({Cu:e,methodName:t,qu:i,path:Re.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Yi(n){let e=n._freezeSettings(),t=Yo(n._databaseId);return new Df(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Pc(n,e,t,i,r,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,r);Cp("Data must be an object, but it was:",o,i);let a=CT(i,o),c,u;if(s.merge)c=new yt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let m=Lf(e,p,t);if(!o.contains(m))throw new D(P.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);ST(d,m)||d.push(m)}c=new yt(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new kf(new et(a),c,u)}var Ko=class n extends Sn{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function IT(n,e,t){return new gc({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Vf=class n extends Sn{_toFieldTransform(e){return new ji(e.path,new ii)}isEqual(e){return e instanceof n}},Of=class n extends Sn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=IT(this,e,!0),i=this.Ku.map(s=>Ji(s,t)),r=new Cn(i);return new ji(e.path,r)}isEqual(e){return e instanceof n&&wh(this.Ku,e.Ku)}},Mf=class n extends Sn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=IT(this,e,!0),i=this.Ku.map(s=>Ji(s,t)),r=new bn(i);return new ji(e.path,r)}isEqual(e){return e instanceof n&&wh(this.Ku,e.Ku)}},Ff=class n extends Sn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new ri(e.serializer,uw(e.serializer,this.$u));return new ji(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function Ip(n,e,t,i){let r=n.Qu(1,e,t);Cp("Data must be an object, but it was:",r,i);let s=[],o=et.empty();Hi(i,(c,u)=>{let d=bp(e,c,t);u=ne(u);let p=r.Nu(d);if(u instanceof Ko)s.push(d);else{let m=Ji(u,p);m!=null&&(s.push(d),o.set(d,m))}});let a=new yt(s);return new mc(o,a,r.fieldTransforms)}function Ap(n,e,t,i,r,s){let o=n.Qu(1,e,t),a=[Lf(e,i,t)],c=[r];if(s.length%2!=0)throw new D(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Lf(e,s[m])),c.push(s[m+1]);let u=[],d=et.empty();for(let m=a.length-1;m>=0;--m)if(!ST(u,a[m])){let y=a[m],C=c[m];C=ne(C);let x=o.Nu(y);if(C instanceof Ko)u.push(y);else{let k=Ji(C,x);k!=null&&(u.push(y),d.set(y,k))}}let p=new yt(u);return new mc(d,p,o.fieldTransforms)}function AT(n,e,t,i=!1){return Ji(t,n.Qu(i?4:3,e))}function Ji(n,e){if(bT(n=ne(n)))return Cp("Unsupported field value:",e,n),CT(n,e);if(n instanceof Sn)return function(i,r){if(!ET(r.Cu))throw r.Bu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let c=Ji(a,r.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=ne(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return uw(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=we.fromDate(i);return{timestampValue:qr(r.serializer,s)}}if(i instanceof we){let s=new we(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:qr(r.serializer,s)}}if(i instanceof Wi)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof sn)return{bytesValue:ww(r.serializer,i._byteString)};if(i instanceof pe){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Zf(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof Go)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return Xf(a.serializer,c)})}}}}}}(i,r);throw r.Bu(`Unsupported field value: ${Rc(i)}`)}(n,e)}function CT(n,e){let t={};return Wv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hi(n,(i,r)=>{let s=Ji(r,e.Mu(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function bT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof we||n instanceof Wi||n instanceof sn||n instanceof pe||n instanceof Sn||n instanceof Go)}function Cp(n,e,t){if(!bT(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=Rc(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function Lf(n,e,t){if((e=ne(e))instanceof qt)return e._internalPath;if(typeof e=="string")return bp(n,e);throw _c("Field path arguments must be of type string or ",n,!1,void 0,t)}var Hb=new RegExp("[~\\*/\\[\\]]");function bp(n,e,t){if(e.search(Hb)>=0)throw _c(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qt(...e.split("."))._internalPath}catch{throw _c(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function _c(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new D(P.INVALID_ARGUMENT,a+n+c)}function ST(n,e){return n.some(t=>t.isEqual(e))}var $i=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(xc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Uf=class extends $i{data(){return super.data()}};function xc(n,e){return typeof e=="string"?bp(n,e):e instanceof qt?e._internalPath:e._delegate._internalPath}function RT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var zo=class{},Qi=class extends zo{};function xn(n,e,...t){let i=[];e instanceof zo&&i.push(e),i=i.concat(t),function(s){let o=s.filter(c=>c instanceof Bf).length,a=s.filter(c=>c instanceof yc).length;if(o>1||o>0&&a>0)throw new D(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var yc=class n extends Qi{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return LT(e._query,t),new $e(e.firestore,e.converter,md(e._query,t))}_parse(e){let t=Yi(e.firestore);return function(s,o,a,c,u,d,p){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Dv(p,d);let y=[];for(let C of p)y.push(kv(c,s,C));m={arrayValue:{values:y}}}else m=kv(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Dv(p,d),m=AT(a,o,p,d==="in"||d==="not-in");return ie.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function PT(n,e,t){let i=e,r=xc("where",n);return yc._create(r,i,t)}var Bf=class n extends zo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let c of a)LT(o,c),o=md(o,c)}(e._query,t),new $e(e.firestore,e.converter,md(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var qf=class n extends Qi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bi(s,o)}(e._query,this._field,this._direction);return new $e(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Ut(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function xT(n,e="asc"){let t=e,i=xc("orderBy",n);return qf._create(i,t)}var vc=class n extends Qi{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new $e(e.firestore,e.converter,Fl(e._query,this._limit,this._limitType))}};function NT(n){return lT("limit",n),vc._create("limit",n,"F")}function kT(n){return lT("limitToLast",n),vc._create("limitToLast",n,"L")}var wc=class n extends Qi{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=FT(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(r,s){return new Ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function DT(...n){return wc._create("startAt",n,!0)}function VT(...n){return wc._create("startAfter",n,!1)}var Tc=class n extends Qi{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=FT(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(r,s){return new Ut(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function OT(...n){return Tc._create("endBefore",n,!1)}function MT(...n){return Tc._create("endAt",n,!0)}function FT(n,e,t,i){if(t[0]=ne(t[0]),t[0]instanceof $i)return function(s,o,a,c,u){if(!c)throw new D(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of Dr(s))if(p.field.isKeyField())d.push(Ui(o,c.key));else{let m=c.data.field(p.field);if(Ic(m))throw new D(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=p.field.canonicalString();throw new D(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new nn(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=Yi(n.firestore);return function(o,a,c,u,d,p){let m=o.explicitOrderBy;if(d.length>m.length)throw new D(P.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let C=0;C<d.length;C++){let x=d[C];if(m[C].field.isKeyField()){if(typeof x!="string")throw new D(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof x}`);if(!Yf(o)&&x.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${x}' contains a slash.`);let k=o.path.child(se.fromString(x));if(!U.isDocumentKey(k))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let q=new U(k);y.push(Ui(a,q))}else{let k=AT(c,u,x);y.push(k)}}return new nn(y,p)}(n._query,n.firestore._databaseId,r,e,t,i)}}function kv(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yf(e)&&t.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(se.fromString(t));if(!U.isDocumentKey(i))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ui(n,new U(i))}if(t instanceof pe)return Ui(n,t._key);throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rc(t)}.`)}function Dv(n,e){if(!Array.isArray(n)||n.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LT(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Jr=class{convertValue(e,t="none"){switch(Li(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ye(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return Hi(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>ye(o.doubleValue));return new Go(s)}convertGeoPoint(e){return new Wi(ye(e.latitude),ye(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=Qf(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Ro(e));default:return null}}convertTimestamp(e){let t=An(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=se.fromString(e);G(Nw(i));let r=new ti(i.get(1),i.get(3)),s=new U(i.popFirst(5));return r.isEqual(t)||Se(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Nc(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var jf=class extends Jr{constructor(e){super(),this.firestore=e}convertBytes(e){return new sn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};var In=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Pt=class extends $i{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Jn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(xc("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},Jn=class extends Pt{data(e={}){return super.data(e)}},jt=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new In(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Jn(this._firestore,this._userDataWriter,i.key,i,new In(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new Jn(r._firestore,r._userDataWriter,a.doc.key,a.doc,new In(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Jn(r._firestore,r._userDataWriter,a.doc.key,a.doc,new In(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Yb(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Yb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function Sp(n,e){return n instanceof Pt&&e instanceof Pt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof jt&&e instanceof jt&&n._firestore===e._firestore&&Ep(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function UT(n){n=oe(n,pe);let e=oe(n.firestore,Te);return sT(Qe(e),n._key).then(t=>Np(e,n,t))}var Rn=class extends Jr{constructor(e){super(),this.firestore=e}convertBytes(e){return new sn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}};function BT(n){n=oe(n,pe);let e=oe(n.firestore,Te),t=Qe(e),i=new Rn(e);return Gb(t,n._key).then(r=>new Pt(e,i,n._key,r,new In(r!==null&&r.hasLocalMutations,!0),n.converter))}function qT(n){n=oe(n,pe);let e=oe(n.firestore,Te);return sT(Qe(e),n._key,{source:"server"}).then(t=>Np(e,n,t))}function jT(n){n=oe(n,$e);let e=oe(n.firestore,Te),t=Qe(e),i=new Rn(e);return RT(n._query),oT(t,n._query).then(r=>new jt(e,i,n,r))}function GT(n){n=oe(n,$e);let e=oe(n.firestore,Te),t=Qe(e),i=new Rn(e);return Kb(t,n._query).then(r=>new jt(e,i,n,r))}function KT(n){n=oe(n,$e);let e=oe(n.firestore,Te),t=Qe(e),i=new Rn(e);return oT(t,n._query,{source:"server"}).then(r=>new jt(e,i,n,r))}function Rp(n,e,t){n=oe(n,pe);let i=oe(n.firestore,Te),r=Nc(n.converter,e,t);return rs(i,[Pc(Yi(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Ce.none())])}function Pp(n,e,t,...i){n=oe(n,pe);let r=oe(n.firestore,Te),s=Yi(r),o;return o=typeof(e=ne(e))=="string"||e instanceof qt?Ap(s,"updateDoc",n._key,e,t,i):Ip(s,"updateDoc",n._key,e),rs(r,[o.toMutation(n._key,Ce.exists(!0))])}function zT(n){return rs(oe(n.firestore,Te),[new oi(n._key,Ce.none())])}function WT(n,e){let t=oe(n.firestore,Te),i=Xo(n),r=Nc(n.converter,e);return rs(t,[Pc(Yi(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Ce.exists(!1))]).then(()=>i)}function xp(n,...e){var t,i,r;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xf(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xf(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let c,u,d;if(n instanceof pe)u=oe(n.firestore,Te),d=Zr(n._key.path),c={next:p=>{e[o]&&e[o](Np(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=oe(n,$e);u=oe(p.firestore,Te),d=p._query;let m=new Rn(u);c={next:y=>{e[o]&&e[o](new jt(u,m,p,y))},error:e[o+1],complete:e[o+2]},RT(n._query)}return function(m,y,C,x){let k=new Hr(x),q=new jo(y,k,C);return m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return op(yield Yr(m),q)})),()=>{k.Za(),m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return ap(yield Yr(m),q)}))}}(Qe(u),d,a,c)}function $T(n,e){return zb(Qe(n=oe(n,Te)),xf(e)?e:{next:e})}function rs(n,e){return function(i,r){let s=new Be;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return Ab(yield _p(i),r,s)})),s.promise}(Qe(n),e)}function Np(n,e,t){let i=t.docs.get(e._key),r=new Rn(n);return new Pt(n,r,e._key,i,new In(t.hasPendingWrites,t.fromCache),e.converter)}var Jb={maxAttempts:5};var Ec=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yi(e)}set(e,t,i){this._verifyNotCommitted();let r=Hn(e,this._firestore),s=Nc(r.converter,t,i),o=Pc(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Ce.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=Hn(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof qt?Ap(this._dataReader,"WriteBatch.update",s._key,t,i,r):Ip(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ce.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Hn(e,this._firestore);return this._mutations=this._mutations.concat(new oi(t._key,Ce.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Hn(n,e){if((n=ne(n)).firestore!==e)throw new D(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Gf=class extends class{constructor(t,i){this._firestore=t,this._transaction=i,this._dataReader=Yi(t)}get(t){let i=Hn(t,this._firestore),r=new jf(this._firestore);return this._transaction.lookup([i._key]).then(s=>{if(!s||s.length!==1)return B();let o=s[0];if(o.isFoundDocument())return new $i(this._firestore,r,o.key,o,i.converter);if(o.isNoDocument())return new $i(this._firestore,r,i._key,null,i.converter);throw B()})}set(t,i,r){let s=Hn(t,this._firestore),o=Nc(s.converter,i,r),a=Pc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,a),this}update(t,i,r,...s){let o=Hn(t,this._firestore),a;return a=typeof(i=ne(i))=="string"||i instanceof qt?Ap(this._dataReader,"Transaction.update",o._key,i,r,s):Ip(this._dataReader,"Transaction.update",o._key,i),this._transaction.update(o._key,a),this}delete(t){let i=Hn(t,this._firestore);return this._transaction.delete(i._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Hn(e,this._firestore),i=new Rn(this._firestore);return super.get(e).then(r=>new Pt(this._firestore,i,t._key,r._document,new In(!1,!1),t.converter))}};function QT(n,e,t){n=oe(n,Te);let i=Object.assign(Object.assign({},Jb),t);return function(s){if(s.maxAttempts<1)throw new D(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,o,a){let c=new Be;return s.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let u=yield Bb(s);new Rf(s.asyncQueue,u,a,o,c).au()})),c.promise}(Qe(n),r=>e(new Gf(n,r)),i)}function HT(){return new Ko("deleteField")}function YT(){return new Vf("serverTimestamp")}function JT(...n){return new Of("arrayUnion",n)}function XT(...n){return new Mf("arrayRemove",n)}function ZT(n){return new Ff("increment",n)}(function(e,t=!0){(function(r){Xr=r})(hl),Ri(new gt("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Te(new Wh(i.getProvider("auth-internal")),new Yh(i.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new D(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ti(u.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Mt(Ny,"4.7.3",e),Mt(Ny,"4.7.3","esm2017")})();var Xb="@firebase/firestore-compat",Zb="0.3.38";function Fp(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function eE(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function tE(){if(!$v())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var kc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return tE(),new n(sn.fromBase64String(e))}static fromUint8Array(e){return eE(),new n(sn.fromUint8Array(e))}toBase64(){return tE(),this._delegate.toBase64()}toUint8Array(){return eE(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function kp(n){return eS(n,["next","error","complete"])}function eS(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Dp=class{enableIndexedDbPersistence(e,t){return fT(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return pT(e._delegate)}clearIndexedDbPersistence(e){return gT(e._delegate)}},Dc=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof ti||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Lt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){cT(this._delegate,e,t,i)}enableNetwork(){return yT(this._delegate)}disableNetwork(){return vT(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,vp("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return _T(this._delegate)}onSnapshotsInSync(e){return $T(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new as(this,wp(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new on(this,Xo(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new tr(this,uT(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return QT(this._delegate,t=>e(new Vc(this,t)))}batch(){return Qe(this._delegate),new Oc(new Ec(this._delegate,e=>rs(this._delegate,e)))}loadBundle(e){return wT(this._delegate,e)}namedQuery(e){return TT(this._delegate,e).then(t=>t?new tr(this,t):null)}},ss=class extends Jr{constructor(e){super(),this.firestore=e}convertBytes(e){return new kc(new sn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return on.forKey(t,this.firestore,null)}};function tS(n){Vv(n)}var Vc=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ss(e)}get(e){let t=Xi(e);return this._delegate.get(t).then(i=>new Zi(this._firestore,new Pt(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=Xi(e);return i?(Fp("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=Xi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=Xi(e);return this._delegate.delete(t),this}},Oc=class{constructor(e){this._delegate=e}set(e,t,i){let r=Xi(e);return i?(Fp("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=Xi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=Xi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},os=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new Jn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new er(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new ss(e),t),r.set(t,s)),s}};os.INSTANCES=new WeakMap;var on=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ss(e)}static forPath(e,t,i){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new pe(t._delegate,i,new U(e)))}static forKey(e,t,i){return new n(t,new pe(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new as(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new as(this.firestore,wp(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof pe?Tp(this._delegate,e):!1}set(e,t){t=Fp("DocumentReference.set",t);try{return t?Rp(this._delegate,e,t):Rp(this._delegate,e)}catch(i){throw at(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Pp(this._delegate,e):Pp(this._delegate,e,t,...i)}catch(r){throw at(r,"updateDoc()","DocumentReference.update()")}}delete(){return zT(this._delegate)}onSnapshot(...e){let t=nE(e),i=iE(e,r=>new Zi(this.firestore,new Pt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return xp(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=BT(this._delegate):e?.source==="server"?t=qT(this._delegate):t=UT(this._delegate),t.then(i=>new Zi(this.firestore,new Pt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(os.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function at(n,e,t){return n.message=n.message.replace(e,t),n}function nE(n){for(let e of n)if(typeof e=="object"&&!kp(e))return e;return{}}function iE(n,e){var t,i;let r;return kp(n[0])?r=n[0]:kp(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var Zi=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new on(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Sp(this._delegate,e._delegate)}},er=class extends Zi{data(e){let t=this._delegate.data(e);return this._delegate._converter||Ov(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},tr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ss(e)}where(e,t,i){try{return new n(this.firestore,xn(this._delegate,PT(e,t,i)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,xn(this._delegate,xT(e,t)))}catch(i){throw at(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,xn(this._delegate,NT(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,xn(this._delegate,kT(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,xn(this._delegate,DT(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,xn(this._delegate,VT(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,xn(this._delegate,OT(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,xn(this._delegate,MT(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return Ep(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=GT(this._delegate):e?.source==="server"?t=KT(this._delegate):t=jT(this._delegate),t.then(i=>new Zo(this.firestore,new jt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=nE(e),i=iE(e,r=>new Zo(this.firestore,new jt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return xp(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(os.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Vp=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new er(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Zo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new tr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new er(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Vp(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new er(this._firestore,i))})}isEqual(e){return Sp(this._delegate,e._delegate)}},as=class n extends tr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new on(this.firestore,e):null}doc(e){try{return e===void 0?new on(this.firestore,Xo(this._delegate)):new on(this.firestore,Xo(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return WT(this._delegate,e).then(t=>new on(this.firestore,t))}isEqual(e){return Tp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(os.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Xi(n){return oe(n,pe)}var Op=class n{constructor(...e){this._delegate=new qt(...e)}static documentId(){return new n(Re.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof qt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Mp=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=YT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=HT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=JT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=XT(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=ZT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var nS={Firestore:Dc,GeoPoint:Wi,Timestamp:we,Blob:kc,Transaction:Vc,WriteBatch:Oc,DocumentReference:on,DocumentSnapshot:Zi,Query:tr,QueryDocumentSnapshot:er,QuerySnapshot:Zo,CollectionReference:as,FieldPath:Op,FieldValue:Mp,setLogLevel:tS,CACHE_SIZE_UNLIMITED:hT};function iS(n,e){n.INTERNAL.registerComponent(new gt("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},nS)))}function rS(n){iS(n,(e,t)=>new Dc(e,t,new Dp)),n.registerVersion(Xb,Zb)}rS(Ue);function sS(n,e=mr){return new Fn(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function rE(n,e){return sS(n,e)}function oS(n,e){return rE(n,e).pipe(Xa(void 0),Ja(),Ae(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Bp(n,e){return rE(n,e).pipe(Ae(t=>({payload:t,type:"query"})))}var Mc=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=cE(i,t);return new Lc(r,s,this.afs)}snapshotChanges(){return oS(this.ref,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return this.snapshotChanges().pipe(Ae(({payload:t})=>e.idField?Vt(je({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Ln(this.ref.get(e)).pipe(be)}};function Fc(n,e){return Bp(n,e).pipe(Xa(void 0),Ja(),Ae(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=i?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function sE(n,e,t){return Fc(n,t).pipe(Ci((i,r)=>aS(i,r.map(s=>s.payload),e),[]),Ya(),Ae(i=>i.map(r=>({type:r.type,payload:r}))))}function aS(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=lS(n,i))}),n}function Lp(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function lS(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Lp(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Lp(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Lp(n,e.oldIndex,1);break}return n}function oE(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Lc=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Fc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ae(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Xa(void 0),Ja(),Ws(([i,r])=>r.length>0||!i),Ae(([,i])=>i),be)}auditTrail(e){return this.stateChanges(e).pipe(Ci((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=oE(e);return sE(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return Bp(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.payload.docs.map(i=>e.idField?Vt(je({},i.data()),{[e.idField]:i.id}):i.data())),be)}get(e){return Ln(this.query.get(e)).pipe(be)}add(e){return this.ref.add(e)}doc(e){return new Mc(this.ref.doc(e),this.afs)}},Up=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Fc(this.query,this.afs.schedulers.outsideAngular).pipe(be):Fc(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.filter(i=>e.indexOf(i.type)>-1)),Ws(t=>t.length>0),be)}auditTrail(e){return this.stateChanges(e).pipe(Ci((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=oE(e);return sE(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return Bp(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(i=>i.payload.docs.map(r=>e.idField?je({[e.idField]:r.id},r.data()):r.data())),be)}get(e){return Ln(this.query.get(e)).pipe(be)}},aE=new Ne("angularfire2.enableFirestorePersistence"),lE=new Ne("angularfire2.firestore.persistenceSettings"),cS=new Ne("angularfire2.firestore.settings"),uS=new Ne("angularfire2.firestore.use-emulator");function cE(n,e=t=>t){return{query:e(n),ref:n}}var hS=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,x,k,q,j){this.schedulers=c;let M=Pi(t,a,i),W=d;p&&uo(M,a,m,C,x,k,y,q),[this.firestore,this.persistenceEnabled$]=wr(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let H=a.runOutsideAngular(()=>M.firestore());if(s&&H.settings(s),W&&H.useEmulator(...W),r&&!nl(o)){let Y=()=>{try{return Ln(H.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),Wt(!1)}};return[H,a.runOutsideAngular(Y)]}else return[H,Wt(!1)]},[s,W,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=cE(r,i),a=this.schedulers.ngZone.run(()=>s);return new Lc(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new Up(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.schedulers.ngZone.run(()=>i);return new Mc(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(K(jn),K(Gn,8),K(aE,8),K(cS,8),K(Un),K(pt),K(vr),K(lE,8),K(uS,8),K(ho,8),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(co,8),K(vn,8))};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),gk=(()=>{class n{constructor(){Ue.registerVersion("angularfire",wn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:aE,useValue:!0},{provide:lE,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Qt({type:n});static \u0275inj=$t({providers:[hS]})}return n})();At();At();Za();$s();var uE="@firebase/database",hE="1.0.8";var Xm="";function Zm(n){Xm=n}var Qp=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ke(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ll(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Hp=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ct(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var jE=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Qp(e)}}catch{}return new Hp},ir=jE("localStorage"),Yp=jE("sessionStorage");var hs=new qn("@firebase/database"),GE=function(){let n=1;return function(){return n++}}(),KE=function(n){let e=hy(n),t=new uy;t.update(e);let i=t.digest();return sl.encodeByteArray(i)},Ia=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Ia.apply(null,i):typeof i=="object"?e+=ke(i):e+=i,e+=" "}return e},rr=null,dE=!0,zE=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(hs.logLevel=bt.VERBOSE,rr=hs.log.bind(hs),e&&Yp.set("logging_enabled",!0)):typeof n=="function"?rr=n:(rr=null,Yp.remove("logging_enabled"))},Ke=function(...n){if(dE===!0&&(dE=!1,rr===null&&Yp.get("logging_enabled")===!0&&zE(!0)),rr){let e=Ia.apply(null,n);rr(e)}},Aa=function(n){return function(...e){Ke(n,...e)}},Jp=function(...n){let e="FIREBASE INTERNAL ERROR: "+Ia(...n);hs.error(e)},cn=function(...n){let e=`FIREBASE FATAL ERROR: ${Ia(...n)}`;throw hs.error(e),new Error(e)},tt=function(...n){let e="FIREBASE WARNING: "+Ia(...n);hs.warn(e)},dS=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},du=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},fS=function(n){if(Ht()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},pi="[MIN_NAME]",Nn="[MAX_NAME]",or=function(n,e){if(n===e)return 0;if(n===pi||e===Nn)return-1;if(e===pi||n===Nn)return 1;{let t=fE(n),i=fE(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},pS=function(n,e){return n===e?0:n<e?-1:1},ea=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ke(e))},eg=function(n){if(typeof n!="object"||n===null)return ke(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ke(e[i]),t+=":",t+=eg(n[e[i]]);return t+="}",t},WE=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function ze(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var $E=function(n){O(!du(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(r?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},mS=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},gS=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function _S(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var yS=new RegExp("^-?(0*)\\d{1,10}$"),vS=-2147483648,wS=2147483647,fE=function(n){if(yS.test(n)){let e=Number(n);if(e>=vS&&e<=wS)return e}return null},ws=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},TS=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ra=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Xp=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){tt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Zp=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ke("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tt(e)}},sa=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Bc="5",QE="v",HE="s",YE="r",JE="f",XE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ZE="ls",eI="p",em="ac",tI="websocket",nI="long_polling";var qc=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ir.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ir.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function ES(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function iI(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let i;if(e===tI)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===nI)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);ES(n)&&(t.ns=n.namespace);let r=[];return ze(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var tm=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Ct(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return iy(this.counters_)}};var qp={},jp={};function tg(n){let e=n.toString();return qp[e]||(qp[e]=new tm),qp[e]}function IS(n,e){let t=n.toString();return jp[t]||(jp[t]=e()),jp[t]}var nm=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&ws(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var pE="start",AS="close",CS="pLPCommand",bS="pRTLPCB",rI="id",sI="pw",oI="ser",SS="cb",RS="seg",PS="ts",xS="d",NS="dframe",aI=1870,lI=30,kS=aI-lI,DS=25e3,VS=3e4,ca=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Aa(e),this.stats_=tg(t),this.urlFn=c=>(this.appCheckToken&&(c[em]=this.appCheckToken),iI(t,nI,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nm(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(VS)),fS(()=>{if(this.isClosed_)return;this.scriptTagHolder=new im((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===pE)this.id=a,this.password=c;else if(o===AS)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[pE]="t",i[oI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[SS]=this.scriptTagHolder.uniqueCallbackIdentifier),i[QE]=Bc,this.transportSessionId&&(i[HE]=this.transportSessionId),this.lastSessionId&&(i[ZE]=this.lastSessionId),this.applicationId&&(i[eI]=this.applicationId),this.appCheckToken&&(i[em]=this.appCheckToken),typeof location<"u"&&location.hostname&&XE.test(location.hostname)&&(i[YE]=JE);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ht()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!mS()&&!gS()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ke(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=ny(t),r=WE(i,kS);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ht())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[NS]="t",i[rI]=e,i[sI]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ke(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},im=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ht())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=GE(),window[CS+this.uniqueCallbackIdentifier]=e,window[bS+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ke("frame writing exception"),a.stack&&Ke(a.stack),Ke(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ke("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[rI]=this.myID,e[sI]=this.myPW,e[oI]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+lI+i.length<=aI;){let o=this.pendingSegs.shift();i=i+"&"+RS+r+"="+o.seg+"&"+PS+r+"="+o.ts+"&"+xS+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(DS)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){Ht()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Ke("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var OS=16384,MS=45e3,jc=null;typeof MozWebSocket<"u"?jc=MozWebSocket:typeof WebSocket<"u"&&(jc=WebSocket);var cs=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Aa(this.connId),this.stats_=tg(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[QE]=Bc,!Ht()&&typeof location<"u"&&location.hostname&&XE.test(location.hostname)&&(a[YE]=JE),i&&(a[HE]=i),r&&(a[ZE]=r),s&&(a[em]=s),o&&(a[eI]=o),iI(t,tI,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ir.set("previous_websocket_failure",!0);try{let r;if(Ht()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${Bc}/${Xm}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new jc(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&jc!==null&&!n.forceDisallow_}static previouslyFailed(){return ir.isInMemoryStorage||ir.get("previous_websocket_failure")===!0}markConnectionHealthy(){ir.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=ll(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=ke(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=WE(i,OS);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(MS))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),cI=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[ca,cs]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=cs&&cs.isAvailable(),r=i&&!cs.previouslyFailed();if(t.webSocketOnly&&(i||tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[cs];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),FS=6e4,LS=5e3,US=10*1024,BS=100*1024,Gp="t",mE="d",qS="s",gE="r",jS="e",_E="o",yE="a",vE="n",wE="p",GS="h",rm=class{constructor(e,t,i,r,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Aa("c:"+this.id+":"),this.transportManager_=new cI(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ra(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BS?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>US?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Gp in e){let t=e[Gp];t===yE?this.upgradeIfSecondaryHealthy_():t===gE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===_E&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ea("t",e),i=ea("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:wE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:yE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:vE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ea("t",e),i=ea("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ea(Gp,e);if(mE in e){let i=e[mE];if(t===GS){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===vE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===qS?this.onConnectionShutdown_(i):t===gE?this.onReset_(i):t===jS?Jp("Server Error: "+i):t===_E?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Jp("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Bc!==i&&tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ra(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(FS))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ra(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(LS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:wE,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ir.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Gc=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var Kc=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var zc=class n extends Kc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!yh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var TE=32,EE=768,ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ce("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function mi(n){return n.pieces_.length-n.pieceNum_}function fe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function ng(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function KS(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function ua(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function uI(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function ve(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof ce)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new ce(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function lt(n,e){let t=Z(n),i=Z(e);if(t===null)return e;if(t===i)return lt(fe(n),fe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function zS(n,e){let t=ua(n,0),i=ua(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=or(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function ig(n,e){if(mi(n)!==mi(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function xt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(mi(n)>mi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var sm=class{constructor(e,t){this.errorPrefix_=t,this.parts_=ua(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=to(this.parts_[i]);hI(this)}};function WS(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=to(e),hI(n)}function $S(n){let e=n.parts_.pop();n.byteLength_-=to(e),n.parts_.length>0&&(n.byteLength_-=1)}function hI(n){if(n.byteLength_>EE)throw new Error(n.errorPrefix_+"has a key path longer than "+EE+" bytes ("+n.byteLength_+").");if(n.parts_.length>TE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+TE+") or object contains a cycle "+nr(n))}function nr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var om=class n extends Kc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var ta=1e3,QS=60*5*1e3,IE=30*1e3,HS=1.3,YS=3e4,JS="server_kill",AE=3,rg=(()=>{class n extends Gc{constructor(t,i,r,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=Aa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ta,this.maxReconnectDelay_=QS,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Ht())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");om.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&zc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(ke(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new Ge,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&Ct(t,"w")){let r=Bn(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ly(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=IE)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=ay(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ke(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Jp("Unrecognized action received from server: "+ke(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ta,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ta,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>YS&&(this.reconnectDelay_=ta),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*HS)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,r())},d=function(m){O(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,y]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?Ke("getToken() completed but was canceled"):(Ke("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=y&&y.token,c=new rm(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,C=>{tt(C+" ("+this.repoInfo_.toString()+")"),this.interrupt(JS)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&tt(m),u())}}})}interrupt(t){Ke("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ke("Resuming connection for reason: "+t),delete this.interruptReasons_[t],cl(this.interruptReasons_)&&(this.reconnectDelay_=ta,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>eg(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new ce(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){Ke("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=AE&&(this.reconnectDelay_=IE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){Ke("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=AE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";Ht()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Xm.replace(/\./g,"-")]=1,yh()?t["framework.cordova"]=1:ry()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=zc.getInstance().currentlyOnline();return cl(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var ds=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new te(pi,e),r=new te(pi,t);return this.compare(i,r)!==0}minPost(){return te.MIN}};var Uc,Wc=class extends ds{static get __EMPTY_NODE(){return Uc}static set __EMPTY_NODE(e){Uc=e}compare(e,t){return or(e.name,t.name)}isDefinedOn(e){throw yr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(Nn,Uc)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,Uc)}toString(){return".key"}},ln=new Wc;var us=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Gt=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??Nt.EMPTY_NODE,this.right=o??Nt.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Nt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return Nt.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),am=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new Gt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Nt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Gt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Gt.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new us(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new us(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new us(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new us(this.root_,null,this.comparator_,!0,e)}};Nt.EMPTY_NODE=new am;function XS(n,e){return or(n.name,e.name)}function sg(n,e){return or(n,e)}var lm;function ZS(n){lm=n}var dI=function(n){return typeof n=="number"?"number:"+$E(n):"string:"+n},fI=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ct(e,".sv"),"Priority must be a string or number.")}else O(n===lm||n.isEmpty(),"priority of unexpected type.");O(n===lm||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var CE,fs=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),fI(this.priorityNode_)}static set __childrenNodeConstructor(t){CE=t}static get __childrenNodeConstructor(){return CE}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=Z(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(O(r!==".priority"||mi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(fe(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+dI(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=$E(this.value_):t+=this.value_,this.lazyHash_=KE(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return O(s>=0,"Unknown leaf type: "+i),O(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),pI,mI;function eR(n){pI=n}function tR(n){mI=n}var cm=class extends ds{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?or(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(Nn,new fs("[PRIORITY-POST]",mI))}makePost(e,t){let i=pI(e);return new te(t,new fs("[PRIORITY-POST]",i))}toString(){return".priority"}},me=new cm;var nR=Math.log(2),um=class{constructor(e){let t=s=>parseInt(Math.log(s)/nR,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},$c=function(n,e,t,i){n.sort(e);let r=function(c,u){let d=u-c,p,m;if(d===0)return null;if(d===1)return p=n[c],m=t?t(p):p,new Gt(m,p.node,Gt.BLACK,null,null);{let y=parseInt(d/2,10)+c,C=r(c,y),x=r(y+1,u);return p=n[y],m=t?t(p):p,new Gt(m,p.node,Gt.BLACK,C,x)}},s=function(c){let u=null,d=null,p=n.length,m=function(C,x){let k=p-C,q=p;p-=C;let j=r(k+1,q),M=n[k],W=t?t(M):M;y(new Gt(W,M.node,x,null,j))},y=function(C){u?(u.left=C,u=C):(d=C,u=C)};for(let C=0;C<c.count;++C){let x=c.nextBitIsOne(),k=Math.pow(2,c.count-(C+1));x?m(k,Gt.BLACK):(m(k,Gt.BLACK),m(k,Gt.RED))}return d},o=new um(n.length),a=s(o);return new Nt(i||e,a)};var Kp,ls={},ps=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(ls&&me,"ChildrenNode.ts has not been loaded"),Kp=Kp||new n({".priority":ls},{".priority":me}),Kp}get(e){let t=Bn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Nt?t:null}hasIndex(e){return Ct(this.indexSet_,e.toString())}addIndex(e,t){O(e!==ln,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=$c(i,e.getCompare()):a=ls;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let i=eo(this.indexes_,(r,s)=>{let o=Bn(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),r===ls)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(te.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),$c(a,o.getCompare())}else return ls;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new te(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=eo(this.indexes_,r=>{if(r===ls)return r;{let s=t.get(e.name);return s?r.remove(new te(e.name,s)):r}});return new n(i,this.indexSet_)}};var na,J=(()=>{class n{constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&fI(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return na||(na=new n(new Nt(sg),null,ps.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||na}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?na:i}}getChild(t){let i=Z(t);return i===null?this:this.getImmediateChild(i).getChild(fe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(O(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new te(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?na:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=Z(t);if(r===null)return i;{O(Z(t)!==".priority"||mi(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(fe(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(me,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+dI(this.getPriority().val())+":"),this.forEachChild(me,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":KE(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new te(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new te(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new te(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ca?-1:0}withIndex(t){if(t===ln||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===ln||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(me),s=i.getIterator(me),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===ln?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),hm=class extends J{constructor(){super(new Nt(sg),J.EMPTY_NODE,ps.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return J.EMPTY_NODE}isEmpty(){return!1}},Ca=new hm;Object.defineProperties(te,{MIN:{value:new te(pi,J.EMPTY_NODE)},MAX:{value:new te(Nn,Ca)}});Wc.__EMPTY_NODE=J.EMPTY_NODE;fs.__childrenNodeConstructor=J;ZS(Ca);tR(Ca);var iR=!0;function Ee(n,e=null){if(n===null)return J.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new fs(t,Ee(e))}if(!(n instanceof Array)&&iR){let t=[],i=!1;if(ze(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=Ee(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new te(o,c)))}}),t.length===0)return J.EMPTY_NODE;let s=$c(t,XS,o=>o.name,sg);if(i){let o=$c(t,me.getCompare());return new J(s,Ee(e),new ps({".priority":o},{".priority":me}))}else return new J(s,Ee(e),ps.Default)}else{let t=J.EMPTY_NODE;return ze(n,(i,r)=>{if(Ct(n,i)&&i.substring(0,1)!=="."){let s=Ee(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(Ee(e))}}eR(Ee);var ha=class extends ds{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?or(e.name,t.name):s}makePost(e,t){let i=Ee(e),r=J.EMPTY_NODE.updateChild(this.indexPath_,i);return new te(t,r)}maxPost(){let e=J.EMPTY_NODE.updateChild(this.indexPath_,Ca);return new te(Nn,e)}toString(){return ua(this.indexPath_,0).join("/")}};var dm=class extends ds{compare(e,t){let i=e.node.compareTo(t.node);return i===0?or(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let i=Ee(e);return new te(t,i)}toString(){return".value"}},og=new dm;function gI(n){return{type:"value",snapshotNode:n}}function ms(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function da(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function fa(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function rR(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var pa=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(da(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ms(t,i)):o.trackChildChange(fa(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(me,(r,s)=>{t.hasChild(r)||i.trackChildChange(da(r,s))}),t.isLeafNode()||t.forEachChild(me,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(fa(r,s,o))}else i.trackChildChange(ms(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?J.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Qc=class n{constructor(e){this.indexedFilter_=new pa(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new te(t,i))||(i=J.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=J.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(J.EMPTY_NODE);let s=this;return t.forEachChild(me,(o,a)=>{s.matches(new te(o,a))||(r=r.updateImmediateChild(o,J.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var fm=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Qc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new te(t,i))||(i=J.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=J.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=J.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(J.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,J.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(m,y)=>p(y,m)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let c=new te(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),m=r.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);let y=m==null?1:o(m,c);if(d&&!i.isEmpty()&&y>=0)return s?.trackChildChange(fa(t,i,p)),a.updateImmediateChild(t,i);{s?.trackChildChange(da(t,p));let x=a.updateImmediateChild(t,J.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(ms(m.name,m.node)),x.updateImmediateChild(m.name,m.node)):x}}else return i.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(da(u.name,u.node)),s.trackChildChange(ms(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,J.EMPTY_NODE)):e}};var ma=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=me}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:pi}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Nn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===me}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function sR(n){return n.loadsAllData()?new pa(n.getIndex()):n.hasLimit()?new fm(n):new Qc(n)}function oR(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function aR(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function pm(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function lR(n,e,t){let i;return n.index_===ln||t?i=pm(n,e,t):i=pm(n,e,Nn),i.startAfterSet_=!0,i}function mm(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function cR(n,e,t){let i;return n.index_===ln||t?i=mm(n,e,t):i=mm(n,e,pi),i.endBeforeSet_=!0,i}function fu(n,e){let t=n.copy();return t.index_=e,t}function bE(n){let e={};if(n.isDefault())return e;let t;if(n.index_===me?t="$priority":n.index_===og?t="$value":n.index_===ln?t="$key":(O(n.index_ instanceof ha,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ke(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=ke(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+ke(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=ke(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+ke(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function SE(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==me&&(e.i=n.index_.toString()),e}var gm=class n extends Gc{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Aa("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=bE(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,i),Bn(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",r(m,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=bE(e._queryParams),i=e._path.toString(),r=new Ge;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+cy(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=ll(a.responseText)}catch{tt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&tt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var _m=class{constructor(){this.rootNode_=J.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Hc(){return{value:null,children:new Map}}function Ts(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=Z(e);n.children.has(i)||n.children.set(i,Hc());let r=n.children.get(i);e=fe(e),Ts(r,e,t)}}function ym(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(me,(i,r)=>{Ts(n,new ce(i),r)}),ym(n,e)}}else if(n.children.size>0){let t=Z(e);return e=fe(e),n.children.has(t)&&ym(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function vm(n,e,t){n.value!==null?t(e,n.value):uR(n,(i,r)=>{let s=new ce(e.toString()+"/"+i);vm(r,s,t)})}function uR(n,e){n.children.forEach((t,i)=>{e(i,t)})}var wm=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ze(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var RE=10*1e3,hR=30*1e3,dR=5*60*1e3,Tm=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new wm(e);let i=RE+(hR-RE)*Math.random();ra(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;ze(e,(r,s)=>{s>0&&Ct(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),ra(this.reportStats_.bind(this),Math.floor(Math.random()*2*dR))}};var an=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(an||{});function ag(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function lg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function cg(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Em=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=an.ACK_USER_WRITE,this.source=ag()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ce(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(fe(this.path),this.affectedTree,this.revert)}};var Yc=class n{constructor(e,t){this.source=e,this.path=t,this.type=an.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,fe(this.path))}};var gs=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=an.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,fe(this.path),this.snap)}};var ga=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=an.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new gs(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,fe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var un=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Im=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function fR(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(rR(o.childName,o.snapshotNode))}),ia(n,r,"child_removed",e,i,t),ia(n,r,"child_added",e,i,t),ia(n,r,"child_moved",s,i,t),ia(n,r,"child_changed",e,i,t),ia(n,r,"value",e,i,t),r}function ia(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>mR(n,a,c)),o.forEach(a=>{let c=pR(n,a,s);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function pR(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function mR(n,e,t){if(e.childName==null||t.childName==null)throw yr("Should only compare child_ events.");let i=new te(e.childName,e.snapshotNode),r=new te(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function pu(n,e){return{eventCache:n,serverCache:e}}function oa(n,e,t,i){return pu(new un(e,t,i),n.serverCache)}function _I(n,e,t,i){return pu(n.eventCache,new un(e,t,i))}function Jc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function sr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var zp,gR=()=>(zp||(zp=new Nt(pS)),zp),ct=class n{constructor(e,t=gR()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return ze(e,(i,r)=>{t=t.set(new ce(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let i=Z(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(fe(e),t);return s!=null?{path:ve(new ce(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),i=this.children.get(t);return i!==null?i.subtree(fe(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let i=Z(e),s=(this.children.get(i)||new n(null)).set(fe(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),i=this.children.get(t);if(i){let r=i.remove(fe(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),i=this.children.get(t);return i?i.get(fe(e)):null}}setTree(e,t){if(ee(e))return t;{let i=Z(e),s=(this.children.get(i)||new n(null)).setTree(fe(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ve(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(fe(e),ve(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,i){if(ee(e))return this;{this.value&&i(t,this.value);let r=Z(e),s=this.children.get(r);return s?s.foreachOnPath_(fe(e),ve(t,r),i):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(ve(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var Kt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ct(null))}};function aa(n,e,t){if(ee(e))return new Kt(new ct(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=lt(r,e);return s=s.updateChild(o,t),new Kt(n.writeTree_.set(r,s))}else{let r=new ct(t),s=n.writeTree_.setTree(e,r);return new Kt(s)}}}function Am(n,e,t){let i=n;return ze(t,(r,s)=>{i=aa(i,ve(e,r),s)}),i}function PE(n,e){if(ee(e))return Kt.empty();{let t=n.writeTree_.setTree(e,new ct(null));return new Kt(t)}}function Cm(n,e){return ar(n,e)!=null}function ar(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(lt(t.path,e)):null}function xE(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(me,(i,r)=>{e.push(new te(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new te(i,r.value))}),e}function di(n,e){if(ee(e))return n;{let t=ar(n,e);return t!=null?new Kt(new ct(t)):new Kt(n.writeTree_.subtree(e))}}function bm(n){return n.writeTree_.isEmpty()}function _s(n,e){return yI(le(),n.writeTree_,e)}function yI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=yI(ve(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ve(n,".priority"),i)),t}}function mu(n,e){return EI(e,n)}function _R(n,e,t,i,r){O(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=aa(n.visibleWrites,e,t)),n.lastWriteId=i}function yR(n,e,t,i){O(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Am(n.visibleWrites,e,t),n.lastWriteId=i}function vR(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function wR(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&TR(a,i.path)?r=!1:xt(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return ER(n),!0;if(i.snap)n.visibleWrites=PE(n.visibleWrites,i.path);else{let a=i.children;ze(a,c=>{n.visibleWrites=PE(n.visibleWrites,ve(i.path,c))})}return!0}else return!1}function TR(n,e){if(n.snap)return xt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&xt(ve(n.path,t),e))return!0;return!1}function ER(n){n.visibleWrites=vI(n.allWrites,IR,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function IR(n){return n.visible}function vI(n,e,t){let i=Kt.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)xt(t,o)?(a=lt(t,o),i=aa(i,a,s.snap)):xt(o,t)&&(a=lt(o,t),i=aa(i,le(),s.snap.getChild(a)));else if(s.children){if(xt(t,o))a=lt(t,o),i=Am(i,a,s.children);else if(xt(o,t))if(a=lt(o,t),ee(a))i=Am(i,le(),s.children);else{let c=Bn(s.children,Z(a));if(c){let u=c.getChild(fe(a));i=aa(i,le(),u)}}}else throw yr("WriteRecord should have .snap or .children")}}return i}function wI(n,e,t,i,r){if(!i&&!r){let s=ar(n.visibleWrites,e);if(s!=null)return s;{let o=di(n.visibleWrites,e);if(bm(o))return t;if(t==null&&!Cm(o,le()))return null;{let a=t||J.EMPTY_NODE;return _s(o,a)}}}else{let s=di(n.visibleWrites,e);if(!r&&bm(s))return t;if(!r&&t==null&&!Cm(s,le()))return null;{let o=function(u){return(u.visible||r)&&(!i||!~i.indexOf(u.writeId))&&(xt(u.path,e)||xt(e,u.path))},a=vI(n.allWrites,o,e),c=t||J.EMPTY_NODE;return _s(a,c)}}}function AR(n,e,t){let i=J.EMPTY_NODE,r=ar(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(me,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=di(n.visibleWrites,e);return t.forEachChild(me,(o,a)=>{let c=_s(di(s,new ce(o)),a);i=i.updateImmediateChild(o,c)}),xE(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=di(n.visibleWrites,e);return xE(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function CR(n,e,t,i,r){O(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=ve(e,t);if(Cm(n.visibleWrites,s))return null;{let o=di(n.visibleWrites,s);return bm(o)?r.getChild(t):_s(o,r.getChild(t))}}function bR(n,e,t,i){let r=ve(e,t),s=ar(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=di(n.visibleWrites,r);return _s(o,i.getNode().getImmediateChild(t))}else return null}function SR(n,e){return ar(n.visibleWrites,e)}function RR(n,e,t,i,r,s,o){let a,c=di(n.visibleWrites,e),u=ar(c,le());if(u!=null)a=u;else if(t!=null)a=_s(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),m=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),y=m.getNext();for(;y&&d.length<r;)p(y,i)!==0&&d.push(y),y=m.getNext();return d}else return[]}function PR(){return{visibleWrites:Kt.empty(),allWrites:[],lastWriteId:-1}}function Xc(n,e,t,i){return wI(n.writeTree,n.treePath,e,t,i)}function ug(n,e){return AR(n.writeTree,n.treePath,e)}function NE(n,e,t,i){return CR(n.writeTree,n.treePath,e,t,i)}function Zc(n,e){return SR(n.writeTree,ve(n.treePath,e))}function xR(n,e,t,i,r,s){return RR(n.writeTree,n.treePath,e,t,i,r,s)}function hg(n,e,t){return bR(n.writeTree,n.treePath,e,t)}function TI(n,e){return EI(ve(n.treePath,e),n.writeTree)}function EI(n,e){return{treePath:n,writeTree:e}}var Sm=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,fa(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,da(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,ms(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,fa(i,e.snapshotNode,r.oldSnap));else throw yr("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Rm=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},II=new Rm,_a=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new un(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return hg(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:sr(this.viewCache_),s=xR(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function NR(n){return{filter:n}}function kR(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function DR(n,e,t,i,r){let s=new Sm,o,a;if(t.type===an.OVERWRITE){let u=t;u.source.fromUser?o=Pm(n,e,u.path,u.snap,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=eu(n,e,u.path,u.snap,i,r,a,s))}else if(t.type===an.MERGE){let u=t;u.source.fromUser?o=OR(n,e,u.path,u.children,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=xm(n,e,u.path,u.children,i,r,a,s))}else if(t.type===an.ACK_USER_WRITE){let u=t;u.revert?o=LR(n,e,u.path,i,r,s):o=MR(n,e,u.path,u.affectedTree,i,r,s)}else if(t.type===an.LISTEN_COMPLETE)o=FR(n,e,t.path,i,s);else throw yr("Unknown operation type: "+t.type);let c=s.getChanges();return VR(e,o,c),{viewCache:o,changes:c}}function VR(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Jc(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(gI(Jc(e)))}}function AI(n,e,t,i,r,s){let o=e.eventCache;if(Zc(i,t)!=null)return e;{let a,c;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=sr(e),d=u instanceof J?u:J.EMPTY_NODE,p=ug(i,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=Xc(i,sr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=Z(t);if(u===".priority"){O(mi(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=NE(i,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=fe(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=NE(i,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(u).updateChild(d,m):p=o.getNode().getImmediateChild(u)}else p=hg(i,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,r,s):a=o.getNode()}}return oa(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function eu(n,e,t,i,r,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,i);u=d.updateFullNode(c.getNode(),y,null)}else{let y=Z(t);if(!c.isCompleteForPath(t)&&mi(t)>1)return e;let C=fe(t),k=c.getNode().getImmediateChild(y).updateChild(C,i);y===".priority"?u=d.updatePriority(c.getNode(),k):u=d.updateChild(c.getNode(),y,k,C,II,null)}let p=_I(e,u,c.isFullyInitialized()||ee(t),d.filtersNodes()),m=new _a(r,p,s);return AI(n,p,t,r,m,a)}function Pm(n,e,t,i,r,s,o){let a=e.eventCache,c,u,d=new _a(r,e,s);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=oa(e,u,!0,n.filter.filtersNodes());else{let p=Z(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),i),c=oa(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=fe(t),y=a.getNode().getImmediateChild(p),C;if(ee(m))C=i;else{let x=d.getCompleteChild(p);x!=null?ng(m)===".priority"&&x.getChild(uI(m)).isEmpty()?C=x:C=x.updateChild(m,i):C=J.EMPTY_NODE}if(y.equals(C))c=e;else{let x=n.filter.updateChild(a.getNode(),p,C,m,d,o);c=oa(e,x,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function kE(n,e){return n.eventCache.isCompleteForChild(e)}function OR(n,e,t,i,r,s,o){let a=e;return i.foreach((c,u)=>{let d=ve(t,c);kE(e,Z(d))&&(a=Pm(n,a,d,u,r,s,o))}),i.foreach((c,u)=>{let d=ve(t,c);kE(e,Z(d))||(a=Pm(n,a,d,u,r,s,o))}),a}function DE(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function xm(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ee(t)?u=i:u=new ct(null).setTree(t,i);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,m)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),C=DE(n,y,m);c=eu(n,c,new ce(p),C,r,s,o,a)}}),u.children.inorderTraversal((p,m)=>{let y=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!d.hasChild(p)&&!y){let C=e.serverCache.getNode().getImmediateChild(p),x=DE(n,C,m);c=eu(n,c,new ce(p),x,r,s,o,a)}}),c}function MR(n,e,t,i,r,s,o){if(Zc(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return eu(n,e,t,c.getNode().getChild(t),r,s,a,o);if(ee(t)){let u=new ct(null);return c.getNode().forEachChild(ln,(d,p)=>{u=u.set(new ce(d),p)}),xm(n,e,t,u,r,s,a,o)}else return e}else{let u=new ct(null);return i.foreach((d,p)=>{let m=ve(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),xm(n,e,t,u,r,s,a,o)}}function FR(n,e,t,i,r){let s=e.serverCache,o=_I(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return AI(n,o,t,i,II,r)}function LR(n,e,t,i,r,s){let o;if(Zc(i,t)!=null)return e;{let a=new _a(i,e,r),c=e.eventCache.getNode(),u;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Xc(i,sr(e));else{let p=e.serverCache.getNode();O(p instanceof J,"serverChildren would be complete if leaf node"),d=ug(i,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=Z(t),p=hg(i,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,fe(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,J.EMPTY_NODE,fe(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Xc(i,sr(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||Zc(i,le())!=null,oa(e,u,o,n.filter.filtersNodes())}}var Nm=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new pa(i.getIndex()),s=sR(i);this.processor_=NR(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(J.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(J.EMPTY_NODE,a.getNode(),null),d=new un(c,o.isFullyInitialized(),r.filtersNodes()),p=new un(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=pu(p,d),this.eventGenerator_=new Im(this.query_)}get query(){return this.query_}};function UR(n){return n.viewCache_.serverCache.getNode()}function BR(n){return Jc(n.viewCache_)}function qR(n,e){let t=sr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function VE(n){return n.eventRegistrations_.length===0}function jR(n,e){n.eventRegistrations_.push(e)}function OE(n,e,t){let i=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function ME(n,e,t,i){e.type===an.MERGE&&e.source.queryId!==null&&(O(sr(n.viewCache_),"We should always have a full cache before handling merges"),O(Jc(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=DR(n.processor_,r,e,t,i);return kR(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,CI(n,s.changes,s.viewCache.eventCache.getNode(),null)}function GR(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(me,(s,o)=>{i.push(ms(s,o))}),t.isFullyInitialized()&&i.push(gI(t.getNode())),CI(n,i,t.getNode(),e)}function CI(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return fR(n.eventGenerator_,e,t,r)}var tu,nu=class{constructor(){this.views=new Map}};function KR(n){O(!tu,"__referenceConstructor has already been defined"),tu=n}function zR(){return O(tu,"Reference.ts has not been loaded"),tu}function WR(n){return n.views.size===0}function dg(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return O(s!=null,"SyncTree gave us an op for an invalid query."),ME(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(ME(o,e,t,i));return s}}function bI(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Xc(t,r?i:null),c=!1;a?c=!0:i instanceof J?(a=ug(t,i),c=!1):(a=J.EMPTY_NODE,c=!1);let u=pu(new un(a,c,!1),new un(i,r,!1));return new Nm(e,u)}return o}function $R(n,e,t,i,r,s){let o=bI(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),jR(o,t),GR(o,t)}function QR(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=gi(n);if(r==="default")for(let[c,u]of n.views.entries())o=o.concat(OE(u,t,i)),VE(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(r);c&&(o=o.concat(OE(c,t,i)),VE(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!gi(n)&&s.push(new(zR())(e._repo,e._path)),{removed:s,events:o}}function SI(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function fi(n,e){let t=null;for(let i of n.views.values())t=t||qR(i,e);return t}function RI(n,e){if(e._queryParams.loadsAllData())return gu(n);{let i=e._queryIdentifier;return n.views.get(i)}}function PI(n,e){return RI(n,e)!=null}function gi(n){return gu(n)!=null}function gu(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var iu;function HR(n){O(!iu,"__referenceConstructor has already been defined"),iu=n}function YR(){return O(iu,"Reference.ts has not been loaded"),iu}var JR=1,ru=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_=PR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function fg(n,e,t,i,r){return _R(n.pendingWriteTree_,e,t,i,r),r?Es(n,new gs(ag(),e,t)):[]}function XR(n,e,t,i){yR(n.pendingWriteTree_,e,t,i);let r=ct.fromObject(t);return Es(n,new ga(ag(),e,r))}function hi(n,e,t=!1){let i=vR(n.pendingWriteTree_,e);if(wR(n.pendingWriteTree_,e)){let s=new ct(null);return i.snap!=null?s=s.set(le(),!0):ze(i.children,o=>{s=s.set(new ce(o),!0)}),Es(n,new Em(i.path,s,t))}else return[]}function ba(n,e,t){return Es(n,new gs(lg(),e,t))}function ZR(n,e,t){let i=ct.fromObject(t);return Es(n,new ga(lg(),e,i))}function eP(n,e){return Es(n,new Yc(lg(),e))}function tP(n,e,t){let i=pg(n,t);if(i){let r=mg(i),s=r.path,o=r.queryId,a=lt(s,e),c=new Yc(cg(o),a);return gg(n,s,c)}else return[]}function su(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||PI(o,e))){let c=QR(o,e,t,i);WR(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!r){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(m,y)=>gi(y));if(d&&!p){let m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){let y=rP(m);for(let C=0;C<y.length;++C){let x=y[C],k=x.query,q=DI(n,x);n.listenProvider_.startListening(la(k),ya(n,k),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!i&&(d?n.listenProvider_.stopListening(la(e),null):u.forEach(m=>{let y=n.queryToTagMap.get(yu(m));n.listenProvider_.stopListening(la(m),y)}))}sP(n,u)}return a}function xI(n,e,t,i){let r=pg(n,i);if(r!=null){let s=mg(r),o=s.path,a=s.queryId,c=lt(o,e),u=new gs(cg(a),c,t);return gg(n,o,u)}else return[]}function nP(n,e,t,i){let r=pg(n,i);if(r){let s=mg(r),o=s.path,a=s.queryId,c=lt(o,e),u=ct.fromObject(t),d=new ga(cg(a),c,u);return gg(n,o,d)}else return[]}function km(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(m,y)=>{let C=lt(m,r);s=s||fi(y,C),o=o||gi(y)});let a=n.syncPointTree_.get(r);a?(o=o||gi(a),s=s||fi(a,le())):(a=new nu,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=J.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((y,C)=>{let x=fi(C,le());x&&(s=s.updateImmediateChild(y,x))}));let u=PI(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=yu(e);O(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");let y=oP();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}let d=mu(n.pendingWriteTree_,r),p=$R(a,e,t,d,s,c);if(!u&&!o&&!i){let m=RI(a,e);p=p.concat(aP(n,e,m))}return p}function _u(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=lt(o,e),u=fi(a,c);if(u)return u});return wI(r,e,s,t,!0)}function iP(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=lt(u,t);i=i||fi(d,p)});let r=n.syncPointTree_.get(t);r?i=i||fi(r,le()):(r=new nu,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new un(i,!0,!1):null,a=mu(n.pendingWriteTree_,e._path),c=bI(r,e,a,s?o.getNode():J.EMPTY_NODE,s);return BR(c)}function Es(n,e){return NI(e,n.syncPointTree_,null,mu(n.pendingWriteTree_,le()))}function NI(n,e,t,i){if(ee(n.path))return kI(n,e,t,i);{let r=e.get(le());t==null&&r!=null&&(t=fi(r,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=TI(i,o);s=s.concat(NI(a,c,u,d))}return r&&(s=s.concat(dg(r,n,i,t))),s}}function kI(n,e,t,i){let r=e.get(le());t==null&&r!=null&&(t=fi(r,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=TI(i,o),d=n.operationForChild(o);d&&(s=s.concat(kI(d,a,c,u)))}),r&&(s=s.concat(dg(r,n,i,t))),s}function DI(n,e){let t=e.query,i=ya(n,t);return{hashFn:()=>(UR(e)||J.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?tP(n,t._path,i):eP(n,t._path);{let s=_S(r,t);return su(n,t,null,s)}}}}function ya(n,e){let t=yu(e);return n.queryToTagMap.get(t)}function yu(n){return n._path.toString()+"$"+n._queryIdentifier}function pg(n,e){return n.tagToQueryMap.get(e)}function mg(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function gg(n,e,t){let i=n.syncPointTree_.get(e);O(i,"Missing sync point for query tag that we're tracking");let r=mu(n.pendingWriteTree_,e);return dg(i,t,r,null)}function rP(n){return n.fold((e,t,i)=>{if(t&&gi(t))return[gu(t)];{let r=[];return t&&(r=SI(t)),ze(i,(s,o)=>{r=r.concat(o)}),r}})}function la(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(YR())(n._repo,n._path):n}function sP(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=yu(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function oP(){return JR++}function aP(n,e,t){let i=e._path,r=ya(n,e),s=DI(n,t),o=n.listenProvider_.startListening(la(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)O(!gi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!ee(u)&&d&&gi(d))return[gu(d).query];{let m=[];return d&&(m=m.concat(SI(d).map(y=>y.query))),ze(p,(y,C)=>{m=m.concat(C)}),m}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(la(d),ya(n,d))}}return o}var Dm=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Vm=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ve(this.path_,e);return new n(this.syncTree_,t)}node(){return _u(this.syncTree_,this.path_)}},lP=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},FE=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return cP(n[".sv"],e,t);if(typeof n[".sv"]=="object")return uP(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},cP=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},uP=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&O(!1,"Unexpected increment value: "+i);let r=e.node();if(O(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},VI=function(n,e,t,i){return yg(e,new Vm(t,n),i)},_g=function(n,e,t){return yg(n,new Dm(e),t)};function yg(n,e,t){let i=n.getPriority().val(),r=FE(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=FE(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new fs(a,Ee(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new fs(r))),o.forEachChild(me,(a,c)=>{let u=yg(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var va=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function vu(n,e){let t=e instanceof ce?e:new ce(e),i=n,r=Z(t);for(;r!==null;){let s=Bn(i.node.children,r)||{children:{},childCount:0};i=new va(r,i,s),t=fe(t),r=Z(t)}return i}function lr(n){return n.node.value}function vg(n,e){n.node.value=e,Om(n)}function OI(n){return n.node.childCount>0}function hP(n){return lr(n)===void 0&&!OI(n)}function wu(n,e){ze(n.node.children,(t,i)=>{e(new va(t,n,i))})}function MI(n,e,t,i){t&&!i&&e(n),wu(n,r=>{MI(r,e,!0,i)}),t&&i&&e(n)}function dP(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Sa(n){return new ce(n.parent===null?n.name:Sa(n.parent)+"/"+n.name)}function Om(n){n.parent!==null&&fP(n.parent,n.name,n)}function fP(n,e,t){let i=hP(t),r=Ct(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Om(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Om(n))}var pP=/[\[\].#$\/\u0000-\u001F\u007F]/,mP=/[\[\].#$\u0000-\u001F\u007F]/,Wp=10*1024*1024,Tu=function(n){return typeof n=="string"&&n.length!==0&&!pP.test(n)},FI=function(n){return typeof n=="string"&&n.length!==0&&!mP.test(n)},gP=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),FI(n)},wa=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!du(n)||n&&typeof n=="object"&&Ct(n,".sv")},hn=function(n,e,t,i){i&&e===void 0||Ra(ht(n,"value"),e,t)},Ra=function(n,e,t){let i=t instanceof ce?new sm(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+nr(i));if(typeof e=="function")throw new Error(n+"contains a function "+nr(i)+" with contents = "+e.toString());if(du(e))throw new Error(n+"contains "+e.toString()+" "+nr(i));if(typeof e=="string"&&e.length>Wp/3&&to(e)>Wp)throw new Error(n+"contains a string greater than "+Wp+" utf8 bytes "+nr(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(ze(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Tu(o)))throw new Error(n+" contains an invalid key ("+o+") "+nr(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);WS(i,o),Ra(n,a,i),$S(i)}),r&&s)throw new Error(n+' contains ".value" child '+nr(i)+" in addition to actual children.")}},_P=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=ua(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Tu(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(zS);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&xt(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},LI=function(n,e,t,i){if(i&&e===void 0)return;let r=ht(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];ze(e,(o,a)=>{let c=new ce(o);if(Ra(r,a,ve(t,c)),ng(c)===".priority"&&!wa(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),_P(r,s)},wg=function(n,e,t){if(!(t&&e===void 0)){if(du(e))throw new Error(ht(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!wa(e))throw new Error(ht(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Pa=function(n,e,t,i){if(!(i&&t===void 0)&&!Tu(t))throw new Error(ht(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Is=function(n,e,t,i){if(!(i&&t===void 0)&&!FI(t))throw new Error(ht(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},yP=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Is(n,e,t,i)},vt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},UI=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Tu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!gP(t))throw new Error(ht(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Mm=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Eu(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!ig(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function BI(n,e,t){Eu(n,t),qI(n,i=>ig(i,e))}function wt(n,e,t){Eu(n,t),qI(n,i=>xt(i,e)||xt(e,i))}function qI(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(vP(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function vP(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();rr&&Ke("event: "+t.toString()),ws(i)}}}var jI="repo_interrupt",wP=25,Fm=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Mm,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Hc(),this.transactionQueueTree_=new va,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function TP(n,e,t){if(n.stats_=tg(n.repoInfo_),n.forceRestClient_||TS())n.server_=new gm(n.repoInfo_,(i,r,s,o)=>{LE(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>UE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ke(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new rg(n.repoInfo_,e,(i,r,s,o)=>{LE(n,i,r,s,o)},i=>{UE(n,i)},i=>{EP(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=IS(n.repoInfo_,()=>new Tm(n.stats_,n.server_)),n.infoData_=new _m,n.infoSyncTree_=new ru({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=ba(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Tg(n,"connected",!1),n.serverSyncTree_=new ru({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let u=o(a,c);wt(n.eventQueue_,i._path,u)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function GI(n){let t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function xa(n){return lP({timestamp:GI(n)})}function LE(n,e,t,i,r){n.dataUpdateCount++;let s=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=eo(t,u=>Ee(u));o=nP(n.serverSyncTree_,s,c,r)}else{let c=Ee(t);o=xI(n.serverSyncTree_,s,c,r)}else if(i){let c=eo(t,u=>Ee(u));o=ZR(n.serverSyncTree_,s,c)}else{let c=Ee(t);o=ba(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=ys(n,s)),wt(n.eventQueue_,a,o)}function UE(n,e){Tg(n,"connected",e),e===!1&&CP(n)}function EP(n,e){ze(e,(t,i)=>{Tg(n,t,i)})}function Tg(n,e,t){let i=new ce("/.info/"+e),r=Ee(t);n.infoData_.updateSnapshot(i,r);let s=ba(n.infoSyncTree_,i,r);wt(n.eventQueue_,i,s)}function Iu(n){return n.nextWriteId_++}function IP(n,e,t){let i=iP(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=Ee(r).withIndex(e._queryParams.getIndex());km(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ba(n.serverSyncTree_,e._path,s);else{let a=ya(n.serverSyncTree_,e);o=xI(n.serverSyncTree_,e._path,s,a)}return wt(n.eventQueue_,e._path,o),su(n.serverSyncTree_,e,t,null,!0),s},r=>(As(n,"get for query "+ke(e)+" failed: "+r),Promise.reject(new Error(r))))}function Eg(n,e,t,i,r){As(n,"set",{path:e.toString(),value:t,priority:i});let s=xa(n),o=Ee(t,i),a=_u(n.serverSyncTree_,e),c=_g(o,a,s),u=Iu(n),d=fg(n.serverSyncTree_,e,c,u,!0);Eu(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(m,y)=>{let C=m==="ok";C||tt("set at "+e+" failed: "+m);let x=hi(n.serverSyncTree_,u,!C);wt(n.eventQueue_,e,x),_i(n,r,m,y)});let p=Ag(n,e);ys(n,p),wt(n.eventQueue_,p,[])}function AP(n,e,t,i){As(n,"update",{path:e.toString(),value:t});let r=!0,s=xa(n),o={};if(ze(t,(a,c)=>{r=!1,o[a]=VI(ve(e,a),Ee(c),n.serverSyncTree_,s)}),r)Ke("update() called with empty data.  Don't do anything."),_i(n,i,"ok",void 0);else{let a=Iu(n),c=XR(n.serverSyncTree_,e,o,a);Eu(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||tt("update at "+e+" failed: "+u);let m=hi(n.serverSyncTree_,a,!p),y=m.length>0?ys(n,e):e;wt(n.eventQueue_,y,m),_i(n,i,u,d)}),ze(t,u=>{let d=Ag(n,ve(e,u));ys(n,d)}),wt(n.eventQueue_,e,[])}}function CP(n){As(n,"onDisconnectEvents");let e=xa(n),t=Hc();vm(n.onDisconnect_,le(),(r,s)=>{let o=VI(r,s,n.serverSyncTree_,e);Ts(t,r,o)});let i=[];vm(t,le(),(r,s)=>{i=i.concat(ba(n.serverSyncTree_,r,s));let o=Ag(n,r);ys(n,o)}),n.onDisconnect_=Hc(),wt(n.eventQueue_,le(),i)}function bP(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&ym(n.onDisconnect_,e),_i(n,t,i,r)})}function BE(n,e,t,i){let r=Ee(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&Ts(n.onDisconnect_,e,r),_i(n,i,s,o)})}function SP(n,e,t,i,r){let s=Ee(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ts(n.onDisconnect_,e,s),_i(n,r,o,a)})}function RP(n,e,t,i){if(cl(t)){Ke("onDisconnect().update() called with empty data.  Don't do anything."),_i(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&ze(t,(o,a)=>{let c=Ee(a);Ts(n.onDisconnect_,ve(e,o),c)}),_i(n,i,r,s)})}function PP(n,e,t){let i;Z(e._path)===".info"?i=km(n.infoSyncTree_,e,t):i=km(n.serverSyncTree_,e,t),BI(n.eventQueue_,e._path,i)}function Lm(n,e,t){let i;Z(e._path)===".info"?i=su(n.infoSyncTree_,e,t):i=su(n.serverSyncTree_,e,t),BI(n.eventQueue_,e._path,i)}function KI(n){n.persistentConnection_&&n.persistentConnection_.interrupt(jI)}function xP(n){n.persistentConnection_&&n.persistentConnection_.resume(jI)}function As(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ke(t,...e)}function _i(n,e,t,i){e&&ws(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function NP(n,e,t,i,r,s){As(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:GE(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Ig(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ra("transaction failed: Data returned ",c,o.path),o.status=0;let u=vu(n.transactionQueueTree_,e),d=lr(u)||[];d.push(o),vg(u,d);let p;typeof c=="object"&&c!==null&&Ct(c,".priority")?(p=Bn(c,".priority"),O(wa(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(_u(n.serverSyncTree_,e)||J.EMPTY_NODE).getPriority().val();let m=xa(n),y=Ee(c,p),C=_g(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=C,o.currentWriteId=Iu(n);let x=fg(n.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);wt(n.eventQueue_,e,x),Au(n,n.transactionQueueTree_)}}function Ig(n,e,t){return _u(n.serverSyncTree_,e,t)||J.EMPTY_NODE}function Au(n,e=n.transactionQueueTree_){if(e||Cu(n,e),lr(e)){let t=WI(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&kP(n,Sa(e),t)}else OI(e)&&wu(e,t=>{Au(n,t)})}function kP(n,e,t){let i=t.map(u=>u.currentWriteId),r=Ig(n,e,i),s=r,o=r.hash();for(let u=0;u<t.length;u++){let d=t[u];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=lt(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{As(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(hi(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Cu(n,vu(n.transactionQueueTree_,e)),Au(n,n.transactionQueueTree_),wt(n.eventQueue_,e,d);for(let m=0;m<p.length;m++)ws(p[m])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{tt("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}ys(n,e)}},o)}function ys(n,e){let t=zI(n,e),i=Sa(t),r=WI(n,t);return DP(n,r,i),i}function DP(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=lt(t,c.path),d=!1,p;if(O(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,r=r.concat(hi(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=wP)d=!0,p="maxretry",r=r.concat(hi(n.serverSyncTree_,c.currentWriteId,!0));else{let m=Ig(n,c.path,o);c.currentInputSnapshot=m;let y=e[a].update(m.val());if(y!==void 0){Ra("transaction failed: Data returned ",y,c.path);let C=Ee(y);typeof y=="object"&&y!=null&&Ct(y,".priority")||(C=C.updatePriority(m.getPriority()));let k=c.currentWriteId,q=xa(n),j=_g(C,m,q);c.currentOutputSnapshotRaw=C,c.currentOutputSnapshotResolved=j,c.currentWriteId=Iu(n),o.splice(o.indexOf(k),1),r=r.concat(fg(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),r=r.concat(hi(n.serverSyncTree_,k,!0))}else d=!0,p="nodata",r=r.concat(hi(n.serverSyncTree_,c.currentWriteId,!0))}wt(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(p),!1,null))))}Cu(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)ws(i[a]);Au(n,n.transactionQueueTree_)}function zI(n,e){let t,i=n.transactionQueueTree_;for(t=Z(e);t!==null&&lr(i)===void 0;)i=vu(i,t),e=fe(e),t=Z(e);return i}function WI(n,e){let t=[];return $I(n,e,t),t.sort((i,r)=>i.order-r.order),t}function $I(n,e,t){let i=lr(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);wu(e,r=>{$I(n,r,t)})}function Cu(n,e){let t=lr(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,vg(e,t.length>0?t:void 0)}wu(e,i=>{Cu(n,i)})}function Ag(n,e){let t=Sa(zI(n,e)),i=vu(n.transactionQueueTree_,e);return dP(i,r=>{$p(n,r)}),$p(n,i),MI(i,r=>{$p(n,r)}),t}function $p(n,e){let t=lr(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(hi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?vg(e,void 0):t.length=s+1,wt(n.eventQueue_,Sa(e),r);for(let o=0;o<i.length;o++)ws(i[o])}}function VP(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function OP(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):tt(`Invalid query segment '${t}' in query '${n}'`)}return e}var Um=function(n,e){let t=MP(n),i=t.namespace;t.domain==="firebase.com"&&cn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&cn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||dS();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new qc(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new ce(t.pathString)}},MP=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(r=VP(n.substring(d,p)));let m=OP(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let C=e.indexOf(".");i=e.substring(0,C).toLowerCase(),t=e.substring(C+1),s=i}"ns"in m&&(s=m.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var qE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",FP=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=qE.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=qE.charAt(e[r]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var ou=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ke(this.snapshot.exportVal())}},au=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ta=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var lu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ge;return bP(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){vt("OnDisconnect.remove",this._path);let e=new Ge;return BE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){vt("OnDisconnect.set",this._path),hn("OnDisconnect.set",e,this._path,!1);let t=new Ge;return BE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){vt("OnDisconnect.setWithPriority",this._path),hn("OnDisconnect.setWithPriority",e,this._path,!1),wg("OnDisconnect.setWithPriority",t,!1);let i=new Ge;return SP(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){vt("OnDisconnect.update",this._path),LI("OnDisconnect.update",e,this._path,!1);let t=new Ge;return RP(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var ut=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return ee(this._path)?null:ng(this._path)}get ref(){return new Tt(this._repo,this._path)}get _queryIdentifier(){let e=SE(this._queryParams),t=eg(e);return t==="{}"?"default":t}get _queryObject(){return SE(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=ig(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+KS(this._path)}};function bu(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function vi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ln){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==pi)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Nn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===me){if(e!=null&&!wa(e)||t!=null&&!wa(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof ha||n.getIndex()===og,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Su(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Tt=class n extends ut{constructor(e,t){super(e,t,new ma,!1)}get parent(){let e=uI(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},vs=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ce(e),i=yi(this.ref,e);return new n(this._node.getChild(t),i,me)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,yi(this.ref,i),me)))}hasChild(e){let t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Cg(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?yi(n._root,e):n._root}function bg(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=Um(e,n._repo.repoInfo_.nodeAdmin);UI("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&cn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),Cg(n,t.path.toString())}function yi(n,e){return n=ne(n),Z(n._path)===null?yP("child","path",e,!1):Is("child","path",e,!1),new Tt(n._repo,ve(n._path,e))}function QI(n,e){n=ne(n),vt("push",n._path),hn("push",e,n._path,!0);let t=GI(n._repo),i=FP(t),r=yi(n,i),s=yi(n,i),o;return e!=null?o=Ru(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function HI(n){return vt("remove",n._path),Ru(n,null)}function Ru(n,e){n=ne(n),vt("set",n._path),hn("set",e,n._path,!1);let t=new Ge;return Eg(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function YI(n,e){n=ne(n),vt("setPriority",n._path),wg("setPriority",e,!1);let t=new Ge;return Eg(n._repo,ve(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function JI(n,e,t){if(vt("setWithPriority",n._path),hn("setWithPriority",e,n._path,!1),wg("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new Ge;return Eg(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function XI(n,e){LI("update",e,n._path,!1);let t=new Ge;return AP(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function ZI(n){n=ne(n);let e=new Ta(()=>{}),t=new Ea(e);return IP(n._repo,n,t).then(i=>new vs(i,new Tt(n._repo,n._path),n._queryParams.getIndex()))}var Ea=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new ou("value",this,new vs(e.snapshotNode,new Tt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new au(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},cu=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new au(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let i=yi(new Tt(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new ou(e.type,this,new vs(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Na(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,u=(d,p)=>{Lm(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Ta(t,s||void 0),a=e==="value"?new Ea(o):new cu(e,o);return PP(n._repo,n,a),()=>Lm(n._repo,n,a)}function Pu(n,e,t,i){return Na(n,"value",e,t,i)}function Sg(n,e,t,i){return Na(n,"child_added",e,t,i)}function Rg(n,e,t,i){return Na(n,"child_changed",e,t,i)}function Pg(n,e,t,i){return Na(n,"child_moved",e,t,i)}function xg(n,e,t,i){return Na(n,"child_removed",e,t,i)}function Ng(n,e,t){let i=null,r=t?new Ta(t):null;e==="value"?i=new Ea(r):e&&(i=new cu(e,r)),Lm(n._repo,n,i)}var Et=class{},uu=class extends Et{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){hn("endAt",this._value,e._path,!0);let t=mm(e._queryParams,this._value,this._key);if(Su(t),vi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function e0(n,e){return Pa("endAt","key",e,!0),new uu(n,e)}var Bm=class extends Et{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){hn("endBefore",this._value,e._path,!1);let t=cR(e._queryParams,this._value,this._key);if(Su(t),vi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function t0(n,e){return Pa("endBefore","key",e,!0),new Bm(n,e)}var hu=class extends Et{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){hn("startAt",this._value,e._path,!0);let t=pm(e._queryParams,this._value,this._key);if(Su(t),vi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function n0(n=null,e){return Pa("startAt","key",e,!0),new hu(n,e)}var qm=class extends Et{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){hn("startAfter",this._value,e._path,!1);let t=lR(e._queryParams,this._value,this._key);if(Su(t),vi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function i0(n,e){return Pa("startAfter","key",e,!0),new qm(n,e)}var jm=class extends Et{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,oR(e._queryParams,this._limit),e._orderByCalled)}};function r0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new jm(n)}var Gm=class extends Et{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,aR(e._queryParams,this._limit),e._orderByCalled)}};function s0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Gm(n)}var Km=class extends Et{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){bu(e,"orderByChild");let t=new ce(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new ha(t),r=fu(e._queryParams,i);return vi(r),new ut(e._repo,e._path,r,!0)}};function o0(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Is("orderByChild","path",n,!1),new Km(n)}var zm=class extends Et{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){bu(e,"orderByKey");let t=fu(e._queryParams,ln);return vi(t),new ut(e._repo,e._path,t,!0)}};function a0(){return new zm}var Wm=class extends Et{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){bu(e,"orderByPriority");let t=fu(e._queryParams,me);return vi(t),new ut(e._repo,e._path,t,!0)}};function l0(){return new Wm}var $m=class extends Et{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){bu(e,"orderByValue");let t=fu(e._queryParams,og);return vi(t),new ut(e._repo,e._path,t,!0)}};function c0(){return new $m}var Qm=class extends Et{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(hn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new uu(this._value,this._key)._apply(new hu(this._value,this._key)._apply(e))}};function u0(n,e){return Pa("equalTo","key",e,!0),new Qm(n,e)}function kt(n,...e){let t=ne(n);for(let i of e)t=i._apply(t);return t}KR(Tt);HR(Tt);var LP="FIREBASE_DATABASE_EMULATOR_HOST",Hm={},UP=!1;function BP(n,e,t,i){n.repoInfo_=new qc(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function kg(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||cn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ke("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Um(s,r),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[LP]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=Um(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let d=r&&c?new sa(sa.OWNER):new Zp(n.name,n.options,e);UI("Invalid Firebase Database URL",o),ee(o.path)||cn("Database URL must point to the root of a Firebase Database (not including a child path).");let p=jP(a,n,d,new Xp(n.name,t));return new Ym(p,n)}function qP(n,e){let t=Hm[e];(!t||t[n.key]!==n)&&cn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),KI(n),delete t[n.key]}function jP(n,e,t,i){let r=Hm[e.name];r||(r={},Hm[e.name]=r);let s=r[n.toURLString()];return s&&cn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Fm(n,UP,t,i),r[n.toURLString()]=s,s}var Ym=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(TP(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Tt(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&(qP(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&cn("Cannot call "+e+" on a deleted database.")}};function h0(){cI.IS_TRANSPORT_INITIALIZED&&tt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function d0(){h0(),ca.forceDisallow()}function f0(){h0(),cs.forceDisallow(),ca.forceAllow()}function p0(n,e,t,i={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&cn("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&cn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new sa(sa.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:ol(i.mockUserToken,n.app.options.projectId);s=new sa(o)}BP(r,e,t,s)}function m0(n){n=ne(n),n._checkNotDeleted("goOffline"),KI(n._repo)}function g0(n){n=ne(n),n._checkNotDeleted("goOnline"),xP(n._repo)}function _0(n,e){zE(n,e)}function GP(n){Zm(hl),Ri(new gt("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return kg(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Mt(uE,hE,n),Mt(uE,hE,"esm2017")}var KP={".sv":"timestamp"};function y0(){return KP}function v0(n){return{".sv":{increment:n}}}var Jm=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function w0(n,e,t){var i;if(n=ne(n),vt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new Ge,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new vs(d,new Tt(n._repo,n._path),me),s.resolve(new Jm(u,p)))},a=Pu(n,()=>{});return NP(n._repo,n._path,e,o,a,r),s.promise}rg.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};rg.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};GP();var zP="@firebase/database-compat",WP="1.0.8";var $P=new qn("@firebase/database-compat"),T0=function(n){let e="FIREBASE WARNING: "+n;$P.warn(e)};var QP=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(ht(n,e)+"must be a boolean.")},HP=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ht(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Dg=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Le("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Le("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Le("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("OnDisconnect.setWithPriority",2,3,arguments.length),Le("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,T0("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Le("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var Vg=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var cr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),Is("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),Is("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Le("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new kn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},xu=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;$("Query.on",2,4,arguments.length),Le("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(u,d)=>{t.call(o.context,new cr(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Pu(this._delegate,a,c),t;case"child_added":return Sg(this._delegate,a,c),t;case"child_removed":return xg(this._delegate,a,c),t;case"child_changed":return Rg(this._delegate,a,c),t;case"child_moved":return Pg(this._delegate,a,c),t;default:throw new Error(ht("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if($("Query.off",0,3,arguments.length),HP("Query.off",e,!0),Le("Query.off","callback",t,!0),Th("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,Ng(this._delegate,e,r)}else Ng(this._delegate,e)}get(){return ZI(this._delegate).then(e=>new cr(this.database,e))}once(e,t,i,r){$("Query.once",1,4,arguments.length),Le("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new Ge,a=(u,d)=>{let p=new cr(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":Pu(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":Sg(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":xg(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":Rg(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":Pg(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(ht("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,kt(this._delegate,r0(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,kt(this._delegate,s0(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,kt(this._delegate,o0(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,kt(this._delegate,a0()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,kt(this._delegate,l0()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,kt(this._delegate,c0()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,kt(this._delegate,n0(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,kt(this._delegate,i0(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,kt(this._delegate,e0(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,kt(this._delegate,t0(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,kt(this._delegate,u0(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,Le(e,"cancel",r.cancel,!0),r.context=i,Th(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(ht(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new kn(this.database,new Tt(this._delegate._repo,this._delegate._path))}},kn=class n extends xu{constructor(e,t){super(e,new ut(t._repo,t._path,new ma,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,yi(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Le("Reference.set","onComplete",t,!0);let i=Ru(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,T0("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}vt("Reference.update",this._delegate._path),Le("Reference.update","onComplete",t,!0);let i=XI(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("Reference.setWithPriority",2,3,arguments.length),Le("Reference.setWithPriority","onComplete",i,!0);let r=JI(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){$("Reference.remove",0,1,arguments.length),Le("Reference.remove","onComplete",e,!0);let t=HI(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){$("Reference.transaction",1,3,arguments.length),Le("Reference.transaction","transactionUpdate",e,!1),Le("Reference.transaction","onComplete",t,!0),QP("Reference.transaction","applyLocally",i,!0);let r=w0(this._delegate,e,{applyLocally:i}).then(s=>new Vg(s.committed,new cr(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Le("Reference.setPriority","onComplete",t,!0);let i=YI(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){$("Reference.push",0,2,arguments.length),Le("Reference.push","onComplete",t,!0);let i=QI(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return vt("Reference.onDisconnect",this._delegate._path),new Dg(new lu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var ur=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:d0,forceLongPolling:f0}}useEmulator(e,t,i={}){p0(this._delegate,e,t,i)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof kn){let t=bg(this._delegate,e.toString());return new kn(this,t)}else{let t=Cg(this._delegate,e);return new kn(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let i=bg(this._delegate,e);return new kn(this,i)}goOffline(){return $("database.goOffline",0,0,arguments.length),m0(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),g0(this._delegate)}};ur.ServerValue={TIMESTAMP:y0(),increment:n=>v0(n)};function YP({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){Zm(t);let a=new Eh("database-standalone"),c=new ul("auth-internal",a);c.setComponent(new gt("auth-internal",()=>i,"PRIVATE"));let u;return r&&(u=new ul("app-check-internal",a),u.setComponent(new gt("app-check-internal",()=>r,"PRIVATE"))),{instance:new ur(kg(n,c,u,e,o),n),namespace:s}}var JP=Object.freeze({__proto__:null,initStandalone:YP});var XP=ur.ServerValue;function ZP(n){n.INTERNAL.registerComponent(new gt("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new ur(r,i)},"PUBLIC").setServiceProps({Reference:kn,Query:xu,Database:ur,DataSnapshot:cr,enableLogging:_0,INTERNAL:JP,ServerValue:XP}).setMultipleInstances(!0)),n.registerVersion(zP,WP)}ZP(Ue);function ka(n,e,t="on",i=mr){return new Fn(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ae(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),G_())}function ex(n){return typeof n=="string"}function tx(n){return typeof n.exportVal=="function"}function b0(n){return n==null}function S0(n){return typeof n.set=="function"}function E0(n,e){return S0(e)?e:n.ref(e)}function R0(n,e){if(ex(n))return e.stringCase();if(S0(n))return e.firebaseCase();if(tx(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function P0(n){return(b0(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function x0(n,e,t){e=P0(e);let i=e.map(r=>ka(n,r,"on",t));return zs(...i)}function nx(n,e,t){let i=x0(n,e).pipe(Ci((r,s)=>[...r,s],[]));return rx(n,i,t)}function ix(n,e){return ka(n,"value","on",e).pipe(Ae(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function rx(n,e,t){return ix(n,t).pipe(W_(e),Ae(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),K_(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),Ae(r=>r.actions))}function I0(n,e){return function(i,r){return R0(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function sx(n){return function(t){return t?R0(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function ox(n,e,t){return ka(n,"value","once",t).pipe(mn(i=>{let r=[Wt(i)];return e.forEach(s=>r.push(ka(n,s,"on",t))),zs(...r).pipe(Ci(lx,[]))}),Ya())}function N0(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function ax(n,e){if(b0(e))return 0;{let t=N0(n,e);return t===-1?n.length:t+1}}function lx(n,e){let{payload:t,prevKey:i,key:r}=e,s=N0(n,r),o=ax(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function A0(n,e,t){return e=P0(e),ox(n,e,t)}function cx(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:I0(i,"update"),set:I0(i,"set"),push:r=>i.push(r),remove:sx(i),snapshotChanges(r){return A0(n,r,t).pipe(be)},stateChanges(r){return x0(n,r,t).pipe(be)},auditTrail(r){return nx(n,r,t).pipe(be)},valueChanges(r,s){return A0(n,r,t).pipe(Ae(a=>a.map(c=>s&&s.idField?Vt(je({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),be)}}}function C0(n,e){return function(){return ka(n,"value","on",e)}}function ux(n,e){return{query:n,snapshotChanges(){return C0(n,e.schedulers.outsideAngular)().pipe(be)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return C0(n,e.schedulers.outsideAngular)().pipe(be,Ae(i=>i.payload.exists()?i.payload.val():null))}}}var hx=new Ne("angularfire2.realtimeDatabaseURL"),dx=new Ne("angularfire2.database.use-emulator"),fx=(()=>{class n{schedulers;database;constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,x,k){this.schedulers=a;let q=c,j=Pi(t,o,i);u&&uo(j,o,d,m,y,C,p,x),this.database=wr(`${j.name}.database.${r}`,"AngularFireDatabase",j.name,()=>{let M=o.runOutsideAngular(()=>j.database(r||void 0));return q&&M.useEmulator(...q),M},[q])}list(t,i){let r=this.schedulers.ngZone.runOutsideAngular(()=>E0(this.database,t)),s=r;return i&&(s=i(r)),cx(s,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>E0(this.database,t));return ux(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(K(jn),K(Gn,8),K(hx,8),K(Un),K(pt),K(vr),K(dx,8),K(ho,8),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(co,8),K(vn,8))};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),zk=(()=>{class n{constructor(){Ue.registerVersion("angularfire",wn.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Qt({type:n});static \u0275inj=$t({providers:[fx]})}return n})();At();At();$s();var k0=["toast-component",""];function px(n,e){if(n&1){let t=hh();Ot(0,"button",5),Xs("click",function(){oh(t);let r=mt();return ah(r.remove())}),Ot(1,"span",6),yn(2,"\xD7"),_n()()}}function mx(n,e){if(n&1&&(ch(0),yn(1),uh()),n&2){let t=mt(2);Fe(),Si("[",t.duplicatesCount+1,"]")}}function gx(n,e){if(n&1&&(Ot(0,"div"),yn(1),Qs(2,mx,2,1,"ng-container",4),_n()),n&2){let t=mt();gn(t.options.titleClass),Hs("aria-label",t.title),Fe(),Si(" ",t.title," "),Fe(),rt("ngIf",t.duplicatesCount)}}function _x(n,e){if(n&1&&Js(0,"div",7),n&2){let t=mt();gn(t.options.messageClass),rt("innerHTML",t.message,lh)}}function yx(n,e){if(n&1&&(Ot(0,"div",8),yn(1),_n()),n&2){let t=mt();gn(t.options.messageClass),Hs("aria-label",t.message),Fe(),Si(" ",t.message," ")}}function vx(n,e){if(n&1&&(Ot(0,"div"),Js(1,"div",9),_n()),n&2){let t=mt();Fe(),Ys("width",t.width+"%")}}function wx(n,e){if(n&1){let t=hh();Ot(0,"button",5),Xs("click",function(){oh(t);let r=mt();return ah(r.remove())}),Ot(1,"span",6),yn(2,"\xD7"),_n()()}}function Tx(n,e){if(n&1&&(ch(0),yn(1),uh()),n&2){let t=mt(2);Fe(),Si("[",t.duplicatesCount+1,"]")}}function Ex(n,e){if(n&1&&(Ot(0,"div"),yn(1),Qs(2,Tx,2,1,"ng-container",4),_n()),n&2){let t=mt();gn(t.options.titleClass),Hs("aria-label",t.title),Fe(),Si(" ",t.title," "),Fe(),rt("ngIf",t.duplicatesCount)}}function Ix(n,e){if(n&1&&Js(0,"div",7),n&2){let t=mt();gn(t.options.messageClass),rt("innerHTML",t.message,lh)}}function Ax(n,e){if(n&1&&(Ot(0,"div",8),yn(1),_n()),n&2){let t=mt();gn(t.options.messageClass),Hs("aria-label",t.message),Fe(),Si(" ",t.message," ")}}function Cx(n,e){if(n&1&&(Ot(0,"div"),Js(1,"div",9),_n()),n&2){let t=mt();Fe(),Ys("width",t.width+"%")}}var Og=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Mg=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},Fg=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new zt;_activate=new zt;_manualClose=new zt;_resetTimeout=new zt;_countDuplicate=new zt;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Cs=class{toastId;config;message;title;toastType;toastRef;_onTap=new zt;_onAction=new zt;constructor(e,t,i,r,s,o){this.toastId=e,this.config=t,this.message=i,this.title=r,this.toastType=s,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},D0={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},V0=new Ne("ToastConfig"),Lg=class extends Mg{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,i){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=i}attachComponentPortal(e,t){let i=this._componentFactoryResolver.resolveComponentFactory(e.component),r;return r=i.create(e.injector),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.detachView(r.hostView),r.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(r),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(r)),r}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},bx=(()=>{class n{_document=_r(ph);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ug=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},Sx=(()=>{class n{_overlayContainer=_r(bx);_componentFactoryResolver=_r(Y_);_appRef=_r(tl);_document=_r(ph);_paneElements=new Map;create(t,i){return this._createOverlayRef(this.getPaneElement(t,i))}getPaneElement(t="",i){return this._paneElements.get(i)||this._paneElements.set(i,{}),this._paneElements.get(i)[t]||(this._paneElements.get(i)[t]=this._createPaneElement(t,i)),this._paneElements.get(i)[t]}_createPaneElement(t,i){let r=this._document.createElement("div");return r.id="toast-container",r.classList.add(t),r.classList.add("toast-container"),i?i.getContainerElement().appendChild(r):this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalHost(t){return new Lg(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new Ug(this._createPortalHost(t))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),O0=(()=>{class n{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,i,r,s,o){this.overlay=i,this._injector=r,this.sanitizer=s,this.ngZone=o,this.toastrConfig=je(je({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=je(je({},t.default.iconClasses),t.config.iconClasses))}show(t,i,r={},s=""){return this._preBuildNotification(s,t,i,this.applyConfig(r))}success(t,i,r={}){let s=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}error(t,i,r={}){let s=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}info(t,i,r={}){let s=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}warning(t,i,r={}){let s=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}clear(t){for(let i of this.toasts)if(t!==void 0){if(i.toastId===t){i.toastRef.manualClose();return}}else i.toastRef.manualClose()}remove(t){let i=this._findToast(t);if(!i||(i.activeToast.toastRef.close(),this.toasts.splice(i.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let r=this.toasts[this.currentlyActive].toastRef;r.isInactive()||(this.currentlyActive=this.currentlyActive+1,r.activate())}return!0}findDuplicate(t="",i="",r,s){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let c=o&&a.title===t;if((!o||c)&&a.message===i)return a.toastRef.onDuplicate(r,s),a}return null}applyConfig(t={}){return je(je({},this.toastrConfig),t)}_findToast(t){for(let i=0;i<this.toasts.length;i++)if(this.toasts[i].toastId===t)return{index:i,activeToast:this.toasts[i]};return null}_preBuildNotification(t,i,r,s){return s.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,i,r,s)):this._buildNotification(t,i,r,s)}_buildNotification(t,i,r,s){if(!s.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(r,i,this.toastrConfig.resetTimeoutOnDuplicate&&s.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&r||i)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=i;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let c=this.overlay.create(s.positionClass,this.overlayContainer);this.index=this.index+1;let u=i;i&&s.enableHtml&&(u=this.sanitizer.sanitize(H_.HTML,i));let d=new Fg(c),p=new Cs(this.index,s,u,r,t,d),m=[{provide:Cs,useValue:p}],y=el.create({providers:m,parent:this._injector}),C=new Og(s.toastComponent,y),x=c.attach(C,s.newestOnTop);d.componentInstance=x.instance;let k={toastId:this.index,title:r||"",message:i||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:p.onTap(),onAction:p.onAction(),portal:x};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{k.toastRef.activate()})),this.toasts.push(k),k}static \u0275fac=function(i){return new(i||n)(K(V0),K(Sx),K(el),K(ey),K(pt))};static \u0275prov=It({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Rx=(()=>{class n{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";state;get displayStyle(){if(this.state.value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.ngZone=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s}),this.state={value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}}}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state=Vt(je({},this.state),{value:"active"}),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width=i/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state=Vt(je({},this.state),{value:"active"}),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state.value!=="removed"&&(clearTimeout(this.timeout),this.state=Vt(je({},this.state),{value:"removed"}),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state.value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state.value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state.value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),i)):this.timeout=setTimeout(()=>t(),i)}outsideInterval(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),i)):this.intervalId=setInterval(()=>t(),i)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(i){return new(i||n)(bi(O0),bi(Cs),bi(pt))};static \u0275cmp=sh({type:n,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(i,r){i&1&&Xs("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(J_("@flyInOut",r.state),gn(r.toastClasses),Ys("display",r.displayStyle))},standalone:!0,features:[dh],attrs:k0,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&Qs(0,px,3,0,"button",0)(1,gx,3,5,"div",1)(2,_x,1,3,"div",2)(3,yx,2,4,"div",3)(4,vx,2,2,"div",4),i&2&&(rt("ngIf",r.options.closeButton),Fe(),rt("ngIf",r.title),Fe(),rt("ngIf",r.message&&r.options.enableHtml),Fe(),rt("ngIf",r.message&&!r.options.enableHtml),Fe(),rt("ngIf",r.options.progressBar))},dependencies:[mh],encapsulation:2,data:{animation:[ty("flyInOut",[rl("inactive",il({opacity:0})),rl("active",il({opacity:1})),rl("removed",il({opacity:0})),_h("inactive => active",gh("{{ easeTime }}ms {{ easing }}")),_h("active => removed",gh("{{ easeTime }}ms {{ easing }}"))])]}})}return n})(),Px=Vt(je({},D0),{toastComponent:Rx}),xx=(n={})=>Q_([{provide:V0,useValue:{default:Px,config:n}}]),lD=(()=>{class n{static forRoot(t={}){return{ngModule:n,providers:[xx(t)]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Qt({type:n});static \u0275inj=$t({})}return n})();var Nx=(()=>{class n{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";get displayStyle(){return this.state==="inactive"?"none":null}state="inactive";timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.appRef=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state="active",!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width=i/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state="active",this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state!=="removed"&&(clearTimeout(this.timeout),this.state="removed",this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(i){return new(i||n)(bi(O0),bi(Cs),bi(tl))};static \u0275cmp=sh({type:n,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(i,r){i&1&&Xs("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(gn(r.toastClasses),Ys("display",r.displayStyle))},standalone:!0,features:[dh],attrs:k0,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&Qs(0,wx,3,0,"button",0)(1,Ex,3,5,"div",1)(2,Ix,1,3,"div",2)(3,Ax,2,4,"div",3)(4,Cx,2,2,"div",4),i&2&&(rt("ngIf",r.options.closeButton),Fe(),rt("ngIf",r.title),Fe(),rt("ngIf",r.message&&r.options.enableHtml),Fe(),rt("ngIf",r.message&&!r.options.enableHtml),Fe(),rt("ngIf",r.options.progressBar))},dependencies:[mh],encapsulation:2})}return n})(),cD=Vt(je({},D0),{toastComponent:Nx});var dD={production:!0,firebase:{apiKey:"***************************************",authDomain:"************************",projectId:"***********************************",storageBucket:"************************",messagingSenderId:"*********************",appId:"*******************************************",measurementId:"*********************"}};export{Qx as a,ho as b,kN as c,gk as d,zk as e,dD as f,O0 as g,lD as h};
