import{a as OA}from"./chunk-J44PX5B4.js";import{b as RA,c as Tc,d as Ic,e as Ac,f as ut,g as Pc,h as Cc,i as Oc,j as D_,k as Rc,l as Nc,m as Dc,n as xc,o as kc,p as Mc,q as qc,r as Fc,s as Vc,t as BA}from"./chunk-2NUTOWU5.js";import{A as ne,B as Vt,C as at,D as R_,E as UA,F as su,G as fe,H as Pr,I as wc,J as N_,K as rr,L as js,M as Ec,N as Sc,P as Us,Q as On,a as U,b as Ls,c as NA,d as DA,e as xA,f as Ot,g as yc,h as nu,i as P_,j as kA,k as Ar,l as C_,m as MA,n as qA,p as vc,q as rt,r as FA,s as VA,t as tr,u as Cn,v as bc,w as iu,x as O_,y as LA,z as jA}from"./chunk-6LIFATZG.js";import{b as vA,j as bA,k as re,l as Ft,m as mc,n as gc,o as wA,p as EA,q as _c,r as SA,s as ru,t as TA,u as IA,v as AA,w as PA,x as CA}from"./chunk-LRPIMIQI.js";import{b as mA,c as gA,d as _A,e as yA}from"./chunk-RZ54XKMH.js";import{c as fc,d as dA,g as fA,h as Pe}from"./chunk-6WONESTQ.js";import{b as cA,c as hA}from"./chunk-EMQUMKIL.js";import{a as me,b as Ir,f as pA,g as I_,m as Vs,n as A_,o as pc}from"./chunk-CARY4E7O.js";import"./chunk-BCSET4D3.js";import{$ as hc,Aa as tA,E as E_,F as S_,Q as lc,Sb as sA,Ta as dc,Ua as T_,V as cc,W as ki,X as QI,Xc as tt,Yc as Me,_ as $I,aa as HI,ad as aA,c as ac,fa as YI,ga as JI,ha as XI,ia as ye,j as uc,ka as Tr,la as Ue,na as Pn,ob as rA,p as eu,pa as ue,q as tu,qa as ZI,qb as nA,qc as oA,qd as uA,sb as iA,tb as Fs,td as lA,u as ht,va as eA,wa as Be}from"./chunk-NXEWHPL2.js";import{a as Sr,b as Xa,c as GI,e as E,g as lF,h as Za,i as b_,j as q,k as w_,q as cF}from"./chunk-5VBBBU7A.js";var Te=E(Tf=>{"use strict";Object.defineProperty(Tf,"__esModule",{value:!0});Tf.isFunction=void 0;function oW(r){return typeof r=="function"}Tf.isFunction=oW});var oi=E(If=>{"use strict";Object.defineProperty(If,"__esModule",{value:!0});If.createErrorClass=void 0;function aW(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}If.createErrorClass=aW});var fS=E(Af=>{"use strict";Object.defineProperty(Af,"__esModule",{value:!0});Af.UnsubscriptionError=void 0;var uW=oi();Af.UnsubscriptionError=uW.createErrorClass(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}})});var mn=E(Pf=>{"use strict";Object.defineProperty(Pf,"__esModule",{value:!0});Pf.arrRemove=void 0;function lW(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}Pf.arrRemove=lW});var Xt=E(jt=>{"use strict";var wx=jt&&jt.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ex=jt&&jt.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Sx=jt&&jt.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(jt,"__esModule",{value:!0});jt.isSubscription=jt.EMPTY_SUBSCRIPTION=jt.Subscription=void 0;var Dl=Te(),pS=fS(),Tx=mn(),mS=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=wx(o),u=a.next();!u.done;u=a.next()){var c=u.value;c.remove(this)}}catch(w){e={error:w}}finally{try{u&&!u.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var h=this.initialTeardown;if(Dl.isFunction(h))try{h()}catch(w){s=w instanceof pS.UnsubscriptionError?w.errors:[w]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var m=wx(f),_=m.next();!_.done;_=m.next()){var v=_.value;try{Ix(v)}catch(w){s=s??[],w instanceof pS.UnsubscriptionError?s=Sx(Sx([],Ex(s)),Ex(w.errors)):s.push(w)}}}catch(w){n={error:w}}finally{try{_&&!_.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}}if(s)throw new pS.UnsubscriptionError(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Ix(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Tx.arrRemove(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&Tx.arrRemove(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}();jt.Subscription=mS;jt.EMPTY_SUBSCRIPTION=mS.EMPTY;function cW(r){return r instanceof mS||r&&"closed"in r&&Dl.isFunction(r.remove)&&Dl.isFunction(r.add)&&Dl.isFunction(r.unsubscribe)}jt.isSubscription=cW;function Ix(r){Dl.isFunction(r)?r():r.unsubscribe()}});var Ho=E(Cf=>{"use strict";Object.defineProperty(Cf,"__esModule",{value:!0});Cf.config=void 0;Cf.config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}});var gS=E(zr=>{"use strict";var Ax=zr&&zr.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Px=zr&&zr.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(zr,"__esModule",{value:!0});zr.timeoutProvider=void 0;zr.timeoutProvider={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=zr.timeoutProvider.delegate;return i?.setTimeout?i.setTimeout.apply(i,Px([r,e],Ax(t))):setTimeout.apply(void 0,Px([r,e],Ax(t)))},clearTimeout:function(r){var e=zr.timeoutProvider.delegate;return(e?.clearTimeout||clearTimeout)(r)},delegate:void 0}});var _S=E(Of=>{"use strict";Object.defineProperty(Of,"__esModule",{value:!0});Of.reportUnhandledError=void 0;var hW=Ho(),dW=gS();function fW(r){dW.timeoutProvider.setTimeout(function(){var e=hW.config.onUnhandledError;if(e)e(r);else throw r})}Of.reportUnhandledError=fW});var _t=E(Rf=>{"use strict";Object.defineProperty(Rf,"__esModule",{value:!0});Rf.noop=void 0;function pW(){}Rf.noop=pW});var Cx=E(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.createNotification=Kr.nextNotification=Kr.errorNotification=Kr.COMPLETE_NOTIFICATION=void 0;Kr.COMPLETE_NOTIFICATION=function(){return Nf("C",void 0,void 0)}();function mW(r){return Nf("E",void 0,r)}Kr.errorNotification=mW;function gW(r){return Nf("N",r,void 0)}Kr.nextNotification=gW;function Nf(r,e,t){return{kind:r,value:e,error:t}}Kr.createNotification=Nf});var Df=E(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.captureError=Yo.errorContext=void 0;var Ox=Ho(),Es=null;function _W(r){if(Ox.config.useDeprecatedSynchronousErrorHandling){var e=!Es;if(e&&(Es={errorThrown:!1,error:null}),r(),e){var t=Es,n=t.errorThrown,i=t.error;if(Es=null,n)throw i}}else r()}Yo.errorContext=_W;function yW(r){Ox.config.useDeprecatedSynchronousErrorHandling&&Es&&(Es.errorThrown=!0,Es.error=r)}Yo.captureError=yW});var Jo=E(br=>{"use strict";var Dx=br&&br.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(br,"__esModule",{value:!0});br.EMPTY_OBSERVER=br.SafeSubscriber=br.Subscriber=void 0;var vW=Te(),Rx=Xt(),wS=Ho(),bW=_S(),Nx=_t(),yS=Cx(),wW=gS(),EW=Df(),xx=function(r){Dx(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Rx.isSubscription(t)&&t.add(n)):n.destination=br.EMPTY_OBSERVER,n}return e.create=function(t,n,i){return new kx(t,n,i)},e.prototype.next=function(t){this.isStopped?bS(yS.nextNotification(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?bS(yS.errorNotification(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?bS(yS.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Rx.Subscription);br.Subscriber=xx;var SW=Function.prototype.bind;function vS(r,e){return SW.call(r,e)}var TW=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){xf(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){xf(n)}else xf(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){xf(t)}},r}(),kx=function(r){Dx(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(vW.isFunction(t)||!t)o={next:t??void 0,error:n??void 0,complete:i??void 0};else{var a;s&&wS.config.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&vS(t.next,a),error:t.error&&vS(t.error,a),complete:t.complete&&vS(t.complete,a)}):o=t}return s.destination=new TW(o),s}return e}(xx);br.SafeSubscriber=kx;function xf(r){wS.config.useDeprecatedSynchronousErrorHandling?EW.captureError(r):bW.reportUnhandledError(r)}function IW(r){throw r}function bS(r,e){var t=wS.config.onStoppedNotification;t&&wW.timeoutProvider.setTimeout(function(){return t(r,e)})}br.EMPTY_OBSERVER={closed:!0,next:Nx.noop,error:IW,complete:Nx.noop}});var xl=E(kf=>{"use strict";Object.defineProperty(kf,"__esModule",{value:!0});kf.observable=void 0;kf.observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}()});var yt=E(Mf=>{"use strict";Object.defineProperty(Mf,"__esModule",{value:!0});Mf.identity=void 0;function AW(r){return r}Mf.identity=AW});var kl=E(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.pipeFromArray=Xo.pipe=void 0;var PW=yt();function CW(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Mx(r)}Xo.pipe=CW;function Mx(r){return r.length===0?PW.identity:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}Xo.pipeFromArray=Mx});var Ie=E(qf=>{"use strict";Object.defineProperty(qf,"__esModule",{value:!0});qf.Observable=void 0;var SS=Jo(),OW=Xt(),RW=xl(),NW=kl(),DW=Ho(),ES=Te(),xW=Df(),kW=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=qW(e)?e:new SS.SafeSubscriber(e,t,n);return xW.errorContext(function(){var o=i,a=o.operator,u=o.source;s.add(a?a.call(s,u):u?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=qx(t),new t(function(i,s){var o=new SS.SafeSubscriber({next:function(a){try{e(a)}catch(u){s(u),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[RW.observable]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return NW.pipeFromArray(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=qx(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();qf.Observable=kW;function qx(r){var e;return(e=r??DW.config.Promise)!==null&&e!==void 0?e:Promise}function MW(r){return r&&ES.isFunction(r.next)&&ES.isFunction(r.error)&&ES.isFunction(r.complete)}function qW(r){return r&&r instanceof SS.Subscriber||MW(r)&&OW.isSubscription(r)}});var K=E(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.operate=Zo.hasLift=void 0;var FW=Te();function Fx(r){return FW.isFunction(r?.lift)}Zo.hasLift=Fx;function VW(r){return function(e){if(Fx(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}Zo.operate=VW});var J=E(ai=>{"use strict";var LW=ai&&ai.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ai,"__esModule",{value:!0});ai.OperatorSubscriber=ai.createOperatorSubscriber=void 0;var jW=Jo();function UW(r,e,t,n,i){return new Vx(r,e,t,n,i)}ai.createOperatorSubscriber=UW;var Vx=function(r){LW(e,r);function e(t,n,i,s,o,a){var u=r.call(this,t)||this;return u.onFinalize=o,u.shouldUnsubscribe=a,u._next=n?function(c){try{n(c)}catch(h){t.error(h)}}:r.prototype._next,u._error=s?function(c){try{s(c)}catch(h){t.error(h)}finally{this.unsubscribe()}}:r.prototype._error,u._complete=i?function(){try{i()}catch(c){t.error(c)}finally{this.unsubscribe()}}:r.prototype._complete,u}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(jW.Subscriber);ai.OperatorSubscriber=Vx});var Vf=E(Ff=>{"use strict";Object.defineProperty(Ff,"__esModule",{value:!0});Ff.refCount=void 0;var BW=K(),WW=J();function zW(){return BW.operate(function(r,e){var t=null;r._refCount++;var n=WW.createOperatorSubscriber(e,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){t=null;return}var i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}Ff.refCount=zW});var Ml=E(ea=>{"use strict";var KW=ea&&ea.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ea,"__esModule",{value:!0});ea.ConnectableObservable=void 0;var GW=Ie(),Lx=Xt(),QW=Vf(),$W=J(),HW=K(),YW=function(r){KW(e,r);function e(t,n){var i=r.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,HW.hasLift(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t?.unsubscribe()},e.prototype.connect=function(){var t=this,n=this._connection;if(!n){n=this._connection=new Lx.Subscription;var i=this.getSubject();n.add(this.source.subscribe($W.createOperatorSubscriber(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),n.closed&&(this._connection=null,n=Lx.Subscription.EMPTY)}return n},e.prototype.refCount=function(){return QW.refCount()(this)},e}(GW.Observable);ea.ConnectableObservable=YW});var jx=E(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.performanceTimestampProvider=void 0;ql.performanceTimestampProvider={now:function(){return(ql.performanceTimestampProvider.delegate||performance).now()},delegate:void 0}});var TS=E(wr=>{"use strict";var Ux=wr&&wr.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Bx=wr&&wr.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(wr,"__esModule",{value:!0});wr.animationFrameProvider=void 0;var JW=Xt();wr.animationFrameProvider={schedule:function(r){var e=requestAnimationFrame,t=cancelAnimationFrame,n=wr.animationFrameProvider.delegate;n&&(e=n.requestAnimationFrame,t=n.cancelAnimationFrame);var i=e(function(s){t=void 0,r(s)});return new JW.Subscription(function(){return t?.(i)})},requestAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=wr.animationFrameProvider.delegate;return(t?.requestAnimationFrame||requestAnimationFrame).apply(void 0,Bx([],Ux(r)))},cancelAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=wr.animationFrameProvider.delegate;return(t?.cancelAnimationFrame||cancelAnimationFrame).apply(void 0,Bx([],Ux(r)))},delegate:void 0}});var Kx=E(Lf=>{"use strict";Object.defineProperty(Lf,"__esModule",{value:!0});Lf.animationFrames=void 0;var XW=Ie(),ZW=jx(),Wx=TS();function ez(r){return r?zx(r):tz}Lf.animationFrames=ez;function zx(r){return new XW.Observable(function(e){var t=r||ZW.performanceTimestampProvider,n=t.now(),i=0,s=function(){e.closed||(i=Wx.animationFrameProvider.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:r?a:o,elapsed:a-n}),s()}))};return s(),function(){i&&Wx.animationFrameProvider.cancelAnimationFrame(i)}})}var tz=zx()});var IS=E(jf=>{"use strict";Object.defineProperty(jf,"__esModule",{value:!0});jf.ObjectUnsubscribedError=void 0;var rz=oi();jf.ObjectUnsubscribedError=rz.createErrorClass(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})});var vt=E(Gr=>{"use strict";var Qx=Gr&&Gr.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),nz=Gr&&Gr.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.AnonymousSubject=Gr.Subject=void 0;var Gx=Ie(),PS=Xt(),iz=IS(),sz=mn(),AS=Df(),$x=function(r){Qx(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new CS(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new iz.ObjectUnsubscribedError},e.prototype.next=function(t){var n=this;AS.errorContext(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=nz(n.currentObservers),a=o.next();!a.done;a=o.next()){var u=a.value;u.next(t)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;AS.errorContext(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;AS.errorContext(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?PS.EMPTY_SUBSCRIPTION:(this.currentObservers=null,a.push(t),new PS.Subscription(function(){n.currentObservers=null,sz.arrRemove(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new Gx.Observable;return t.source=this,t},e.create=function(t,n){return new CS(t,n)},e}(Gx.Observable);Gr.Subject=$x;var CS=function(r){Qx(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:PS.EMPTY_SUBSCRIPTION},e}($x);Gr.AnonymousSubject=CS});var OS=E(ta=>{"use strict";var oz=ta&&ta.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ta,"__esModule",{value:!0});ta.BehaviorSubject=void 0;var az=vt(),uz=function(r){oz(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(az.Subject);ta.BehaviorSubject=uz});var Uf=E(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});Fl.dateTimestampProvider=void 0;Fl.dateTimestampProvider={now:function(){return(Fl.dateTimestampProvider.delegate||Date).now()},delegate:void 0}});var Bf=E(ra=>{"use strict";var lz=ra&&ra.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ra,"__esModule",{value:!0});ra.ReplaySubject=void 0;var cz=vt(),hz=Uf(),dz=function(r){lz(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=hz.dateTimestampProvider);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,u=n._windowTime;i||(s.push(t),!o&&s.push(a.now()+u)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),u=0;u<a.length&&!t.closed;u+=s?1:2)t.next(a[u]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var u=i.now(),c=0,h=1;h<s.length&&s[h]<=u;h+=2)c=h;c&&s.splice(0,c+1)}},e}(cz.Subject);ra.ReplaySubject=dz});var Wf=E(na=>{"use strict";var fz=na&&na.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(na,"__esModule",{value:!0});na.AsyncSubject=void 0;var pz=vt(),mz=function(r){fz(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n._hasValue,o=n._value,a=n.thrownError,u=n.isStopped,c=n._isComplete;i?t.error(a):(u||c)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,n=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,n&&r.prototype.next.call(this,i),r.prototype.complete.call(this))},e}(pz.Subject);na.AsyncSubject=mz});var Hx=E(ia=>{"use strict";var gz=ia&&ia.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ia,"__esModule",{value:!0});ia.Action=void 0;var _z=Xt(),yz=function(r){gz(e,r);function e(t,n){return r.call(this)||this}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),this},e}(_z.Subscription);ia.Action=yz});var Xx=E(Qr=>{"use strict";var Yx=Qr&&Qr.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Jx=Qr&&Qr.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.intervalProvider=void 0;Qr.intervalProvider={setInterval:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Qr.intervalProvider.delegate;return i?.setInterval?i.setInterval.apply(i,Jx([r,e],Yx(t))):setInterval.apply(void 0,Jx([r,e],Yx(t)))},clearInterval:function(r){var e=Qr.intervalProvider.delegate;return(e?.clearInterval||clearInterval)(r)},delegate:void 0}});var oa=E(sa=>{"use strict";var vz=sa&&sa.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(sa,"__esModule",{value:!0});sa.AsyncAction=void 0;var bz=Hx(),Zx=Xx(),wz=mn(),Ez=function(r){vz(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(t,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),Zx.intervalProvider.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Zx.intervalProvider.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,wz.arrRemove(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},e}(bz.Action);sa.AsyncAction=Ez});var tk=E(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.TestTools=aa.Immediate=void 0;var Sz=1,RS,zf={};function ek(r){return r in zf?(delete zf[r],!0):!1}aa.Immediate={setImmediate:function(r){var e=Sz++;return zf[e]=!0,RS||(RS=Promise.resolve()),RS.then(function(){return ek(e)&&r()}),e},clearImmediate:function(r){ek(r)}};aa.TestTools={pending:function(){return Object.keys(zf).length}}});var nk=E($r=>{"use strict";var Tz=$r&&$r.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Iz=$r&&$r.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty($r,"__esModule",{value:!0});$r.immediateProvider=void 0;var rk=tk(),Az=rk.Immediate.setImmediate,Pz=rk.Immediate.clearImmediate;$r.immediateProvider={setImmediate:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=$r.immediateProvider.delegate;return(t?.setImmediate||Az).apply(void 0,Iz([],Tz(r)))},clearImmediate:function(r){var e=$r.immediateProvider.delegate;return(e?.clearImmediate||Pz)(r)},delegate:void 0}});var sk=E(ua=>{"use strict";var Cz=ua&&ua.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ua,"__esModule",{value:!0});ua.AsapAction=void 0;var Oz=oa(),ik=nk(),Rz=function(r){Cz(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=ik.immediateProvider.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(ik.immediateProvider.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},e}(Oz.AsyncAction);ua.AsapAction=Rz});var NS=E(Kf=>{"use strict";Object.defineProperty(Kf,"__esModule",{value:!0});Kf.Scheduler=void 0;var Nz=Uf(),Dz=function(){function r(e,t){t===void 0&&(t=r.now),this.schedulerActionCtor=e,this.now=t}return r.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},r.now=Nz.dateTimestampProvider.now,r}();Kf.Scheduler=Dz});var ca=E(la=>{"use strict";var xz=la&&la.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(la,"__esModule",{value:!0});la.AsyncScheduler=void 0;var ok=NS(),kz=function(r){xz(e,r);function e(t,n){n===void 0&&(n=ok.Scheduler.now);var i=r.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},e}(ok.Scheduler);la.AsyncScheduler=kz});var ak=E(ha=>{"use strict";var Mz=ha&&ha.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ha,"__esModule",{value:!0});ha.AsapScheduler=void 0;var qz=ca(),Fz=function(r){Mz(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(qz.AsyncScheduler);ha.AsapScheduler=Fz});var uk=E(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.asap=Ss.asapScheduler=void 0;var Vz=sk(),Lz=ak();Ss.asapScheduler=new Lz.AsapScheduler(Vz.AsapAction);Ss.asap=Ss.asapScheduler});var Ut=E(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.async=Ts.asyncScheduler=void 0;var jz=oa(),Uz=ca();Ts.asyncScheduler=new Uz.AsyncScheduler(jz.AsyncAction);Ts.async=Ts.asyncScheduler});var lk=E(da=>{"use strict";var Bz=da&&da.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(da,"__esModule",{value:!0});da.QueueAction=void 0;var Wz=oa(),zz=function(r){Bz(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,n){return n>0||this.closed?r.prototype.execute.call(this,t,n):this._execute(t,n)},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.flush(this),0)},e}(Wz.AsyncAction);da.QueueAction=zz});var ck=E(fa=>{"use strict";var Kz=fa&&fa.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(fa,"__esModule",{value:!0});fa.QueueScheduler=void 0;var Gz=ca(),Qz=function(r){Kz(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Gz.AsyncScheduler);fa.QueueScheduler=Qz});var hk=E(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.queue=Is.queueScheduler=void 0;var $z=lk(),Hz=ck();Is.queueScheduler=new Hz.QueueScheduler($z.QueueAction);Is.queue=Is.queueScheduler});var fk=E(pa=>{"use strict";var Yz=pa&&pa.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(pa,"__esModule",{value:!0});pa.AnimationFrameAction=void 0;var Jz=oa(),dk=TS(),Xz=function(r){Yz(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=dk.animationFrameProvider.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(dk.animationFrameProvider.cancelAnimationFrame(n),t._scheduled=void 0)},e}(Jz.AsyncAction);pa.AnimationFrameAction=Xz});var pk=E(ma=>{"use strict";var Zz=ma&&ma.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ma,"__esModule",{value:!0});ma.AnimationFrameScheduler=void 0;var e4=ca(),t4=function(r){Zz(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(e4.AsyncScheduler);ma.AnimationFrameScheduler=t4});var mk=E(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.animationFrame=As.animationFrameScheduler=void 0;var r4=fk(),n4=pk();As.animationFrameScheduler=new n4.AnimationFrameScheduler(r4.AnimationFrameAction);As.animationFrame=As.animationFrameScheduler});var yk=E(ui=>{"use strict";var gk=ui&&ui.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(ui,"__esModule",{value:!0});ui.VirtualAction=ui.VirtualTimeScheduler=void 0;var i4=oa(),s4=Xt(),o4=ca(),a4=function(r){gk(e,r);function e(t,n){t===void 0&&(t=_k),n===void 0&&(n=1/0);var i=r.call(this,t,function(){return i.frame})||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,n=t.actions,i=t.maxFrames,s,o;(o=n[0])&&o.delay<=i&&(n.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=n.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(o4.AsyncScheduler);ui.VirtualTimeScheduler=a4;var _k=function(r){gk(e,r);function e(t,n,i){i===void 0&&(i=t.index+=1);var s=r.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return r.prototype.schedule.call(this,t,n);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,n)}else return s4.Subscription.EMPTY},e.prototype.requestAsyncId=function(t,n,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,n,i){i===void 0&&(i=0)},e.prototype._execute=function(t,n){if(this.active===!0)return r.prototype._execute.call(this,t,n)},e.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},e}(i4.AsyncAction);ui.VirtualAction=_k});var Er=E(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.empty=Ps.EMPTY=void 0;var vk=Ie();Ps.EMPTY=new vk.Observable(function(r){return r.complete()});function u4(r){return r?l4(r):Ps.EMPTY}Ps.empty=u4;function l4(r){return new vk.Observable(function(e){return r.schedule(function(){return e.complete()})})}});var Vl=E(Gf=>{"use strict";Object.defineProperty(Gf,"__esModule",{value:!0});Gf.isScheduler=void 0;var c4=Te();function h4(r){return r&&c4.isFunction(r.schedule)}Gf.isScheduler=h4});var Bt=E(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.popNumber=li.popScheduler=li.popResultSelector=void 0;var d4=Te(),f4=Vl();function DS(r){return r[r.length-1]}function p4(r){return d4.isFunction(DS(r))?r.pop():void 0}li.popResultSelector=p4;function m4(r){return f4.isScheduler(DS(r))?r.pop():void 0}li.popScheduler=m4;function g4(r,e){return typeof DS(r)=="number"?r.pop():e}li.popNumber=g4});var $f=E(Qf=>{"use strict";Object.defineProperty(Qf,"__esModule",{value:!0});Qf.isArrayLike=void 0;Qf.isArrayLike=function(r){return r&&typeof r.length=="number"&&typeof r!="function"}});var xS=E(Hf=>{"use strict";Object.defineProperty(Hf,"__esModule",{value:!0});Hf.isPromise=void 0;var _4=Te();function y4(r){return _4.isFunction(r?.then)}Hf.isPromise=y4});var kS=E(Yf=>{"use strict";Object.defineProperty(Yf,"__esModule",{value:!0});Yf.isInteropObservable=void 0;var v4=xl(),b4=Te();function w4(r){return b4.isFunction(r[v4.observable])}Yf.isInteropObservable=w4});var MS=E(Jf=>{"use strict";Object.defineProperty(Jf,"__esModule",{value:!0});Jf.isAsyncIterable=void 0;var E4=Te();function S4(r){return Symbol.asyncIterator&&E4.isFunction(r?.[Symbol.asyncIterator])}Jf.isAsyncIterable=S4});var qS=E(Xf=>{"use strict";Object.defineProperty(Xf,"__esModule",{value:!0});Xf.createInvalidObservableTypeError=void 0;function T4(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}Xf.createInvalidObservableTypeError=T4});var FS=E(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.iterator=ga.getSymbolIterator=void 0;function bk(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}ga.getSymbolIterator=bk;ga.iterator=bk()});var VS=E(Zf=>{"use strict";Object.defineProperty(Zf,"__esModule",{value:!0});Zf.isIterable=void 0;var I4=FS(),A4=Te();function P4(r){return A4.isFunction(r?.[I4.iterator])}Zf.isIterable=P4});var ep=E(cr=>{"use strict";var C4=cr&&cr.__generator||function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return u([c,h])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(h){c=[6,h],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},_a=cr&&cr.__await||function(r){return this instanceof _a?(this.v=r,this):new _a(r)},O4=cr&&cr.__asyncGenerator||function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(m){n[m]&&(i[m]=function(_){return new Promise(function(v,w){s.push([m,_,v,w])>1||a(m,_)})})}function a(m,_){try{u(n[m](_))}catch(v){f(s[0][3],v)}}function u(m){m.value instanceof _a?Promise.resolve(m.value.v).then(c,h):f(s[0][2],m)}function c(m){a("next",m)}function h(m){a("throw",m)}function f(m,_){m(_),s.shift(),s.length&&a(s[0][0],s[0][1])}};Object.defineProperty(cr,"__esModule",{value:!0});cr.isReadableStreamLike=cr.readableStreamLikeToAsyncGenerator=void 0;var R4=Te();function N4(r){return O4(this,arguments,function(){var t,n,i,s;return C4(this,function(o){switch(o.label){case 0:t=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,_a(t.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,_a(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,_a(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}cr.readableStreamLikeToAsyncGenerator=N4;function D4(r){return R4.isFunction(r?.getReader)}cr.isReadableStreamLike=D4});var ae=E(Le=>{"use strict";var x4=Le&&Le.__awaiter||function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(f){o(f)}}function u(h){try{c(n.throw(h))}catch(f){o(f)}}function c(h){h.done?s(h.value):i(h.value).then(a,u)}c((n=n.apply(r,e||[])).next())})},k4=Le&&Le.__generator||function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return u([c,h])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(h){c=[6,h],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},M4=Le&&Le.__asyncValues||function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof LS=="function"?LS(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,u){o=r[s](o),i(a,u,o.done,o.value)})}}function i(s,o,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},o)}},LS=Le&&Le.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Le,"__esModule",{value:!0});Le.fromReadableStreamLike=Le.fromAsyncIterable=Le.fromIterable=Le.fromPromise=Le.fromArrayLike=Le.fromInteropObservable=Le.innerFrom=void 0;var q4=$f(),F4=xS(),ya=Ie(),V4=kS(),L4=MS(),j4=qS(),U4=VS(),wk=ep(),B4=Te(),W4=_S(),z4=xl();function K4(r){if(r instanceof ya.Observable)return r;if(r!=null){if(V4.isInteropObservable(r))return Ek(r);if(q4.isArrayLike(r))return Sk(r);if(F4.isPromise(r))return Tk(r);if(L4.isAsyncIterable(r))return jS(r);if(U4.isIterable(r))return Ik(r);if(wk.isReadableStreamLike(r))return Ak(r)}throw j4.createInvalidObservableTypeError(r)}Le.innerFrom=K4;function Ek(r){return new ya.Observable(function(e){var t=r[z4.observable]();if(B4.isFunction(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}Le.fromInteropObservable=Ek;function Sk(r){return new ya.Observable(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}Le.fromArrayLike=Sk;function Tk(r){return new ya.Observable(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,W4.reportUnhandledError)})}Le.fromPromise=Tk;function Ik(r){return new ya.Observable(function(e){var t,n;try{for(var i=LS(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}Le.fromIterable=Ik;function jS(r){return new ya.Observable(function(e){G4(r,e).catch(function(t){return e.error(t)})})}Le.fromAsyncIterable=jS;function Ak(r){return jS(wk.readableStreamLikeToAsyncGenerator(r))}Le.fromReadableStreamLike=Ak;function G4(r,e){var t,n,i,s;return x4(this,void 0,void 0,function(){var o,a;return k4(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),t=M4(r),u.label=1;case 1:return[4,t.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}});var gn=E(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.executeSchedule=void 0;function Q4(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}tp.executeSchedule=Q4});var va=E(rp=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.observeOn=void 0;var US=gn(),$4=K(),H4=J();function Y4(r,e){return e===void 0&&(e=0),$4.operate(function(t,n){t.subscribe(H4.createOperatorSubscriber(n,function(i){return US.executeSchedule(n,r,function(){return n.next(i)},e)},function(){return US.executeSchedule(n,r,function(){return n.complete()},e)},function(i){return US.executeSchedule(n,r,function(){return n.error(i)},e)}))})}rp.observeOn=Y4});var ba=E(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});np.subscribeOn=void 0;var J4=K();function X4(r,e){return e===void 0&&(e=0),J4.operate(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}np.subscribeOn=X4});var Pk=E(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.scheduleObservable=void 0;var Z4=ae(),eK=va(),tK=ba();function rK(r,e){return Z4.innerFrom(r).pipe(tK.subscribeOn(e),eK.observeOn(e))}ip.scheduleObservable=rK});var Ck=E(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});sp.schedulePromise=void 0;var nK=ae(),iK=va(),sK=ba();function oK(r,e){return nK.innerFrom(r).pipe(sK.subscribeOn(e),iK.observeOn(e))}sp.schedulePromise=oK});var Ok=E(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.scheduleArray=void 0;var aK=Ie();function uK(r,e){return new aK.Observable(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}op.scheduleArray=uK});var BS=E(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});ap.scheduleIterable=void 0;var lK=Ie(),cK=FS(),hK=Te(),Rk=gn();function dK(r,e){return new lK.Observable(function(t){var n;return Rk.executeSchedule(t,e,function(){n=r[cK.iterator](),Rk.executeSchedule(t,e,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return hK.isFunction(n?.return)&&n.return()}})}ap.scheduleIterable=dK});var WS=E(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.scheduleAsyncIterable=void 0;var fK=Ie(),Nk=gn();function pK(r,e){if(!r)throw new Error("Iterable cannot be null");return new fK.Observable(function(t){Nk.executeSchedule(t,e,function(){var n=r[Symbol.asyncIterator]();Nk.executeSchedule(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}up.scheduleAsyncIterable=pK});var Dk=E(lp=>{"use strict";Object.defineProperty(lp,"__esModule",{value:!0});lp.scheduleReadableStreamLike=void 0;var mK=WS(),gK=ep();function _K(r,e){return mK.scheduleAsyncIterable(gK.readableStreamLikeToAsyncGenerator(r),e)}lp.scheduleReadableStreamLike=_K});var zS=E(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.scheduled=void 0;var yK=Pk(),vK=Ck(),bK=Ok(),wK=BS(),EK=WS(),SK=kS(),TK=xS(),IK=$f(),AK=VS(),PK=MS(),CK=qS(),OK=ep(),RK=Dk();function NK(r,e){if(r!=null){if(SK.isInteropObservable(r))return yK.scheduleObservable(r,e);if(IK.isArrayLike(r))return bK.scheduleArray(r,e);if(TK.isPromise(r))return vK.schedulePromise(r,e);if(PK.isAsyncIterable(r))return EK.scheduleAsyncIterable(r,e);if(AK.isIterable(r))return wK.scheduleIterable(r,e);if(OK.isReadableStreamLike(r))return RK.scheduleReadableStreamLike(r,e)}throw CK.createInvalidObservableTypeError(r)}cp.scheduled=NK});var _n=E(hp=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.from=void 0;var DK=zS(),xK=ae();function kK(r,e){return e?DK.scheduled(r,e):xK.innerFrom(r)}hp.from=kK});var fp=E(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});dp.of=void 0;var MK=Bt(),qK=_n();function FK(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=MK.popScheduler(r);return qK.from(r,t)}dp.of=FK});var KS=E(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.throwError=void 0;var VK=Ie(),LK=Te();function jK(r,e){var t=LK.isFunction(r)?r:function(){return r},n=function(i){return i.error(t())};return new VK.Observable(e?function(i){return e.schedule(n,0,i)}:n)}pp.throwError=jK});var mp=E(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.observeNotification=yn.Notification=yn.NotificationKind=void 0;var UK=Er(),BK=fp(),WK=KS(),zK=Te(),KK;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(KK=yn.NotificationKind||(yn.NotificationKind={}));var GK=function(){function r(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue=e==="N"}return r.prototype.observe=function(e){return xk(this,e)},r.prototype.do=function(e,t,n){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e?.(o):s==="E"?t?.(a):n?.()},r.prototype.accept=function(e,t,n){var i;return zK.isFunction((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,n)},r.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,i=e.error,s=t==="N"?BK.of(n):t==="E"?WK.throwError(function(){return i}):t==="C"?UK.EMPTY:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},r.createNext=function(e){return new r("N",e)},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();yn.Notification=GK;function xk(r,e){var t,n,i,s=r,o=s.kind,a=s.value,u=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(n=e.error)===null||n===void 0||n.call(e,u):(i=e.complete)===null||i===void 0||i.call(e)}yn.observeNotification=xk});var Mk=E(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.isObservable=void 0;var QK=Ie(),kk=Te();function $K(r){return!!r&&(r instanceof QK.Observable||kk.isFunction(r.lift)&&kk.isFunction(r.subscribe))}gp.isObservable=$K});var ci=E(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.EmptyError=void 0;var HK=oi();_p.EmptyError=HK.createErrorClass(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}})});var qk=E(yp=>{"use strict";Object.defineProperty(yp,"__esModule",{value:!0});yp.lastValueFrom=void 0;var YK=ci();function JK(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=!1,o;r.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?n(o):t?n(e.defaultValue):i(new YK.EmptyError)}})})}yp.lastValueFrom=JK});var Fk=E(vp=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});vp.firstValueFrom=void 0;var XK=ci(),ZK=Jo();function e9(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=new ZK.SafeSubscriber({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){t?n(e.defaultValue):i(new XK.EmptyError)}});r.subscribe(s)})}vp.firstValueFrom=e9});var GS=E(bp=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0});bp.ArgumentOutOfRangeError=void 0;var t9=oi();bp.ArgumentOutOfRangeError=t9.createErrorClass(function(r){return function(){r(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}})});var QS=E(wp=>{"use strict";Object.defineProperty(wp,"__esModule",{value:!0});wp.NotFoundError=void 0;var r9=oi();wp.NotFoundError=r9.createErrorClass(function(r){return function(t){r(this),this.name="NotFoundError",this.message=t}})});var $S=E(Ep=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});Ep.SequenceError=void 0;var n9=oi();Ep.SequenceError=n9.createErrorClass(function(r){return function(t){r(this),this.name="SequenceError",this.message=t}})});var Tp=E(Sp=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.isValidDate=void 0;function i9(r){return r instanceof Date&&!isNaN(r)}Sp.isValidDate=i9});var Ll=E(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.timeout=Cs.TimeoutError=void 0;var s9=Ut(),o9=Tp(),a9=K(),u9=ae(),l9=oi(),c9=J(),h9=gn();Cs.TimeoutError=l9.createErrorClass(function(r){return function(t){t===void 0&&(t=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function d9(r,e){var t=o9.isValidDate(r)?{first:r}:typeof r=="number"?{each:r}:r,n=t.first,i=t.each,s=t.with,o=s===void 0?f9:s,a=t.scheduler,u=a===void 0?e??s9.asyncScheduler:a,c=t.meta,h=c===void 0?null:c;if(n==null&&i==null)throw new TypeError("No timeout provided.");return a9.operate(function(f,m){var _,v,w=null,A=0,M=function(V){v=h9.executeSchedule(m,u,function(){try{_.unsubscribe(),u9.innerFrom(o({meta:h,lastValue:w,seen:A})).subscribe(m)}catch(j){m.error(j)}},V)};_=f.subscribe(c9.createOperatorSubscriber(m,function(V){v?.unsubscribe(),A++,m.next(w=V),i>0&&M(i)},void 0,void 0,function(){v?.closed||v?.unsubscribe(),w=null})),!A&&M(n!=null?typeof n=="number"?n:+n-u.now():i)})}Cs.timeout=d9;function f9(r){throw new Cs.TimeoutError(r)}});var vn=E(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.map=void 0;var p9=K(),m9=J();function g9(r,e){return p9.operate(function(t,n){var i=0;t.subscribe(m9.createOperatorSubscriber(n,function(s){n.next(r.call(e,s,i++))}))})}Ip.map=g9});var di=E(hi=>{"use strict";var _9=hi&&hi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},y9=hi&&hi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(hi,"__esModule",{value:!0});hi.mapOneOrManyArgs=void 0;var v9=vn(),b9=Array.isArray;function w9(r,e){return b9(e)?r.apply(void 0,y9([],_9(e))):r(e)}function E9(r){return v9.map(function(e){return w9(r,e)})}hi.mapOneOrManyArgs=E9});var YS=E(fi=>{"use strict";var S9=fi&&fi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Vk=fi&&fi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(fi,"__esModule",{value:!0});fi.bindCallbackInternals=void 0;var T9=Vl(),I9=Ie(),A9=ba(),P9=di(),C9=va(),O9=Wf();function HS(r,e,t,n){if(t)if(T9.isScheduler(t))n=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return HS(r,e,n).apply(this,i).pipe(P9.mapOneOrManyArgs(t))};return n?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return HS(r,e).apply(this,i).pipe(A9.subscribeOn(n),C9.observeOn(n))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new O9.AsyncSubject,u=!0;return new I9.Observable(function(c){var h=a.subscribe(c);if(u){u=!1;var f=!1,m=!1;e.apply(i,Vk(Vk([],S9(s)),[function(){for(var _=[],v=0;v<arguments.length;v++)_[v]=arguments[v];if(r){var w=_.shift();if(w!=null){a.error(w);return}}a.next(1<_.length?_:_[0]),m=!0,f&&a.complete()}])),m&&a.complete(),f=!0}return h})}}fi.bindCallbackInternals=HS});var Lk=E(Ap=>{"use strict";Object.defineProperty(Ap,"__esModule",{value:!0});Ap.bindCallback=void 0;var R9=YS();function N9(r,e,t){return R9.bindCallbackInternals(!1,r,e,t)}Ap.bindCallback=N9});var jk=E(Pp=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});Pp.bindNodeCallback=void 0;var D9=YS();function x9(r,e,t){return D9.bindCallbackInternals(!0,r,e,t)}Pp.bindNodeCallback=x9});var JS=E(Cp=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.argsArgArrayOrObject=void 0;var k9=Array.isArray,M9=Object.getPrototypeOf,q9=Object.prototype,F9=Object.keys;function V9(r){if(r.length===1){var e=r[0];if(k9(e))return{args:e,keys:null};if(L9(e)){var t=F9(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:r,keys:null}}Cp.argsArgArrayOrObject=V9;function L9(r){return r&&typeof r=="object"&&M9(r)===q9}});var XS=E(Op=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.createObject=void 0;function j9(r,e){return r.reduce(function(t,n,i){return t[n]=e[i],t},{})}Op.createObject=j9});var Rp=E(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.combineLatestInit=wa.combineLatest=void 0;var U9=Ie(),B9=JS(),Wk=_n(),zk=yt(),W9=di(),Uk=Bt(),z9=XS(),K9=J(),G9=gn();function Q9(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Uk.popScheduler(r),n=Uk.popResultSelector(r),i=B9.argsArgArrayOrObject(r),s=i.args,o=i.keys;if(s.length===0)return Wk.from([],t);var a=new U9.Observable(Kk(s,t,o?function(u){return z9.createObject(o,u)}:zk.identity));return n?a.pipe(W9.mapOneOrManyArgs(n)):a}wa.combineLatest=Q9;function Kk(r,e,t){return t===void 0&&(t=zk.identity),function(n){Bk(e,function(){for(var i=r.length,s=new Array(i),o=i,a=i,u=function(h){Bk(e,function(){var f=Wk.from(r[h],e),m=!1;f.subscribe(K9.createOperatorSubscriber(n,function(_){s[h]=_,m||(m=!0,a--),a||n.next(t(s.slice()))},function(){--o||n.complete()}))},n)},c=0;c<i;c++)u(c)},n)}}wa.combineLatestInit=Kk;function Bk(r,e,t){r?G9.executeSchedule(t,r,e):e()}});var Dp=E(Np=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.mergeInternals=void 0;var $9=ae(),H9=gn(),Gk=J();function Y9(r,e,t,n,i,s,o,a){var u=[],c=0,h=0,f=!1,m=function(){f&&!u.length&&!c&&e.complete()},_=function(w){return c<n?v(w):u.push(w)},v=function(w){s&&e.next(w),c++;var A=!1;$9.innerFrom(t(w,h++)).subscribe(Gk.createOperatorSubscriber(e,function(M){i?.(M),s?_(M):e.next(M)},function(){A=!0},void 0,function(){if(A)try{c--;for(var M=function(){var V=u.shift();o?H9.executeSchedule(e,o,function(){return v(V)}):v(V)};u.length&&c<n;)M();m()}catch(V){e.error(V)}}))};return r.subscribe(Gk.createOperatorSubscriber(e,_,function(){f=!0,m()})),function(){a?.()}}Np.mergeInternals=Y9});var Hr=E(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});xp.mergeMap=void 0;var J9=vn(),X9=ae(),Z9=K(),eG=Dp(),tG=Te();function Qk(r,e,t){return t===void 0&&(t=1/0),tG.isFunction(e)?Qk(function(n,i){return J9.map(function(s,o){return e(n,s,i,o)})(X9.innerFrom(r(n,i)))},t):(typeof e=="number"&&(t=e),Z9.operate(function(n,i){return eG.mergeInternals(n,i,r,t)}))}xp.mergeMap=Qk});var Ea=E(kp=>{"use strict";Object.defineProperty(kp,"__esModule",{value:!0});kp.mergeAll=void 0;var rG=Hr(),nG=yt();function iG(r){return r===void 0&&(r=1/0),rG.mergeMap(nG.identity,r)}kp.mergeAll=iG});var jl=E(Mp=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.concatAll=void 0;var sG=Ea();function oG(){return sG.mergeAll(1)}Mp.concatAll=oG});var Ul=E(qp=>{"use strict";Object.defineProperty(qp,"__esModule",{value:!0});qp.concat=void 0;var aG=jl(),uG=Bt(),lG=_n();function cG(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return aG.concatAll()(lG.from(r,uG.popScheduler(r)))}qp.concat=cG});var Bl=E(Fp=>{"use strict";Object.defineProperty(Fp,"__esModule",{value:!0});Fp.defer=void 0;var hG=Ie(),dG=ae();function fG(r){return new hG.Observable(function(e){dG.innerFrom(r()).subscribe(e)})}Fp.defer=fG});var $k=E(Vp=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});Vp.connectable=void 0;var pG=vt(),mG=Ie(),gG=Bl(),_G={connector:function(){return new pG.Subject},resetOnDisconnect:!0};function yG(r,e){e===void 0&&(e=_G);var t=null,n=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=n(),a=new mG.Observable(function(u){return o.subscribe(u)});return a.connect=function(){return(!t||t.closed)&&(t=gG.defer(function(){return r}).subscribe(o),s&&t.add(function(){return o=n()})),t},a}Vp.connectable=yG});var Hk=E(Lp=>{"use strict";Object.defineProperty(Lp,"__esModule",{value:!0});Lp.forkJoin=void 0;var vG=Ie(),bG=JS(),wG=ae(),EG=Bt(),SG=J(),TG=di(),IG=XS();function AG(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=EG.popResultSelector(r),n=bG.argsArgArrayOrObject(r),i=n.args,s=n.keys,o=new vG.Observable(function(a){var u=i.length;if(!u){a.complete();return}for(var c=new Array(u),h=u,f=u,m=function(v){var w=!1;wG.innerFrom(i[v]).subscribe(SG.createOperatorSubscriber(a,function(A){w||(w=!0,f--),c[v]=A},function(){return h--},void 0,function(){(!h||!w)&&(f||a.next(s?IG.createObject(s,c):c),a.complete())}))},_=0;_<u;_++)m(_)});return t?o.pipe(TG.mapOneOrManyArgs(t)):o}Lp.forkJoin=AG});var Jk=E(Sa=>{"use strict";var PG=Sa&&Sa.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.fromEvent=void 0;var CG=ae(),OG=Ie(),RG=Hr(),NG=$f(),Os=Te(),DG=di(),xG=["addListener","removeListener"],kG=["addEventListener","removeEventListener"],MG=["on","off"];function ZS(r,e,t,n){if(Os.isFunction(t)&&(n=t,t=void 0),n)return ZS(r,e,t).pipe(DG.mapOneOrManyArgs(n));var i=PG(VG(r)?kG.map(function(a){return function(u){return r[a](e,u,t)}}):qG(r)?xG.map(Yk(r,e)):FG(r)?MG.map(Yk(r,e)):[],2),s=i[0],o=i[1];if(!s&&NG.isArrayLike(r))return RG.mergeMap(function(a){return ZS(a,e,t)})(CG.innerFrom(r));if(!s)throw new TypeError("Invalid event target");return new OG.Observable(function(a){var u=function(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];return a.next(1<c.length?c:c[0])};return s(u),function(){return o(u)}})}Sa.fromEvent=ZS;function Yk(r,e){return function(t){return function(n){return r[t](e,n)}}}function qG(r){return Os.isFunction(r.addListener)&&Os.isFunction(r.removeListener)}function FG(r){return Os.isFunction(r.on)&&Os.isFunction(r.off)}function VG(r){return Os.isFunction(r.addEventListener)&&Os.isFunction(r.removeEventListener)}});var Zk=E(jp=>{"use strict";Object.defineProperty(jp,"__esModule",{value:!0});jp.fromEventPattern=void 0;var LG=Ie(),jG=Te(),UG=di();function Xk(r,e,t){return t?Xk(r,e).pipe(UG.mapOneOrManyArgs(t)):new LG.Observable(function(n){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return n.next(o.length===1?o[0]:o)},s=r(i);return jG.isFunction(e)?function(){return e(i,s)}:void 0})}jp.fromEventPattern=Xk});var tM=E(Ta=>{"use strict";var BG=Ta&&Ta.__generator||function(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return u([c,h])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(h){c=[6,h],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(Ta,"__esModule",{value:!0});Ta.generate=void 0;var eM=yt(),WG=Vl(),zG=Bl(),KG=BS();function GG(r,e,t,n,i){var s,o,a,u;arguments.length===1?(s=r,u=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?eM.identity:o,i=s.scheduler):(u=r,!n||WG.isScheduler(n)?(a=eM.identity,i=n):a=n);function c(){var h;return BG(this,function(f){switch(f.label){case 0:h=u,f.label=1;case 1:return!e||e(h)?[4,a(h)]:[3,4];case 2:f.sent(),f.label=3;case 3:return h=t(h),[3,1];case 4:return[2]}})}return zG.defer(i?function(){return KG.scheduleIterable(c(),i)}:c)}Ta.generate=GG});var rM=E(Up=>{"use strict";Object.defineProperty(Up,"__esModule",{value:!0});Up.iif=void 0;var QG=Bl();function $G(r,e,t){return QG.defer(function(){return r()?e:t})}Up.iif=$G});var pi=E(Bp=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});Bp.timer=void 0;var HG=Ie(),YG=Ut(),JG=Vl(),XG=Tp();function ZG(r,e,t){r===void 0&&(r=0),t===void 0&&(t=YG.async);var n=-1;return e!=null&&(JG.isScheduler(e)?t=e:n=e),new HG.Observable(function(i){var s=XG.isValidDate(r)?+r-t.now():r;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}Bp.timer=ZG});var eT=E(Wp=>{"use strict";Object.defineProperty(Wp,"__esModule",{value:!0});Wp.interval=void 0;var eQ=Ut(),tQ=pi();function rQ(r,e){return r===void 0&&(r=0),e===void 0&&(e=eQ.asyncScheduler),r<0&&(r=0),tQ.timer(r,r,e)}Wp.interval=rQ});var iM=E(zp=>{"use strict";Object.defineProperty(zp,"__esModule",{value:!0});zp.merge=void 0;var nQ=Ea(),iQ=ae(),sQ=Er(),nM=Bt(),oQ=_n();function aQ(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=nM.popScheduler(r),n=nM.popNumber(r,1/0),i=r;return i.length?i.length===1?iQ.innerFrom(i[0]):nQ.mergeAll(n)(oQ.from(i,t)):sQ.EMPTY}zp.merge=aQ});var tT=E(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.never=Rs.NEVER=void 0;var uQ=Ie(),lQ=_t();Rs.NEVER=new uQ.Observable(lQ.noop);function cQ(){return Rs.NEVER}Rs.never=cQ});var mi=E(Kp=>{"use strict";Object.defineProperty(Kp,"__esModule",{value:!0});Kp.argsOrArgArray=void 0;var hQ=Array.isArray;function dQ(r){return r.length===1&&hQ(r[0])?r[0]:r}Kp.argsOrArgArray=dQ});var rT=E(Gp=>{"use strict";Object.defineProperty(Gp,"__esModule",{value:!0});Gp.onErrorResumeNext=void 0;var fQ=Ie(),pQ=mi(),mQ=J(),sM=_t(),gQ=ae();function _Q(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=pQ.argsOrArgArray(r);return new fQ.Observable(function(n){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=gQ.innerFrom(t[i++])}catch{s();return}var a=new mQ.OperatorSubscriber(n,void 0,sM.noop,sM.noop);o.subscribe(a),a.add(s)}else n.complete()};s()})}Gp.onErrorResumeNext=_Q});var oM=E(Qp=>{"use strict";Object.defineProperty(Qp,"__esModule",{value:!0});Qp.pairs=void 0;var yQ=_n();function vQ(r,e){return yQ.from(Object.entries(r),e)}Qp.pairs=vQ});var nT=E($p=>{"use strict";Object.defineProperty($p,"__esModule",{value:!0});$p.not=void 0;function bQ(r,e){return function(t,n){return!r.call(e,t,n)}}$p.not=bQ});var bn=E(Hp=>{"use strict";Object.defineProperty(Hp,"__esModule",{value:!0});Hp.filter=void 0;var wQ=K(),EQ=J();function SQ(r,e){return wQ.operate(function(t,n){var i=0;t.subscribe(EQ.createOperatorSubscriber(n,function(s){return r.call(e,s,i++)&&n.next(s)}))})}Hp.filter=SQ});var lM=E(Yp=>{"use strict";Object.defineProperty(Yp,"__esModule",{value:!0});Yp.partition=void 0;var TQ=nT(),aM=bn(),uM=ae();function IQ(r,e,t){return[aM.filter(e,t)(uM.innerFrom(r)),aM.filter(TQ.not(e,t))(uM.innerFrom(r))]}Yp.partition=IQ});var iT=E(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.raceInit=Ia.race=void 0;var AQ=Ie(),cM=ae(),PQ=mi(),CQ=J();function OQ(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r=PQ.argsOrArgArray(r),r.length===1?cM.innerFrom(r[0]):new AQ.Observable(hM(r))}Ia.race=OQ;function hM(r){return function(e){for(var t=[],n=function(s){t.push(cM.innerFrom(r[s]).subscribe(CQ.createOperatorSubscriber(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<r.length;i++)n(i)}}Ia.raceInit=hM});var dM=E(Jp=>{"use strict";Object.defineProperty(Jp,"__esModule",{value:!0});Jp.range=void 0;var RQ=Ie(),NQ=Er();function DQ(r,e,t){if(e==null&&(e=r,r=0),e<=0)return NQ.EMPTY;var n=e+r;return new RQ.Observable(t?function(i){var s=r;return t.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}Jp.range=DQ});var fM=E(Xp=>{"use strict";Object.defineProperty(Xp,"__esModule",{value:!0});Xp.using=void 0;var xQ=Ie(),kQ=ae(),MQ=Er();function qQ(r,e){return new xQ.Observable(function(t){var n=r(),i=e(n),s=i?kQ.innerFrom(i):MQ.EMPTY;return s.subscribe(t),function(){n&&n.unsubscribe()}})}Xp.using=qQ});var Zp=E(gi=>{"use strict";var FQ=gi&&gi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},VQ=gi&&gi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(gi,"__esModule",{value:!0});gi.zip=void 0;var LQ=Ie(),jQ=ae(),UQ=mi(),BQ=Er(),WQ=J(),zQ=Bt();function KQ(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=zQ.popResultSelector(r),n=UQ.argsOrArgArray(r);return n.length?new LQ.Observable(function(i){var s=n.map(function(){return[]}),o=n.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(c){jQ.innerFrom(n[c]).subscribe(WQ.createOperatorSubscriber(i,function(h){if(s[c].push(h),s.every(function(m){return m.length})){var f=s.map(function(m){return m.shift()});i.next(t?t.apply(void 0,VQ([],FQ(f))):f),s.some(function(m,_){return!m.length&&o[_]})&&i.complete()}},function(){o[c]=!0,!s[c].length&&i.complete()}))},u=0;!i.closed&&u<n.length;u++)a(u);return function(){s=o=null}}):BQ.EMPTY}gi.zip=KQ});var mM=E(pM=>{"use strict";Object.defineProperty(pM,"__esModule",{value:!0})});var tm=E(em=>{"use strict";Object.defineProperty(em,"__esModule",{value:!0});em.audit=void 0;var GQ=K(),QQ=ae(),gM=J();function $Q(r){return GQ.operate(function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(s?.unsubscribe(),s=null,n){n=!1;var c=i;i=null,t.next(c)}o&&t.complete()},u=function(){s=null,o&&t.complete()};e.subscribe(gM.createOperatorSubscriber(t,function(c){n=!0,i=c,s||QQ.innerFrom(r(c)).subscribe(s=gM.createOperatorSubscriber(t,a,u))},function(){o=!0,(!n||!s||s.closed)&&t.complete()}))})}em.audit=$Q});var sT=E(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.auditTime=void 0;var HQ=Ut(),YQ=tm(),JQ=pi();function XQ(r,e){return e===void 0&&(e=HQ.asyncScheduler),YQ.audit(function(){return JQ.timer(r,e)})}rm.auditTime=XQ});var oT=E(nm=>{"use strict";Object.defineProperty(nm,"__esModule",{value:!0});nm.buffer=void 0;var ZQ=K(),e$=_t(),_M=J(),t$=ae();function r$(r){return ZQ.operate(function(e,t){var n=[];return e.subscribe(_M.createOperatorSubscriber(t,function(i){return n.push(i)},function(){t.next(n),t.complete()})),t$.innerFrom(r).subscribe(_M.createOperatorSubscriber(t,function(){var i=n;n=[],t.next(i)},e$.noop)),function(){n=null}})}nm.buffer=r$});var uT=E(Aa=>{"use strict";var aT=Aa&&Aa.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Aa,"__esModule",{value:!0});Aa.bufferCount=void 0;var n$=K(),i$=J(),s$=mn();function o$(r,e){return e===void 0&&(e=null),e=e??r,n$.operate(function(t,n){var i=[],s=0;t.subscribe(i$.createOperatorSubscriber(n,function(o){var a,u,c,h,f=null;s++%e===0&&i.push([]);try{for(var m=aT(i),_=m.next();!_.done;_=m.next()){var v=_.value;v.push(o),r<=v.length&&(f=f??[],f.push(v))}}catch(M){a={error:M}}finally{try{_&&!_.done&&(u=m.return)&&u.call(m)}finally{if(a)throw a.error}}if(f)try{for(var w=aT(f),A=w.next();!A.done;A=w.next()){var v=A.value;s$.arrRemove(i,v),n.next(v)}}catch(M){c={error:M}}finally{try{A&&!A.done&&(h=w.return)&&h.call(w)}finally{if(c)throw c.error}}},function(){var o,a;try{for(var u=aT(i),c=u.next();!c.done;c=u.next()){var h=c.value;n.next(h)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}n.complete()},void 0,function(){i=null}))})}Aa.bufferCount=o$});var lT=E(Pa=>{"use strict";var a$=Pa&&Pa.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Pa,"__esModule",{value:!0});Pa.bufferTime=void 0;var u$=Xt(),l$=K(),c$=J(),h$=mn(),d$=Ut(),f$=Bt(),yM=gn();function p$(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=f$.popScheduler(n))!==null&&e!==void 0?e:d$.asyncScheduler,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return l$.operate(function(u,c){var h=[],f=!1,m=function(w){var A=w.buffer,M=w.subs;M.unsubscribe(),h$.arrRemove(h,w),c.next(A),f&&_()},_=function(){if(h){var w=new u$.Subscription;c.add(w);var A=[],M={buffer:A,subs:w};h.push(M),yM.executeSchedule(w,s,function(){return m(M)},r)}};o!==null&&o>=0?yM.executeSchedule(c,s,_,o,!0):f=!0,_();var v=c$.createOperatorSubscriber(c,function(w){var A,M,V=h.slice();try{for(var j=a$(V),G=j.next();!G.done;G=j.next()){var te=G.value,H=te.buffer;H.push(w),a<=H.length&&m(te)}}catch(P){A={error:P}}finally{try{G&&!G.done&&(M=j.return)&&M.call(j)}finally{if(A)throw A.error}}},function(){for(;h?.length;)c.next(h.shift().buffer);v?.unsubscribe(),c.complete(),c.unsubscribe()},void 0,function(){return h=null});u.subscribe(v)})}Pa.bufferTime=p$});var hT=E(Ca=>{"use strict";var m$=Ca&&Ca.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ca,"__esModule",{value:!0});Ca.bufferToggle=void 0;var g$=Xt(),_$=K(),vM=ae(),cT=J(),bM=_t(),y$=mn();function v$(r,e){return _$.operate(function(t,n){var i=[];vM.innerFrom(r).subscribe(cT.createOperatorSubscriber(n,function(s){var o=[];i.push(o);var a=new g$.Subscription,u=function(){y$.arrRemove(i,o),n.next(o),a.unsubscribe()};a.add(vM.innerFrom(e(s)).subscribe(cT.createOperatorSubscriber(n,u,bM.noop)))},bM.noop)),t.subscribe(cT.createOperatorSubscriber(n,function(s){var o,a;try{for(var u=m$(i),c=u.next();!c.done;c=u.next()){var h=c.value;h.push(s)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)n.next(i.shift());n.complete()}))})}Ca.bufferToggle=v$});var dT=E(im=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0});im.bufferWhen=void 0;var b$=K(),w$=_t(),wM=J(),E$=ae();function S$(r){return b$.operate(function(e,t){var n=null,i=null,s=function(){i?.unsubscribe();var o=n;n=[],o&&t.next(o),E$.innerFrom(r()).subscribe(i=wM.createOperatorSubscriber(t,s,w$.noop))};s(),e.subscribe(wM.createOperatorSubscriber(t,function(o){return n?.push(o)},function(){n&&t.next(n),t.complete()},void 0,function(){return n=i=null}))})}im.bufferWhen=S$});var fT=E(sm=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.catchError=void 0;var T$=ae(),I$=J(),A$=K();function EM(r){return A$.operate(function(e,t){var n=null,i=!1,s;n=e.subscribe(I$.createOperatorSubscriber(t,void 0,void 0,function(o){s=T$.innerFrom(r(o,EM(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}sm.catchError=EM});var pT=E(om=>{"use strict";Object.defineProperty(om,"__esModule",{value:!0});om.scanInternals=void 0;var P$=J();function C$(r,e,t,n,i){return function(s,o){var a=t,u=e,c=0;s.subscribe(P$.createOperatorSubscriber(o,function(h){var f=c++;u=a?r(u,h,f):(a=!0,h),n&&o.next(u)},i&&function(){a&&o.next(u),o.complete()}))}}om.scanInternals=C$});var Ns=E(am=>{"use strict";Object.defineProperty(am,"__esModule",{value:!0});am.reduce=void 0;var O$=pT(),R$=K();function N$(r,e){return R$.operate(O$.scanInternals(r,e,arguments.length>=2,!1,!0))}am.reduce=N$});var lm=E(um=>{"use strict";Object.defineProperty(um,"__esModule",{value:!0});um.toArray=void 0;var D$=Ns(),x$=K(),k$=function(r,e){return r.push(e),r};function M$(){return x$.operate(function(r,e){D$.reduce(k$,[])(r).subscribe(e)})}um.toArray=M$});var mT=E(cm=>{"use strict";Object.defineProperty(cm,"__esModule",{value:!0});cm.joinAllInternals=void 0;var q$=yt(),F$=di(),V$=kl(),L$=Hr(),j$=lm();function U$(r,e){return V$.pipe(j$.toArray(),L$.mergeMap(function(t){return r(t)}),e?F$.mapOneOrManyArgs(e):q$.identity)}cm.joinAllInternals=U$});var dm=E(hm=>{"use strict";Object.defineProperty(hm,"__esModule",{value:!0});hm.combineLatestAll=void 0;var B$=Rp(),W$=mT();function z$(r){return W$.joinAllInternals(B$.combineLatest,r)}hm.combineLatestAll=z$});var gT=E(fm=>{"use strict";Object.defineProperty(fm,"__esModule",{value:!0});fm.combineAll=void 0;var K$=dm();fm.combineAll=K$.combineLatestAll});var _T=E(_i=>{"use strict";var SM=_i&&_i.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},TM=_i&&_i.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(_i,"__esModule",{value:!0});_i.combineLatest=void 0;var G$=Rp(),Q$=K(),$$=mi(),H$=di(),Y$=kl(),J$=Bt();function IM(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=J$.popResultSelector(r);return t?Y$.pipe(IM.apply(void 0,TM([],SM(r))),H$.mapOneOrManyArgs(t)):Q$.operate(function(n,i){G$.combineLatestInit(TM([n],SM($$.argsOrArgArray(r))))(i)})}_i.combineLatest=IM});var yT=E(yi=>{"use strict";var X$=yi&&yi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},Z$=yi&&yi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(yi,"__esModule",{value:!0});yi.combineLatestWith=void 0;var e5=_T();function t5(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return e5.combineLatest.apply(void 0,Z$([],X$(r)))}yi.combineLatestWith=t5});var mm=E(pm=>{"use strict";Object.defineProperty(pm,"__esModule",{value:!0});pm.concatMap=void 0;var AM=Hr(),r5=Te();function n5(r,e){return r5.isFunction(e)?AM.mergeMap(r,e,1):AM.mergeMap(r,1)}pm.concatMap=n5});var vT=E(gm=>{"use strict";Object.defineProperty(gm,"__esModule",{value:!0});gm.concatMapTo=void 0;var PM=mm(),i5=Te();function s5(r,e){return i5.isFunction(e)?PM.concatMap(function(){return r},e):PM.concatMap(function(){return r})}gm.concatMapTo=s5});var bT=E(vi=>{"use strict";var o5=vi&&vi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},a5=vi&&vi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(vi,"__esModule",{value:!0});vi.concat=void 0;var u5=K(),l5=jl(),c5=Bt(),h5=_n();function d5(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=c5.popScheduler(r);return u5.operate(function(n,i){l5.concatAll()(h5.from(a5([n],o5(r)),t)).subscribe(i)})}vi.concat=d5});var wT=E(bi=>{"use strict";var f5=bi&&bi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},p5=bi&&bi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(bi,"__esModule",{value:!0});bi.concatWith=void 0;var m5=bT();function g5(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return m5.concat.apply(void 0,p5([],f5(r)))}bi.concatWith=g5});var CM=E(_m=>{"use strict";Object.defineProperty(_m,"__esModule",{value:!0});_m.fromSubscribable=void 0;var _5=Ie();function y5(r){return new _5.Observable(function(e){return r.subscribe(e)})}_m.fromSubscribable=y5});var Wl=E(ym=>{"use strict";Object.defineProperty(ym,"__esModule",{value:!0});ym.connect=void 0;var v5=vt(),b5=ae(),w5=K(),E5=CM(),S5={connector:function(){return new v5.Subject}};function T5(r,e){e===void 0&&(e=S5);var t=e.connector;return w5.operate(function(n,i){var s=t();b5.innerFrom(r(E5.fromSubscribable(s))).subscribe(i),i.add(n.subscribe(s))})}ym.connect=T5});var ET=E(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.count=void 0;var I5=Ns();function A5(r){return I5.reduce(function(e,t,n){return!r||r(t,n)?e+1:e},0)}vm.count=A5});var ST=E(bm=>{"use strict";Object.defineProperty(bm,"__esModule",{value:!0});bm.debounce=void 0;var P5=K(),C5=_t(),OM=J(),O5=ae();function R5(r){return P5.operate(function(e,t){var n=!1,i=null,s=null,o=function(){if(s?.unsubscribe(),s=null,n){n=!1;var a=i;i=null,t.next(a)}};e.subscribe(OM.createOperatorSubscriber(t,function(a){s?.unsubscribe(),n=!0,i=a,s=OM.createOperatorSubscriber(t,o,C5.noop),O5.innerFrom(r(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}bm.debounce=R5});var TT=E(wm=>{"use strict";Object.defineProperty(wm,"__esModule",{value:!0});wm.debounceTime=void 0;var N5=Ut(),D5=K(),x5=J();function k5(r,e){return e===void 0&&(e=N5.asyncScheduler),D5.operate(function(t,n){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var c=s;s=null,n.next(c)}};function u(){var c=o+r,h=e.now();if(h<c){i=this.schedule(void 0,c-h),n.add(i);return}a()}t.subscribe(x5.createOperatorSubscriber(n,function(c){s=c,o=e.now(),i||(i=e.schedule(u,r),n.add(i))},function(){a(),n.complete()},void 0,function(){s=i=null}))})}wm.debounceTime=k5});var Oa=E(Em=>{"use strict";Object.defineProperty(Em,"__esModule",{value:!0});Em.defaultIfEmpty=void 0;var M5=K(),q5=J();function F5(r){return M5.operate(function(e,t){var n=!1;e.subscribe(q5.createOperatorSubscriber(t,function(i){n=!0,t.next(i)},function(){n||t.next(r),t.complete()}))})}Em.defaultIfEmpty=F5});var Ra=E(Sm=>{"use strict";Object.defineProperty(Sm,"__esModule",{value:!0});Sm.take=void 0;var V5=Er(),L5=K(),j5=J();function U5(r){return r<=0?function(){return V5.EMPTY}:L5.operate(function(e,t){var n=0;e.subscribe(j5.createOperatorSubscriber(t,function(i){++n<=r&&(t.next(i),r<=n&&t.complete())}))})}Sm.take=U5});var Im=E(Tm=>{"use strict";Object.defineProperty(Tm,"__esModule",{value:!0});Tm.ignoreElements=void 0;var B5=K(),W5=J(),z5=_t();function K5(){return B5.operate(function(r,e){r.subscribe(W5.createOperatorSubscriber(e,z5.noop))})}Tm.ignoreElements=K5});var Pm=E(Am=>{"use strict";Object.defineProperty(Am,"__esModule",{value:!0});Am.mapTo=void 0;var G5=vn();function Q5(r){return G5.map(function(){return r})}Am.mapTo=Q5});var Om=E(Cm=>{"use strict";Object.defineProperty(Cm,"__esModule",{value:!0});Cm.delayWhen=void 0;var $5=Ul(),RM=Ra(),H5=Im(),Y5=Pm(),J5=Hr(),X5=ae();function NM(r,e){return e?function(t){return $5.concat(e.pipe(RM.take(1),H5.ignoreElements()),t.pipe(NM(r)))}:J5.mergeMap(function(t,n){return X5.innerFrom(r(t,n)).pipe(RM.take(1),Y5.mapTo(t))})}Cm.delayWhen=NM});var IT=E(Rm=>{"use strict";Object.defineProperty(Rm,"__esModule",{value:!0});Rm.delay=void 0;var Z5=Ut(),e6=Om(),t6=pi();function r6(r,e){e===void 0&&(e=Z5.asyncScheduler);var t=t6.timer(r,e);return e6.delayWhen(function(){return t})}Rm.delay=r6});var AT=E(Nm=>{"use strict";Object.defineProperty(Nm,"__esModule",{value:!0});Nm.dematerialize=void 0;var n6=mp(),i6=K(),s6=J();function o6(){return i6.operate(function(r,e){r.subscribe(s6.createOperatorSubscriber(e,function(t){return n6.observeNotification(t,e)}))})}Nm.dematerialize=o6});var PT=E(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0});Dm.distinct=void 0;var a6=K(),DM=J(),u6=_t(),l6=ae();function c6(r,e){return a6.operate(function(t,n){var i=new Set;t.subscribe(DM.createOperatorSubscriber(n,function(s){var o=r?r(s):s;i.has(o)||(i.add(o),n.next(s))})),e&&l6.innerFrom(e).subscribe(DM.createOperatorSubscriber(n,function(){return i.clear()},u6.noop))})}Dm.distinct=c6});var km=E(xm=>{"use strict";Object.defineProperty(xm,"__esModule",{value:!0});xm.distinctUntilChanged=void 0;var h6=yt(),d6=K(),f6=J();function p6(r,e){return e===void 0&&(e=h6.identity),r=r??m6,d6.operate(function(t,n){var i,s=!0;t.subscribe(f6.createOperatorSubscriber(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}xm.distinctUntilChanged=p6;function m6(r,e){return r===e}});var CT=E(Mm=>{"use strict";Object.defineProperty(Mm,"__esModule",{value:!0});Mm.distinctUntilKeyChanged=void 0;var g6=km();function _6(r,e){return g6.distinctUntilChanged(function(t,n){return e?e(t[r],n[r]):t[r]===n[r]})}Mm.distinctUntilKeyChanged=_6});var Na=E(qm=>{"use strict";Object.defineProperty(qm,"__esModule",{value:!0});qm.throwIfEmpty=void 0;var y6=ci(),v6=K(),b6=J();function w6(r){return r===void 0&&(r=E6),v6.operate(function(e,t){var n=!1;e.subscribe(b6.createOperatorSubscriber(t,function(i){n=!0,t.next(i)},function(){return n?t.complete():t.error(r())}))})}qm.throwIfEmpty=w6;function E6(){return new y6.EmptyError}});var OT=E(Fm=>{"use strict";Object.defineProperty(Fm,"__esModule",{value:!0});Fm.elementAt=void 0;var xM=GS(),S6=bn(),T6=Na(),I6=Oa(),A6=Ra();function P6(r,e){if(r<0)throw new xM.ArgumentOutOfRangeError;var t=arguments.length>=2;return function(n){return n.pipe(S6.filter(function(i,s){return s===r}),A6.take(1),t?I6.defaultIfEmpty(e):T6.throwIfEmpty(function(){return new xM.ArgumentOutOfRangeError}))}}Fm.elementAt=P6});var RT=E(wi=>{"use strict";var C6=wi&&wi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},O6=wi&&wi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(wi,"__esModule",{value:!0});wi.endWith=void 0;var R6=Ul(),N6=fp();function D6(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(t){return R6.concat(t,N6.of.apply(void 0,O6([],C6(r))))}}wi.endWith=D6});var NT=E(Vm=>{"use strict";Object.defineProperty(Vm,"__esModule",{value:!0});Vm.every=void 0;var x6=K(),k6=J();function M6(r,e){return x6.operate(function(t,n){var i=0;t.subscribe(k6.createOperatorSubscriber(n,function(s){r.call(e,s,i++,t)||(n.next(!1),n.complete())},function(){n.next(!0),n.complete()}))})}Vm.every=M6});var jm=E(Lm=>{"use strict";Object.defineProperty(Lm,"__esModule",{value:!0});Lm.exhaustMap=void 0;var q6=vn(),kM=ae(),F6=K(),MM=J();function qM(r,e){return e?function(t){return t.pipe(qM(function(n,i){return kM.innerFrom(r(n,i)).pipe(q6.map(function(s,o){return e(n,s,i,o)}))}))}:F6.operate(function(t,n){var i=0,s=null,o=!1;t.subscribe(MM.createOperatorSubscriber(n,function(a){s||(s=MM.createOperatorSubscriber(n,void 0,function(){s=null,o&&n.complete()}),kM.innerFrom(r(a,i++)).subscribe(s))},function(){o=!0,!s&&n.complete()}))})}Lm.exhaustMap=qM});var Bm=E(Um=>{"use strict";Object.defineProperty(Um,"__esModule",{value:!0});Um.exhaustAll=void 0;var V6=jm(),L6=yt();function j6(){return V6.exhaustMap(L6.identity)}Um.exhaustAll=j6});var DT=E(Wm=>{"use strict";Object.defineProperty(Wm,"__esModule",{value:!0});Wm.exhaust=void 0;var U6=Bm();Wm.exhaust=U6.exhaustAll});var xT=E(zm=>{"use strict";Object.defineProperty(zm,"__esModule",{value:!0});zm.expand=void 0;var B6=K(),W6=Dp();function z6(r,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,B6.operate(function(n,i){return W6.mergeInternals(n,i,r,e,void 0,!0,t)})}zm.expand=z6});var kT=E(Km=>{"use strict";Object.defineProperty(Km,"__esModule",{value:!0});Km.finalize=void 0;var K6=K();function G6(r){return K6.operate(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}Km.finalize=G6});var Gm=E(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.createFind=Da.find=void 0;var Q6=K(),$6=J();function H6(r,e){return Q6.operate(FM(r,e,"value"))}Da.find=H6;function FM(r,e,t){var n=t==="index";return function(i,s){var o=0;i.subscribe($6.createOperatorSubscriber(s,function(a){var u=o++;r.call(e,a,u,i)&&(s.next(n?u:a),s.complete())},function(){s.next(n?-1:void 0),s.complete()}))}}Da.createFind=FM});var MT=E(Qm=>{"use strict";Object.defineProperty(Qm,"__esModule",{value:!0});Qm.findIndex=void 0;var Y6=K(),J6=Gm();function X6(r,e){return Y6.operate(J6.createFind(r,e,"index"))}Qm.findIndex=X6});var qT=E($m=>{"use strict";Object.defineProperty($m,"__esModule",{value:!0});$m.first=void 0;var Z6=ci(),e3=bn(),t3=Ra(),r3=Oa(),n3=Na(),i3=yt();function s3(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?e3.filter(function(i,s){return r(i,s,n)}):i3.identity,t3.take(1),t?r3.defaultIfEmpty(e):n3.throwIfEmpty(function(){return new Z6.EmptyError}))}}$m.first=s3});var FT=E(Hm=>{"use strict";Object.defineProperty(Hm,"__esModule",{value:!0});Hm.groupBy=void 0;var o3=Ie(),a3=ae(),u3=vt(),l3=K(),VM=J();function c3(r,e,t,n){return l3.operate(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,n=e.connector);var a=new Map,u=function(v){a.forEach(v),v(s)},c=function(v){return u(function(w){return w.error(v)})},h=0,f=!1,m=new VM.OperatorSubscriber(s,function(v){try{var w=r(v),A=a.get(w);if(!A){a.set(w,A=n?n():new u3.Subject);var M=_(w,A);if(s.next(M),t){var V=VM.createOperatorSubscriber(A,function(){A.complete(),V?.unsubscribe()},void 0,void 0,function(){return a.delete(w)});m.add(a3.innerFrom(t(M)).subscribe(V))}}A.next(o?o(v):v)}catch(j){c(j)}},function(){return u(function(v){return v.complete()})},c,function(){return a.clear()},function(){return f=!0,h===0});i.subscribe(m);function _(v,w){var A=new o3.Observable(function(M){h++;var V=w.subscribe(M);return function(){V.unsubscribe(),--h===0&&f&&m.unsubscribe()}});return A.key=v,A}})}Hm.groupBy=c3});var VT=E(Ym=>{"use strict";Object.defineProperty(Ym,"__esModule",{value:!0});Ym.isEmpty=void 0;var h3=K(),d3=J();function f3(){return h3.operate(function(r,e){r.subscribe(d3.createOperatorSubscriber(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}Ym.isEmpty=f3});var Jm=E(xa=>{"use strict";var p3=xa&&xa.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(xa,"__esModule",{value:!0});xa.takeLast=void 0;var m3=Er(),g3=K(),_3=J();function y3(r){return r<=0?function(){return m3.EMPTY}:g3.operate(function(e,t){var n=[];e.subscribe(_3.createOperatorSubscriber(t,function(i){n.push(i),r<n.length&&n.shift()},function(){var i,s;try{for(var o=p3(n),a=o.next();!a.done;a=o.next()){var u=a.value;t.next(u)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){n=null}))})}xa.takeLast=y3});var LT=E(Xm=>{"use strict";Object.defineProperty(Xm,"__esModule",{value:!0});Xm.last=void 0;var v3=ci(),b3=bn(),w3=Jm(),E3=Na(),S3=Oa(),T3=yt();function I3(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?b3.filter(function(i,s){return r(i,s,n)}):T3.identity,w3.takeLast(1),t?S3.defaultIfEmpty(e):E3.throwIfEmpty(function(){return new v3.EmptyError}))}}Xm.last=I3});var UT=E(Zm=>{"use strict";Object.defineProperty(Zm,"__esModule",{value:!0});Zm.materialize=void 0;var jT=mp(),A3=K(),P3=J();function C3(){return A3.operate(function(r,e){r.subscribe(P3.createOperatorSubscriber(e,function(t){e.next(jT.Notification.createNext(t))},function(){e.next(jT.Notification.createComplete()),e.complete()},function(t){e.next(jT.Notification.createError(t)),e.complete()}))})}Zm.materialize=C3});var BT=E(eg=>{"use strict";Object.defineProperty(eg,"__esModule",{value:!0});eg.max=void 0;var O3=Ns(),R3=Te();function N3(r){return O3.reduce(R3.isFunction(r)?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t})}eg.max=N3});var WT=E(tg=>{"use strict";Object.defineProperty(tg,"__esModule",{value:!0});tg.flatMap=void 0;var D3=Hr();tg.flatMap=D3.mergeMap});var zT=E(rg=>{"use strict";Object.defineProperty(rg,"__esModule",{value:!0});rg.mergeMapTo=void 0;var LM=Hr(),x3=Te();function k3(r,e,t){return t===void 0&&(t=1/0),x3.isFunction(e)?LM.mergeMap(function(){return r},e,t):(typeof e=="number"&&(t=e),LM.mergeMap(function(){return r},t))}rg.mergeMapTo=k3});var KT=E(ng=>{"use strict";Object.defineProperty(ng,"__esModule",{value:!0});ng.mergeScan=void 0;var M3=K(),q3=Dp();function F3(r,e,t){return t===void 0&&(t=1/0),M3.operate(function(n,i){var s=e;return q3.mergeInternals(n,i,function(o,a){return r(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}ng.mergeScan=F3});var GT=E(Ei=>{"use strict";var V3=Ei&&Ei.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},L3=Ei&&Ei.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.merge=void 0;var j3=K(),U3=mi(),B3=Ea(),jM=Bt(),W3=_n();function z3(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=jM.popScheduler(r),n=jM.popNumber(r,1/0);return r=U3.argsOrArgArray(r),j3.operate(function(i,s){B3.mergeAll(n)(W3.from(L3([i],V3(r)),t)).subscribe(s)})}Ei.merge=z3});var QT=E(Si=>{"use strict";var K3=Si&&Si.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},G3=Si&&Si.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Si,"__esModule",{value:!0});Si.mergeWith=void 0;var Q3=GT();function $3(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Q3.merge.apply(void 0,G3([],K3(r)))}Si.mergeWith=$3});var $T=E(ig=>{"use strict";Object.defineProperty(ig,"__esModule",{value:!0});ig.min=void 0;var H3=Ns(),Y3=Te();function J3(r){return H3.reduce(Y3.isFunction(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}ig.min=J3});var zl=E(sg=>{"use strict";Object.defineProperty(sg,"__esModule",{value:!0});sg.multicast=void 0;var X3=Ml(),UM=Te(),Z3=Wl();function eH(r,e){var t=UM.isFunction(r)?r:function(){return r};return UM.isFunction(e)?Z3.connect(e,{connector:t}):function(n){return new X3.ConnectableObservable(n,t)}}sg.multicast=eH});var HT=E(Yr=>{"use strict";var tH=Yr&&Yr.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},rH=Yr&&Yr.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.onErrorResumeNext=Yr.onErrorResumeNextWith=void 0;var nH=mi(),iH=rT();function BM(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=nH.argsOrArgArray(r);return function(n){return iH.onErrorResumeNext.apply(void 0,rH([n],tH(t)))}}Yr.onErrorResumeNextWith=BM;Yr.onErrorResumeNext=BM});var YT=E(og=>{"use strict";Object.defineProperty(og,"__esModule",{value:!0});og.pairwise=void 0;var sH=K(),oH=J();function aH(){return sH.operate(function(r,e){var t,n=!1;r.subscribe(oH.createOperatorSubscriber(e,function(i){var s=t;t=i,n&&e.next([s,i]),n=!0}))})}og.pairwise=aH});var JT=E(ag=>{"use strict";Object.defineProperty(ag,"__esModule",{value:!0});ag.pluck=void 0;var uH=vn();function lH(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.length;if(t===0)throw new Error("list of properties cannot be empty.");return uH.map(function(n){for(var i=n,s=0;s<t;s++){var o=i?.[r[s]];if(typeof o<"u")i=o;else return}return i})}ag.pluck=lH});var XT=E(ug=>{"use strict";Object.defineProperty(ug,"__esModule",{value:!0});ug.publish=void 0;var cH=vt(),hH=zl(),dH=Wl();function fH(r){return r?function(e){return dH.connect(r)(e)}:function(e){return hH.multicast(new cH.Subject)(e)}}ug.publish=fH});var ZT=E(lg=>{"use strict";Object.defineProperty(lg,"__esModule",{value:!0});lg.publishBehavior=void 0;var pH=OS(),mH=Ml();function gH(r){return function(e){var t=new pH.BehaviorSubject(r);return new mH.ConnectableObservable(e,function(){return t})}}lg.publishBehavior=gH});var e0=E(cg=>{"use strict";Object.defineProperty(cg,"__esModule",{value:!0});cg.publishLast=void 0;var _H=Wf(),yH=Ml();function vH(){return function(r){var e=new _H.AsyncSubject;return new yH.ConnectableObservable(r,function(){return e})}}cg.publishLast=vH});var t0=E(hg=>{"use strict";Object.defineProperty(hg,"__esModule",{value:!0});hg.publishReplay=void 0;var bH=Bf(),wH=zl(),WM=Te();function EH(r,e,t,n){t&&!WM.isFunction(t)&&(n=t);var i=WM.isFunction(t)?t:void 0;return function(s){return wH.multicast(new bH.ReplaySubject(r,e,n),i)(s)}}hg.publishReplay=EH});var dg=E(Ti=>{"use strict";var SH=Ti&&Ti.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},TH=Ti&&Ti.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.raceWith=void 0;var IH=iT(),AH=K(),PH=yt();function CH(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?AH.operate(function(t,n){IH.raceInit(TH([t],SH(r)))(n)}):PH.identity}Ti.raceWith=CH});var r0=E(fg=>{"use strict";Object.defineProperty(fg,"__esModule",{value:!0});fg.repeat=void 0;var OH=Er(),RH=K(),zM=J(),NH=ae(),DH=pi();function xH(r){var e,t=1/0,n;return r!=null&&(typeof r=="object"?(e=r.count,t=e===void 0?1/0:e,n=r.delay):t=r),t<=0?function(){return OH.EMPTY}:RH.operate(function(i,s){var o=0,a,u=function(){if(a?.unsubscribe(),a=null,n!=null){var h=typeof n=="number"?DH.timer(n):NH.innerFrom(n(o)),f=zM.createOperatorSubscriber(s,function(){f.unsubscribe(),c()});h.subscribe(f)}else c()},c=function(){var h=!1;a=i.subscribe(zM.createOperatorSubscriber(s,void 0,function(){++o<t?a?u():h=!0:s.complete()})),h&&u()};c()})}fg.repeat=xH});var n0=E(pg=>{"use strict";Object.defineProperty(pg,"__esModule",{value:!0});pg.repeatWhen=void 0;var kH=ae(),MH=vt(),qH=K(),KM=J();function FH(r){return qH.operate(function(e,t){var n,i=!1,s,o=!1,a=!1,u=function(){return a&&o&&(t.complete(),!0)},c=function(){return s||(s=new MH.Subject,kH.innerFrom(r(s)).subscribe(KM.createOperatorSubscriber(t,function(){n?h():i=!0},function(){o=!0,u()}))),s},h=function(){a=!1,n=e.subscribe(KM.createOperatorSubscriber(t,void 0,function(){a=!0,!u()&&c().next()})),i&&(n.unsubscribe(),n=null,i=!1,h())};h()})}pg.repeatWhen=FH});var i0=E(mg=>{"use strict";Object.defineProperty(mg,"__esModule",{value:!0});mg.retry=void 0;var VH=K(),GM=J(),LH=yt(),jH=pi(),UH=ae();function BH(r){r===void 0&&(r=1/0);var e;r&&typeof r=="object"?e=r:e={count:r};var t=e.count,n=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return n<=0?LH.identity:VH.operate(function(a,u){var c=0,h,f=function(){var m=!1;h=a.subscribe(GM.createOperatorSubscriber(u,function(_){o&&(c=0),u.next(_)},void 0,function(_){if(c++<n){var v=function(){h?(h.unsubscribe(),h=null,f()):m=!0};if(i!=null){var w=typeof i=="number"?jH.timer(i):UH.innerFrom(i(_,c)),A=GM.createOperatorSubscriber(u,function(){A.unsubscribe(),v()},function(){u.complete()});w.subscribe(A)}else v()}else u.error(_)})),m&&(h.unsubscribe(),h=null,f())};f()})}mg.retry=BH});var s0=E(gg=>{"use strict";Object.defineProperty(gg,"__esModule",{value:!0});gg.retryWhen=void 0;var WH=ae(),zH=vt(),KH=K(),QM=J();function GH(r){return KH.operate(function(e,t){var n,i=!1,s,o=function(){n=e.subscribe(QM.createOperatorSubscriber(t,void 0,void 0,function(a){s||(s=new zH.Subject,WH.innerFrom(r(s)).subscribe(QM.createOperatorSubscriber(t,function(){return n?o():i=!0}))),s&&s.next(a)})),i&&(n.unsubscribe(),n=null,i=!1,o())};o()})}gg.retryWhen=GH});var yg=E(_g=>{"use strict";Object.defineProperty(_g,"__esModule",{value:!0});_g.sample=void 0;var QH=ae(),$H=K(),HH=_t(),$M=J();function YH(r){return $H.operate(function(e,t){var n=!1,i=null;e.subscribe($M.createOperatorSubscriber(t,function(s){n=!0,i=s})),QH.innerFrom(r).subscribe($M.createOperatorSubscriber(t,function(){if(n){n=!1;var s=i;i=null,t.next(s)}},HH.noop))})}_g.sample=YH});var o0=E(vg=>{"use strict";Object.defineProperty(vg,"__esModule",{value:!0});vg.sampleTime=void 0;var JH=Ut(),XH=yg(),ZH=eT();function eY(r,e){return e===void 0&&(e=JH.asyncScheduler),XH.sample(ZH.interval(r,e))}vg.sampleTime=eY});var a0=E(bg=>{"use strict";Object.defineProperty(bg,"__esModule",{value:!0});bg.scan=void 0;var tY=K(),rY=pT();function nY(r,e){return tY.operate(rY.scanInternals(r,e,arguments.length>=2,!0))}bg.scan=nY});var u0=E(wg=>{"use strict";Object.defineProperty(wg,"__esModule",{value:!0});wg.sequenceEqual=void 0;var iY=K(),sY=J(),oY=ae();function aY(r,e){return e===void 0&&(e=function(t,n){return t===n}),iY.operate(function(t,n){var i=HM(),s=HM(),o=function(u){n.next(u),n.complete()},a=function(u,c){var h=sY.createOperatorSubscriber(n,function(f){var m=c.buffer,_=c.complete;m.length===0?_?o(!1):u.buffer.push(f):!e(f,m.shift())&&o(!1)},function(){u.complete=!0;var f=c.complete,m=c.buffer;f&&o(m.length===0),h?.unsubscribe()});return h};t.subscribe(a(i,s)),oY.innerFrom(r).subscribe(a(s,i))})}wg.sequenceEqual=aY;function HM(){return{buffer:[],complete:!1}}});var Eg=E(Ii=>{"use strict";var uY=Ii&&Ii.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},lY=Ii&&Ii.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.share=void 0;var YM=ae(),cY=vt(),JM=Jo(),hY=K();function dY(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new cY.Subject}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,u=a===void 0?!0:a;return function(c){var h,f,m,_=0,v=!1,w=!1,A=function(){f?.unsubscribe(),f=void 0},M=function(){A(),h=m=void 0,v=w=!1},V=function(){var j=h;M(),j?.unsubscribe()};return hY.operate(function(j,G){_++,!w&&!v&&A();var te=m=m??t();G.add(function(){_--,_===0&&!w&&!v&&(f=l0(V,u))}),te.subscribe(G),!h&&_>0&&(h=new JM.SafeSubscriber({next:function(H){return te.next(H)},error:function(H){w=!0,A(),f=l0(M,i,H),te.error(H)},complete:function(){v=!0,A(),f=l0(M,o),te.complete()}}),YM.innerFrom(j).subscribe(h))})(c)}}Ii.share=dY;function l0(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new JM.SafeSubscriber({next:function(){i.unsubscribe(),r()}});return YM.innerFrom(e.apply(void 0,lY([],uY(t)))).subscribe(i)}}});var c0=E(Sg=>{"use strict";Object.defineProperty(Sg,"__esModule",{value:!0});Sg.shareReplay=void 0;var fY=Bf(),pY=Eg();function mY(r,e,t){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,e=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,t=r.scheduler):o=r??1/0,pY.share({connector:function(){return new fY.ReplaySubject(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}Sg.shareReplay=mY});var h0=E(Tg=>{"use strict";Object.defineProperty(Tg,"__esModule",{value:!0});Tg.single=void 0;var gY=ci(),_Y=$S(),yY=QS(),vY=K(),bY=J();function wY(r){return vY.operate(function(e,t){var n=!1,i,s=!1,o=0;e.subscribe(bY.createOperatorSubscriber(t,function(a){s=!0,(!r||r(a,o++,e))&&(n&&t.error(new _Y.SequenceError("Too many matching values")),n=!0,i=a)},function(){n?(t.next(i),t.complete()):t.error(s?new yY.NotFoundError("No matching values"):new gY.EmptyError)}))})}Tg.single=wY});var d0=E(Ig=>{"use strict";Object.defineProperty(Ig,"__esModule",{value:!0});Ig.skip=void 0;var EY=bn();function SY(r){return EY.filter(function(e,t){return r<=t})}Ig.skip=SY});var f0=E(Ag=>{"use strict";Object.defineProperty(Ag,"__esModule",{value:!0});Ag.skipLast=void 0;var TY=yt(),IY=K(),AY=J();function PY(r){return r<=0?TY.identity:IY.operate(function(e,t){var n=new Array(r),i=0;return e.subscribe(AY.createOperatorSubscriber(t,function(s){var o=i++;if(o<r)n[o]=s;else{var a=o%r,u=n[a];n[a]=s,t.next(u)}})),function(){n=null}})}Ag.skipLast=PY});var p0=E(Pg=>{"use strict";Object.defineProperty(Pg,"__esModule",{value:!0});Pg.skipUntil=void 0;var CY=K(),XM=J(),OY=ae(),RY=_t();function NY(r){return CY.operate(function(e,t){var n=!1,i=XM.createOperatorSubscriber(t,function(){i?.unsubscribe(),n=!0},RY.noop);OY.innerFrom(r).subscribe(i),e.subscribe(XM.createOperatorSubscriber(t,function(s){return n&&t.next(s)}))})}Pg.skipUntil=NY});var m0=E(Cg=>{"use strict";Object.defineProperty(Cg,"__esModule",{value:!0});Cg.skipWhile=void 0;var DY=K(),xY=J();function kY(r){return DY.operate(function(e,t){var n=!1,i=0;e.subscribe(xY.createOperatorSubscriber(t,function(s){return(n||(n=!r(s,i++)))&&t.next(s)}))})}Cg.skipWhile=kY});var g0=E(Og=>{"use strict";Object.defineProperty(Og,"__esModule",{value:!0});Og.startWith=void 0;var ZM=Ul(),MY=Bt(),qY=K();function FY(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=MY.popScheduler(r);return qY.operate(function(n,i){(t?ZM.concat(r,n,t):ZM.concat(r,n)).subscribe(i)})}Og.startWith=FY});var ka=E(Rg=>{"use strict";Object.defineProperty(Rg,"__esModule",{value:!0});Rg.switchMap=void 0;var VY=ae(),LY=K(),eq=J();function jY(r,e){return LY.operate(function(t,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};t.subscribe(eq.createOperatorSubscriber(n,function(u){i?.unsubscribe();var c=0,h=s++;VY.innerFrom(r(u,h)).subscribe(i=eq.createOperatorSubscriber(n,function(f){return n.next(e?e(u,f,h,c++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}Rg.switchMap=jY});var _0=E(Ng=>{"use strict";Object.defineProperty(Ng,"__esModule",{value:!0});Ng.switchAll=void 0;var UY=ka(),BY=yt();function WY(){return UY.switchMap(BY.identity)}Ng.switchAll=WY});var y0=E(Dg=>{"use strict";Object.defineProperty(Dg,"__esModule",{value:!0});Dg.switchMapTo=void 0;var tq=ka(),zY=Te();function KY(r,e){return zY.isFunction(e)?tq.switchMap(function(){return r},e):tq.switchMap(function(){return r})}Dg.switchMapTo=KY});var v0=E(xg=>{"use strict";Object.defineProperty(xg,"__esModule",{value:!0});xg.switchScan=void 0;var GY=ka(),QY=K();function $Y(r,e){return QY.operate(function(t,n){var i=e;return GY.switchMap(function(s,o){return r(i,s,o)},function(s,o){return i=o,o})(t).subscribe(n),function(){i=null}})}xg.switchScan=$Y});var b0=E(kg=>{"use strict";Object.defineProperty(kg,"__esModule",{value:!0});kg.takeUntil=void 0;var HY=K(),YY=J(),JY=ae(),XY=_t();function ZY(r){return HY.operate(function(e,t){JY.innerFrom(r).subscribe(YY.createOperatorSubscriber(t,function(){return t.complete()},XY.noop)),!t.closed&&e.subscribe(t)})}kg.takeUntil=ZY});var w0=E(Mg=>{"use strict";Object.defineProperty(Mg,"__esModule",{value:!0});Mg.takeWhile=void 0;var e7=K(),t7=J();function r7(r,e){return e===void 0&&(e=!1),e7.operate(function(t,n){var i=0;t.subscribe(t7.createOperatorSubscriber(n,function(s){var o=r(s,i++);(o||e)&&n.next(s),!o&&n.complete()}))})}Mg.takeWhile=r7});var E0=E(qg=>{"use strict";Object.defineProperty(qg,"__esModule",{value:!0});qg.tap=void 0;var n7=Te(),i7=K(),s7=J(),o7=yt();function a7(r,e,t){var n=n7.isFunction(r)||e||t?{next:r,error:e,complete:t}:r;return n?i7.operate(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(s7.createOperatorSubscriber(s,function(u){var c;(c=n.next)===null||c===void 0||c.call(n,u),s.next(u)},function(){var u;a=!1,(u=n.complete)===null||u===void 0||u.call(n),s.complete()},function(u){var c;a=!1,(c=n.error)===null||c===void 0||c.call(n,u),s.error(u)},function(){var u,c;a&&((u=n.unsubscribe)===null||u===void 0||u.call(n)),(c=n.finalize)===null||c===void 0||c.call(n)}))}):o7.identity}qg.tap=a7});var Vg=E(Fg=>{"use strict";Object.defineProperty(Fg,"__esModule",{value:!0});Fg.throttle=void 0;var u7=K(),rq=J(),l7=ae();function c7(r,e){return u7.operate(function(t,n){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,u=a===void 0?!1:a,c=!1,h=null,f=null,m=!1,_=function(){f?.unsubscribe(),f=null,u&&(A(),m&&n.complete())},v=function(){f=null,m&&n.complete()},w=function(M){return f=l7.innerFrom(r(M)).subscribe(rq.createOperatorSubscriber(n,_,v))},A=function(){if(c){c=!1;var M=h;h=null,n.next(M),!m&&w(M)}};t.subscribe(rq.createOperatorSubscriber(n,function(M){c=!0,h=M,!(f&&!f.closed)&&(o?A():w(M))},function(){m=!0,!(u&&c&&f&&!f.closed)&&n.complete()}))})}Fg.throttle=c7});var S0=E(Lg=>{"use strict";Object.defineProperty(Lg,"__esModule",{value:!0});Lg.throttleTime=void 0;var h7=Ut(),d7=Vg(),f7=pi();function p7(r,e,t){e===void 0&&(e=h7.asyncScheduler);var n=f7.timer(r,e);return d7.throttle(function(){return n},t)}Lg.throttleTime=p7});var T0=E(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.TimeInterval=Ma.timeInterval=void 0;var m7=Ut(),g7=K(),_7=J();function y7(r){return r===void 0&&(r=m7.asyncScheduler),g7.operate(function(e,t){var n=r.now();e.subscribe(_7.createOperatorSubscriber(t,function(i){var s=r.now(),o=s-n;n=s,t.next(new nq(i,o))}))})}Ma.timeInterval=y7;var nq=function(){function r(e,t){this.value=e,this.interval=t}return r}();Ma.TimeInterval=nq});var I0=E(jg=>{"use strict";Object.defineProperty(jg,"__esModule",{value:!0});jg.timeoutWith=void 0;var v7=Ut(),b7=Tp(),w7=Ll();function E7(r,e,t){var n,i,s;if(t=t??v7.async,b7.isValidDate(r)?n=r:typeof r=="number"&&(i=r),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(n==null&&i==null)throw new TypeError("No timeout provided.");return w7.timeout({first:n,each:i,scheduler:t,with:s})}jg.timeoutWith=E7});var A0=E(Ug=>{"use strict";Object.defineProperty(Ug,"__esModule",{value:!0});Ug.timestamp=void 0;var S7=Uf(),T7=vn();function I7(r){return r===void 0&&(r=S7.dateTimestampProvider),T7.map(function(e){return{value:e,timestamp:r.now()}})}Ug.timestamp=I7});var P0=E(Bg=>{"use strict";Object.defineProperty(Bg,"__esModule",{value:!0});Bg.window=void 0;var iq=vt(),A7=K(),sq=J(),P7=_t(),C7=ae();function O7(r){return A7.operate(function(e,t){var n=new iq.Subject;t.next(n.asObservable());var i=function(s){n.error(s),t.error(s)};return e.subscribe(sq.createOperatorSubscriber(t,function(s){return n?.next(s)},function(){n.complete(),t.complete()},i)),C7.innerFrom(r).subscribe(sq.createOperatorSubscriber(t,function(){n.complete(),t.next(n=new iq.Subject)},P7.noop,i)),function(){n?.unsubscribe(),n=null}})}Bg.window=O7});var C0=E(qa=>{"use strict";var R7=qa&&qa.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(qa,"__esModule",{value:!0});qa.windowCount=void 0;var oq=vt(),N7=K(),D7=J();function x7(r,e){e===void 0&&(e=0);var t=e>0?e:r;return N7.operate(function(n,i){var s=[new oq.Subject],o=[],a=0;i.next(s[0].asObservable()),n.subscribe(D7.createOperatorSubscriber(i,function(u){var c,h;try{for(var f=R7(s),m=f.next();!m.done;m=f.next()){var _=m.value;_.next(u)}}catch(A){c={error:A}}finally{try{m&&!m.done&&(h=f.return)&&h.call(f)}finally{if(c)throw c.error}}var v=a-r+1;if(v>=0&&v%t===0&&s.shift().complete(),++a%t===0){var w=new oq.Subject;s.push(w),i.next(w.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(u){for(;s.length>0;)s.shift().error(u);i.error(u)},function(){o=null,s=null}))})}qa.windowCount=x7});var O0=E(Wg=>{"use strict";Object.defineProperty(Wg,"__esModule",{value:!0});Wg.windowTime=void 0;var k7=vt(),M7=Ut(),q7=Xt(),F7=K(),V7=J(),L7=mn(),j7=Bt(),aq=gn();function U7(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=j7.popScheduler(n))!==null&&e!==void 0?e:M7.asyncScheduler,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return F7.operate(function(u,c){var h=[],f=!1,m=function(A){var M=A.window,V=A.subs;M.complete(),V.unsubscribe(),L7.arrRemove(h,A),f&&_()},_=function(){if(h){var A=new q7.Subscription;c.add(A);var M=new k7.Subject,V={window:M,subs:A,seen:0};h.push(V),c.next(M.asObservable()),aq.executeSchedule(A,s,function(){return m(V)},r)}};o!==null&&o>=0?aq.executeSchedule(c,s,_,o,!0):f=!0,_();var v=function(A){return h.slice().forEach(A)},w=function(A){v(function(M){var V=M.window;return A(V)}),A(c),c.unsubscribe()};return u.subscribe(V7.createOperatorSubscriber(c,function(A){v(function(M){M.window.next(A),a<=++M.seen&&m(M)})},function(){return w(function(A){return A.complete()})},function(A){return w(function(M){return M.error(A)})})),function(){h=null}})}Wg.windowTime=U7});var N0=E(Fa=>{"use strict";var B7=Fa&&Fa.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Fa,"__esModule",{value:!0});Fa.windowToggle=void 0;var W7=vt(),z7=Xt(),K7=K(),uq=ae(),R0=J(),lq=_t(),G7=mn();function Q7(r,e){return K7.operate(function(t,n){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);n.error(o)};uq.innerFrom(r).subscribe(R0.createOperatorSubscriber(n,function(o){var a=new W7.Subject;i.push(a);var u=new z7.Subscription,c=function(){G7.arrRemove(i,a),a.complete(),u.unsubscribe()},h;try{h=uq.innerFrom(e(o))}catch(f){s(f);return}n.next(a.asObservable()),u.add(h.subscribe(R0.createOperatorSubscriber(n,c,lq.noop,s)))},lq.noop)),t.subscribe(R0.createOperatorSubscriber(n,function(o){var a,u,c=i.slice();try{for(var h=B7(c),f=h.next();!f.done;f=h.next()){var m=f.value;m.next(o)}}catch(_){a={error:_}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();n.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}Fa.windowToggle=Q7});var D0=E(zg=>{"use strict";Object.defineProperty(zg,"__esModule",{value:!0});zg.windowWhen=void 0;var $7=vt(),H7=K(),cq=J(),Y7=ae();function J7(r){return H7.operate(function(e,t){var n,i,s=function(a){n.error(a),t.error(a)},o=function(){i?.unsubscribe(),n?.complete(),n=new $7.Subject,t.next(n.asObservable());var a;try{a=Y7.innerFrom(r())}catch(u){s(u);return}a.subscribe(i=cq.createOperatorSubscriber(t,o,o,s))};o(),e.subscribe(cq.createOperatorSubscriber(t,function(a){return n.next(a)},function(){n.complete(),t.complete()},s,function(){i?.unsubscribe(),n=null}))})}zg.windowWhen=J7});var x0=E(Ai=>{"use strict";var hq=Ai&&Ai.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},dq=Ai&&Ai.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Ai,"__esModule",{value:!0});Ai.withLatestFrom=void 0;var X7=K(),fq=J(),Z7=ae(),e8=yt(),t8=_t(),r8=Bt();function n8(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r8.popResultSelector(r);return X7.operate(function(n,i){for(var s=r.length,o=new Array(s),a=r.map(function(){return!1}),u=!1,c=function(f){Z7.innerFrom(r[f]).subscribe(fq.createOperatorSubscriber(i,function(m){o[f]=m,!u&&!a[f]&&(a[f]=!0,(u=a.every(e8.identity))&&(a=null))},t8.noop))},h=0;h<s;h++)c(h);n.subscribe(fq.createOperatorSubscriber(i,function(f){if(u){var m=dq([f],hq(o));i.next(t?t.apply(void 0,dq([],hq(m))):m)}}))})}Ai.withLatestFrom=n8});var k0=E(Kg=>{"use strict";Object.defineProperty(Kg,"__esModule",{value:!0});Kg.zipAll=void 0;var i8=Zp(),s8=mT();function o8(r){return s8.joinAllInternals(i8.zip,r)}Kg.zipAll=o8});var M0=E(Pi=>{"use strict";var a8=Pi&&Pi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},u8=Pi&&Pi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Pi,"__esModule",{value:!0});Pi.zip=void 0;var l8=Zp(),c8=K();function h8(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return c8.operate(function(t,n){l8.zip.apply(void 0,u8([t],a8(r))).subscribe(n)})}Pi.zip=h8});var q0=E(Ci=>{"use strict";var d8=Ci&&Ci.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},f8=Ci&&Ci.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.zipWith=void 0;var p8=M0();function m8(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return p8.zip.apply(void 0,f8([],d8(r)))}Ci.zipWith=m8});var F0=E(g=>{"use strict";var g8=g&&g.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),_8=g&&g.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&g8(e,r,t)};Object.defineProperty(g,"__esModule",{value:!0});g.interval=g.iif=g.generate=g.fromEventPattern=g.fromEvent=g.from=g.forkJoin=g.empty=g.defer=g.connectable=g.concat=g.combineLatest=g.bindNodeCallback=g.bindCallback=g.UnsubscriptionError=g.TimeoutError=g.SequenceError=g.ObjectUnsubscribedError=g.NotFoundError=g.EmptyError=g.ArgumentOutOfRangeError=g.firstValueFrom=g.lastValueFrom=g.isObservable=g.identity=g.noop=g.pipe=g.NotificationKind=g.Notification=g.Subscriber=g.Subscription=g.Scheduler=g.VirtualAction=g.VirtualTimeScheduler=g.animationFrameScheduler=g.animationFrame=g.queueScheduler=g.queue=g.asyncScheduler=g.async=g.asapScheduler=g.asap=g.AsyncSubject=g.ReplaySubject=g.BehaviorSubject=g.Subject=g.animationFrames=g.observable=g.ConnectableObservable=g.Observable=void 0;g.filter=g.expand=g.exhaustMap=g.exhaustAll=g.exhaust=g.every=g.endWith=g.elementAt=g.distinctUntilKeyChanged=g.distinctUntilChanged=g.distinct=g.dematerialize=g.delayWhen=g.delay=g.defaultIfEmpty=g.debounceTime=g.debounce=g.count=g.connect=g.concatWith=g.concatMapTo=g.concatMap=g.concatAll=g.combineLatestWith=g.combineLatestAll=g.combineAll=g.catchError=g.bufferWhen=g.bufferToggle=g.bufferTime=g.bufferCount=g.buffer=g.auditTime=g.audit=g.config=g.NEVER=g.EMPTY=g.scheduled=g.zip=g.using=g.timer=g.throwError=g.range=g.race=g.partition=g.pairs=g.onErrorResumeNext=g.of=g.never=g.merge=void 0;g.switchMap=g.switchAll=g.subscribeOn=g.startWith=g.skipWhile=g.skipUntil=g.skipLast=g.skip=g.single=g.shareReplay=g.share=g.sequenceEqual=g.scan=g.sampleTime=g.sample=g.refCount=g.retryWhen=g.retry=g.repeatWhen=g.repeat=g.reduce=g.raceWith=g.publishReplay=g.publishLast=g.publishBehavior=g.publish=g.pluck=g.pairwise=g.onErrorResumeNextWith=g.observeOn=g.multicast=g.min=g.mergeWith=g.mergeScan=g.mergeMapTo=g.mergeMap=g.flatMap=g.mergeAll=g.max=g.materialize=g.mapTo=g.map=g.last=g.isEmpty=g.ignoreElements=g.groupBy=g.first=g.findIndex=g.find=g.finalize=void 0;g.zipWith=g.zipAll=g.withLatestFrom=g.windowWhen=g.windowToggle=g.windowTime=g.windowCount=g.window=g.toArray=g.timestamp=g.timeoutWith=g.timeout=g.timeInterval=g.throwIfEmpty=g.throttleTime=g.throttle=g.tap=g.takeWhile=g.takeUntil=g.takeLast=g.take=g.switchScan=g.switchMapTo=void 0;var y8=Ie();Object.defineProperty(g,"Observable",{enumerable:!0,get:function(){return y8.Observable}});var v8=Ml();Object.defineProperty(g,"ConnectableObservable",{enumerable:!0,get:function(){return v8.ConnectableObservable}});var b8=xl();Object.defineProperty(g,"observable",{enumerable:!0,get:function(){return b8.observable}});var w8=Kx();Object.defineProperty(g,"animationFrames",{enumerable:!0,get:function(){return w8.animationFrames}});var E8=vt();Object.defineProperty(g,"Subject",{enumerable:!0,get:function(){return E8.Subject}});var S8=OS();Object.defineProperty(g,"BehaviorSubject",{enumerable:!0,get:function(){return S8.BehaviorSubject}});var T8=Bf();Object.defineProperty(g,"ReplaySubject",{enumerable:!0,get:function(){return T8.ReplaySubject}});var I8=Wf();Object.defineProperty(g,"AsyncSubject",{enumerable:!0,get:function(){return I8.AsyncSubject}});var pq=uk();Object.defineProperty(g,"asap",{enumerable:!0,get:function(){return pq.asap}});Object.defineProperty(g,"asapScheduler",{enumerable:!0,get:function(){return pq.asapScheduler}});var mq=Ut();Object.defineProperty(g,"async",{enumerable:!0,get:function(){return mq.async}});Object.defineProperty(g,"asyncScheduler",{enumerable:!0,get:function(){return mq.asyncScheduler}});var gq=hk();Object.defineProperty(g,"queue",{enumerable:!0,get:function(){return gq.queue}});Object.defineProperty(g,"queueScheduler",{enumerable:!0,get:function(){return gq.queueScheduler}});var _q=mk();Object.defineProperty(g,"animationFrame",{enumerable:!0,get:function(){return _q.animationFrame}});Object.defineProperty(g,"animationFrameScheduler",{enumerable:!0,get:function(){return _q.animationFrameScheduler}});var yq=yk();Object.defineProperty(g,"VirtualTimeScheduler",{enumerable:!0,get:function(){return yq.VirtualTimeScheduler}});Object.defineProperty(g,"VirtualAction",{enumerable:!0,get:function(){return yq.VirtualAction}});var A8=NS();Object.defineProperty(g,"Scheduler",{enumerable:!0,get:function(){return A8.Scheduler}});var P8=Xt();Object.defineProperty(g,"Subscription",{enumerable:!0,get:function(){return P8.Subscription}});var C8=Jo();Object.defineProperty(g,"Subscriber",{enumerable:!0,get:function(){return C8.Subscriber}});var vq=mp();Object.defineProperty(g,"Notification",{enumerable:!0,get:function(){return vq.Notification}});Object.defineProperty(g,"NotificationKind",{enumerable:!0,get:function(){return vq.NotificationKind}});var O8=kl();Object.defineProperty(g,"pipe",{enumerable:!0,get:function(){return O8.pipe}});var R8=_t();Object.defineProperty(g,"noop",{enumerable:!0,get:function(){return R8.noop}});var N8=yt();Object.defineProperty(g,"identity",{enumerable:!0,get:function(){return N8.identity}});var D8=Mk();Object.defineProperty(g,"isObservable",{enumerable:!0,get:function(){return D8.isObservable}});var x8=qk();Object.defineProperty(g,"lastValueFrom",{enumerable:!0,get:function(){return x8.lastValueFrom}});var k8=Fk();Object.defineProperty(g,"firstValueFrom",{enumerable:!0,get:function(){return k8.firstValueFrom}});var M8=GS();Object.defineProperty(g,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return M8.ArgumentOutOfRangeError}});var q8=ci();Object.defineProperty(g,"EmptyError",{enumerable:!0,get:function(){return q8.EmptyError}});var F8=QS();Object.defineProperty(g,"NotFoundError",{enumerable:!0,get:function(){return F8.NotFoundError}});var V8=IS();Object.defineProperty(g,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return V8.ObjectUnsubscribedError}});var L8=$S();Object.defineProperty(g,"SequenceError",{enumerable:!0,get:function(){return L8.SequenceError}});var j8=Ll();Object.defineProperty(g,"TimeoutError",{enumerable:!0,get:function(){return j8.TimeoutError}});var U8=fS();Object.defineProperty(g,"UnsubscriptionError",{enumerable:!0,get:function(){return U8.UnsubscriptionError}});var B8=Lk();Object.defineProperty(g,"bindCallback",{enumerable:!0,get:function(){return B8.bindCallback}});var W8=jk();Object.defineProperty(g,"bindNodeCallback",{enumerable:!0,get:function(){return W8.bindNodeCallback}});var z8=Rp();Object.defineProperty(g,"combineLatest",{enumerable:!0,get:function(){return z8.combineLatest}});var K8=Ul();Object.defineProperty(g,"concat",{enumerable:!0,get:function(){return K8.concat}});var G8=$k();Object.defineProperty(g,"connectable",{enumerable:!0,get:function(){return G8.connectable}});var Q8=Bl();Object.defineProperty(g,"defer",{enumerable:!0,get:function(){return Q8.defer}});var $8=Er();Object.defineProperty(g,"empty",{enumerable:!0,get:function(){return $8.empty}});var H8=Hk();Object.defineProperty(g,"forkJoin",{enumerable:!0,get:function(){return H8.forkJoin}});var Y8=_n();Object.defineProperty(g,"from",{enumerable:!0,get:function(){return Y8.from}});var J8=Jk();Object.defineProperty(g,"fromEvent",{enumerable:!0,get:function(){return J8.fromEvent}});var X8=Zk();Object.defineProperty(g,"fromEventPattern",{enumerable:!0,get:function(){return X8.fromEventPattern}});var Z8=tM();Object.defineProperty(g,"generate",{enumerable:!0,get:function(){return Z8.generate}});var eJ=rM();Object.defineProperty(g,"iif",{enumerable:!0,get:function(){return eJ.iif}});var tJ=eT();Object.defineProperty(g,"interval",{enumerable:!0,get:function(){return tJ.interval}});var rJ=iM();Object.defineProperty(g,"merge",{enumerable:!0,get:function(){return rJ.merge}});var nJ=tT();Object.defineProperty(g,"never",{enumerable:!0,get:function(){return nJ.never}});var iJ=fp();Object.defineProperty(g,"of",{enumerable:!0,get:function(){return iJ.of}});var sJ=rT();Object.defineProperty(g,"onErrorResumeNext",{enumerable:!0,get:function(){return sJ.onErrorResumeNext}});var oJ=oM();Object.defineProperty(g,"pairs",{enumerable:!0,get:function(){return oJ.pairs}});var aJ=lM();Object.defineProperty(g,"partition",{enumerable:!0,get:function(){return aJ.partition}});var uJ=iT();Object.defineProperty(g,"race",{enumerable:!0,get:function(){return uJ.race}});var lJ=dM();Object.defineProperty(g,"range",{enumerable:!0,get:function(){return lJ.range}});var cJ=KS();Object.defineProperty(g,"throwError",{enumerable:!0,get:function(){return cJ.throwError}});var hJ=pi();Object.defineProperty(g,"timer",{enumerable:!0,get:function(){return hJ.timer}});var dJ=fM();Object.defineProperty(g,"using",{enumerable:!0,get:function(){return dJ.using}});var fJ=Zp();Object.defineProperty(g,"zip",{enumerable:!0,get:function(){return fJ.zip}});var pJ=zS();Object.defineProperty(g,"scheduled",{enumerable:!0,get:function(){return pJ.scheduled}});var mJ=Er();Object.defineProperty(g,"EMPTY",{enumerable:!0,get:function(){return mJ.EMPTY}});var gJ=tT();Object.defineProperty(g,"NEVER",{enumerable:!0,get:function(){return gJ.NEVER}});_8(mM(),g);var _J=Ho();Object.defineProperty(g,"config",{enumerable:!0,get:function(){return _J.config}});var yJ=tm();Object.defineProperty(g,"audit",{enumerable:!0,get:function(){return yJ.audit}});var vJ=sT();Object.defineProperty(g,"auditTime",{enumerable:!0,get:function(){return vJ.auditTime}});var bJ=oT();Object.defineProperty(g,"buffer",{enumerable:!0,get:function(){return bJ.buffer}});var wJ=uT();Object.defineProperty(g,"bufferCount",{enumerable:!0,get:function(){return wJ.bufferCount}});var EJ=lT();Object.defineProperty(g,"bufferTime",{enumerable:!0,get:function(){return EJ.bufferTime}});var SJ=hT();Object.defineProperty(g,"bufferToggle",{enumerable:!0,get:function(){return SJ.bufferToggle}});var TJ=dT();Object.defineProperty(g,"bufferWhen",{enumerable:!0,get:function(){return TJ.bufferWhen}});var IJ=fT();Object.defineProperty(g,"catchError",{enumerable:!0,get:function(){return IJ.catchError}});var AJ=gT();Object.defineProperty(g,"combineAll",{enumerable:!0,get:function(){return AJ.combineAll}});var PJ=dm();Object.defineProperty(g,"combineLatestAll",{enumerable:!0,get:function(){return PJ.combineLatestAll}});var CJ=yT();Object.defineProperty(g,"combineLatestWith",{enumerable:!0,get:function(){return CJ.combineLatestWith}});var OJ=jl();Object.defineProperty(g,"concatAll",{enumerable:!0,get:function(){return OJ.concatAll}});var RJ=mm();Object.defineProperty(g,"concatMap",{enumerable:!0,get:function(){return RJ.concatMap}});var NJ=vT();Object.defineProperty(g,"concatMapTo",{enumerable:!0,get:function(){return NJ.concatMapTo}});var DJ=wT();Object.defineProperty(g,"concatWith",{enumerable:!0,get:function(){return DJ.concatWith}});var xJ=Wl();Object.defineProperty(g,"connect",{enumerable:!0,get:function(){return xJ.connect}});var kJ=ET();Object.defineProperty(g,"count",{enumerable:!0,get:function(){return kJ.count}});var MJ=ST();Object.defineProperty(g,"debounce",{enumerable:!0,get:function(){return MJ.debounce}});var qJ=TT();Object.defineProperty(g,"debounceTime",{enumerable:!0,get:function(){return qJ.debounceTime}});var FJ=Oa();Object.defineProperty(g,"defaultIfEmpty",{enumerable:!0,get:function(){return FJ.defaultIfEmpty}});var VJ=IT();Object.defineProperty(g,"delay",{enumerable:!0,get:function(){return VJ.delay}});var LJ=Om();Object.defineProperty(g,"delayWhen",{enumerable:!0,get:function(){return LJ.delayWhen}});var jJ=AT();Object.defineProperty(g,"dematerialize",{enumerable:!0,get:function(){return jJ.dematerialize}});var UJ=PT();Object.defineProperty(g,"distinct",{enumerable:!0,get:function(){return UJ.distinct}});var BJ=km();Object.defineProperty(g,"distinctUntilChanged",{enumerable:!0,get:function(){return BJ.distinctUntilChanged}});var WJ=CT();Object.defineProperty(g,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return WJ.distinctUntilKeyChanged}});var zJ=OT();Object.defineProperty(g,"elementAt",{enumerable:!0,get:function(){return zJ.elementAt}});var KJ=RT();Object.defineProperty(g,"endWith",{enumerable:!0,get:function(){return KJ.endWith}});var GJ=NT();Object.defineProperty(g,"every",{enumerable:!0,get:function(){return GJ.every}});var QJ=DT();Object.defineProperty(g,"exhaust",{enumerable:!0,get:function(){return QJ.exhaust}});var $J=Bm();Object.defineProperty(g,"exhaustAll",{enumerable:!0,get:function(){return $J.exhaustAll}});var HJ=jm();Object.defineProperty(g,"exhaustMap",{enumerable:!0,get:function(){return HJ.exhaustMap}});var YJ=xT();Object.defineProperty(g,"expand",{enumerable:!0,get:function(){return YJ.expand}});var JJ=bn();Object.defineProperty(g,"filter",{enumerable:!0,get:function(){return JJ.filter}});var XJ=kT();Object.defineProperty(g,"finalize",{enumerable:!0,get:function(){return XJ.finalize}});var ZJ=Gm();Object.defineProperty(g,"find",{enumerable:!0,get:function(){return ZJ.find}});var eX=MT();Object.defineProperty(g,"findIndex",{enumerable:!0,get:function(){return eX.findIndex}});var tX=qT();Object.defineProperty(g,"first",{enumerable:!0,get:function(){return tX.first}});var rX=FT();Object.defineProperty(g,"groupBy",{enumerable:!0,get:function(){return rX.groupBy}});var nX=Im();Object.defineProperty(g,"ignoreElements",{enumerable:!0,get:function(){return nX.ignoreElements}});var iX=VT();Object.defineProperty(g,"isEmpty",{enumerable:!0,get:function(){return iX.isEmpty}});var sX=LT();Object.defineProperty(g,"last",{enumerable:!0,get:function(){return sX.last}});var oX=vn();Object.defineProperty(g,"map",{enumerable:!0,get:function(){return oX.map}});var aX=Pm();Object.defineProperty(g,"mapTo",{enumerable:!0,get:function(){return aX.mapTo}});var uX=UT();Object.defineProperty(g,"materialize",{enumerable:!0,get:function(){return uX.materialize}});var lX=BT();Object.defineProperty(g,"max",{enumerable:!0,get:function(){return lX.max}});var cX=Ea();Object.defineProperty(g,"mergeAll",{enumerable:!0,get:function(){return cX.mergeAll}});var hX=WT();Object.defineProperty(g,"flatMap",{enumerable:!0,get:function(){return hX.flatMap}});var dX=Hr();Object.defineProperty(g,"mergeMap",{enumerable:!0,get:function(){return dX.mergeMap}});var fX=zT();Object.defineProperty(g,"mergeMapTo",{enumerable:!0,get:function(){return fX.mergeMapTo}});var pX=KT();Object.defineProperty(g,"mergeScan",{enumerable:!0,get:function(){return pX.mergeScan}});var mX=QT();Object.defineProperty(g,"mergeWith",{enumerable:!0,get:function(){return mX.mergeWith}});var gX=$T();Object.defineProperty(g,"min",{enumerable:!0,get:function(){return gX.min}});var _X=zl();Object.defineProperty(g,"multicast",{enumerable:!0,get:function(){return _X.multicast}});var yX=va();Object.defineProperty(g,"observeOn",{enumerable:!0,get:function(){return yX.observeOn}});var vX=HT();Object.defineProperty(g,"onErrorResumeNextWith",{enumerable:!0,get:function(){return vX.onErrorResumeNextWith}});var bX=YT();Object.defineProperty(g,"pairwise",{enumerable:!0,get:function(){return bX.pairwise}});var wX=JT();Object.defineProperty(g,"pluck",{enumerable:!0,get:function(){return wX.pluck}});var EX=XT();Object.defineProperty(g,"publish",{enumerable:!0,get:function(){return EX.publish}});var SX=ZT();Object.defineProperty(g,"publishBehavior",{enumerable:!0,get:function(){return SX.publishBehavior}});var TX=e0();Object.defineProperty(g,"publishLast",{enumerable:!0,get:function(){return TX.publishLast}});var IX=t0();Object.defineProperty(g,"publishReplay",{enumerable:!0,get:function(){return IX.publishReplay}});var AX=dg();Object.defineProperty(g,"raceWith",{enumerable:!0,get:function(){return AX.raceWith}});var PX=Ns();Object.defineProperty(g,"reduce",{enumerable:!0,get:function(){return PX.reduce}});var CX=r0();Object.defineProperty(g,"repeat",{enumerable:!0,get:function(){return CX.repeat}});var OX=n0();Object.defineProperty(g,"repeatWhen",{enumerable:!0,get:function(){return OX.repeatWhen}});var RX=i0();Object.defineProperty(g,"retry",{enumerable:!0,get:function(){return RX.retry}});var NX=s0();Object.defineProperty(g,"retryWhen",{enumerable:!0,get:function(){return NX.retryWhen}});var DX=Vf();Object.defineProperty(g,"refCount",{enumerable:!0,get:function(){return DX.refCount}});var xX=yg();Object.defineProperty(g,"sample",{enumerable:!0,get:function(){return xX.sample}});var kX=o0();Object.defineProperty(g,"sampleTime",{enumerable:!0,get:function(){return kX.sampleTime}});var MX=a0();Object.defineProperty(g,"scan",{enumerable:!0,get:function(){return MX.scan}});var qX=u0();Object.defineProperty(g,"sequenceEqual",{enumerable:!0,get:function(){return qX.sequenceEqual}});var FX=Eg();Object.defineProperty(g,"share",{enumerable:!0,get:function(){return FX.share}});var VX=c0();Object.defineProperty(g,"shareReplay",{enumerable:!0,get:function(){return VX.shareReplay}});var LX=h0();Object.defineProperty(g,"single",{enumerable:!0,get:function(){return LX.single}});var jX=d0();Object.defineProperty(g,"skip",{enumerable:!0,get:function(){return jX.skip}});var UX=f0();Object.defineProperty(g,"skipLast",{enumerable:!0,get:function(){return UX.skipLast}});var BX=p0();Object.defineProperty(g,"skipUntil",{enumerable:!0,get:function(){return BX.skipUntil}});var WX=m0();Object.defineProperty(g,"skipWhile",{enumerable:!0,get:function(){return WX.skipWhile}});var zX=g0();Object.defineProperty(g,"startWith",{enumerable:!0,get:function(){return zX.startWith}});var KX=ba();Object.defineProperty(g,"subscribeOn",{enumerable:!0,get:function(){return KX.subscribeOn}});var GX=_0();Object.defineProperty(g,"switchAll",{enumerable:!0,get:function(){return GX.switchAll}});var QX=ka();Object.defineProperty(g,"switchMap",{enumerable:!0,get:function(){return QX.switchMap}});var $X=y0();Object.defineProperty(g,"switchMapTo",{enumerable:!0,get:function(){return $X.switchMapTo}});var HX=v0();Object.defineProperty(g,"switchScan",{enumerable:!0,get:function(){return HX.switchScan}});var YX=Ra();Object.defineProperty(g,"take",{enumerable:!0,get:function(){return YX.take}});var JX=Jm();Object.defineProperty(g,"takeLast",{enumerable:!0,get:function(){return JX.takeLast}});var XX=b0();Object.defineProperty(g,"takeUntil",{enumerable:!0,get:function(){return XX.takeUntil}});var ZX=w0();Object.defineProperty(g,"takeWhile",{enumerable:!0,get:function(){return ZX.takeWhile}});var eZ=E0();Object.defineProperty(g,"tap",{enumerable:!0,get:function(){return eZ.tap}});var tZ=Vg();Object.defineProperty(g,"throttle",{enumerable:!0,get:function(){return tZ.throttle}});var rZ=S0();Object.defineProperty(g,"throttleTime",{enumerable:!0,get:function(){return rZ.throttleTime}});var nZ=Na();Object.defineProperty(g,"throwIfEmpty",{enumerable:!0,get:function(){return nZ.throwIfEmpty}});var iZ=T0();Object.defineProperty(g,"timeInterval",{enumerable:!0,get:function(){return iZ.timeInterval}});var sZ=Ll();Object.defineProperty(g,"timeout",{enumerable:!0,get:function(){return sZ.timeout}});var oZ=I0();Object.defineProperty(g,"timeoutWith",{enumerable:!0,get:function(){return oZ.timeoutWith}});var aZ=A0();Object.defineProperty(g,"timestamp",{enumerable:!0,get:function(){return aZ.timestamp}});var uZ=lm();Object.defineProperty(g,"toArray",{enumerable:!0,get:function(){return uZ.toArray}});var lZ=P0();Object.defineProperty(g,"window",{enumerable:!0,get:function(){return lZ.window}});var cZ=C0();Object.defineProperty(g,"windowCount",{enumerable:!0,get:function(){return cZ.windowCount}});var hZ=O0();Object.defineProperty(g,"windowTime",{enumerable:!0,get:function(){return hZ.windowTime}});var dZ=N0();Object.defineProperty(g,"windowToggle",{enumerable:!0,get:function(){return dZ.windowToggle}});var fZ=D0();Object.defineProperty(g,"windowWhen",{enumerable:!0,get:function(){return fZ.windowWhen}});var pZ=x0();Object.defineProperty(g,"withLatestFrom",{enumerable:!0,get:function(){return pZ.withLatestFrom}});var mZ=k0();Object.defineProperty(g,"zipAll",{enumerable:!0,get:function(){return mZ.zipAll}});var gZ=q0();Object.defineProperty(g,"zipWith",{enumerable:!0,get:function(){return gZ.zipWith}})});var Gg=E(V0=>{"use strict";Object.defineProperty(V0,"__esModule",{value:!0});var _Z=(Me(),Za(tt)),bq=F0(),yZ=function(){function r(){this.onDragStart=new bq.Subject,this.onDragEnd=new bq.Subject}return r.decorators=[{type:_Z.Injectable}],r.ctorParameters=function(){return[]},r}();V0.NgDragDropService=yZ});var j0=E(L0=>{"use strict";Object.defineProperty(L0,"__esModule",{value:!0});var vZ=(Me(),Za(tt)),bZ=function(){function r(){}return r.matches=function(e,t){var n=Element.prototype,i=n.matches||n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector||function(s){for(var o=(this.document||this.ownerDocument).querySelectorAll(s),a=o.length;--a>=0&&o.item(a)!==this;);return a>-1};return i.call(e,t)},r.addClass=function(e,t){var n=this.getElementWithValidClassList(e);n&&n.classList.add(t)},r.removeClass=function(e,t){var n=this.getElementWithValidClassList(e);n&&n.classList.remove(t)},r.getElementWithValidClassList=function(e){var t=e instanceof vZ.ElementRef?e.nativeElement:e;return t.classList!==void 0&&t.classList!==null?t:null},r}();L0.DomHelper=bZ});var wq=E(U0=>{"use strict";Object.defineProperty(U0,"__esModule",{value:!0});var je=(Me(),Za(tt)),wZ=Gg(),Ds=j0(),EZ=function(){function r(e,t,n,i){this.el=e,this.renderer=t,this.ng2DragDropService=n,this.zone=i,this.dragEffect="move",this.dragScope="default",this.dragHandleClass="drag-handle",this.dragClass="drag-border",this.dragTransitClass="drag-transit",this.onDragStart=new je.EventEmitter,this.onDrag=new je.EventEmitter,this.onDragEnd=new je.EventEmitter,this._dragEnabled=!0}return Object.defineProperty(r.prototype,"dragImage",{get:function(){return this._dragImage},set:function(e){this._dragImage=e,this.dragImageElement=new Image,this.dragImageElement.src=this.dragImage},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dragEnabled",{get:function(){return this._dragEnabled},set:function(e){this._dragEnabled=e,this.applyDragHandleClass()},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){this.applyDragHandleClass()},r.prototype.ngOnDestroy=function(){this.unbindDragListeners()},r.prototype.dragStart=function(e){var t=this;this.allowDrag()?(Ds.DomHelper.addClass(this.el,this.dragTransitClass),setTimeout(function(){Ds.DomHelper.addClass(t.el,t.dragClass),Ds.DomHelper.removeClass(t.el,t.dragTransitClass)},10),this.ng2DragDropService.dragData=this.dragData,this.ng2DragDropService.scope=this.dragScope,e.dataTransfer!=null&&e.dataTransfer.setData("text",""),this.dragImage&&e.dataTransfer.setDragImage(this.dragImageElement,0,0),e.stopPropagation(),this.onDragStart.emit(e),this.ng2DragDropService.onDragStart.next(),this.zone.runOutsideAngular(function(){t.unbindDragListener=t.renderer.listen(t.el.nativeElement,"drag",function(n){t.drag(n)})})):e.preventDefault()},r.prototype.drag=function(e){this.onDrag.emit(e)},r.prototype.dragEnd=function(e){this.unbindDragListeners(),Ds.DomHelper.removeClass(this.el,this.dragClass),this.ng2DragDropService.onDragEnd.next(),this.onDragEnd.emit(e),e.stopPropagation(),e.preventDefault()},r.prototype.mousedown=function(e){this.mouseDownElement=e.target},r.prototype.allowDrag=function(){return this.dragHandle?Ds.DomHelper.matches(this.mouseDownElement,this.dragHandle)&&this.dragEnabled:this.dragEnabled},r.prototype.applyDragHandleClass=function(){var e=this.getDragHandleElement();e&&(this.dragEnabled?Ds.DomHelper.addClass(e,this.dragHandleClass):Ds.DomHelper.removeClass(this.el,this.dragHandleClass))},r.prototype.getDragHandleElement=function(){var e=this.el;return this.dragHandle&&(e=this.el.nativeElement.querySelector(this.dragHandle)),e},r.prototype.unbindDragListeners=function(){this.unbindDragListener&&this.unbindDragListener()},r.decorators=[{type:je.Directive,args:[{selector:"[draggable]"}]}],r.ctorParameters=function(){return[{type:je.ElementRef},{type:je.Renderer2},{type:wZ.NgDragDropService},{type:je.NgZone}]},r.propDecorators={dragData:[{type:je.Input}],dragHandle:[{type:je.Input}],dragEffect:[{type:je.Input}],dragScope:[{type:je.Input}],dragHandleClass:[{type:je.Input}],dragClass:[{type:je.Input}],dragTransitClass:[{type:je.Input}],dragImage:[{type:je.Input}],dragEnabled:[{type:je.HostBinding,args:["draggable"]},{type:je.Input}],onDragStart:[{type:je.Output}],onDrag:[{type:je.Output}],onDragEnd:[{type:je.Output}],dragStart:[{type:je.HostListener,args:["dragstart",["$event"]]}],dragEnd:[{type:je.HostListener,args:["dragend",["$event"]]}],mousedown:[{type:je.HostListener,args:["mousedown",["$event"]]},{type:je.HostListener,args:["touchstart",["$event"]]}]},r}();U0.Draggable=EZ});var Sq=E(Qg=>{"use strict";Object.defineProperty(Qg,"__esModule",{value:!0});Qg.partition=void 0;var SZ=nT(),Eq=bn();function TZ(r,e){return function(t){return[Eq.filter(r,e)(t),Eq.filter(SZ.not(r,e))(t)]}}Qg.partition=TZ});var Tq=E(Oi=>{"use strict";var IZ=Oi&&Oi.__read||function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s},AZ=Oi&&Oi.__spreadArray||function(r,e){for(var t=0,n=e.length,i=r.length;t<n;t++,i++)r[i]=e[t];return r};Object.defineProperty(Oi,"__esModule",{value:!0});Oi.race=void 0;var PZ=mi(),CZ=dg();function OZ(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return CZ.raceWith.apply(void 0,AZ([],IZ(PZ.argsOrArgArray(r))))}Oi.race=OZ});var Iq=E(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.mergeAll=S.merge=S.max=S.materialize=S.mapTo=S.map=S.last=S.isEmpty=S.ignoreElements=S.groupBy=S.first=S.findIndex=S.find=S.finalize=S.filter=S.expand=S.exhaustMap=S.exhaustAll=S.exhaust=S.every=S.endWith=S.elementAt=S.distinctUntilKeyChanged=S.distinctUntilChanged=S.distinct=S.dematerialize=S.delayWhen=S.delay=S.defaultIfEmpty=S.debounceTime=S.debounce=S.count=S.connect=S.concatWith=S.concatMapTo=S.concatMap=S.concatAll=S.concat=S.combineLatestWith=S.combineLatest=S.combineLatestAll=S.combineAll=S.catchError=S.bufferWhen=S.bufferToggle=S.bufferTime=S.bufferCount=S.buffer=S.auditTime=S.audit=void 0;S.timeInterval=S.throwIfEmpty=S.throttleTime=S.throttle=S.tap=S.takeWhile=S.takeUntil=S.takeLast=S.take=S.switchScan=S.switchMapTo=S.switchMap=S.switchAll=S.subscribeOn=S.startWith=S.skipWhile=S.skipUntil=S.skipLast=S.skip=S.single=S.shareReplay=S.share=S.sequenceEqual=S.scan=S.sampleTime=S.sample=S.refCount=S.retryWhen=S.retry=S.repeatWhen=S.repeat=S.reduce=S.raceWith=S.race=S.publishReplay=S.publishLast=S.publishBehavior=S.publish=S.pluck=S.partition=S.pairwise=S.onErrorResumeNext=S.observeOn=S.multicast=S.min=S.mergeWith=S.mergeScan=S.mergeMapTo=S.mergeMap=S.flatMap=void 0;S.zipWith=S.zipAll=S.zip=S.withLatestFrom=S.windowWhen=S.windowToggle=S.windowTime=S.windowCount=S.window=S.toArray=S.timestamp=S.timeoutWith=S.timeout=void 0;var RZ=tm();Object.defineProperty(S,"audit",{enumerable:!0,get:function(){return RZ.audit}});var NZ=sT();Object.defineProperty(S,"auditTime",{enumerable:!0,get:function(){return NZ.auditTime}});var DZ=oT();Object.defineProperty(S,"buffer",{enumerable:!0,get:function(){return DZ.buffer}});var xZ=uT();Object.defineProperty(S,"bufferCount",{enumerable:!0,get:function(){return xZ.bufferCount}});var kZ=lT();Object.defineProperty(S,"bufferTime",{enumerable:!0,get:function(){return kZ.bufferTime}});var MZ=hT();Object.defineProperty(S,"bufferToggle",{enumerable:!0,get:function(){return MZ.bufferToggle}});var qZ=dT();Object.defineProperty(S,"bufferWhen",{enumerable:!0,get:function(){return qZ.bufferWhen}});var FZ=fT();Object.defineProperty(S,"catchError",{enumerable:!0,get:function(){return FZ.catchError}});var VZ=gT();Object.defineProperty(S,"combineAll",{enumerable:!0,get:function(){return VZ.combineAll}});var LZ=dm();Object.defineProperty(S,"combineLatestAll",{enumerable:!0,get:function(){return LZ.combineLatestAll}});var jZ=_T();Object.defineProperty(S,"combineLatest",{enumerable:!0,get:function(){return jZ.combineLatest}});var UZ=yT();Object.defineProperty(S,"combineLatestWith",{enumerable:!0,get:function(){return UZ.combineLatestWith}});var BZ=bT();Object.defineProperty(S,"concat",{enumerable:!0,get:function(){return BZ.concat}});var WZ=jl();Object.defineProperty(S,"concatAll",{enumerable:!0,get:function(){return WZ.concatAll}});var zZ=mm();Object.defineProperty(S,"concatMap",{enumerable:!0,get:function(){return zZ.concatMap}});var KZ=vT();Object.defineProperty(S,"concatMapTo",{enumerable:!0,get:function(){return KZ.concatMapTo}});var GZ=wT();Object.defineProperty(S,"concatWith",{enumerable:!0,get:function(){return GZ.concatWith}});var QZ=Wl();Object.defineProperty(S,"connect",{enumerable:!0,get:function(){return QZ.connect}});var $Z=ET();Object.defineProperty(S,"count",{enumerable:!0,get:function(){return $Z.count}});var HZ=ST();Object.defineProperty(S,"debounce",{enumerable:!0,get:function(){return HZ.debounce}});var YZ=TT();Object.defineProperty(S,"debounceTime",{enumerable:!0,get:function(){return YZ.debounceTime}});var JZ=Oa();Object.defineProperty(S,"defaultIfEmpty",{enumerable:!0,get:function(){return JZ.defaultIfEmpty}});var XZ=IT();Object.defineProperty(S,"delay",{enumerable:!0,get:function(){return XZ.delay}});var ZZ=Om();Object.defineProperty(S,"delayWhen",{enumerable:!0,get:function(){return ZZ.delayWhen}});var eee=AT();Object.defineProperty(S,"dematerialize",{enumerable:!0,get:function(){return eee.dematerialize}});var tee=PT();Object.defineProperty(S,"distinct",{enumerable:!0,get:function(){return tee.distinct}});var ree=km();Object.defineProperty(S,"distinctUntilChanged",{enumerable:!0,get:function(){return ree.distinctUntilChanged}});var nee=CT();Object.defineProperty(S,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return nee.distinctUntilKeyChanged}});var iee=OT();Object.defineProperty(S,"elementAt",{enumerable:!0,get:function(){return iee.elementAt}});var see=RT();Object.defineProperty(S,"endWith",{enumerable:!0,get:function(){return see.endWith}});var oee=NT();Object.defineProperty(S,"every",{enumerable:!0,get:function(){return oee.every}});var aee=DT();Object.defineProperty(S,"exhaust",{enumerable:!0,get:function(){return aee.exhaust}});var uee=Bm();Object.defineProperty(S,"exhaustAll",{enumerable:!0,get:function(){return uee.exhaustAll}});var lee=jm();Object.defineProperty(S,"exhaustMap",{enumerable:!0,get:function(){return lee.exhaustMap}});var cee=xT();Object.defineProperty(S,"expand",{enumerable:!0,get:function(){return cee.expand}});var hee=bn();Object.defineProperty(S,"filter",{enumerable:!0,get:function(){return hee.filter}});var dee=kT();Object.defineProperty(S,"finalize",{enumerable:!0,get:function(){return dee.finalize}});var fee=Gm();Object.defineProperty(S,"find",{enumerable:!0,get:function(){return fee.find}});var pee=MT();Object.defineProperty(S,"findIndex",{enumerable:!0,get:function(){return pee.findIndex}});var mee=qT();Object.defineProperty(S,"first",{enumerable:!0,get:function(){return mee.first}});var gee=FT();Object.defineProperty(S,"groupBy",{enumerable:!0,get:function(){return gee.groupBy}});var _ee=Im();Object.defineProperty(S,"ignoreElements",{enumerable:!0,get:function(){return _ee.ignoreElements}});var yee=VT();Object.defineProperty(S,"isEmpty",{enumerable:!0,get:function(){return yee.isEmpty}});var vee=LT();Object.defineProperty(S,"last",{enumerable:!0,get:function(){return vee.last}});var bee=vn();Object.defineProperty(S,"map",{enumerable:!0,get:function(){return bee.map}});var wee=Pm();Object.defineProperty(S,"mapTo",{enumerable:!0,get:function(){return wee.mapTo}});var Eee=UT();Object.defineProperty(S,"materialize",{enumerable:!0,get:function(){return Eee.materialize}});var See=BT();Object.defineProperty(S,"max",{enumerable:!0,get:function(){return See.max}});var Tee=GT();Object.defineProperty(S,"merge",{enumerable:!0,get:function(){return Tee.merge}});var Iee=Ea();Object.defineProperty(S,"mergeAll",{enumerable:!0,get:function(){return Iee.mergeAll}});var Aee=WT();Object.defineProperty(S,"flatMap",{enumerable:!0,get:function(){return Aee.flatMap}});var Pee=Hr();Object.defineProperty(S,"mergeMap",{enumerable:!0,get:function(){return Pee.mergeMap}});var Cee=zT();Object.defineProperty(S,"mergeMapTo",{enumerable:!0,get:function(){return Cee.mergeMapTo}});var Oee=KT();Object.defineProperty(S,"mergeScan",{enumerable:!0,get:function(){return Oee.mergeScan}});var Ree=QT();Object.defineProperty(S,"mergeWith",{enumerable:!0,get:function(){return Ree.mergeWith}});var Nee=$T();Object.defineProperty(S,"min",{enumerable:!0,get:function(){return Nee.min}});var Dee=zl();Object.defineProperty(S,"multicast",{enumerable:!0,get:function(){return Dee.multicast}});var xee=va();Object.defineProperty(S,"observeOn",{enumerable:!0,get:function(){return xee.observeOn}});var kee=HT();Object.defineProperty(S,"onErrorResumeNext",{enumerable:!0,get:function(){return kee.onErrorResumeNext}});var Mee=YT();Object.defineProperty(S,"pairwise",{enumerable:!0,get:function(){return Mee.pairwise}});var qee=Sq();Object.defineProperty(S,"partition",{enumerable:!0,get:function(){return qee.partition}});var Fee=JT();Object.defineProperty(S,"pluck",{enumerable:!0,get:function(){return Fee.pluck}});var Vee=XT();Object.defineProperty(S,"publish",{enumerable:!0,get:function(){return Vee.publish}});var Lee=ZT();Object.defineProperty(S,"publishBehavior",{enumerable:!0,get:function(){return Lee.publishBehavior}});var jee=e0();Object.defineProperty(S,"publishLast",{enumerable:!0,get:function(){return jee.publishLast}});var Uee=t0();Object.defineProperty(S,"publishReplay",{enumerable:!0,get:function(){return Uee.publishReplay}});var Bee=Tq();Object.defineProperty(S,"race",{enumerable:!0,get:function(){return Bee.race}});var Wee=dg();Object.defineProperty(S,"raceWith",{enumerable:!0,get:function(){return Wee.raceWith}});var zee=Ns();Object.defineProperty(S,"reduce",{enumerable:!0,get:function(){return zee.reduce}});var Kee=r0();Object.defineProperty(S,"repeat",{enumerable:!0,get:function(){return Kee.repeat}});var Gee=n0();Object.defineProperty(S,"repeatWhen",{enumerable:!0,get:function(){return Gee.repeatWhen}});var Qee=i0();Object.defineProperty(S,"retry",{enumerable:!0,get:function(){return Qee.retry}});var $ee=s0();Object.defineProperty(S,"retryWhen",{enumerable:!0,get:function(){return $ee.retryWhen}});var Hee=Vf();Object.defineProperty(S,"refCount",{enumerable:!0,get:function(){return Hee.refCount}});var Yee=yg();Object.defineProperty(S,"sample",{enumerable:!0,get:function(){return Yee.sample}});var Jee=o0();Object.defineProperty(S,"sampleTime",{enumerable:!0,get:function(){return Jee.sampleTime}});var Xee=a0();Object.defineProperty(S,"scan",{enumerable:!0,get:function(){return Xee.scan}});var Zee=u0();Object.defineProperty(S,"sequenceEqual",{enumerable:!0,get:function(){return Zee.sequenceEqual}});var ete=Eg();Object.defineProperty(S,"share",{enumerable:!0,get:function(){return ete.share}});var tte=c0();Object.defineProperty(S,"shareReplay",{enumerable:!0,get:function(){return tte.shareReplay}});var rte=h0();Object.defineProperty(S,"single",{enumerable:!0,get:function(){return rte.single}});var nte=d0();Object.defineProperty(S,"skip",{enumerable:!0,get:function(){return nte.skip}});var ite=f0();Object.defineProperty(S,"skipLast",{enumerable:!0,get:function(){return ite.skipLast}});var ste=p0();Object.defineProperty(S,"skipUntil",{enumerable:!0,get:function(){return ste.skipUntil}});var ote=m0();Object.defineProperty(S,"skipWhile",{enumerable:!0,get:function(){return ote.skipWhile}});var ate=g0();Object.defineProperty(S,"startWith",{enumerable:!0,get:function(){return ate.startWith}});var ute=ba();Object.defineProperty(S,"subscribeOn",{enumerable:!0,get:function(){return ute.subscribeOn}});var lte=_0();Object.defineProperty(S,"switchAll",{enumerable:!0,get:function(){return lte.switchAll}});var cte=ka();Object.defineProperty(S,"switchMap",{enumerable:!0,get:function(){return cte.switchMap}});var hte=y0();Object.defineProperty(S,"switchMapTo",{enumerable:!0,get:function(){return hte.switchMapTo}});var dte=v0();Object.defineProperty(S,"switchScan",{enumerable:!0,get:function(){return dte.switchScan}});var fte=Ra();Object.defineProperty(S,"take",{enumerable:!0,get:function(){return fte.take}});var pte=Jm();Object.defineProperty(S,"takeLast",{enumerable:!0,get:function(){return pte.takeLast}});var mte=b0();Object.defineProperty(S,"takeUntil",{enumerable:!0,get:function(){return mte.takeUntil}});var gte=w0();Object.defineProperty(S,"takeWhile",{enumerable:!0,get:function(){return gte.takeWhile}});var _te=E0();Object.defineProperty(S,"tap",{enumerable:!0,get:function(){return _te.tap}});var yte=Vg();Object.defineProperty(S,"throttle",{enumerable:!0,get:function(){return yte.throttle}});var vte=S0();Object.defineProperty(S,"throttleTime",{enumerable:!0,get:function(){return vte.throttleTime}});var bte=Na();Object.defineProperty(S,"throwIfEmpty",{enumerable:!0,get:function(){return bte.throwIfEmpty}});var wte=T0();Object.defineProperty(S,"timeInterval",{enumerable:!0,get:function(){return wte.timeInterval}});var Ete=Ll();Object.defineProperty(S,"timeout",{enumerable:!0,get:function(){return Ete.timeout}});var Ste=I0();Object.defineProperty(S,"timeoutWith",{enumerable:!0,get:function(){return Ste.timeoutWith}});var Tte=A0();Object.defineProperty(S,"timestamp",{enumerable:!0,get:function(){return Tte.timestamp}});var Ite=lm();Object.defineProperty(S,"toArray",{enumerable:!0,get:function(){return Ite.toArray}});var Ate=P0();Object.defineProperty(S,"window",{enumerable:!0,get:function(){return Ate.window}});var Pte=C0();Object.defineProperty(S,"windowCount",{enumerable:!0,get:function(){return Pte.windowCount}});var Cte=O0();Object.defineProperty(S,"windowTime",{enumerable:!0,get:function(){return Cte.windowTime}});var Ote=N0();Object.defineProperty(S,"windowToggle",{enumerable:!0,get:function(){return Ote.windowToggle}});var Rte=D0();Object.defineProperty(S,"windowWhen",{enumerable:!0,get:function(){return Rte.windowWhen}});var Nte=x0();Object.defineProperty(S,"withLatestFrom",{enumerable:!0,get:function(){return Nte.withLatestFrom}});var Dte=M0();Object.defineProperty(S,"zip",{enumerable:!0,get:function(){return Dte.zip}});var xte=k0();Object.defineProperty(S,"zipAll",{enumerable:!0,get:function(){return xte.zipAll}});var kte=q0();Object.defineProperty(S,"zipWith",{enumerable:!0,get:function(){return kte.zipWith}})});var W0=E(B0=>{"use strict";Object.defineProperty(B0,"__esModule",{value:!0});var Mte=function(){function r(e,t){this.nativeEvent=e,this.dragData=t}return r}();B0.DropEvent=Mte});var Pq=E(z0=>{"use strict";Object.defineProperty(z0,"__esModule",{value:!0});var Aq=F0(),qte=Iq(),bt=(Me(),Za(tt)),Fte=W0(),Vte=Gg(),Kl=j0(),Lte=function(){function r(e,t,n,i){this.el=e,this.renderer=t,this.ng2DragDropService=n,this.zone=i,this.onDragEnter=new bt.EventEmitter,this.onDragOver=new bt.EventEmitter,this.onDragLeave=new bt.EventEmitter,this.onDrop=new bt.EventEmitter,this.dragOverClass="drag-over-border",this.dragHintClass="drag-hint-border",this.dropScope="default",this._dropEnabled=!0,this._isDragActive=!1,this._isServiceActive=!1}return Object.defineProperty(r.prototype,"dropEnabled",{get:function(){return this._dropEnabled},set:function(e){this._dropEnabled=e,this._dropEnabled===!0?this.subscribeService():this.unsubscribeService()},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){this.dropEnabled===!0&&this.subscribeService()},r.prototype.ngOnDestroy=function(){this.unsubscribeService(),this.unbindDragListeners()},r.prototype.dragEnter=function(e){e.preventDefault(),e.stopPropagation(),this.onDragEnter.emit(e)},r.prototype.dragOver=function(e,t){t&&(Kl.DomHelper.addClass(this.el,this.dragOverClass),e.preventDefault(),this.onDragOver.emit(e))},r.prototype.dragLeave=function(e){Kl.DomHelper.removeClass(this.el,this.dragOverClass),e.preventDefault(),this.onDragLeave.emit(e)},r.prototype.drop=function(e){var t=this;this.allowDrop().subscribe(function(n){n&&t._isDragActive&&(Kl.DomHelper.removeClass(t.el,t.dragOverClass),e.preventDefault(),e.stopPropagation(),t.ng2DragDropService.onDragEnd.next(),t.onDrop.emit(new Fte.DropEvent(e,t.ng2DragDropService.dragData)),t.ng2DragDropService.dragData=null,t.ng2DragDropService.scope=null)})},r.prototype.allowDrop=function(){var e=this,t=!1;if(typeof this.dropScope=="string")typeof this.ng2DragDropService.scope=="string"?t=this.ng2DragDropService.scope===this.dropScope:this.ng2DragDropService.scope instanceof Array&&(t=this.ng2DragDropService.scope.indexOf(this.dropScope)>-1);else if(this.dropScope instanceof Array)typeof this.ng2DragDropService.scope=="string"?t=this.dropScope.indexOf(this.ng2DragDropService.scope)>-1:this.ng2DragDropService.scope instanceof Array&&(t=this.dropScope.filter(function(n){return e.ng2DragDropService.scope.indexOf(n)!==-1}).length>0);else if(typeof this.dropScope=="function"&&(t=this.dropScope(this.ng2DragDropService.dragData),t instanceof Aq.Observable))return t.pipe(qte.map(function(n){return n&&e.dropEnabled}));return Aq.of(t&&this.dropEnabled)},r.prototype.subscribeService=function(){var e=this;this._isServiceActive!==!0&&(this._isServiceActive=!0,this.dragStartSubscription=this.ng2DragDropService.onDragStart.subscribe(function(){e._isDragActive=!0,e.allowDrop().subscribe(function(t){t&&e._isDragActive&&(Kl.DomHelper.addClass(e.el,e.dragHintClass),e.zone.runOutsideAngular(function(){e.unbindDragEnterListener=e.renderer.listen(e.el.nativeElement,"dragenter",function(n){e.dragEnter(n)}),e.unbindDragOverListener=e.renderer.listen(e.el.nativeElement,"dragover",function(n){e.dragOver(n,t)}),e.unbindDragLeaveListener=e.renderer.listen(e.el.nativeElement,"dragleave",function(n){e.dragLeave(n)})}))})}),this.dragEndSubscription=this.ng2DragDropService.onDragEnd.subscribe(function(){e._isDragActive=!1,Kl.DomHelper.removeClass(e.el,e.dragHintClass),e.unbindDragListeners()}))},r.prototype.unsubscribeService=function(){this._isServiceActive=!1,this.dragStartSubscription&&this.dragStartSubscription.unsubscribe(),this.dragEndSubscription&&this.dragEndSubscription.unsubscribe()},r.prototype.unbindDragListeners=function(){this.unbindDragEnterListener&&this.unbindDragEnterListener(),this.unbindDragOverListener&&this.unbindDragOverListener(),this.unbindDragLeaveListener&&this.unbindDragLeaveListener()},r.decorators=[{type:bt.Directive,args:[{selector:"[droppable]"}]}],r.ctorParameters=function(){return[{type:bt.ElementRef},{type:bt.Renderer2},{type:Vte.NgDragDropService},{type:bt.NgZone}]},r.propDecorators={onDragEnter:[{type:bt.Output}],onDragOver:[{type:bt.Output}],onDragLeave:[{type:bt.Output}],onDrop:[{type:bt.Output}],dragOverClass:[{type:bt.Input}],dragHintClass:[{type:bt.Input}],dropScope:[{type:bt.Input}],dropEnabled:[{type:bt.Input}],drop:[{type:bt.HostListener,args:["drop",["$event"]]}]},r}();z0.Droppable=Lte});var Rq=E(K0=>{"use strict";Object.defineProperty(K0,"__esModule",{value:!0});var jte=(Me(),Za(tt)),Cq=wq(),Oq=Pq(),Ute=Gg(),Bte=function(){function r(){}return r.forRoot=function(){return{ngModule:r,providers:[Ute.NgDragDropService]}},r.decorators=[{type:jte.NgModule,args:[{imports:[],declarations:[Cq.Draggable,Oq.Droppable],exports:[Cq.Draggable,Oq.Droppable]}]}],r}();K0.NgDragDropModule=Bte});var Nq=E($g=>{"use strict";Object.defineProperty($g,"__esModule",{value:!0});var Wte=Rq();$g.NgDragDropModule=Wte.NgDragDropModule;var zte=W0();$g.DropEvent=zte.DropEvent});Me();Me();Me();Me();Me();function WA(r){return new ye(3e3,!1)}function hF(){return new ye(3100,!1)}function dF(){return new ye(3101,!1)}function fF(r){return new ye(3001,!1)}function pF(r){return new ye(3003,!1)}function mF(r){return new ye(3004,!1)}function gF(r,e){return new ye(3005,!1)}function _F(){return new ye(3006,!1)}function yF(){return new ye(3007,!1)}function vF(r,e){return new ye(3008,!1)}function bF(r){return new ye(3002,!1)}function wF(r,e,t,n,i){return new ye(3010,!1)}function EF(){return new ye(3011,!1)}function SF(){return new ye(3012,!1)}function TF(){return new ye(3200,!1)}function IF(){return new ye(3202,!1)}function AF(){return new ye(3013,!1)}function PF(r){return new ye(3014,!1)}function CF(r){return new ye(3015,!1)}function OF(r){return new ye(3016,!1)}function RF(r,e){return new ye(3404,!1)}function NF(r){return new ye(3502,!1)}function DF(r){return new ye(3503,!1)}function xF(){return new ye(3300,!1)}function kF(r){return new ye(3504,!1)}function MF(r){return new ye(3301,!1)}function qF(r,e){return new ye(3302,!1)}function FF(r){return new ye(3303,!1)}function VF(r,e){return new ye(3400,!1)}function LF(r){return new ye(3401,!1)}function jF(r){return new ye(3402,!1)}function UF(r,e){return new ye(3505,!1)}function Rn(r){switch(r.length){case 0:return new Vs;case 1:return r[0];default:return new A_(r)}}function nP(r,e,t=new Map,n=new Map){let i=[],s=[],o=-1,a=null;if(e.forEach(u=>{let c=u.get("offset"),h=c==o,f=h&&a||new Map;u.forEach((m,_)=>{let v=_,w=m;if(_!=="offset")switch(v=r.normalizePropertyName(v,i),w){case pc:w=t.get(_);break;case Ir:w=n.get(_);break;default:w=r.normalizeStyleValue(_,v,w,i);break}f.set(v,w)}),h||s.push(f),a=f,o=c}),i.length)throw NF(i);return s}function ty(r,e,t,n){switch(e){case"start":r.onStart(()=>n(t&&x_(t,"start",r)));break;case"done":r.onDone(()=>n(t&&x_(t,"done",r)));break;case"destroy":r.onDestroy(()=>n(t&&x_(t,"destroy",r)));break}}function x_(r,e,t){let n=t.totalTime,i=!!t.disabled,s=ry(r.element,r.triggerName,r.fromState,r.toState,e||r.phaseName,n??r.totalTime,i),o=r._data;return o!=null&&(s._data=o),s}function ry(r,e,t,n,i="",s=0,o){return{element:r,triggerName:e,fromState:t,toState:n,phaseName:i,totalTime:s,disabled:!!o}}function Kt(r,e,t){let n=r.get(e);return n||r.set(e,n=t),n}function zA(r){let e=r.indexOf(":"),t=r.substring(1,e),n=r.slice(e+1);return[t,n]}var BF=typeof document>"u"?null:document.documentElement;function ny(r){let e=r.parentNode||r.host||null;return e===BF?null:e}function WF(r){return r.substring(1,6)=="ebkit"}var Mi=null,KA=!1;function zF(r){Mi||(Mi=KF()||{},KA=Mi.style?"WebkitAppearance"in Mi.style:!1);let e=!0;return Mi.style&&!WF(r)&&(e=r in Mi.style,!e&&KA&&(e="Webkit"+r.charAt(0).toUpperCase()+r.slice(1)in Mi.style)),e}function KF(){return typeof document<"u"?document.body:null}function iP(r,e){for(;e;){if(e===r)return!0;e=ny(e)}return!1}function sP(r,e,t){if(t)return Array.from(r.querySelectorAll(e));let n=r.querySelector(e);return n?[n]:[]}var iy=(()=>{class r{validateStyleProperty(t){return zF(t)}matchesElement(t,n){return!1}containsElement(t,n){return iP(t,n)}getParentElement(t){return ny(t)}query(t,n,i){return sP(t,n,i)}computeStyle(t,n,i){return i||""}animate(t,n,i,s,o,a=[],u){return new Vs(i,s)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275prov=Tr({token:r,factory:r.\u0275fac})}}return r})(),Vi=class{static{this.NOOP=new iy}},Li=class{};var GF=1e3,oP="{{",QF="}}",aP="ng-enter",L_="ng-leave",Lc="ng-trigger",zc=".ng-trigger",GA="ng-animating",j_=".ng-animating";function tn(r){if(typeof r=="number")return r;let e=r.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:U_(parseFloat(e[1]),e[2])}function U_(r,e){switch(e){case"s":return r*GF;default:return r}}function Kc(r,e,t){return r.hasOwnProperty("duration")?r:$F(r,e,t)}function $F(r,e,t){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,i,s=0,o="";if(typeof r=="string"){let a=r.match(n);if(a===null)return e.push(WA(r)),{duration:0,delay:0,easing:""};i=U_(parseFloat(a[1]),a[2]);let u=a[3];u!=null&&(s=U_(parseFloat(u),a[4]));let c=a[5];c&&(o=c)}else i=r;if(!t){let a=!1,u=e.length;i<0&&(e.push(hF()),a=!0),s<0&&(e.push(dF()),a=!0),a&&e.splice(u,0,WA(r))}return{duration:i,delay:s,easing:o}}function HF(r){return r.length?r[0]instanceof Map?r:r.map(e=>new Map(Object.entries(e))):[]}function Cr(r,e,t){e.forEach((n,i)=>{let s=sy(i);t&&!t.has(i)&&t.set(i,r.style[s]),r.style[s]=n})}function Fi(r,e){e.forEach((t,n)=>{let i=sy(n);r.style[i]=""})}function ou(r){return Array.isArray(r)?r.length==1?r[0]:pA(r):r}function YF(r,e,t){let n=e.params||{},i=uP(r);i.length&&i.forEach(s=>{n.hasOwnProperty(s)||t.push(fF(s))})}var B_=new RegExp(`${oP}\\s*(.+?)\\s*${QF}`,"g");function uP(r){let e=[];if(typeof r=="string"){let t;for(;t=B_.exec(r);)e.push(t[1]);B_.lastIndex=0}return e}function uu(r,e,t){let n=`${r}`,i=n.replace(B_,(s,o)=>{let a=e[o];return a==null&&(t.push(pF(o)),a=""),a.toString()});return i==n?r:i}var JF=/-+([a-z0-9])/g;function sy(r){return r.replace(JF,(...e)=>e[1].toUpperCase())}function XF(r,e){return r===0||e===0}function ZF(r,e,t){if(t.size&&e.length){let n=e[0],i=[];if(t.forEach((s,o)=>{n.has(o)||i.push(o),n.set(o,s)}),i.length)for(let s=1;s<e.length;s++){let o=e[s];i.forEach(a=>o.set(a,oy(r,a)))}}return e}function zt(r,e,t){switch(e.type){case me.Trigger:return r.visitTrigger(e,t);case me.State:return r.visitState(e,t);case me.Transition:return r.visitTransition(e,t);case me.Sequence:return r.visitSequence(e,t);case me.Group:return r.visitGroup(e,t);case me.Animate:return r.visitAnimate(e,t);case me.Keyframes:return r.visitKeyframes(e,t);case me.Style:return r.visitStyle(e,t);case me.Reference:return r.visitReference(e,t);case me.AnimateChild:return r.visitAnimateChild(e,t);case me.AnimateRef:return r.visitAnimateRef(e,t);case me.Query:return r.visitQuery(e,t);case me.Stagger:return r.visitStagger(e,t);default:throw mF(e.type)}}function oy(r,e){return window.getComputedStyle(r)[e]}var eV=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Gc=class extends Li{normalizePropertyName(e,t){return sy(e)}normalizeStyleValue(e,t,n,i){let s="",o=n.toString().trim();if(eV.has(t)&&n!==0&&n!=="0")if(typeof n=="number")s="px";else{let a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&i.push(gF(e,n))}return o+s}};var Qc="*";function tV(r,e){let t=[];return typeof r=="string"?r.split(/\s*,\s*/).forEach(n=>rV(n,t,e)):t.push(r),t}function rV(r,e,t){if(r[0]==":"){let u=nV(r,t);if(typeof u=="function"){e.push(u);return}r=u}let n=r.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(CF(r)),e;let i=n[1],s=n[2],o=n[3];e.push(QA(i,o));let a=i==Qc&&o==Qc;s[0]=="<"&&!a&&e.push(QA(o,i))}function nV(r,e){switch(r){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(OF(r)),"* => *"}}var jc=new Set(["true","1"]),Uc=new Set(["false","0"]);function QA(r,e){let t=jc.has(r)||Uc.has(r),n=jc.has(e)||Uc.has(e);return(i,s)=>{let o=r==Qc||r==i,a=e==Qc||e==s;return!o&&t&&typeof i=="boolean"&&(o=i?jc.has(r):Uc.has(r)),!a&&n&&typeof s=="boolean"&&(a=s?jc.has(e):Uc.has(e)),o&&a}}var lP=":self",iV=new RegExp(`s*${lP}s*,?`,"g");function cP(r,e,t,n){return new W_(r).build(e,t,n)}var $A="",W_=class{constructor(e){this._driver=e}build(e,t,n){let i=new z_(t);return this._resetContextStyleTimingState(i),zt(this,ou(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector=$A,e.collectedStyles=new Map,e.collectedStyles.set($A,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,i=t.depCount=0,s=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(_F()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==me.State){let u=a,c=u.name;c.toString().split(/\s*,\s*/).forEach(h=>{u.name=h,s.push(this.visitState(u,t))}),u.name=c}else if(a.type==me.Transition){let u=this.visitTransition(a,t);n+=u.queryCount,i+=u.depCount,o.push(u)}else t.errors.push(yF())}),{type:me.Trigger,name:e.name,states:s,transitions:o,queryCount:n,depCount:i,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(n.containsDynamicStyles){let s=new Set,o=i||{};n.styles.forEach(a=>{a instanceof Map&&a.forEach(u=>{uP(u).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&t.errors.push(vF(e.name,[...s.values()]))}return{type:me.State,name:e.name,style:n,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=zt(this,ou(e.animation),t),i=tV(e.expr,t.errors);return{type:me.Transition,matchers:i,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:qi(e.options)}}visitSequence(e,t){return{type:me.Sequence,steps:e.steps.map(n=>zt(this,n,t)),options:qi(e.options)}}visitGroup(e,t){let n=t.currentTime,i=0,s=e.steps.map(o=>{t.currentTime=n;let a=zt(this,o,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:me.Group,steps:s,options:qi(e.options)}}visitAnimate(e,t){let n=uV(e.timings,t.errors);t.currentAnimateTimings=n;let i,s=e.styles?e.styles:I_({});if(s.type==me.Keyframes)i=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};n.easing&&(c.easing=n.easing),o=I_(c)}t.currentTime+=n.duration+n.delay;let u=this.visitStyle(o,t);u.isEmptyStep=a,i=u}return t.currentAnimateTimings=null,{type:me.Animate,timings:n,style:i,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of i)typeof a=="string"?a===Ir?n.push(a):t.errors.push(bF(a)):n.push(new Map(Object.entries(a)));let s=!1,o=null;return n.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s)){for(let u of a.values())if(u.toString().indexOf(oP)>=0){s=!0;break}}}),{type:me.Style,styles:n,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,i=t.currentTime,s=t.currentTime;n&&s>0&&(s-=n.duration+n.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,u)=>{let c=t.collectedStyles.get(t.currentQuerySelector),h=c.get(u),f=!0;h&&(s!=i&&s>=h.startTime&&i<=h.endTime&&(t.errors.push(wF(u,h.startTime,h.endTime,s,i)),f=!1),s=h.startTime),f&&c.set(u,{startTime:s,endTime:i}),t.options&&YF(a,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:me.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(EF()),n;let i=1,s=0,o=[],a=!1,u=!1,c=0,h=e.steps.map(M=>{let V=this._makeStyleAst(M,t),j=V.offset!=null?V.offset:aV(V.styles),G=0;return j!=null&&(s++,G=V.offset=j),u=u||G<0||G>1,a=a||G<c,c=G,o.push(G),V});u&&t.errors.push(SF()),a&&t.errors.push(TF());let f=e.steps.length,m=0;s>0&&s<f?t.errors.push(IF()):s==0&&(m=i/(f-1));let _=f-1,v=t.currentTime,w=t.currentAnimateTimings,A=w.duration;return h.forEach((M,V)=>{let j=m>0?V==_?1:m*V:o[V],G=j*A;t.currentTime=v+w.delay+G,w.duration=G,this._validateStyleAst(M,t),M.offset=j,n.styles.push(M)}),n}visitReference(e,t){return{type:me.Reference,animation:zt(this,ou(e.animation),t),options:qi(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:me.AnimateChild,options:qi(e.options)}}visitAnimateRef(e,t){return{type:me.AnimateRef,animation:this.visitReference(e.animation,t),options:qi(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;let[s,o]=sV(e.selector);t.currentQuerySelector=n.length?n+" "+s:s,Kt(t.collectedStyles,t.currentQuerySelector,new Map);let a=zt(this,ou(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:me.Query,selector:s,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:qi(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(AF());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Kc(e.timings,t.errors,!0);return{type:me.Stagger,animation:zt(this,ou(e.animation),t),timings:n,options:null}}};function sV(r){let e=!!r.split(/\s*,\s*/).find(t=>t==lP);return e&&(r=r.replace(iV,"")),r=r.replace(/@\*/g,zc).replace(/@\w+/g,t=>zc+"-"+t.slice(1)).replace(/:animating/g,j_),[r,e]}function oV(r){return r?Sr({},r):null}var z_=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function aV(r){if(typeof r=="string")return null;let e=null;if(Array.isArray(r))r.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(r instanceof Map&&r.has("offset")){let t=r;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function uV(r,e){if(r.hasOwnProperty("duration"))return r;if(typeof r=="number"){let s=Kc(r,e).duration;return k_(s,0,"")}let t=r;if(t.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=k_(0,0,"");return s.dynamic=!0,s.strValue=t,s}let i=Kc(t,e);return k_(i.duration,i.delay,i.easing)}function qi(r){return r?(r=Sr({},r),r.params&&(r.params=oV(r.params))):r={},r}function k_(r,e,t){return{duration:r,delay:e,easing:t}}function ay(r,e,t,n,i,s,o=null,a=!1){return{type:1,element:r,keyframes:e,preStyleProps:t,postStyleProps:n,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}var lu=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},lV=1,cV=":enter",hV=new RegExp(cV,"g"),dV=":leave",fV=new RegExp(dV,"g");function hP(r,e,t,n,i,s=new Map,o=new Map,a,u,c=[]){return new K_().buildKeyframes(r,e,t,n,i,s,o,a,u,c)}var K_=class{buildKeyframes(e,t,n,i,s,o,a,u,c,h=[]){c=c||new lu;let f=new G_(e,t,c,i,s,h,[]);f.options=u;let m=u.delay?tn(u.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,u),zt(this,n,f);let _=f.timelines.filter(v=>v.containsAnimation());if(_.length&&a.size){let v;for(let w=_.length-1;w>=0;w--){let A=_[w];if(A.element===t){v=A;break}}v&&!v.allowOnlyTimelineStyles()&&v.setStyles([a],null,f.errors,u)}return _.length?_.map(v=>v.buildKeyframes()):[ay(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let i=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,i,i.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let i of e){let s=i?.delay;if(s){let o=typeof s=="number"?s:tn(uu(s,i?.params??{},t.errors));n.delayNextStep(o)}}}_visitSubInstructions(e,t,n){let s=t.currentTimeline.currentTime,o=n.duration!=null?tn(n.duration):null,a=n.delay!=null?tn(n.delay):null;return o!==0&&e.forEach(u=>{let c=t.appendInstructionToTimeline(u,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),zt(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,i=t,s=e.options;if(s&&(s.params||s.delay)&&(i=t.createSubContext(s),i.transformIntoNewTimeline(),s.delay!=null)){i.previousNode.type==me.Style&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=$c);let o=tn(s.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>zt(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>n&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],i=t.currentTimeline.currentTime,s=e.options&&e.options.delay?tn(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);s&&a.delayNextStep(s),zt(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),n.push(a.currentTimeline)}),n.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,i=t.params?uu(n,t.params,t.errors):n;return Kc(i,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),i.snapshotCurrentStyles());let s=e.style;s.type==me.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(n.duration),this.visitStyle(s,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,i=t.currentAnimateTimings;!i&&n.hasCurrentStyleProperties()&&n.forwardFrame();let s=i&&i.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(s):n.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,i=t.currentTimeline.duration,s=n.duration,a=t.createSubContext().currentTimeline;a.easing=n.easing,e.styles.forEach(u=>{let c=u.offset||0;a.forwardTime(c*s),a.setStyles(u.styles,u.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(i+s),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,i=e.options||{},s=i.delay?tn(i.delay):0;s&&(t.previousNode.type===me.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=$c);let o=n,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=a.length;let u=null;a.forEach((c,h)=>{t.currentQueryIndex=h;let f=t.createSubContext(e.options,c);s&&f.delayNextStep(s),c===t.element&&(u=f.currentTimeline),zt(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,i=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1),u=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":u=a-u;break;case"full":u=n.currentStaggerTime;break}let h=t.currentTimeline;u&&h.delayNextStep(u);let f=h.currentTime;zt(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=i.currentTime-f+(i.startTime-n.currentTimeline.startTime)}},$c={},G_=class r{constructor(e,t,n,i,s,o,a,u){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=i,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=$c,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new Hc(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,i=this.options;n.duration!=null&&(i.duration=tn(n.duration)),n.delay!=null&&(i.delay=tn(n.delay));let s=n.params;if(s){let o=i.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=uu(s[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(i=>{n[i]=t[i]})}}return e}createSubContext(e=null,t,n){let i=t||this.element,s=new r(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,n||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=$c,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},s=new Q_(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(s),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,i,s,o){let a=[];if(i&&a.push(this.element),e.length>0){e=e.replace(hV,"."+this._enterClassName),e=e.replace(fV,"."+this._leaveClassName);let u=n!=1,c=this._driver.query(this.element,e,u);n!==0&&(c=n<0?c.slice(c.length+n,c.length):c.slice(0,n)),a.push(...c)}return!s&&a.length==0&&o.push(PF(t)),a}},Hc=class r{constructor(e,t,n,i){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=i,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new r(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=lV,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||Ir),this._currentKeyframe.set(t,Ir);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,i){t&&this._previousKeyframe.set("easing",t);let s=i&&i.params||{},o=pV(e,this._globalTimelineStyles);for(let[a,u]of o){let c=uu(u,s,n);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Ir),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let i=this._styleSummary.get(n);(!i||t.time>i.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,i=[];this._keyframes.forEach((a,u)=>{let c=new Map([...this._backFill,...a]);c.forEach((h,f)=>{h===pc?e.add(f):h===Ir&&t.add(f)}),n||c.set("offset",u/this.duration),i.push(c)});let s=[...e.values()],o=[...t.values()];if(n){let a=i[0],u=new Map(a);a.set("offset",0),u.set("offset",1),i=[a,u]}return ay(this.element,i,s,o,this.duration,this.startTime,this.easing,!1)}},Q_=class extends Hc{constructor(e,t,n,i,s,o,a=!1){super(e,t,o.delay),this.keyframes=n,this.preStyleProps=i,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){let s=[],o=n+t,a=t/o,u=new Map(e[0]);u.set("offset",0),s.push(u);let c=new Map(e[0]);c.set("offset",HA(a)),s.push(c);let h=e.length-1;for(let f=1;f<=h;f++){let m=new Map(e[f]),_=m.get("offset"),v=t+_*n;m.set("offset",HA(v/o)),s.push(m)}n=o,t=0,i="",e=s}return ay(this.element,e,this.preStyleProps,this.postStyleProps,n,t,i,!0)}};function HA(r,e=3){let t=Math.pow(10,e-1);return Math.round(r*t)/t}function pV(r,e){let t=new Map,n;return r.forEach(i=>{if(i==="*"){n??=e.keys();for(let s of n)t.set(s,Ir)}else for(let[s,o]of i)t.set(s,o)}),t}function YA(r,e,t,n,i,s,o,a,u,c,h,f,m){return{type:0,element:r,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:s,toState:n,toStyles:o,timelines:a,queriedElements:u,preStyleProps:c,postStyleProps:h,totalTime:f,errors:m}}var M_={},Yc=class{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,i){return mV(this.ast.matchers,e,t,n,i)}buildStyles(e,t,n){let i=this._stateStyles.get("*");return e!==void 0&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,n):new Map}build(e,t,n,i,s,o,a,u,c,h){let f=[],m=this.ast.options&&this.ast.options.params||M_,_=a&&a.params||M_,v=this.buildStyles(n,_,f),w=u&&u.params||M_,A=this.buildStyles(i,w,f),M=new Set,V=new Map,j=new Map,G=i==="void",te={params:dP(w,m),delay:this.ast.options?.delay},H=h?[]:hP(e,t,this.ast.animation,s,o,v,A,te,c,f),P=0;return H.forEach(b=>{P=Math.max(b.duration+b.delay,P)}),f.length?YA(t,this._triggerName,n,i,G,v,A,[],[],V,j,P,f):(H.forEach(b=>{let I=b.element,C=Kt(V,I,new Set);b.preStyleProps.forEach(N=>C.add(N));let O=Kt(j,I,new Set);b.postStyleProps.forEach(N=>O.add(N)),I!==t&&M.add(I)}),YA(t,this._triggerName,n,i,G,v,A,H,[...M.values()],V,j,P))}};function mV(r,e,t,n,i){return r.some(s=>s(e,t,n,i))}function dP(r,e){let t=Sr({},e);return Object.entries(r).forEach(([n,i])=>{i!=null&&(t[n]=i)}),t}var $_=class{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,i=dP(e,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((o,a)=>{o&&(o=uu(o,i,t));let u=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,u,o,t),n.set(a,o)})}),n}};function gV(r,e,t){return new H_(r,e,t)}var H_=class{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states=new Map,t.states.forEach(i=>{let s=i.options&&i.options.params||{};this.states.set(i.name,new $_(i.style,s,n))}),JA(this.states,"true","1"),JA(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new Yc(e,i,this.states))}),this.fallbackTransition=_V(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,i){return this.transitionFactories.find(o=>o.match(e,t,n,i))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function _V(r,e,t){let n=[(o,a)=>!0],i={type:me.Sequence,steps:[],options:null},s={type:me.Transition,animation:i,matchers:n,options:null,queryCount:0,depCount:0};return new Yc(r,s,e)}function JA(r,e,t){r.has(e)?r.has(t)||r.set(t,r.get(e)):r.has(t)&&r.set(e,r.get(t))}var yV=new lu,Y_=class{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let n=[],i=[],s=cP(this._driver,t,n,i);if(n.length)throw DF(n);i.length&&void 0,this._animations.set(e,s)}_buildPlayer(e,t,n){let i=e.element,s=nP(this._normalizer,e.keyframes,t,n);return this._driver.animate(i,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let i=[],s=this._animations.get(e),o,a=new Map;if(s?(o=hP(this._driver,t,s,aP,L_,new Map,new Map,n,yV,i),o.forEach(h=>{let f=Kt(a,h.element,new Map);h.postStyleProps.forEach(m=>f.set(m,null))})):(i.push(xF()),o=[]),i.length)throw kF(i);a.forEach((h,f)=>{h.forEach((m,_)=>{h.set(_,this._driver.computeStyle(f,_,Ir))})});let u=o.map(h=>{let f=a.get(h.element);return this._buildPlayer(h,new Map,f)}),c=Rn(u);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw MF(e);return t}listen(e,t,n,i){let s=ry(t,"","","");return ty(this._getPlayer(e),n,s,i),()=>{}}command(e,t,n,i){if(n=="register"){this.register(e,i[0]);return}if(n=="create"){let o=i[0]||{};this.create(e,t,o);return}let s=this._getPlayer(e);switch(n){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e);break}}},XA="ng-animate-queued",vV=".ng-animate-queued",q_="ng-animate-disabled",bV=".ng-animate-disabled",wV="ng-star-inserted",EV=".ng-star-inserted",SV=[],fP={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},TV={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},dr="__ng_removed",cu=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),i=n?e.value:e;if(this.value=AV(i),n){let s=e,{value:o}=s,a=GI(s,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(i=>{n[i]==null&&(n[i]=t[i])})}}},au="void",F_=new cu(au),J_=class{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,nr(t,this._hostClassName)}listen(e,t,n,i){if(!this._triggers.has(t))throw qF(n,t);if(n==null||n.length==0)throw FF(t);if(!PV(n))throw VF(n,t);let s=Kt(this._elementListeners,e,[]),o={name:t,phase:n,callback:i};s.push(o);let a=Kt(this._engine.statesByElement,e,new Map);return a.has(t)||(nr(e,Lc),nr(e,Lc+"-"+t),a.set(t,F_)),()=>{this._engine.afterFlush(()=>{let u=s.indexOf(o);u>=0&&s.splice(u,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw LF(e);return t}trigger(e,t,n,i=!0){let s=this._getTrigger(t),o=new hu(this.id,t,e),a=this._engine.statesByElement.get(e);a||(nr(e,Lc),nr(e,Lc+"-"+t),this._engine.statesByElement.set(e,a=new Map));let u=a.get(t),c=new cu(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),a.set(t,c),u||(u=F_),!(c.value===au)&&u.value===c.value){if(!RV(u.params,c.params)){let w=[],A=s.matchStyles(u.value,u.params,w),M=s.matchStyles(c.value,c.params,w);w.length?this._engine.reportError(w):this._engine.afterFlush(()=>{Fi(e,A),Cr(e,M)})}return}let m=Kt(this._engine.playersByElement,e,[]);m.forEach(w=>{w.namespaceId==this.id&&w.triggerName==t&&w.queued&&w.destroy()});let _=s.matchTransition(u.value,c.value,e,c.params),v=!1;if(!_){if(!i)return;_=s.fallbackTransition,v=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:_,fromState:u,toState:c,player:o,isFallbackTransition:v}),v||(nr(e,XA),o.onStart(()=>{Bs(e,XA)})),o.onDone(()=>{let w=this.players.indexOf(o);w>=0&&this.players.splice(w,1);let A=this._engine.playersByElement.get(e);if(A){let M=A.indexOf(o);M>=0&&A.splice(M,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,zc,!0);n.forEach(i=>{if(i[dr])return;let s=this._engine.fetchNamespacesByElement(i);s.size?s.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,n,i){let s=this._engine.statesByElement.get(e),o=new Map;if(s){let a=[];if(s.forEach((u,c)=>{if(o.set(c,u.value),this._triggers.has(c)){let h=this.trigger(e,c,au,i);h&&a.push(h)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),n&&Rn(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let i=new Set;t.forEach(s=>{let o=s.name;if(i.has(o))return;i.add(o);let u=this._triggers.get(o).fallbackTransition,c=n.get(o)||F_,h=new cu(au),f=new hu(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:u,fromState:c,toState:h,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(n.totalAnimations){let s=n.players.length?n.playersByQueriedElement.get(e):[];if(s&&s.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(n.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)n.markElementAsRemoved(this.id,e,!1,t);else{let s=e[dr];(!s||s===fP)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){nr(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let i=n.player;if(i.destroyed)return;let s=n.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==n.triggerName){let u=ry(s,n.triggerName,n.fromState.value,n.toState.value);u._data=e,ty(n.player,a.phase,u,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(n)}),this._queue=[],t.sort((n,i)=>{let s=n.transition.ast.depCount,o=i.transition.ast.depCount;return s==0||o==0?s-o:this._engine.driver.containsElement(n.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},X_=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n,i){this.bodyNode=e,this.driver=t,this._normalizer=n,this.scheduler=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,o)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new J_(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,i=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let u=i.get(a);if(u){let c=n.indexOf(u);n.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||n.unshift(e)}else n.push(e);return i.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let i=this._namespaceLookup[e];i&&i.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let i=this._namespaceList.indexOf(n);i>=0&&this._namespaceList.splice(i,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let i of n.values())if(i.namespaceId){let s=this._fetchNamespace(i.namespaceId);s&&t.add(s)}}return t}trigger(e,t,n,i){if(Bc(t)){let s=this._fetchNamespace(e);if(s)return s.trigger(t,n,i),!0}return!1}insertNode(e,t,n,i){if(!Bc(t))return;let s=t[dr];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,n)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),nr(e,q_)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Bs(e,q_))}removeNode(e,t,n){if(Bc(t)){this.scheduler?.notify();let i=e?this._fetchNamespace(e):null;i?i.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,i,s){this.collectedLeaveElements.push(t),t[dr]={namespaceId:e,setForRemoval:i,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,n,i,s){return Bc(t)?this._fetchNamespace(e).listen(t,n,i,s):()=>{}}_buildInstruction(e,t,n,i,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,i,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,zc,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,j_,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Rn(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[dr];if(t&&t.setForRemoval){if(e[dr]=fP,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(q_)&&this.markElementAsDisabled(e,!1),this.driver.query(e,bV,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,i)=>this._balanceNamespaceList(n,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let i=this.collectedEnterElements[n];nr(i,wV)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let i=0;i<n.length;i++)n[i]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let i=this.collectedLeaveElements[n];this.processLeaveNode(i)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?Rn(t).onDone(()=>{n.forEach(i=>i())}):n.forEach(i=>i())}}reportError(e){throw jF(e)}_flushAnimations(e,t){let n=new lu,i=[],s=new Map,o=[],a=new Map,u=new Map,c=new Map,h=new Set;this.disabledNodes.forEach($=>{h.add($);let X=this.driver.query($,vV,!0);for(let ee=0;ee<X.length;ee++)h.add(X[ee])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),_=tP(m,this.collectedEnterElements),v=new Map,w=0;_.forEach(($,X)=>{let ee=aP+w++;v.set(X,ee),$.forEach(de=>nr(de,ee))});let A=[],M=new Set,V=new Set;for(let $=0;$<this.collectedLeaveElements.length;$++){let X=this.collectedLeaveElements[$],ee=X[dr];ee&&ee.setForRemoval&&(A.push(X),M.add(X),ee.hasAnimation?this.driver.query(X,EV,!0).forEach(de=>M.add(de)):V.add(X))}let j=new Map,G=tP(m,Array.from(M));G.forEach(($,X)=>{let ee=L_+w++;j.set(X,ee),$.forEach(de=>nr(de,ee))}),e.push(()=>{_.forEach(($,X)=>{let ee=v.get(X);$.forEach(de=>Bs(de,ee))}),G.forEach(($,X)=>{let ee=j.get(X);$.forEach(de=>Bs(de,ee))}),A.forEach($=>{this.processLeaveNode($)})});let te=[],H=[];for(let $=this._namespaceList.length-1;$>=0;$--)this._namespaceList[$].drainQueuedTransitions(t).forEach(ee=>{let de=ee.player,Ye=ee.element;if(te.push(de),this.collectedEnterElements.length){let Qe=Ye[dr];if(Qe&&Qe.setForMove){if(Qe.previousTriggersValues&&Qe.previousTriggersValues.has(ee.triggerName)){let Jr=Qe.previousTriggersValues.get(ee.triggerName),qt=this.statesByElement.get(ee.element);if(qt&&qt.has(ee.triggerName)){let Xr=qt.get(ee.triggerName);Xr.value=Jr,qt.set(ee.triggerName,Xr)}}de.destroy();return}}let er=!f||!this.driver.containsElement(f,Ye),Ge=j.get(Ye),De=v.get(Ye),xe=this._buildInstruction(ee,n,De,Ge,er);if(xe.errors&&xe.errors.length){H.push(xe);return}if(er){de.onStart(()=>Fi(Ye,xe.fromStyles)),de.onDestroy(()=>Cr(Ye,xe.toStyles)),i.push(de);return}if(ee.isFallbackTransition){de.onStart(()=>Fi(Ye,xe.fromStyles)),de.onDestroy(()=>Cr(Ye,xe.toStyles)),i.push(de);return}let En=[];xe.timelines.forEach(Qe=>{Qe.stretchStartingKeyframe=!0,this.disabledNodes.has(Qe.element)||En.push(Qe)}),xe.timelines=En,n.append(Ye,xe.timelines);let Hg={instruction:xe,player:de,element:Ye};o.push(Hg),xe.queriedElements.forEach(Qe=>Kt(a,Qe,[]).push(de)),xe.preStyleProps.forEach((Qe,Jr)=>{if(Qe.size){let qt=u.get(Jr);qt||u.set(Jr,qt=new Set),Qe.forEach((Xr,Sn)=>qt.add(Sn))}}),xe.postStyleProps.forEach((Qe,Jr)=>{let qt=c.get(Jr);qt||c.set(Jr,qt=new Set),Qe.forEach((Xr,Sn)=>qt.add(Sn))})});if(H.length){let $=[];H.forEach(X=>{$.push(UF(X.triggerName,X.errors))}),te.forEach(X=>X.destroy()),this.reportError($)}let P=new Map,b=new Map;o.forEach($=>{let X=$.element;n.has(X)&&(b.set(X,X),this._beforeAnimationBuild($.player.namespaceId,$.instruction,P))}),i.forEach($=>{let X=$.element;this._getPreviousPlayers(X,!1,$.namespaceId,$.triggerName,null).forEach(de=>{Kt(P,X,[]).push(de),de.destroy()})});let I=A.filter($=>rP($,u,c)),C=new Map;eP(C,this.driver,V,c,Ir).forEach($=>{rP($,u,c)&&I.push($)});let N=new Map;_.forEach(($,X)=>{eP(N,this.driver,new Set($),u,pc)}),I.forEach($=>{let X=C.get($),ee=N.get($);C.set($,new Map([...X?.entries()??[],...ee?.entries()??[]]))});let T=[],Zt=[],wn={};o.forEach($=>{let{element:X,player:ee,instruction:de}=$;if(n.has(X)){if(h.has(X)){ee.onDestroy(()=>Cr(X,de.toStyles)),ee.disabled=!0,ee.overrideTotalTime(de.totalTime),i.push(ee);return}let Ye=wn;if(b.size>1){let Ge=X,De=[];for(;Ge=Ge.parentNode;){let xe=b.get(Ge);if(xe){Ye=xe;break}De.push(Ge)}De.forEach(xe=>b.set(xe,Ye))}let er=this._buildAnimation(ee.namespaceId,de,P,s,N,C);if(ee.setRealPlayer(er),Ye===wn)T.push(ee);else{let Ge=this.playersByElement.get(Ye);Ge&&Ge.length&&(ee.parentPlayer=Rn(Ge)),i.push(ee)}}else Fi(X,de.fromStyles),ee.onDestroy(()=>Cr(X,de.toStyles)),Zt.push(ee),h.has(X)&&i.push(ee)}),Zt.forEach($=>{let X=s.get($.element);if(X&&X.length){let ee=Rn(X);$.setRealPlayer(ee)}}),i.forEach($=>{$.parentPlayer?$.syncPlayerEvents($.parentPlayer):$.destroy()});for(let $=0;$<A.length;$++){let X=A[$],ee=X[dr];if(Bs(X,L_),ee&&ee.hasAnimation)continue;let de=[];if(a.size){let er=a.get(X);er&&er.length&&de.push(...er);let Ge=this.driver.query(X,j_,!0);for(let De=0;De<Ge.length;De++){let xe=a.get(Ge[De]);xe&&xe.length&&de.push(...xe)}}let Ye=de.filter(er=>!er.destroyed);Ye.length?CV(this,X,Ye):this.processLeaveNode(X)}return A.length=0,T.forEach($=>{this.players.push($),$.onDone(()=>{$.destroy();let X=this.players.indexOf($);this.players.splice(X,1)}),$.play()}),T}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,i,s){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let u=!s||s==au;a.forEach(c=>{c.queued||!u&&c.triggerName!=i||o.push(c)})}}return(n||i)&&(o=o.filter(a=>!(n&&n!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(e,t,n){let i=t.triggerName,s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:i;for(let u of t.timelines){let c=u.element,h=c!==s,f=Kt(n,c,[]);this._getPreviousPlayers(c,h,o,a,t.toState).forEach(_=>{let v=_.getRealPlayer();v.beforeDestroy&&v.beforeDestroy(),_.destroy(),f.push(_)})}Fi(s,t.fromStyles)}_buildAnimation(e,t,n,i,s,o){let a=t.triggerName,u=t.element,c=[],h=new Set,f=new Set,m=t.timelines.map(v=>{let w=v.element;h.add(w);let A=w[dr];if(A&&A.removedBeforeQueried)return new Vs(v.duration,v.delay);let M=w!==u,V=OV((n.get(w)||SV).map(P=>P.getRealPlayer())).filter(P=>{let b=P;return b.element?b.element===w:!1}),j=s.get(w),G=o.get(w),te=nP(this._normalizer,v.keyframes,j,G),H=this._buildPlayer(v,te,V);if(v.subTimeline&&i&&f.add(w),M){let P=new hu(e,a,w);P.setRealPlayer(H),c.push(P)}return H});c.forEach(v=>{Kt(this.playersByQueriedElement,v.element,[]).push(v),v.onDone(()=>IV(this.playersByQueriedElement,v.element,v))}),h.forEach(v=>nr(v,GA));let _=Rn(m);return _.onDestroy(()=>{h.forEach(v=>Bs(v,GA)),Cr(u,t.toStyles)}),f.forEach(v=>{Kt(i,v,[]).push(_)}),_}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new Vs(e.duration,e.delay)}},hu=class{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new Vs,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(i=>ty(e,n,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Kt(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function IV(r,e,t){let n=r.get(e);if(n){if(n.length){let i=n.indexOf(t);n.splice(i,1)}n.length==0&&r.delete(e)}return n}function AV(r){return r??null}function Bc(r){return r&&r.nodeType===1}function PV(r){return r=="start"||r=="done"}function ZA(r,e){let t=r.style.display;return r.style.display=e??"none",t}function eP(r,e,t,n,i){let s=[];t.forEach(u=>s.push(ZA(u)));let o=[];n.forEach((u,c)=>{let h=new Map;u.forEach(f=>{let m=e.computeStyle(c,f,i);h.set(f,m),(!m||m.length==0)&&(c[dr]=TV,o.push(c))}),r.set(c,h)});let a=0;return t.forEach(u=>ZA(u,s[a++])),o}function tP(r,e){let t=new Map;if(r.forEach(a=>t.set(a,[])),e.length==0)return t;let n=1,i=new Set(e),s=new Map;function o(a){if(!a)return n;let u=s.get(a);if(u)return u;let c=a.parentNode;return t.has(c)?u=c:i.has(c)?u=n:u=o(c),s.set(a,u),u}return e.forEach(a=>{let u=o(a);u!==n&&t.get(u).push(a)}),t}function nr(r,e){r.classList?.add(e)}function Bs(r,e){r.classList?.remove(e)}function CV(r,e,t){Rn(t).onDone(()=>r.processLeaveNode(e))}function OV(r){let e=[];return pP(r,e),e}function pP(r,e){for(let t=0;t<r.length;t++){let n=r[t];n instanceof A_?pP(n.players,e):e.push(n)}}function RV(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!=n.length)return!1;for(let i=0;i<t.length;i++){let s=t[i];if(!e.hasOwnProperty(s)||r[s]!==e[s])return!1}return!0}function rP(r,e,t){let n=t.get(r);if(!n)return!1;let i=e.get(r);return i?n.forEach(s=>i.add(s)):e.set(r,n),t.delete(r),!0}var Ws=class{constructor(e,t,n,i){this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(s,o)=>{},this._transitionEngine=new X_(e.body,t,n,i),this._timelineEngine=new Y_(e.body,t,n),this._transitionEngine.onRemovalComplete=(s,o)=>this.onRemovalComplete(s,o)}registerTrigger(e,t,n,i,s){let o=e+"-"+i,a=this._triggerCache[o];if(!a){let u=[],c=[],h=cP(this._driver,s,u,c);if(u.length)throw RF(i,u);c.length&&void 0,a=gV(i,h,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,i,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,i){this._transitionEngine.insertNode(e,t,n,i)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,i){if(n.charAt(0)=="@"){let[s,o]=zA(n),a=i;this._timelineEngine.command(s,t,o,a)}else this._transitionEngine.trigger(e,t,n,i)}listen(e,t,n,i,s){if(n.charAt(0)=="@"){let[o,a]=zA(n);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,n,i,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function NV(r,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=V_(e[0]),e.length>1&&(n=V_(e[e.length-1]))):e instanceof Map&&(t=V_(e)),t||n?new Z_(r,t,n):null}var Z_=class r{static{this.initialStylesByElement=new WeakMap}constructor(e,t,n){this._element=e,this._startStyles=t,this._endStyles=n,this._state=0;let i=r.initialStylesByElement.get(e);i||r.initialStylesByElement.set(e,i=new Map),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&Cr(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Cr(this._element,this._initialStyles),this._endStyles&&(Cr(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(r.initialStylesByElement.delete(this._element),this._startStyles&&(Fi(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Fi(this._element,this._endStyles),this._endStyles=null),Cr(this._element,this._initialStyles),this._state=3)}};function V_(r){let e=null;return r.forEach((t,n)=>{DV(n)&&(e=e||new Map,e.set(n,t))}),e}function DV(r){return r==="display"||r==="position"}var Jc=class{constructor(e,t,n,i){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){return e.animate(this._convertKeyframesToObject(t),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,i)=>{i!=="offset"&&e.set(i,this._finished?n:oy(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Xc=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return iP(e,t)}getParentElement(e){return ny(e)}query(e,t,n){return sP(e,t,n)}computeStyle(e,t,n){return oy(e,t)}animate(e,t,n,i,s,o=[]){let a=i==0?"both":"forwards",u={duration:n,delay:i,fill:a};s&&(u.easing=s);let c=new Map,h=o.filter(_=>_ instanceof Jc);XF(n,i)&&h.forEach(_=>{_.currentSnapshot.forEach((v,w)=>c.set(w,v))});let f=HF(t).map(_=>new Map(_));f=ZF(e,f,c);let m=NV(e,f);return new Jc(e,f,u,m)}};var Wc="@",mP="@.disabled",Zc=class{constructor(e,t,n,i){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=i,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,i=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,i){this.delegate.setAttribute(e,t,n,i)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,i){this.delegate.setStyle(e,t,n,i)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==Wc&&t==mP?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},ey=class extends Zc{constructor(e,t,n,i,s){super(t,n,i,s),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==Wc?t.charAt(1)=="."&&t==mP?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if(t.charAt(0)==Wc){let i=xV(e),s=t.slice(1),o="";return s.charAt(0)!=Wc&&([s,o]=kV(s)),this.engine.listen(this.namespaceId,i,s,o,a=>{let u=a._data||-1;this.factory.scheduleListenerCallback(u,n,a)})}return this.delegate.listen(e,t,n)}};function xV(r){switch(r){case"body":return document.body;case"document":return document;case"window":return window;default:return r}}function kV(r){let e=r.indexOf("."),t=r.substring(0,e),n=r.slice(e+1);return[t,n]}var eh=class{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(i,s)=>{let o=s?.parentNode(i);o&&s.removeChild(o,i)}}createRenderer(e,t){let n="",i=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let c=this._rendererCache,h=c.get(i);if(!h){let f=()=>c.delete(i);h=new Zc(n,i,this.engine,f),c.set(i,h)}return h}let s=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(s,o,e,c.name,c)};return t.data.animation.forEach(a),new ey(this,o,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let i=this._animationCallbacksBuffer;i.length==0&&queueMicrotask(()=>{this._zone.run(()=>{i.forEach(s=>{let[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),i.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var qV=(()=>{class r extends Ws{constructor(t,n,i){super(t,n,i,ZI(rA,{optional:!0}))}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(n){return new(n||r)(ue(aA),ue(Vi),ue(Li))}}static{this.\u0275prov=Tr({token:r,factory:r.\u0275fac})}}return r})();function FV(){return new Gc}function VV(r,e,t){return new eh(r,e,t)}var gP=[{provide:Li,useFactory:FV},{provide:Ws,useClass:qV},{provide:nA,useFactory:VV,deps:[cA,Ws,Fs]}],LV=[{provide:Vi,useFactory:()=>new Xc},{provide:T_,useValue:"BrowserAnimations"},...gP],nre=[{provide:Vi,useClass:iy},{provide:T_,useValue:"NoopAnimations"},...gP];function _P(){return iA("NgEagerAnimations"),[...LV]}Me();var yP=(()=>{class r{constructor(t){this.router=t}canActivate(t,n){return sessionStorage.getItem("isloggedin")?!0:(this.router.navigate(["/login"]),!1)}static{this.\u0275fac=function(n){return new(n||r)(ue(dA))}}static{this.\u0275prov=Tr({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();Me();var uy=[{path:"home",canActivate:[yP],children:[{path:"dashboard",loadComponent:()=>import("./chunk-H2MRGFNQ.js").then(r=>r.HomeComponent)},{path:"user",loadComponent:()=>import("./chunk-B7XZEF75.js").then(r=>r.UserComponent)},{path:"mobile-recharge",loadComponent:()=>import("./chunk-H4UGWBCU.js").then(r=>r.NewMobileRechargeComponent)},{path:"transaction-history",loadComponent:()=>import("./chunk-SXG3RNWC.js").then(r=>r.MobileRechargeComponent)},{path:"fast-tag",loadComponent:()=>import("./chunk-RIVEZHZX.js").then(r=>r.FastTagComponent)},{path:"dth-recharge",loadComponent:()=>import("./chunk-W3HQH5AM.js").then(r=>r.DTHRechargeComponent)},{path:"bus-booking",loadComponent:()=>import("./chunk-757CZK7J.js").then(r=>r.BusBookingComponent)},{path:"credit-card-payment",loadComponent:()=>import("./chunk-V7YUONZ3.js").then(r=>r.CreditCardPaymentComponent)},{path:"insurance-premium-payment",loadComponent:()=>import("./chunk-TZMO4SE4.js").then(r=>r.InsurancePremiumPaymentComponent)},{path:"direct-money-transfer",loadComponent:()=>import("./chunk-HMY5RWC5.js").then(r=>r.DirectMoneyTransferComponent)},{path:"aeps",loadComponent:()=>import("./chunk-GMMNTEJC.js").then(r=>r.AEPSComponent)},{path:"aadhar-pay",loadComponent:()=>import("./chunk-BTL32QNR.js").then(r=>r.AadharPayComponent)}]}],vP=(()=>{class r{static{this.routes=uy}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(uy),Pe]})}}return r})();var bP=[{path:"",children:[...vP.routes]}];Me();var ly=[{path:"authentication",children:[{path:"commingsoon",loadComponent:()=>import("./chunk-NUJLXTQ3.js").then(r=>r.CommingsoonComponent)},{path:"under-maintainance",loadComponent:()=>import("./chunk-B62ICYWQ.js").then(r=>r.UnderMaintainanceComponent)}]}],wP=(()=>{class r{static{this.routes=ly}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(ly),Pe]})}}return r})();Me();var EP=[{path:"authentication/create-password",children:[{path:"basic",loadComponent:()=>import("./chunk-SU4OHE75.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-6YB7J7YJ.js").then(r=>r.CoverComponent)}]}],SP=(()=>{class r{static{this.routes=EP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(EP),Pe]})}}return r})();Me();var TP=[{path:"authentication/lock-screen",children:[{path:"basic",loadComponent:()=>import("./chunk-MVEUY4WH.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-AYO2X3ZO.js").then(r=>r.CoverComponent)}]}],IP=(()=>{class r{static{this.routes=TP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(TP),Pe]})}}return r})();Me();var AP=[{path:"authentication/reset-password",children:[{path:"basic",loadComponent:()=>import("./chunk-3GXI7UNB.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-EDXNXHKV.js").then(r=>r.CoverComponent)}]}],PP=(()=>{class r{static{this.routes=AP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(AP),Pe]})}}return r})();Me();var CP=[{path:"authentication/sign-in",children:[{path:"basic",loadComponent:()=>import("./chunk-BI6UZ3OG.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-IMWXCZGN.js").then(r=>r.CoverComponent)}]}],OP=(()=>{class r{static{this.routes=CP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(CP),Pe]})}}return r})();Me();var RP=[{path:"authentication/sign-up",children:[{path:"basic",loadComponent:()=>import("./chunk-GZU6SQAH.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-ID6446HV.js").then(r=>r.CoverComponent)}]}],NP=(()=>{class r{static{this.routes=RP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(RP),Pe]})}}return r})();Me();var DP=[{path:"authentication/twostep-verification",children:[{path:"basic",loadComponent:()=>import("./chunk-Y55DBJCZ.js").then(r=>r.BasicComponent)},{path:"cover",loadComponent:()=>import("./chunk-M3N6JCHO.js").then(r=>r.CoverComponent)}]}],xP=(()=>{class r{static{this.routes=DP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(DP),Pe]})}}return r})();Me();var kP=[{path:"error",children:[{path:"error500",loadComponent:()=>import("./chunk-LHE2EIQP.js").then(r=>r.Error500Component)},{path:"error401",loadComponent:()=>import("./chunk-IPU4NODK.js").then(r=>r.Error401Component)},{path:"error404",loadComponent:()=>import("./chunk-EC5UZXO6.js").then(r=>r.Error404Component)}]}],MP=(()=>{class r{static{this.routes=kP}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=Be({type:r})}static{this.\u0275inj=Ue({imports:[Pe.forChild(kP),Pe]})}}return r})();var qP=[{path:"",children:[...wP.routes,...SP.routes,...IP.routes,...PP.routes,...OP.routes,...NP.routes,...xP.routes,...MP.routes]}];var FP=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-KA734MIN.js").then(r=>r.LoginComponent)},{path:"",component:_A,children:bP},{path:"",component:yA,children:qP},{path:"**",component:OA}];cF();function th(r,e){let t=re(r);if(isNaN(e))return Ft(r,NaN);if(!e)return t;let n=t.getDate(),i=Ft(r,t.getTime());i.setMonth(t.getMonth()+e+1,0);let s=i.getDate();return n>=s?i:(t.setFullYear(i.getFullYear(),i.getMonth(),n),t)}var jV={};function rh(){return jV}function nh(r,e){let t=rh(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=re(r),s=i.getDay(),o=(s<n?7:0)+s-n;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function ji(r){return nh(r,{weekStartsOn:1})}function VP(r){let e=re(r),t=e.getFullYear(),n=Ft(r,0);n.setFullYear(t+1,0,4),n.setHours(0,0,0,0);let i=ji(n),s=Ft(r,0);s.setFullYear(t,0,4),s.setHours(0,0,0,0);let o=ji(s);return e.getTime()>=i.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function cy(r){let e=re(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function LP(r,e){let t=ru(r),n=ru(e),i=+t-cy(t),s=+n-cy(n);return Math.round((i-s)/EA)}function jP(r){let e=VP(r),t=Ft(r,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),ji(t)}function UP(r,e){return gc(r,e*_c)}function BP(r,e){return gc(r,e*1e3)}function ih(r,e){let t=e*7;return mc(r,t)}function WP(r){let e;return r.forEach(function(t){let n=re(t);(e===void 0||e<n||isNaN(Number(n)))&&(e=n)}),e||new Date(NaN)}function KP(r,e){let t=re(r),n=re(e),i=zP(t,n),s=Math.abs(LP(t,n));t.setDate(t.getDate()-i*s);let o=+(zP(t,n)===-i),a=i*(s-o);return a===0?0:a}function zP(r,e){let t=r.getFullYear()-e.getFullYear()||r.getMonth()-e.getMonth()||r.getDate()-e.getDate()||r.getHours()-e.getHours()||r.getMinutes()-e.getMinutes()||r.getSeconds()-e.getSeconds()||r.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function sh(r){return e=>{let n=(r?Math[r]:Math.trunc)(e);return n===0?0:n}}function oh(r,e){return+re(r)-+re(e)}function GP(r,e,t){let n=oh(r,e)/_c;return sh(t?.roundingMethod)(n)}function QP(r,e,t){let n=oh(r,e)/1e3;return sh(t?.roundingMethod)(n)}function $P(r){let e=re(r);return e.setSeconds(0,0),e}function HP(r){let e=re(r);return e.setDate(1),e.setHours(0,0,0,0),e}function YP(r,e){let t=rh(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=re(r),s=i.getDay(),o=(s<n?-7:0)+6-(s-n);return i.setDate(i.getDate()+o),i.setHours(23,59,59,999),i}function JP(r){let e=re(r),t=+ji(e)-+jP(e);return Math.round(t/wA)+1}function XP(r){return re(r).getDate()}function ZP(r){return re(r).getDay()}function eC(r){let e=re(r),t=e.getFullYear(),n=e.getMonth(),i=Ft(r,0);return i.setFullYear(t,n+1,0),i.setHours(0,0,0,0),i.getDate()}function tC(r){return re(r).getHours()}function rC(r){return re(r).getMinutes()}function nC(r){return re(r).getMonth()}function iC(r){return re(r).getFullYear()}function hy(r){let e=re(r);return e.setMilliseconds(0),e}function sC(r,e){let t=hy(r),n=hy(e);return+t==+n}function oC(r,e){let t=re(r),n=t.getFullYear(),i=t.getDate(),s=Ft(r,0);s.setFullYear(n,e,15),s.setHours(0,0,0,0);let o=eC(s);return t.setMonth(e,Math.min(i,o)),t}function aC(r,e){let t=re(r);return t.setDate(e),t}function uC(r,e){let t=re(r);return t.setHours(e),t}function lC(r,e){let t=re(r);return t.setMinutes(e),t}function cC(r,e){let t=re(r);return isNaN(+t)?Ft(r,NaN):(t.setFullYear(e),t)}function hC(r,e){return th(r,-e)}function dC(r,e){return ih(r,-e)}function UV(r){return new Date(r).getTimezoneOffset()}function fC(){return{addDays:mc,addHours:SA,addMinutes:UP,addSeconds:BP,differenceInDays:KP,differenceInMinutes:GP,differenceInSeconds:QP,endOfDay:IA,endOfMonth:AA,endOfWeek:YP,getDay:ZP,getMonth:nC,isSameDay:TA,isSameMonth:PA,isSameSecond:sC,max:WP,setHours:uC,setMinutes:lC,startOfDay:ru,startOfMinute:$P,startOfMonth:HP,startOfWeek:nh,getHours:tC,getMinutes:rC,getTimezoneOffset:UV}}function pC(){return w_(w_({},fC()),{addWeeks:ih,addMonths:th,subDays:CA,subWeeks:dC,subMonths:hC,getISOWeek:JP,setDate:aC,setMonth:oC,setYear:cC,getDate:XP,getYear:iC})}var mC={production:!0,firebase:{apiKey:"***************************************",authDomain:"************************",projectId:"***********************************",storageBucket:"************************",messagingSenderId:"*********************",appId:"*******************************************",measurementId:"*********************"}};Me();Me();XI();JI();var gC="@firebase/database",_C="1.0.8";var Sv="";function Tv(r){Sv=r}var vy=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),rt(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:vc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var by=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return tr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var $C=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){let e=window[r];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vy(e)}}catch{}return new by},Bi=$C("localStorage"),wy=$C("sessionStorage");var Qs=new js("@firebase/database"),HC=function(){let r=1;return function(){return r++}}(),YC=function(r){let e=UA(r),t=new jA;t.update(e);let n=t.digest();return NA.encodeByteArray(n)},Mu=function(...r){let e="";for(let t=0;t<r.length;t++){let n=r[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=Mu.apply(null,n):typeof n=="object"?e+=rt(n):e+=n,e+=" "}return e},Wi=null,yC=!0,JC=function(r,e){U(!e||r===!0||r===!1,"Can't turn on custom loggers persistently."),r===!0?(Qs.logLevel=rr.VERBOSE,Wi=Qs.log.bind(Qs),e&&wy.set("logging_enabled",!0)):typeof r=="function"?Wi=r:(Wi=null,wy.remove("logging_enabled"))},dt=function(...r){if(yC===!0&&(yC=!1,Wi===null&&wy.get("logging_enabled")===!0&&JC(!0)),Wi){let e=Mu.apply(null,r);Wi(e)}},qu=function(r){return function(...e){dt(r,...e)}},Ey=function(...r){let e="FIREBASE INTERNAL ERROR: "+Mu(...r);Qs.error(e)},Nr=function(...r){let e=`FIREBASE FATAL ERROR: ${Mu(...r)}`;throw Qs.error(e),new Error(e)},Tt=function(...r){let e="FIREBASE WARNING: "+Mu(...r);Qs.warn(e)},KV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},kh=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},GV=function(r){if(Ar()||document.readyState==="complete")r();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},kn="[MIN_NAME]",rn="[MAX_NAME]",Ki=function(r,e){if(r===e)return 0;if(r===kn||e===rn)return-1;if(e===kn||r===rn)return 1;{let t=vC(r),n=vC(e);return t!==null?n!==null?t-n===0?r.length-e.length:t-n:-1:n!==null?1:r<e?-1:1}},QV=function(r,e){return r===e?0:r<e?-1:1},du=function(r,e){if(e&&r in e)return e[r];throw new Error("Missing required key ("+r+") in object: "+rt(e))},Iv=function(r){if(typeof r!="object"||r===null)return rt(r);let e=[];for(let n in r)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=rt(e[n]),t+=":",t+=Iv(r[e[n]]);return t+="}",t},XC=function(r,e){let t=r.length;if(t<=e)return[r];let n=[];for(let i=0;i<t;i+=e)i+e>t?n.push(r.substring(i,t)):n.push(r.substring(i,i+e));return n};function ft(r,e){for(let t in r)r.hasOwnProperty(t)&&e(t,r[t])}var ZC=function(r){U(!kh(r),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,i,s,o,a,u;r===0?(s=0,o=0,i=1/r===-1/0?1:0):(i=r<0,r=Math.abs(r),r>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(r)/Math.LN2),n),s=a+n,o=Math.round(r*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(r/Math.pow(2,1-n-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let h=c.join(""),f="";for(u=0;u<64;u+=8){let m=parseInt(h.substr(u,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},$V=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},HV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function YV(r,e){let t="Unknown Error";r==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":r==="permission_denied"?t="Client doesn't have permission to access the desired data.":r==="unavailable"&&(t="The service is unavailable");let n=new Error(r+" at "+e._path.toString()+": "+t);return n.code=r.toUpperCase(),n}var JV=new RegExp("^-?(0*)\\d{1,10}$"),XV=-2147483648,ZV=2147483647,vC=function(r){if(JV.test(r)){let e=Number(r);if(e>=XV&&e<=ZV)return e}return null},ro=function(r){try{r()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},eL=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gu=function(r,e){let t=setTimeout(r,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Sy=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Tt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Ty=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(dt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tt(e)}},_u=(()=>{class r{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}r.OWNER="owner";return r})(),uh="5",eO="v",tO="s",rO="r",nO="f",iO=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,sO="ls",oO="p",Iy="ac",aO="websocket",uO="long_polling";var lh=class{constructor(e,t,n,i,s=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Bi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Bi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function tL(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function lO(r,e,t){U(typeof e=="string","typeof type must == string"),U(typeof t=="object","typeof params must == object");let n;if(e===aO)n=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(e===uO)n=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);tL(r)&&(t.ns=r.namespace);let i=[];return ft(t,(s,o)=>{i.push(s+"="+o)}),n+i.join("&")}var Ay=class{constructor(){this.counters_={}}incrementCounter(e,t=1){tr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return xA(this.counters_)}};var dy={},fy={};function Av(r){let e=r.toString();return dy[e]||(dy[e]=new Ay),dy[e]}function rL(r,e){let t=r.toString();return fy[t]||(fy[t]=e()),fy[t]}var Py=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<n.length;++i)n[i]&&ro(()=>{this.onMessage_(n[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var bC="start",nL="close",iL="pLPCommand",sL="pRTLPCB",cO="id",hO="pw",dO="ser",oL="cb",aL="seg",uL="ts",lL="d",cL="dframe",fO=1870,pO=30,hL=fO-pO,dL=25e3,fL=3e4,wu=class r{constructor(e,t,n,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=qu(e),this.stats_=Av(t),this.urlFn=u=>(this.appCheckToken&&(u[Iy]=this.appCheckToken),lO(t,uO,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Py(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(fL)),GV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Cy((...s)=>{let[o,a,u,c,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===bC)this.id=a,this.password=u;else if(o===nL)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let n={};n[bC]="t",n[dO]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[oL]=this.scriptTagHolder.uniqueCallbackIdentifier),n[eO]=uh,this.transportSessionId&&(n[tO]=this.transportSessionId),this.lastSessionId&&(n[sO]=this.lastSessionId),this.applicationId&&(n[oO]=this.applicationId),this.appCheckToken&&(n[Iy]=this.appCheckToken),typeof location<"u"&&location.hostname&&iO.test(location.hostname)&&(n[rO]=nO);let i=this.urlFn(n);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){r.forceAllow_=!0}static forceDisallow(){r.forceDisallow_=!0}static isAvailable(){return Ar()?!1:r.forceAllow_?!0:!r.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!$V()&&!HV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=rt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=DA(t),i=XC(n,hL);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ar())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[cL]="t",n[cO]=e,n[hO]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=rt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Cy=class r{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ar())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=HC(),window[iL+this.uniqueCallbackIdentifier]=e,window[sL+this.uniqueCallbackIdentifier]=t,this.myIFrame=r.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){dt("frame writing exception"),a.stack&&dt(a.stack),dt(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||dt("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[cO]=this.myID,e[hO]=this.myPW,e[dO]=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+pO+n.length<=fO;){let o=this.pendingSegs.shift();n=n+"&"+aL+i+"="+o.seg+"&"+uL+i+"="+o.ts+"&"+lL+i+"="+o.d,i++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(dL)),s=()=>{clearTimeout(i),n()};this.addTag(e,s)}addTag(e,t){Ar()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let i=n.readyState;(!i||i==="loaded"||i==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{dt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var pL=16384,mL=45e3,ch=null;typeof MozWebSocket<"u"?ch=MozWebSocket:typeof WebSocket<"u"&&(ch=WebSocket);var Ks=(()=>{class r{constructor(t,n,i,s,o,a,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=qu(this.connId),this.stats_=Av(n),this.connURL=r.connectionURL_(n,a,u,s,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,i,s,o){let a={};return a[eO]=uh,!Ar()&&typeof location<"u"&&location.hostname&&iO.test(location.hostname)&&(a[rO]=nO),n&&(a[tO]=n),i&&(a[sO]=i),s&&(a[Iy]=s),o&&(a[oO]=o),lO(t,aO,a)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Bi.set("previous_websocket_failure",!0);try{let i;if(Ar()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${uh}/${Sv}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new ch(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){r.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&ch!==null&&!r.forceDisallow_}static previouslyFailed(){return Bi.isInMemoryStorage||Bi.get("previous_websocket_failure")===!0}markConnectionHealthy(){Bi.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let i=vc(n);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(U(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let n=rt(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=XC(n,pL);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(mL))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}r.responsesRequiredToBeHealthy=2,r.healthyTimeout=3e4;return r})(),mO=(()=>{class r{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[wu,Ks]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let n=Ks&&Ks.isAvailable(),i=n&&!Ks.previouslyFailed();if(t.webSocketOnly&&(n||Tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ks];else{let s=this.transports_=[];for(let o of r.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);r.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}r.globalTransportInitialized_=!1;return r})(),gL=6e4,_L=5e3,yL=10*1024,vL=100*1024,py="t",wC="d",bL="s",EC="r",wL="e",SC="o",TC="a",IC="n",AC="p",EL="h",Oy=class{constructor(e,t,n,i,s,o,a,u,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=qu("c:"+this.id+":"),this.transportManager_=new mO(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=gu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>vL?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>yL?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(py in e){let t=e[py];t===TC?this.upgradeIfSecondaryHealthy_():t===EC?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===SC&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=du("t",e),n=du("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:AC,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:TC,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:IC,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=du("t",e),n=du("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=du(py,e);if(wC in e){let n=e[wC];if(t===EL){let i=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===IC){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===bL?this.onConnectionShutdown_(n):t===EC?this.onReset_(n):t===wL?Ey("Server Error: "+n):t===SC?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ey("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),uh!==n&&Tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),gu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(gL))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(_L))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:AC,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Bi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var hh=class{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var dh=class{constructor(e){this.allowedEvents_=e,this.listeners_={},U(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!n||n===i[s].context)){i.splice(s,1);return}}validateEventType_(e){U(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var fh=class r extends dh{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!P_()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new r}getInitialEvent(e){return U(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var PC=32,CC=768,Ee=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function we(){return new Ee("")}function le(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function Mn(r){return r.pieces_.length-r.pieceNum_}function Ce(r){let e=r.pieceNum_;return e<r.pieces_.length&&e++,new Ee(r.pieces_,e)}function Pv(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function SL(r){let e="";for(let t=r.pieceNum_;t<r.pieces_.length;t++)r.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(r.pieces_[t])));return e||"/"}function Eu(r,e=0){return r.pieces_.slice(r.pieceNum_+e)}function gO(r){if(r.pieceNum_>=r.pieces_.length)return null;let e=[];for(let t=r.pieceNum_;t<r.pieces_.length-1;t++)e.push(r.pieces_[t]);return new Ee(e,0)}function Fe(r,e){let t=[];for(let n=r.pieceNum_;n<r.pieces_.length;n++)t.push(r.pieces_[n]);if(e instanceof Ee)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Ee(t,0)}function ce(r){return r.pieceNum_>=r.pieces_.length}function Rt(r,e){let t=le(r),n=le(e);if(t===null)return e;if(t===n)return Rt(Ce(r),Ce(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+r+")")}function TL(r,e){let t=Eu(r,0),n=Eu(e,0);for(let i=0;i<t.length&&i<n.length;i++){let s=Ki(t[i],n[i]);if(s!==0)return s}return t.length===n.length?0:t.length<n.length?-1:1}function Cv(r,e){if(Mn(r)!==Mn(e))return!1;for(let t=r.pieceNum_,n=e.pieceNum_;t<=r.pieces_.length;t++,n++)if(r.pieces_[t]!==e.pieces_[n])return!1;return!0}function ir(r,e){let t=r.pieceNum_,n=e.pieceNum_;if(Mn(r)>Mn(e))return!1;for(;t<r.pieces_.length;){if(r.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var Ry=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Eu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=su(this.parts_[n]);_O(this)}};function IL(r,e){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(e),r.byteLength_+=su(e),_O(r)}function AL(r){let e=r.parts_.pop();r.byteLength_-=su(e),r.parts_.length>0&&(r.byteLength_-=1)}function _O(r){if(r.byteLength_>CC)throw new Error(r.errorPrefix_+"has a key path longer than "+CC+" bytes ("+r.byteLength_+").");if(r.parts_.length>PC)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+PC+") or object contains a cycle "+Ui(r))}function Ui(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}var Ny=class r extends dh{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new r}getInitialEvent(e){return U(e==="visible","Unknown event type: "+e),[this.visible_]}};var fu=1e3,PL=60*5*1e3,OC=30*1e3,CL=1.3,OL=3e4,RL="server_kill",RC=3,Ov=(()=>{class r extends hh{constructor(t,n,i,s,o,a,u,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=r.nextPersistentConnectionId_++,this.log_=qu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fu,this.maxReconnectDelay_=PL,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ar())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ny.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&fh.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,i){let s=++this.requestNumber_,o={r:s,a:t,b:n};this.log_(rt(o)),U(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let n=new Ot,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?n.resolve(u):n.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(t,n,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),U(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),U(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:n,query:t,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(t){let n=t.query,i=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=n._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,h=u.s;r.warnOnListenWarnings_(c,n),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),h!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(h,c))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&tr(t,"w")){let i=Cn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();Tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||VA(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=OC)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=FA(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,i=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(t,n){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),U(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,n)}sendUnlisten_(t,n,i,s){this.log_("Unlisten on "+t+" for "+n);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:i})}onDisconnectMerge(t,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:i})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,i,s){let o={p:n,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,n,i,s){this.putInternal("p",t,n,i,s)}merge(t,n,i,s){this.putInternal("m",t,n,i,s)}putInternal(t,n,i,s,o){this.initConnection_();let a={p:n,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,i,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+rt(t));let n=t.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):Ey("Unrecognized action received from server: "+rt(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){U(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>OL&&(this.reconnectDelay_=fu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*CL)}this.onConnectStatus_(!1)}establishConnection_(){return q(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+r.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,i())},h=function(m){U(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(m)};this.realtime_={close:c,sendRequest:h};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?dt("getToken() completed but was canceled"):(dt("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=_&&_.token,u=new Oy(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,v=>{Tt(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(RL)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Tt(m),c())}}})}interrupt(t){dt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){dt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],bc(this.interruptReasons_)&&(this.reconnectDelay_=fu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let i;n?i=n.map(o=>Iv(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,n){let i=new Ee(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(n),o.delete(n),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,n){dt("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=RC&&(this.reconnectDelay_=OC,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){dt("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=RC&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";Ar()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+Sv.replace(/\./g,"-")]=1,P_()?t["framework.cordova"]=1:kA()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=fh.getInstance().currentlyOnline();return bc(this.interruptReasons_)&&t}}r.nextPersistentConnectionId_=0,r.nextConnectionId_=0;return r})(),he=class r{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new r(e,t)}};var $s=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new he(kn,e),i=new he(kn,t);return this.compare(n,i)!==0}minPost(){return he.MIN}};var ah,ph=class extends $s{static get __EMPTY_NODE(){return ah}static set __EMPTY_NODE(e){ah=e}compare(e,t){return Ki(e.name,t.name)}isDefinedOn(e){throw Ls("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return he.MIN}maxPost(){return new he(rn,ah)}makePost(e,t){return U(typeof e=="string","KeyIndex indexValue must always be a string."),new he(e,ah)}toString(){return".key"}},Rr=new ph;var Gs=class{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},fr=(()=>{class r{constructor(t,n,i,s,o){this.key=t,this.value=n,this.color=i??r.RED,this.left=s??sr.EMPTY_NODE,this.right=o??sr.EMPTY_NODE}copy(t,n,i,s,o){return new r(t??this.key,n??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,n,i),null):o===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,n,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return sr.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let i,s;if(i=this,n(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(t,i.key)===0){if(i.right.isEmpty())return sr.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return r.RED=!0,r.BLACK=!1,r})(),Dy=class{copy(e,t,n,i,s){return this}insert(e,t,n){return new fr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},sr=class r{constructor(e,t=r.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new r(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fr.BLACK,null,null))}remove(e){return new r(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fr.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(i=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Gs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Gs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Gs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Gs(this.root_,null,this.comparator_,!0,e)}};sr.EMPTY_NODE=new Dy;function NL(r,e){return Ki(r.name,e.name)}function Rv(r,e){return Ki(r,e)}var xy;function DL(r){xy=r}var yO=function(r){return typeof r=="number"?"number:"+ZC(r):"string:"+r},vO=function(r){if(r.isLeafNode()){let e=r.val();U(typeof e=="string"||typeof e=="number"||typeof e=="object"&&tr(e,".sv"),"Priority must be a string or number.")}else U(r===xy||r.isEmpty(),"priority of unexpected type.");U(r===xy||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var NC,Hs=(()=>{class r{constructor(t,n=r.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,U(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),vO(this.priorityNode_)}static set __childrenNodeConstructor(t){NC=t}static get __childrenNodeConstructor(){return NC}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new r(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:r.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ce(t)?this:le(t)===".priority"?this.priorityNode_:r.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:r.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let i=le(t);return i===null?n:n.isEmpty()&&i!==".priority"?this:(U(i!==".priority"||Mn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,r.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ce(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+yO(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=ZC(this.value_):t+=this.value_,this.lazyHash_=YC(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===r.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof r.__childrenNodeConstructor?-1:(U(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,i=typeof this.value_,s=r.VALUE_TYPE_ORDER.indexOf(n),o=r.VALUE_TYPE_ORDER.indexOf(i);return U(s>=0,"Unknown leaf type: "+n),U(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}r.VALUE_TYPE_ORDER=["object","boolean","number","string"];return r})(),bO,wO;function xL(r){bO=r}function kL(r){wO=r}var ky=class extends $s{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return s===0?Ki(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return he.MIN}maxPost(){return new he(rn,new Hs("[PRIORITY-POST]",wO))}makePost(e,t){let n=bO(e);return new he(t,new Hs("[PRIORITY-POST]",n))}toString(){return".priority"}},Re=new ky;var ML=Math.log(2),My=class{constructor(e){let t=s=>parseInt(Math.log(s)/ML,10),n=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=n(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},mh=function(r,e,t,n){r.sort(e);let i=function(u,c){let h=c-u,f,m;if(h===0)return null;if(h===1)return f=r[u],m=t?t(f):f,new fr(m,f.node,fr.BLACK,null,null);{let _=parseInt(h/2,10)+u,v=i(u,_),w=i(_+1,c);return f=r[_],m=t?t(f):f,new fr(m,f.node,fr.BLACK,v,w)}},s=function(u){let c=null,h=null,f=r.length,m=function(v,w){let A=f-v,M=f;f-=v;let V=i(A+1,M),j=r[A],G=t?t(j):j;_(new fr(G,j.node,w,null,V))},_=function(v){c?(c.left=v,c=v):(h=v,c=v)};for(let v=0;v<u.count;++v){let w=u.nextBitIsOne(),A=Math.pow(2,u.count-(v+1));w?m(A,fr.BLACK):(m(A,fr.BLACK),m(A,fr.RED))}return h},o=new My(r.length),a=s(o);return new sr(n||e,a)};var my,zs={},Ys=class r{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return U(zs&&Re,"ChildrenNode.ts has not been loaded"),my=my||new r({".priority":zs},{".priority":Re}),my}get(e){let t=Cn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof sr?t:null}hasIndex(e){return tr(this.indexSet_,e.toString())}addIndex(e,t){U(e!==Rr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],i=!1,s=t.getIterator(he.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),n.push(o),o=s.getNext();let a;i?a=mh(n,e.getCompare()):a=zs;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let h=Object.assign({},this.indexes_);return h[u]=a,new r(h,c)}addToIndexes(e,t){let n=iu(this.indexes_,(i,s)=>{let o=Cn(this.indexSet_,s);if(U(o,"Missing index implementation for "+s),i===zs)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(he.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),mh(a,o.getCompare())}else return zs;else{let a=t.get(e.name),u=i;return a&&(u=u.remove(new he(e.name,a))),u.insert(e,e.node)}});return new r(n,this.indexSet_)}removeFromIndexes(e,t){let n=iu(this.indexes_,i=>{if(i===zs)return i;{let s=t.get(e.name);return s?i.remove(new he(e.name,s)):i}});return new r(n,this.indexSet_)}};var pu,se=(()=>{class r{constructor(t,n,i){this.children_=t,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&vO(this.priorityNode_),this.children_.isEmpty()&&U(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return pu||(pu=new r(new sr(Rv),null,Ys.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||pu}updatePriority(t){return this.children_.isEmpty()?this:new r(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?pu:n}}getChild(t){let n=le(t);return n===null?this:this.getImmediateChild(n).getChild(Ce(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(U(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let i=new he(t,n),s,o;n.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?pu:this.priorityNode_;return new r(s,a,o)}}updateChild(t,n){let i=le(t);if(i===null)return n;{U(le(t)!==".priority"||Mn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Ce(t),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},i=0,s=0,o=!0;if(this.forEachChild(Re,(a,u)=>{n[a]=u.val(t),i++,o&&r.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let u in n)a[u]=n[u];return a}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+yO(this.getPriority().val())+":"),this.forEachChild(Re,(n,i)=>{let s=i.hash();s!==""&&(t+=":"+n+":"+s)}),this.lazyHash_=t===""?"":YC(t)}return this.lazyHash_}getPredecessorChildName(t,n,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new he(t,n));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new he(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new he(n,this.children_.get(n)):null}forEachChild(t,n){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,he.Wrap),o=s.peek();for(;o!=null&&n.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,he.Wrap),o=s.peek();for(;o!=null&&n.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Fu?-1:0}withIndex(t){if(t===Rr||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new r(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===Rr||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let i=this.getIterator(Re),s=n.getIterator(Re),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Rr?null:this.indexMap_.get(t.toString())}}return r.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,r})(),qy=class extends se{constructor(){super(new sr(Rv),se.EMPTY_NODE,Ys.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return se.EMPTY_NODE}isEmpty(){return!1}},Fu=new qy;Object.defineProperties(he,{MIN:{value:new he(kn,se.EMPTY_NODE)},MAX:{value:new he(rn,Fu)}});ph.__EMPTY_NODE=se.EMPTY_NODE;Hs.__childrenNodeConstructor=se;DL(Fu);kL(Fu);var qL=!0;function We(r,e=null){if(r===null)return se.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(e=r[".priority"]),U(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){let t=r;return new Hs(t,We(e))}if(!(r instanceof Array)&&qL){let t=[],n=!1;if(ft(r,(o,a)=>{if(o.substring(0,1)!=="."){let u=We(a);u.isEmpty()||(n=n||!u.getPriority().isEmpty(),t.push(new he(o,u)))}}),t.length===0)return se.EMPTY_NODE;let s=mh(t,NL,o=>o.name,Rv);if(n){let o=mh(t,Re.getCompare());return new se(s,We(e),new Ys({".priority":o},{".priority":Re}))}else return new se(s,We(e),Ys.Default)}else{let t=se.EMPTY_NODE;return ft(r,(n,i)=>{if(tr(r,n)&&n.substring(0,1)!=="."){let s=We(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(n,s))}}),t.updatePriority(We(e))}}xL(We);var Su=class extends $s{constructor(e){super(),this.indexPath_=e,U(!ce(e)&&le(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return s===0?Ki(e.name,t.name):s}makePost(e,t){let n=We(e),i=se.EMPTY_NODE.updateChild(this.indexPath_,n);return new he(t,i)}maxPost(){let e=se.EMPTY_NODE.updateChild(this.indexPath_,Fu);return new he(rn,e)}toString(){return Eu(this.indexPath_,0).join("/")}};var Fy=class extends $s{compare(e,t){let n=e.node.compareTo(t.node);return n===0?Ki(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return he.MIN}maxPost(){return he.MAX}makePost(e,t){let n=We(e);return new he(t,n)}toString(){return".value"}},Nv=new Fy;function EO(r){return{type:"value",snapshotNode:r}}function Js(r,e){return{type:"child_added",snapshotNode:e,childName:r}}function Tu(r,e){return{type:"child_removed",snapshotNode:e,childName:r}}function Iu(r,e,t){return{type:"child_changed",snapshotNode:e,childName:r,oldSnap:t}}function FL(r,e){return{type:"child_moved",snapshotNode:e,childName:r}}var Au=class{constructor(e){this.index_=e}updateChild(e,t,n,i,s,o){U(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Tu(t,a)):U(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Js(t,n)):o.trackChildChange(Iu(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(Re,(i,s)=>{t.hasChild(i)||n.trackChildChange(Tu(i,s))}),t.isLeafNode()||t.forEachChild(Re,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||n.trackChildChange(Iu(i,s,o))}else n.trackChildChange(Js(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?se.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var gh=class r{constructor(e){this.indexedFilter_=new Au(e.getIndex()),this.index_=e.getIndex(),this.startPost_=r.getStartPost_(e),this.endPost_=r.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,s,o){return this.matches(new he(t,n))||(n=se.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=se.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(se.EMPTY_NODE);let s=this;return t.forEachChild(Re,(o,a)=>{s.matches(new he(o,a))||(i=i.updateImmediateChild(o,se.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Vy=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{let n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new gh(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,s,o){return this.rangedFilter_.matches(new he(t,n))||(n=se.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,o):this.fullLimitUpdateChild_(e,t,n,s,o)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=se.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=se.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(se.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,se.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,s){let o;if(this.reverse_){let f=this.index_.getCompare();o=(m,_)=>f(_,m)}else o=this.index_.getCompare();let a=e;U(a.numChildren()===this.limit_,"");let u=new he(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(t)){let f=a.getImmediateChild(t),m=i.getChildAfterChild(this.index_,c,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);let _=m==null?1:o(m,u);if(h&&!n.isEmpty()&&_>=0)return s?.trackChildChange(Iu(t,n,f)),a.updateImmediateChild(t,n);{s?.trackChildChange(Tu(t,f));let w=a.updateImmediateChild(t,se.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(Js(m.name,m.node)),w.updateImmediateChild(m.name,m.node)):w}}else return n.isEmpty()?e:h&&o(c,u)>=0?(s!=null&&(s.trackChildChange(Tu(c.name,c.node)),s.trackChildChange(Js(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,se.EMPTY_NODE)):e}};var Pu=class r{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Re}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return U(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return U(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:kn}hasEnd(){return this.endSet_}getIndexEndValue(){return U(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return U(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:rn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return U(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Re}copy(){let e=new r;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function VL(r){return r.loadsAllData()?new Au(r.getIndex()):r.hasLimit()?new Vy(r):new gh(r)}function LL(r,e){let t=r.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function jL(r,e){let t=r.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Ly(r,e,t){let n=r.copy();return n.startSet_=!0,e===void 0&&(e=null),n.indexStartValue_=e,t!=null?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n}function UL(r,e,t){let n;return r.index_===Rr||t?n=Ly(r,e,t):n=Ly(r,e,rn),n.startAfterSet_=!0,n}function jy(r,e,t){let n=r.copy();return n.endSet_=!0,e===void 0&&(e=null),n.indexEndValue_=e,t!==void 0?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n}function BL(r,e,t){let n;return r.index_===Rr||t?n=jy(r,e,t):n=jy(r,e,kn),n.endBeforeSet_=!0,n}function Mh(r,e){let t=r.copy();return t.index_=e,t}function DC(r){let e={};if(r.isDefault())return e;let t;if(r.index_===Re?t="$priority":r.index_===Nv?t="$value":r.index_===Rr?t="$key":(U(r.index_ instanceof Su,"Unrecognized index type!"),t=r.index_.toString()),e.orderBy=rt(t),r.startSet_){let n=r.startAfterSet_?"startAfter":"startAt";e[n]=rt(r.indexStartValue_),r.startNameSet_&&(e[n]+=","+rt(r.indexStartName_))}if(r.endSet_){let n=r.endBeforeSet_?"endBefore":"endAt";e[n]=rt(r.indexEndValue_),r.endNameSet_&&(e[n]+=","+rt(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?e.limitToFirst=r.limit_:e.limitToLast=r.limit_),e}function xC(r){let e={};if(r.startSet_&&(e.sp=r.indexStartValue_,r.startNameSet_&&(e.sn=r.indexStartName_),e.sin=!r.startAfterSet_),r.endSet_&&(e.ep=r.indexEndValue_,r.endNameSet_&&(e.en=r.indexEndName_),e.ein=!r.endBeforeSet_),r.limitSet_){e.l=r.limit_;let t=r.viewFrom_;t===""&&(r.isViewFromLeft()?t="l":t="r"),e.vf=t}return r.index_!==Re&&(e.i=r.index_.toString()),e}var Uy=class r extends hh{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=qu("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(U(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=r.getListenId_(e,n),a={};this.listens_[o]=a;let u=DC(e._queryParams);this.restRequest_(s+".json",u,(c,h)=>{let f=h;if(c===404&&(f=null,c=null),c===null&&this.onDataUpdate_(s,f,!1,n),Cn(this.listens_,o)===a){let m;c?c===401?m="permission_denied":m="rest_error:"+c:m="ok",i(m,null)}})}unlisten(e,t){let n=r.getListenId_(e,t);delete this.listens_[n]}get(e){let t=DC(e._queryParams),n=e._path.toString(),i=new Ot;return this.restRequest_(n+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(n,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+LA(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=vc(a.responseText)}catch{Tt("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,u)}else a.status!==401&&a.status!==404&&Tt("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}};var By=class{constructor(){this.rootNode_=se.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function _h(){return{value:null,children:new Map}}function no(r,e,t){if(ce(e))r.value=t,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(e,t);else{let n=le(e);r.children.has(n)||r.children.set(n,_h());let i=r.children.get(n);e=Ce(e),no(i,e,t)}}function Wy(r,e){if(ce(e))return r.value=null,r.children.clear(),!0;if(r.value!==null){if(r.value.isLeafNode())return!1;{let t=r.value;return r.value=null,t.forEachChild(Re,(n,i)=>{no(r,new Ee(n),i)}),Wy(r,e)}}else if(r.children.size>0){let t=le(e);return e=Ce(e),r.children.has(t)&&Wy(r.children.get(t),e)&&r.children.delete(t),r.children.size===0}else return!0}function zy(r,e,t){r.value!==null?t(e,r.value):WL(r,(n,i)=>{let s=new Ee(e.toString()+"/"+n);zy(i,s,t)})}function WL(r,e){r.children.forEach((t,n)=>{e(n,t)})}var Ky=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ft(this.last_,(n,i)=>{t[n]=t[n]-i}),this.last_=e,t}};var kC=10*1e3,zL=30*1e3,KL=5*60*1e3,Gy=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ky(e);let n=kC+(zL-kC)*Math.random();gu(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ft(e,(i,s)=>{s>0&&tr(this.statsToReport_,i)&&(t[i]=s,n=!0)}),n&&this.server_.reportStats(t),gu(this.reportStats_.bind(this),Math.floor(Math.random()*2*KL))}};var Or=function(r){return r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",r}(Or||{});function Dv(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function xv(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function kv(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}var Qy=class r{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Or.ACK_USER_WRITE,this.source=Dv()}operationForChild(e){if(ce(this.path)){if(this.affectedTree.value!=null)return U(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Ee(e));return new r(we(),t,this.revert)}}else return U(le(this.path)===e,"operationForChild called for unrelated child."),new r(Ce(this.path),this.affectedTree,this.revert)}};var yh=class r{constructor(e,t){this.source=e,this.path=t,this.type=Or.LISTEN_COMPLETE}operationForChild(e){return ce(this.path)?new r(this.source,we()):new r(this.source,Ce(this.path))}};var Xs=class r{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Or.OVERWRITE}operationForChild(e){return ce(this.path)?new r(this.source,we(),this.snap.getImmediateChild(e)):new r(this.source,Ce(this.path),this.snap)}};var Cu=class r{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Or.MERGE}operationForChild(e){if(ce(this.path)){let t=this.children.subtree(new Ee(e));return t.isEmpty()?null:t.value?new Xs(this.source,we(),t.value):new r(this.source,we(),t)}else return U(le(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new r(this.source,Ce(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Dr=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ce(e))return this.isFullyInitialized()&&!this.filtered_;let t=le(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var $y=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function GL(r,e,t,n){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&r.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(FL(o.childName,o.snapshotNode))}),mu(r,i,"child_removed",e,n,t),mu(r,i,"child_added",e,n,t),mu(r,i,"child_moved",s,n,t),mu(r,i,"child_changed",e,n,t),mu(r,i,"value",e,n,t),i}function mu(r,e,t,n,i,s){let o=n.filter(a=>a.type===t);o.sort((a,u)=>$L(r,a,u)),o.forEach(a=>{let u=QL(r,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,r.query_))})})}function QL(r,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,r.index_)),e}function $L(r,e,t){if(e.childName==null||t.childName==null)throw Ls("Should only compare child_ events.");let n=new he(e.childName,e.snapshotNode),i=new he(t.childName,t.snapshotNode);return r.index_.compare(n,i)}function qh(r,e){return{eventCache:r,serverCache:e}}function yu(r,e,t,n){return qh(new Dr(e,t,n),r.serverCache)}function SO(r,e,t,n){return qh(r.eventCache,new Dr(e,t,n))}function vh(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function zi(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}var gy,HL=()=>(gy||(gy=new sr(QV)),gy),Nt=class r{constructor(e,t=HL()){this.value=e,this.children=t}static fromObject(e){let t=new r(null);return ft(e,(n,i)=>{t=t.set(new Ee(n),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:we(),value:this.value};if(ce(e))return null;{let n=le(e),i=this.children.get(n);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Ce(e),t);return s!=null?{path:Fe(new Ee(n),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ce(e))return this;{let t=le(e),n=this.children.get(t);return n!==null?n.subtree(Ce(e)):new r(null)}}set(e,t){if(ce(e))return new r(t,this.children);{let n=le(e),s=(this.children.get(n)||new r(null)).set(Ce(e),t),o=this.children.insert(n,s);return new r(this.value,o)}}remove(e){if(ce(e))return this.children.isEmpty()?new r(null):new r(null,this.children);{let t=le(e),n=this.children.get(t);if(n){let i=n.remove(Ce(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new r(null):new r(this.value,s)}else return this}}get(e){if(ce(e))return this.value;{let t=le(e),n=this.children.get(t);return n?n.get(Ce(e)):null}}setTree(e,t){if(ce(e))return t;{let n=le(e),s=(this.children.get(n)||new r(null)).setTree(Ce(e),t),o;return s.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,s),new r(this.value,o)}}fold(e){return this.fold_(we(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,s)=>{n[i]=s.fold_(Fe(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,we(),t)}findOnPath_(e,t,n){let i=this.value?n(t,this.value):!1;if(i)return i;if(ce(e))return null;{let s=le(e),o=this.children.get(s);return o?o.findOnPath_(Ce(e),Fe(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,we(),t)}foreachOnPath_(e,t,n){if(ce(e))return this;{this.value&&n(t,this.value);let i=le(e),s=this.children.get(i);return s?s.foreachOnPath_(Ce(e),Fe(t,i),n):new r(null)}}foreach(e){this.foreach_(we(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(Fe(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var pr=class r{constructor(e){this.writeTree_=e}static empty(){return new r(new Nt(null))}};function vu(r,e,t){if(ce(e))return new pr(new Nt(t));{let n=r.writeTree_.findRootMostValueAndPath(e);if(n!=null){let i=n.path,s=n.value,o=Rt(i,e);return s=s.updateChild(o,t),new pr(r.writeTree_.set(i,s))}else{let i=new Nt(t),s=r.writeTree_.setTree(e,i);return new pr(s)}}}function Hy(r,e,t){let n=r;return ft(t,(i,s)=>{n=vu(n,Fe(e,i),s)}),n}function MC(r,e){if(ce(e))return pr.empty();{let t=r.writeTree_.setTree(e,new Nt(null));return new pr(t)}}function Yy(r,e){return Gi(r,e)!=null}function Gi(r,e){let t=r.writeTree_.findRootMostValueAndPath(e);return t!=null?r.writeTree_.get(t.path).getChild(Rt(t.path,e)):null}function qC(r){let e=[],t=r.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Re,(n,i)=>{e.push(new he(n,i))}):r.writeTree_.children.inorderTraversal((n,i)=>{i.value!=null&&e.push(new he(n,i.value))}),e}function Dn(r,e){if(ce(e))return r;{let t=Gi(r,e);return t!=null?new pr(new Nt(t)):new pr(r.writeTree_.subtree(e))}}function Jy(r){return r.writeTree_.isEmpty()}function Zs(r,e){return TO(we(),r.writeTree_,e)}function TO(r,e,t){if(e.value!=null)return t.updateChild(r,e.value);{let n=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(U(s.value!==null,"Priority writes must always be leaf nodes"),n=s.value):t=TO(Fe(r,i),s,t)}),!t.getChild(r).isEmpty()&&n!==null&&(t=t.updateChild(Fe(r,".priority"),n)),t}}function Fh(r,e){return CO(e,r)}function YL(r,e,t,n,i){U(n>r.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),r.allWrites.push({path:e,snap:t,writeId:n,visible:i}),i&&(r.visibleWrites=vu(r.visibleWrites,e,t)),r.lastWriteId=n}function JL(r,e,t,n){U(n>r.lastWriteId,"Stacking an older merge on top of newer ones"),r.allWrites.push({path:e,children:t,writeId:n,visible:!0}),r.visibleWrites=Hy(r.visibleWrites,e,t),r.lastWriteId=n}function XL(r,e){for(let t=0;t<r.allWrites.length;t++){let n=r.allWrites[t];if(n.writeId===e)return n}return null}function ZL(r,e){let t=r.allWrites.findIndex(a=>a.writeId===e);U(t>=0,"removeWrite called with nonexistent writeId.");let n=r.allWrites[t];r.allWrites.splice(t,1);let i=n.visible,s=!1,o=r.allWrites.length-1;for(;i&&o>=0;){let a=r.allWrites[o];a.visible&&(o>=t&&ej(a,n.path)?i=!1:ir(n.path,a.path)&&(s=!0)),o--}if(i){if(s)return tj(r),!0;if(n.snap)r.visibleWrites=MC(r.visibleWrites,n.path);else{let a=n.children;ft(a,u=>{r.visibleWrites=MC(r.visibleWrites,Fe(n.path,u))})}return!0}else return!1}function ej(r,e){if(r.snap)return ir(r.path,e);for(let t in r.children)if(r.children.hasOwnProperty(t)&&ir(Fe(r.path,t),e))return!0;return!1}function tj(r){r.visibleWrites=IO(r.allWrites,rj,we()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function rj(r){return r.visible}function IO(r,e,t){let n=pr.empty();for(let i=0;i<r.length;++i){let s=r[i];if(e(s)){let o=s.path,a;if(s.snap)ir(t,o)?(a=Rt(t,o),n=vu(n,a,s.snap)):ir(o,t)&&(a=Rt(o,t),n=vu(n,we(),s.snap.getChild(a)));else if(s.children){if(ir(t,o))a=Rt(t,o),n=Hy(n,a,s.children);else if(ir(o,t))if(a=Rt(o,t),ce(a))n=Hy(n,we(),s.children);else{let u=Cn(s.children,le(a));if(u){let c=u.getChild(Ce(a));n=vu(n,we(),c)}}}else throw Ls("WriteRecord should have .snap or .children")}}return n}function AO(r,e,t,n,i){if(!n&&!i){let s=Gi(r.visibleWrites,e);if(s!=null)return s;{let o=Dn(r.visibleWrites,e);if(Jy(o))return t;if(t==null&&!Yy(o,we()))return null;{let a=t||se.EMPTY_NODE;return Zs(o,a)}}}else{let s=Dn(r.visibleWrites,e);if(!i&&Jy(s))return t;if(!i&&t==null&&!Yy(s,we()))return null;{let o=function(c){return(c.visible||i)&&(!n||!~n.indexOf(c.writeId))&&(ir(c.path,e)||ir(e,c.path))},a=IO(r.allWrites,o,e),u=t||se.EMPTY_NODE;return Zs(a,u)}}}function nj(r,e,t){let n=se.EMPTY_NODE,i=Gi(r.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Re,(s,o)=>{n=n.updateImmediateChild(s,o)}),n;if(t){let s=Dn(r.visibleWrites,e);return t.forEachChild(Re,(o,a)=>{let u=Zs(Dn(s,new Ee(o)),a);n=n.updateImmediateChild(o,u)}),qC(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{let s=Dn(r.visibleWrites,e);return qC(s).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function ij(r,e,t,n,i){U(n||i,"Either existingEventSnap or existingServerSnap must exist");let s=Fe(e,t);if(Yy(r.visibleWrites,s))return null;{let o=Dn(r.visibleWrites,s);return Jy(o)?i.getChild(t):Zs(o,i.getChild(t))}}function sj(r,e,t,n){let i=Fe(e,t),s=Gi(r.visibleWrites,i);if(s!=null)return s;if(n.isCompleteForChild(t)){let o=Dn(r.visibleWrites,i);return Zs(o,n.getNode().getImmediateChild(t))}else return null}function oj(r,e){return Gi(r.visibleWrites,e)}function aj(r,e,t,n,i,s,o){let a,u=Dn(r.visibleWrites,e),c=Gi(u,we());if(c!=null)a=c;else if(t!=null)a=Zs(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],f=o.getCompare(),m=s?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),_=m.getNext();for(;_&&h.length<i;)f(_,n)!==0&&h.push(_),_=m.getNext();return h}else return[]}function uj(){return{visibleWrites:pr.empty(),allWrites:[],lastWriteId:-1}}function bh(r,e,t,n){return AO(r.writeTree,r.treePath,e,t,n)}function Mv(r,e){return nj(r.writeTree,r.treePath,e)}function FC(r,e,t,n){return ij(r.writeTree,r.treePath,e,t,n)}function wh(r,e){return oj(r.writeTree,Fe(r.treePath,e))}function lj(r,e,t,n,i,s){return aj(r.writeTree,r.treePath,e,t,n,i,s)}function qv(r,e,t){return sj(r.writeTree,r.treePath,e,t)}function PO(r,e){return CO(Fe(r.treePath,e),r.writeTree)}function CO(r,e){return{treePath:r,writeTree:e}}var Xy=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;U(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),U(n!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(n,Iu(n,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(n,Tu(n,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(n,Js(n,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(n,Iu(n,e.snapshotNode,i.oldSnap));else throw Ls("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var Zy=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},OO=new Zy,Ou=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new Dr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return qv(this.writes_,e,n)}}getChildAfterChild(e,t,n){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:zi(this.viewCache_),s=lj(this.writes_,i,t,1,n,e);return s.length===0?null:s[0]}};function cj(r){return{filter:r}}function hj(r,e){U(e.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),U(e.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function dj(r,e,t,n,i){let s=new Xy,o,a;if(t.type===Or.OVERWRITE){let c=t;c.source.fromUser?o=ev(r,e,c.path,c.snap,n,i,s):(U(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!ce(c.path),o=Eh(r,e,c.path,c.snap,n,i,a,s))}else if(t.type===Or.MERGE){let c=t;c.source.fromUser?o=pj(r,e,c.path,c.children,n,i,s):(U(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=tv(r,e,c.path,c.children,n,i,a,s))}else if(t.type===Or.ACK_USER_WRITE){let c=t;c.revert?o=_j(r,e,c.path,n,i,s):o=mj(r,e,c.path,c.affectedTree,n,i,s)}else if(t.type===Or.LISTEN_COMPLETE)o=gj(r,e,t.path,n,s);else throw Ls("Unknown operation type: "+t.type);let u=s.getChanges();return fj(e,o,u),{viewCache:o,changes:u}}function fj(r,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=vh(r);(t.length>0||!r.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&t.push(EO(vh(e)))}}function RO(r,e,t,n,i,s){let o=e.eventCache;if(wh(n,t)!=null)return e;{let a,u;if(ce(t))if(U(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=zi(e),h=c instanceof se?c:se.EMPTY_NODE,f=Mv(n,h);a=r.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{let c=bh(n,zi(e));a=r.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=le(t);if(c===".priority"){U(Mn(t)===1,"Can't have a priority with additional path components");let h=o.getNode();u=e.serverCache.getNode();let f=FC(n,t,h,u);f!=null?a=r.filter.updatePriority(h,f):a=o.getNode()}else{let h=Ce(t),f;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let m=FC(n,t,o.getNode(),u);m!=null?f=o.getNode().getImmediateChild(c).updateChild(h,m):f=o.getNode().getImmediateChild(c)}else f=qv(n,c,e.serverCache);f!=null?a=r.filter.updateChild(o.getNode(),c,f,h,i,s):a=o.getNode()}}return yu(e,a,o.isFullyInitialized()||ce(t),r.filter.filtersNodes())}}function Eh(r,e,t,n,i,s,o,a){let u=e.serverCache,c,h=o?r.filter:r.filter.getIndexedFilter();if(ce(t))c=h.updateFullNode(u.getNode(),n,null);else if(h.filtersNodes()&&!u.isFiltered()){let _=u.getNode().updateChild(t,n);c=h.updateFullNode(u.getNode(),_,null)}else{let _=le(t);if(!u.isCompleteForPath(t)&&Mn(t)>1)return e;let v=Ce(t),A=u.getNode().getImmediateChild(_).updateChild(v,n);_===".priority"?c=h.updatePriority(u.getNode(),A):c=h.updateChild(u.getNode(),_,A,v,OO,null)}let f=SO(e,c,u.isFullyInitialized()||ce(t),h.filtersNodes()),m=new Ou(i,f,s);return RO(r,f,t,i,m,a)}function ev(r,e,t,n,i,s,o){let a=e.eventCache,u,c,h=new Ou(i,e,s);if(ce(t))c=r.filter.updateFullNode(e.eventCache.getNode(),n,o),u=yu(e,c,!0,r.filter.filtersNodes());else{let f=le(t);if(f===".priority")c=r.filter.updatePriority(e.eventCache.getNode(),n),u=yu(e,c,a.isFullyInitialized(),a.isFiltered());else{let m=Ce(t),_=a.getNode().getImmediateChild(f),v;if(ce(m))v=n;else{let w=h.getCompleteChild(f);w!=null?Pv(m)===".priority"&&w.getChild(gO(m)).isEmpty()?v=w:v=w.updateChild(m,n):v=se.EMPTY_NODE}if(_.equals(v))u=e;else{let w=r.filter.updateChild(a.getNode(),f,v,m,h,o);u=yu(e,w,a.isFullyInitialized(),r.filter.filtersNodes())}}}return u}function VC(r,e){return r.eventCache.isCompleteForChild(e)}function pj(r,e,t,n,i,s,o){let a=e;return n.foreach((u,c)=>{let h=Fe(t,u);VC(e,le(h))&&(a=ev(r,a,h,c,i,s,o))}),n.foreach((u,c)=>{let h=Fe(t,u);VC(e,le(h))||(a=ev(r,a,h,c,i,s,o))}),a}function LC(r,e,t){return t.foreach((n,i)=>{e=e.updateChild(n,i)}),e}function tv(r,e,t,n,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;ce(t)?c=n:c=new Nt(null).setTree(t,n);let h=e.serverCache.getNode();return c.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),v=LC(r,_,m);u=Eh(r,u,new Ee(f),v,i,s,o,a)}}),c.children.inorderTraversal((f,m)=>{let _=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!_){let v=e.serverCache.getNode().getImmediateChild(f),w=LC(r,v,m);u=Eh(r,u,new Ee(f),w,i,s,o,a)}}),u}function mj(r,e,t,n,i,s,o){if(wh(i,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(n.value!=null){if(ce(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Eh(r,e,t,u.getNode().getChild(t),i,s,a,o);if(ce(t)){let c=new Nt(null);return u.getNode().forEachChild(Rr,(h,f)=>{c=c.set(new Ee(h),f)}),tv(r,e,t,c,i,s,a,o)}else return e}else{let c=new Nt(null);return n.foreach((h,f)=>{let m=Fe(t,h);u.isCompleteForPath(m)&&(c=c.set(h,u.getNode().getChild(m)))}),tv(r,e,t,c,i,s,a,o)}}function gj(r,e,t,n,i){let s=e.serverCache,o=SO(e,s.getNode(),s.isFullyInitialized()||ce(t),s.isFiltered());return RO(r,o,t,n,OO,i)}function _j(r,e,t,n,i,s){let o;if(wh(n,t)!=null)return e;{let a=new Ou(n,e,i),u=e.eventCache.getNode(),c;if(ce(t)||le(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=bh(n,zi(e));else{let f=e.serverCache.getNode();U(f instanceof se,"serverChildren would be complete if leaf node"),h=Mv(n,f)}h=h,c=r.filter.updateFullNode(u,h,s)}else{let h=le(t),f=qv(n,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=u.getImmediateChild(h)),f!=null?c=r.filter.updateChild(u,h,f,Ce(t),a,s):e.eventCache.getNode().hasChild(h)?c=r.filter.updateChild(u,h,se.EMPTY_NODE,Ce(t),a,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=bh(n,zi(e)),o.isLeafNode()&&(c=r.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||wh(n,we())!=null,yu(e,c,o,r.filter.filtersNodes())}}var rv=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,i=new Au(n.getIndex()),s=VL(n);this.processor_=cj(s);let o=t.serverCache,a=t.eventCache,u=i.updateFullNode(se.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(se.EMPTY_NODE,a.getNode(),null),h=new Dr(u,o.isFullyInitialized(),i.filtersNodes()),f=new Dr(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=qh(f,h),this.eventGenerator_=new $y(this.query_)}get query(){return this.query_}};function yj(r){return r.viewCache_.serverCache.getNode()}function vj(r){return vh(r.viewCache_)}function bj(r,e){let t=zi(r.viewCache_);return t&&(r.query._queryParams.loadsAllData()||!ce(e)&&!t.getImmediateChild(le(e)).isEmpty())?t.getChild(e):null}function jC(r){return r.eventRegistrations_.length===0}function wj(r,e){r.eventRegistrations_.push(e)}function UC(r,e,t){let n=[];if(t){U(e==null,"A cancel should cancel all event registrations.");let i=r.query._path;r.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&n.push(o)})}if(e){let i=[];for(let s=0;s<r.eventRegistrations_.length;++s){let o=r.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(r.eventRegistrations_.slice(s+1));break}}r.eventRegistrations_=i}else r.eventRegistrations_=[];return n}function BC(r,e,t,n){e.type===Or.MERGE&&e.source.queryId!==null&&(U(zi(r.viewCache_),"We should always have a full cache before handling merges"),U(vh(r.viewCache_),"Missing event cache, even though we have a server cache"));let i=r.viewCache_,s=dj(r.processor_,i,e,t,n);return hj(r.processor_,s.viewCache),U(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=s.viewCache,NO(r,s.changes,s.viewCache.eventCache.getNode(),null)}function Ej(r,e){let t=r.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Re,(s,o)=>{n.push(Js(s,o))}),t.isFullyInitialized()&&n.push(EO(t.getNode())),NO(r,n,t.getNode(),e)}function NO(r,e,t,n){let i=n?[n]:r.eventRegistrations_;return GL(r.eventGenerator_,e,t,i)}var Sh,Th=class{constructor(){this.views=new Map}};function Sj(r){U(!Sh,"__referenceConstructor has already been defined"),Sh=r}function Tj(){return U(Sh,"Reference.ts has not been loaded"),Sh}function Ij(r){return r.views.size===0}function Fv(r,e,t,n){let i=e.source.queryId;if(i!==null){let s=r.views.get(i);return U(s!=null,"SyncTree gave us an op for an invalid query."),BC(s,e,t,n)}else{let s=[];for(let o of r.views.values())s=s.concat(BC(o,e,t,n));return s}}function DO(r,e,t,n,i){let s=e._queryIdentifier,o=r.views.get(s);if(!o){let a=bh(t,i?n:null),u=!1;a?u=!0:n instanceof se?(a=Mv(t,n),u=!1):(a=se.EMPTY_NODE,u=!1);let c=qh(new Dr(a,u,!1),new Dr(n,i,!1));return new rv(e,c)}return o}function Aj(r,e,t,n,i,s){let o=DO(r,e,n,i,s);return r.views.has(e._queryIdentifier)||r.views.set(e._queryIdentifier,o),wj(o,t),Ej(o,t)}function Pj(r,e,t,n){let i=e._queryIdentifier,s=[],o=[],a=qn(r);if(i==="default")for(let[u,c]of r.views.entries())o=o.concat(UC(c,t,n)),jC(c)&&(r.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=r.views.get(i);u&&(o=o.concat(UC(u,t,n)),jC(u)&&(r.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!qn(r)&&s.push(new(Tj())(e._repo,e._path)),{removed:s,events:o}}function xO(r){let e=[];for(let t of r.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function xn(r,e){let t=null;for(let n of r.views.values())t=t||bj(n,e);return t}function kO(r,e){if(e._queryParams.loadsAllData())return Vh(r);{let n=e._queryIdentifier;return r.views.get(n)}}function MO(r,e){return kO(r,e)!=null}function qn(r){return Vh(r)!=null}function Vh(r){for(let e of r.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Ih;function Cj(r){U(!Ih,"__referenceConstructor has already been defined"),Ih=r}function Oj(){return U(Ih,"Reference.ts has not been loaded"),Ih}var Rj=1,Ah=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Nt(null),this.pendingWriteTree_=uj(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Vv(r,e,t,n,i){return YL(r.pendingWriteTree_,e,t,n,i),i?io(r,new Xs(Dv(),e,t)):[]}function Nj(r,e,t,n){JL(r.pendingWriteTree_,e,t,n);let i=Nt.fromObject(t);return io(r,new Cu(Dv(),e,i))}function Nn(r,e,t=!1){let n=XL(r.pendingWriteTree_,e);if(ZL(r.pendingWriteTree_,e)){let s=new Nt(null);return n.snap!=null?s=s.set(we(),!0):ft(n.children,o=>{s=s.set(new Ee(o),!0)}),io(r,new Qy(n.path,s,t))}else return[]}function Vu(r,e,t){return io(r,new Xs(xv(),e,t))}function Dj(r,e,t){let n=Nt.fromObject(t);return io(r,new Cu(xv(),e,n))}function xj(r,e){return io(r,new yh(xv(),e))}function kj(r,e,t){let n=Lv(r,t);if(n){let i=jv(n),s=i.path,o=i.queryId,a=Rt(s,e),u=new yh(kv(o),a);return Uv(r,s,u)}else return[]}function Ph(r,e,t,n,i=!1){let s=e._path,o=r.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||MO(o,e))){let u=Pj(o,e,t,n);Ij(o)&&(r.syncPointTree_=r.syncPointTree_.remove(s));let c=u.removed;if(a=u.events,!i){let h=c.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=r.syncPointTree_.findOnPath(s,(m,_)=>qn(_));if(h&&!f){let m=r.syncPointTree_.subtree(s);if(!m.isEmpty()){let _=Fj(m);for(let v=0;v<_.length;++v){let w=_[v],A=w.query,M=LO(r,w);r.listenProvider_.startListening(bu(A),Ru(r,A),M.hashFn,M.onComplete)}}}!f&&c.length>0&&!n&&(h?r.listenProvider_.stopListening(bu(e),null):c.forEach(m=>{let _=r.queryToTagMap.get(jh(m));r.listenProvider_.stopListening(bu(m),_)}))}Vj(r,c)}return a}function qO(r,e,t,n){let i=Lv(r,n);if(i!=null){let s=jv(i),o=s.path,a=s.queryId,u=Rt(o,e),c=new Xs(kv(a),u,t);return Uv(r,o,c)}else return[]}function Mj(r,e,t,n){let i=Lv(r,n);if(i){let s=jv(i),o=s.path,a=s.queryId,u=Rt(o,e),c=Nt.fromObject(t),h=new Cu(kv(a),u,c);return Uv(r,o,h)}else return[]}function nv(r,e,t,n=!1){let i=e._path,s=null,o=!1;r.syncPointTree_.foreachOnPath(i,(m,_)=>{let v=Rt(m,i);s=s||xn(_,v),o=o||qn(_)});let a=r.syncPointTree_.get(i);a?(o=o||qn(a),s=s||xn(a,we())):(a=new Th,r.syncPointTree_=r.syncPointTree_.set(i,a));let u;s!=null?u=!0:(u=!1,s=se.EMPTY_NODE,r.syncPointTree_.subtree(i).foreachChild((_,v)=>{let w=xn(v,we());w&&(s=s.updateImmediateChild(_,w))}));let c=MO(a,e);if(!c&&!e._queryParams.loadsAllData()){let m=jh(e);U(!r.queryToTagMap.has(m),"View does not exist, but we have a tag");let _=Lj();r.queryToTagMap.set(m,_),r.tagToQueryMap.set(_,m)}let h=Fh(r.pendingWriteTree_,i),f=Aj(a,e,t,h,s,u);if(!c&&!o&&!n){let m=kO(a,e);f=f.concat(jj(r,e,m))}return f}function Lh(r,e,t){let i=r.pendingWriteTree_,s=r.syncPointTree_.findOnPath(e,(o,a)=>{let u=Rt(o,e),c=xn(a,u);if(c)return c});return AO(i,e,s,t,!0)}function qj(r,e){let t=e._path,n=null;r.syncPointTree_.foreachOnPath(t,(c,h)=>{let f=Rt(c,t);n=n||xn(h,f)});let i=r.syncPointTree_.get(t);i?n=n||xn(i,we()):(i=new Th,r.syncPointTree_=r.syncPointTree_.set(t,i));let s=n!=null,o=s?new Dr(n,!0,!1):null,a=Fh(r.pendingWriteTree_,e._path),u=DO(i,e,a,s?o.getNode():se.EMPTY_NODE,s);return vj(u)}function io(r,e){return FO(e,r.syncPointTree_,null,Fh(r.pendingWriteTree_,we()))}function FO(r,e,t,n){if(ce(r.path))return VO(r,e,t,n);{let i=e.get(we());t==null&&i!=null&&(t=xn(i,we()));let s=[],o=le(r.path),a=r.operationForChild(o),u=e.children.get(o);if(u&&a){let c=t?t.getImmediateChild(o):null,h=PO(n,o);s=s.concat(FO(a,u,c,h))}return i&&(s=s.concat(Fv(i,r,n,t))),s}}function VO(r,e,t,n){let i=e.get(we());t==null&&i!=null&&(t=xn(i,we()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,c=PO(n,o),h=r.operationForChild(o);h&&(s=s.concat(VO(h,a,u,c)))}),i&&(s=s.concat(Fv(i,r,n,t))),s}function LO(r,e){let t=e.query,n=Ru(r,t);return{hashFn:()=>(yj(e)||se.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return n?kj(r,t._path,n):xj(r,t._path);{let s=YV(i,t);return Ph(r,t,null,s)}}}}function Ru(r,e){let t=jh(e);return r.queryToTagMap.get(t)}function jh(r){return r._path.toString()+"$"+r._queryIdentifier}function Lv(r,e){return r.tagToQueryMap.get(e)}function jv(r){let e=r.indexOf("$");return U(e!==-1&&e<r.length-1,"Bad queryKey."),{queryId:r.substr(e+1),path:new Ee(r.substr(0,e))}}function Uv(r,e,t){let n=r.syncPointTree_.get(e);U(n,"Missing sync point for query tag that we're tracking");let i=Fh(r.pendingWriteTree_,e);return Fv(n,t,i,null)}function Fj(r){return r.fold((e,t,n)=>{if(t&&qn(t))return[Vh(t)];{let i=[];return t&&(i=xO(t)),ft(n,(s,o)=>{i=i.concat(o)}),i}})}function bu(r){return r._queryParams.loadsAllData()&&!r._queryParams.isDefault()?new(Oj())(r._repo,r._path):r}function Vj(r,e){for(let t=0;t<e.length;++t){let n=e[t];if(!n._queryParams.loadsAllData()){let i=jh(n),s=r.queryToTagMap.get(i);r.queryToTagMap.delete(i),r.tagToQueryMap.delete(s)}}}function Lj(){return Rj++}function jj(r,e,t){let n=e._path,i=Ru(r,e),s=LO(r,t),o=r.listenProvider_.startListening(bu(e),i,s.hashFn,s.onComplete),a=r.syncPointTree_.subtree(n);if(i)U(!qn(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,h,f)=>{if(!ce(c)&&h&&qn(h))return[Vh(h).query];{let m=[];return h&&(m=m.concat(xO(h).map(_=>_.query))),ft(f,(_,v)=>{m=m.concat(v)}),m}});for(let c=0;c<u.length;++c){let h=u[c];r.listenProvider_.stopListening(bu(h),Ru(r,h))}}return o}var iv=class r{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new r(t)}node(){return this.node_}},sv=class r{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Fe(this.path_,e);return new r(this.syncTree_,t)}node(){return Lh(this.syncTree_,this.path_)}},Uj=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},WC=function(r,e,t){if(!r||typeof r!="object")return r;if(U(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return Bj(r[".sv"],e,t);if(typeof r[".sv"]=="object")return Wj(r[".sv"],e);U(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},Bj=function(r,e,t){switch(r){case"timestamp":return t.timestamp;default:U(!1,"Unexpected server value: "+r)}},Wj=function(r,e,t){r.hasOwnProperty("increment")||U(!1,"Unexpected server value: "+JSON.stringify(r,null,2));let n=r.increment;typeof n!="number"&&U(!1,"Unexpected increment value: "+n);let i=e.node();if(U(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;let o=i.getValue();return typeof o!="number"?n:o+n},jO=function(r,e,t,n){return Wv(e,new sv(t,r),n)},Bv=function(r,e,t){return Wv(r,new iv(e),t)};function Wv(r,e,t){let n=r.getPriority().val(),i=WC(n,e.getImmediateChild(".priority"),t),s;if(r.isLeafNode()){let o=r,a=WC(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Hs(a,We(i)):r}else{let o=r;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Hs(i))),o.forEachChild(Re,(a,u)=>{let c=Wv(u,e.getImmediateChild(a),t);c!==u&&(s=s.updateImmediateChild(a,c))}),s}}var Nu=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function Uh(r,e){let t=e instanceof Ee?e:new Ee(e),n=r,i=le(t);for(;i!==null;){let s=Cn(n.node.children,i)||{children:{},childCount:0};n=new Nu(i,n,s),t=Ce(t),i=le(t)}return n}function Qi(r){return r.node.value}function zv(r,e){r.node.value=e,ov(r)}function UO(r){return r.node.childCount>0}function zj(r){return Qi(r)===void 0&&!UO(r)}function Bh(r,e){ft(r.node.children,(t,n)=>{e(new Nu(t,r,n))})}function BO(r,e,t,n){t&&!n&&e(r),Bh(r,i=>{BO(i,e,!0,n)}),t&&n&&e(r)}function Kj(r,e,t){let n=t?r:r.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function Lu(r){return new Ee(r.parent===null?r.name:Lu(r.parent)+"/"+r.name)}function ov(r){r.parent!==null&&Gj(r.parent,r.name,r)}function Gj(r,e,t){let n=zj(t),i=tr(r.node.children,e);n&&i?(delete r.node.children[e],r.node.childCount--,ov(r)):!n&&!i&&(r.node.children[e]=t.node,r.node.childCount++,ov(r))}var Qj=/[\[\].#$\/\u0000-\u001F\u007F]/,$j=/[\[\].#$\u0000-\u001F\u007F]/,_y=10*1024*1024,Wh=function(r){return typeof r=="string"&&r.length!==0&&!Qj.test(r)},WO=function(r){return typeof r=="string"&&r.length!==0&&!$j.test(r)},Hj=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),WO(r)},Du=function(r){return r===null||typeof r=="string"||typeof r=="number"&&!kh(r)||r&&typeof r=="object"&&tr(r,".sv")},xr=function(r,e,t,n){n&&e===void 0||ju(Vt(r,"value"),e,t)},ju=function(r,e,t){let n=t instanceof Ee?new Ry(t,r):t;if(e===void 0)throw new Error(r+"contains undefined "+Ui(n));if(typeof e=="function")throw new Error(r+"contains a function "+Ui(n)+" with contents = "+e.toString());if(kh(e))throw new Error(r+"contains "+e.toString()+" "+Ui(n));if(typeof e=="string"&&e.length>_y/3&&su(e)>_y)throw new Error(r+"contains a string greater than "+_y+" utf8 bytes "+Ui(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(ft(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Wh(o)))throw new Error(r+" contains an invalid key ("+o+") "+Ui(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);IL(n,o),ju(r,a,n),AL(n)}),i&&s)throw new Error(r+' contains ".value" child '+Ui(n)+" in addition to actual children.")}},Yj=function(r,e){let t,n;for(t=0;t<e.length;t++){n=e[t];let s=Eu(n);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Wh(s[o]))throw new Error(r+"contains an invalid key ("+s[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(TL);let i=null;for(t=0;t<e.length;t++){if(n=e[t],i!==null&&ir(i,n))throw new Error(r+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}},zO=function(r,e,t,n){if(n&&e===void 0)return;let i=Vt(r,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];ft(e,(o,a)=>{let u=new Ee(o);if(ju(i,a,Fe(t,u)),Pv(u)===".priority"&&!Du(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),Yj(i,s)},Kv=function(r,e,t){if(!(t&&e===void 0)){if(kh(e))throw new Error(Vt(r,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Du(e))throw new Error(Vt(r,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Uu=function(r,e,t,n){if(!(n&&t===void 0)&&!Wh(t))throw new Error(Vt(r,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},so=function(r,e,t,n){if(!(n&&t===void 0)&&!WO(t))throw new Error(Vt(r,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Jj=function(r,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),so(r,e,t,n)},Gt=function(r,e){if(le(e)===".info")throw new Error(r+" failed = Can't modify data under /.info/")},KO=function(r,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Wh(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Hj(t))throw new Error(Vt(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var av=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function zh(r,e){let t=null;for(let n=0;n<e.length;n++){let i=e[n],s=i.getPath();t!==null&&!Cv(s,t.path)&&(r.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&r.eventLists_.push(t)}function GO(r,e,t){zh(r,t),QO(r,n=>Cv(n,e))}function Qt(r,e,t){zh(r,t),QO(r,n=>ir(n,e)||ir(e,n))}function QO(r,e){r.recursionDepth_++;let t=!0;for(let n=0;n<r.eventLists_.length;n++){let i=r.eventLists_[n];if(i){let s=i.path;e(s)?(Xj(r.eventLists_[n]),r.eventLists_[n]=null):t=!1}}t&&(r.eventLists_=[]),r.recursionDepth_--}function Xj(r){for(let e=0;e<r.events.length;e++){let t=r.events[e];if(t!==null){r.events[e]=null;let n=t.getEventRunner();Wi&&dt("event: "+t.toString()),ro(n)}}}var $O="repo_interrupt",Zj=25,uv=class{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new av,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=_h(),this.transactionQueueTree_=new Nu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function e2(r,e,t){if(r.stats_=Av(r.repoInfo_),r.forceRestClient_||eL())r.server_=new Uy(r.repoInfo_,(n,i,s,o)=>{zC(r,n,i,s,o)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>KC(r,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{rt(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}r.persistentConnection_=new Ov(r.repoInfo_,e,(n,i,s,o)=>{zC(r,n,i,s,o)},n=>{KC(r,n)},n=>{t2(r,n)},r.authTokenProvider_,r.appCheckProvider_,t),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(n=>{r.server_.refreshAuthToken(n)}),r.appCheckProvider_.addTokenChangeListener(n=>{r.server_.refreshAppCheckToken(n.token)}),r.statsReporter_=rL(r.repoInfo_,()=>new Gy(r.stats_,r.server_)),r.infoData_=new By,r.infoSyncTree_=new Ah({startListening:(n,i,s,o)=>{let a=[],u=r.infoData_.getNode(n._path);return u.isEmpty()||(a=Vu(r.infoSyncTree_,n._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Gv(r,"connected",!1),r.serverSyncTree_=new Ah({startListening:(n,i,s,o)=>(r.server_.listen(n,s,i,(a,u)=>{let c=o(a,u);Qt(r.eventQueue_,n._path,c)}),[]),stopListening:(n,i)=>{r.server_.unlisten(n,i)}})}function HO(r){let t=r.infoData_.getNode(new Ee(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Bu(r){return Uj({timestamp:HO(r)})}function zC(r,e,t,n,i){r.dataUpdateCount++;let s=new Ee(e);t=r.interceptServerDataCallback_?r.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(n){let u=iu(t,c=>We(c));o=Mj(r.serverSyncTree_,s,u,i)}else{let u=We(t);o=qO(r.serverSyncTree_,s,u,i)}else if(n){let u=iu(t,c=>We(c));o=Dj(r.serverSyncTree_,s,u)}else{let u=We(t);o=Vu(r.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=eo(r,s)),Qt(r.eventQueue_,a,o)}function KC(r,e){Gv(r,"connected",e),e===!1&&i2(r)}function t2(r,e){ft(e,(t,n)=>{Gv(r,t,n)})}function Gv(r,e,t){let n=new Ee("/.info/"+e),i=We(t);r.infoData_.updateSnapshot(n,i);let s=Vu(r.infoSyncTree_,n,i);Qt(r.eventQueue_,n,s)}function Kh(r){return r.nextWriteId_++}function r2(r,e,t){let n=qj(r.serverSyncTree_,e);return n!=null?Promise.resolve(n):r.server_.get(e).then(i=>{let s=We(i).withIndex(e._queryParams.getIndex());nv(r.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Vu(r.serverSyncTree_,e._path,s);else{let a=Ru(r.serverSyncTree_,e);o=qO(r.serverSyncTree_,e._path,s,a)}return Qt(r.eventQueue_,e._path,o),Ph(r.serverSyncTree_,e,t,null,!0),s},i=>(oo(r,"get for query "+rt(e)+" failed: "+i),Promise.reject(new Error(i))))}function Qv(r,e,t,n,i){oo(r,"set",{path:e.toString(),value:t,priority:n});let s=Bu(r),o=We(t,n),a=Lh(r.serverSyncTree_,e),u=Bv(o,a,s),c=Kh(r),h=Vv(r.serverSyncTree_,e,u,c,!0);zh(r.eventQueue_,h),r.server_.put(e.toString(),o.val(!0),(m,_)=>{let v=m==="ok";v||Tt("set at "+e+" failed: "+m);let w=Nn(r.serverSyncTree_,c,!v);Qt(r.eventQueue_,e,w),Fn(r,i,m,_)});let f=Hv(r,e);eo(r,f),Qt(r.eventQueue_,f,[])}function n2(r,e,t,n){oo(r,"update",{path:e.toString(),value:t});let i=!0,s=Bu(r),o={};if(ft(t,(a,u)=>{i=!1,o[a]=jO(Fe(e,a),We(u),r.serverSyncTree_,s)}),i)dt("update() called with empty data.  Don't do anything."),Fn(r,n,"ok",void 0);else{let a=Kh(r),u=Nj(r.serverSyncTree_,e,o,a);zh(r.eventQueue_,u),r.server_.merge(e.toString(),t,(c,h)=>{let f=c==="ok";f||Tt("update at "+e+" failed: "+c);let m=Nn(r.serverSyncTree_,a,!f),_=m.length>0?eo(r,e):e;Qt(r.eventQueue_,_,m),Fn(r,n,c,h)}),ft(t,c=>{let h=Hv(r,Fe(e,c));eo(r,h)}),Qt(r.eventQueue_,e,[])}}function i2(r){oo(r,"onDisconnectEvents");let e=Bu(r),t=_h();zy(r.onDisconnect_,we(),(i,s)=>{let o=jO(i,s,r.serverSyncTree_,e);no(t,i,o)});let n=[];zy(t,we(),(i,s)=>{n=n.concat(Vu(r.serverSyncTree_,i,s));let o=Hv(r,i);eo(r,o)}),r.onDisconnect_=_h(),Qt(r.eventQueue_,we(),n)}function s2(r,e,t){r.server_.onDisconnectCancel(e.toString(),(n,i)=>{n==="ok"&&Wy(r.onDisconnect_,e),Fn(r,t,n,i)})}function GC(r,e,t,n){let i=We(t);r.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&no(r.onDisconnect_,e,i),Fn(r,n,s,o)})}function o2(r,e,t,n,i){let s=We(t,n);r.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&no(r.onDisconnect_,e,s),Fn(r,i,o,a)})}function a2(r,e,t,n){if(bc(t)){dt("onDisconnect().update() called with empty data.  Don't do anything."),Fn(r,n,"ok",void 0);return}r.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&ft(t,(o,a)=>{let u=We(a);no(r.onDisconnect_,Fe(e,o),u)}),Fn(r,n,i,s)})}function u2(r,e,t){let n;le(e._path)===".info"?n=nv(r.infoSyncTree_,e,t):n=nv(r.serverSyncTree_,e,t),GO(r.eventQueue_,e._path,n)}function lv(r,e,t){let n;le(e._path)===".info"?n=Ph(r.infoSyncTree_,e,t):n=Ph(r.serverSyncTree_,e,t),GO(r.eventQueue_,e._path,n)}function YO(r){r.persistentConnection_&&r.persistentConnection_.interrupt($O)}function l2(r){r.persistentConnection_&&r.persistentConnection_.resume($O)}function oo(r,...e){let t="";r.persistentConnection_&&(t=r.persistentConnection_.id+":"),dt(t,...e)}function Fn(r,e,t,n){e&&ro(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;n&&(s+=": "+n);let o=new Error(s);o.code=i,e(o)}})}function c2(r,e,t,n,i,s){oo(r,"transaction on "+e);let o={path:e,update:t,onComplete:n,status:null,order:HC(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=$v(r,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ju("transaction failed: Data returned ",u,o.path),o.status=0;let c=Uh(r.transactionQueueTree_,e),h=Qi(c)||[];h.push(o),zv(c,h);let f;typeof u=="object"&&u!==null&&tr(u,".priority")?(f=Cn(u,".priority"),U(Du(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Lh(r.serverSyncTree_,e)||se.EMPTY_NODE).getPriority().val();let m=Bu(r),_=We(u,f),v=Bv(_,a,m);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=v,o.currentWriteId=Kh(r);let w=Vv(r.serverSyncTree_,e,v,o.currentWriteId,o.applyLocally);Qt(r.eventQueue_,e,w),Gh(r,r.transactionQueueTree_)}}function $v(r,e,t){return Lh(r.serverSyncTree_,e,t)||se.EMPTY_NODE}function Gh(r,e=r.transactionQueueTree_){if(e||Qh(r,e),Qi(e)){let t=XO(r,e);U(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&h2(r,Lu(e),t)}else UO(e)&&Bh(e,t=>{Gh(r,t)})}function h2(r,e,t){let n=t.map(c=>c.currentWriteId),i=$v(r,e,n),s=i,o=i.hash();for(let c=0;c<t.length;c++){let h=t[c];U(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let f=Rt(e,h.path);s=s.updateChild(f,h.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;r.server_.put(u.toString(),a,c=>{oo(r,"transaction put response",{path:u.toString(),status:c});let h=[];if(c==="ok"){let f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(Nn(r.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Qh(r,Uh(r.transactionQueueTree_,e)),Gh(r,r.transactionQueueTree_),Qt(r.eventQueue_,e,h);for(let m=0;m<f.length;m++)ro(f[m])}else{if(c==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Tt("transaction at "+u.toString()+" failed: "+c);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=c}eo(r,e)}},o)}function eo(r,e){let t=JO(r,e),n=Lu(t),i=XO(r,t);return d2(r,i,n),n}function d2(r,e,t){if(e.length===0)return;let n=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=Rt(t,u.path),h=!1,f;if(U(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)h=!0,f=u.abortReason,i=i.concat(Nn(r.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=Zj)h=!0,f="maxretry",i=i.concat(Nn(r.serverSyncTree_,u.currentWriteId,!0));else{let m=$v(r,u.path,o);u.currentInputSnapshot=m;let _=e[a].update(m.val());if(_!==void 0){ju("transaction failed: Data returned ",_,u.path);let v=We(_);typeof _=="object"&&_!=null&&tr(_,".priority")||(v=v.updatePriority(m.getPriority()));let A=u.currentWriteId,M=Bu(r),V=Bv(v,m,M);u.currentOutputSnapshotRaw=v,u.currentOutputSnapshotResolved=V,u.currentWriteId=Kh(r),o.splice(o.indexOf(A),1),i=i.concat(Vv(r.serverSyncTree_,u.path,V,u.currentWriteId,u.applyLocally)),i=i.concat(Nn(r.serverSyncTree_,A,!0))}else h=!0,f="nodata",i=i.concat(Nn(r.serverSyncTree_,u.currentWriteId,!0))}Qt(r.eventQueue_,t,i),i=[],h&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(f),!1,null))))}Qh(r,r.transactionQueueTree_);for(let a=0;a<n.length;a++)ro(n[a]);Gh(r,r.transactionQueueTree_)}function JO(r,e){let t,n=r.transactionQueueTree_;for(t=le(e);t!==null&&Qi(n)===void 0;)n=Uh(n,t),e=Ce(e),t=le(e);return n}function XO(r,e){let t=[];return ZO(r,e,t),t.sort((n,i)=>n.order-i.order),t}function ZO(r,e,t){let n=Qi(e);if(n)for(let i=0;i<n.length;i++)t.push(n[i]);Bh(e,i=>{ZO(r,i,t)})}function Qh(r,e){let t=Qi(e);if(t){let n=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[n]=t[i],n++);t.length=n,zv(e,t.length>0?t:void 0)}Bh(e,n=>{Qh(r,n)})}function Hv(r,e){let t=Lu(JO(r,e)),n=Uh(r.transactionQueueTree_,e);return Kj(n,i=>{yy(r,i)}),yy(r,n),BO(n,i=>{yy(r,i)}),t}function yy(r,e){let t=Qi(e);if(t){let n=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(U(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(U(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Nn(r.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?zv(e,void 0):t.length=s+1,Qt(r.eventQueue_,Lu(e),i);for(let o=0;o<n.length;o++)ro(n[o])}}function f2(r){let e="",t=r.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let i=t[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function p2(r){let e={};r.charAt(0)==="?"&&(r=r.substring(1));for(let t of r.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Tt(`Invalid query segment '${t}' in query '${r}'`)}return e}var cv=function(r,e){let t=m2(r),n=t.namespace;t.domain==="firebase.com"&&Nr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Nr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||KV();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new lh(t.host,t.secure,n,i,e,"",n!==t.subdomain),path:new Ee(t.pathString)}},m2=function(r){let e="",t="",n="",i="",s="",o=!0,a="https",u=443;if(typeof r=="string"){let c=r.indexOf("//");c>=0&&(a=r.substring(0,c-1),r=r.substring(c+2));let h=r.indexOf("/");h===-1&&(h=r.length);let f=r.indexOf("?");f===-1&&(f=r.length),e=r.substring(0,Math.min(h,f)),h<f&&(i=f2(r.substring(h,f)));let m=p2(r.substring(Math.min(r.length,f)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let v=e.indexOf(".");n=e.substring(0,v).toLowerCase(),t=e.substring(v+1),s=n}"ns"in m&&(s=m.ns)}return{host:e,port:u,domain:t,subdomain:n,secure:o,scheme:a,pathString:i,namespace:s}};var QC="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",g2=function(){let r=0,e=[];return function(t){let n=t===r;r=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=QC.charAt(t%64),t=Math.floor(t/64);U(t===0,"Cannot push at time == 0");let o=s.join("");if(n){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=QC.charAt(e[i]);return U(o.length===20,"nextPushId: Length should be 20."),o}}();var Ch=class{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+rt(this.snapshot.exportVal())}},Oh=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var xu=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return U(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Rh=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ot;return s2(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Gt("OnDisconnect.remove",this._path);let e=new Ot;return GC(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Gt("OnDisconnect.set",this._path),xr("OnDisconnect.set",e,this._path,!1);let t=new Ot;return GC(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Gt("OnDisconnect.setWithPriority",this._path),xr("OnDisconnect.setWithPriority",e,this._path,!1),Kv("OnDisconnect.setWithPriority",t,!1);let n=new Ot;return o2(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Gt("OnDisconnect.update",this._path),zO("OnDisconnect.update",e,this._path,!1);let t=new Ot;return a2(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Dt=class r{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return ce(this._path)?null:Pv(this._path)}get ref(){return new $t(this._repo,this._path)}get _queryIdentifier(){let e=xC(this._queryParams),t=Iv(e);return t==="{}"?"default":t}get _queryObject(){return xC(this._queryParams)}isEqual(e){if(e=fe(e),!(e instanceof r))return!1;let t=this._repo===e._repo,n=Cv(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+SL(this._path)}};function $h(r,e){if(r._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ln(r){let e=null,t=null;if(r.hasStart()&&(e=r.getIndexStartValue()),r.hasEnd()&&(t=r.getIndexEndValue()),r.getIndex()===Rr){let n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(r.hasStart()){if(r.getIndexStartName()!==kn)throw new Error(n);if(typeof e!="string")throw new Error(i)}if(r.hasEnd()){if(r.getIndexEndName()!==rn)throw new Error(n);if(typeof t!="string")throw new Error(i)}}else if(r.getIndex()===Re){if(e!=null&&!Du(e)||t!=null&&!Du(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(U(r.getIndex()instanceof Su||r.getIndex()===Nv,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Hh(r){if(r.hasStart()&&r.hasEnd()&&r.hasLimit()&&!r.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var $t=class r extends Dt{constructor(e,t){super(e,t,new Pu,!1)}get parent(){let e=gO(this._path);return e===null?null:new r(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},to=class r{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Ee(e),n=Vn(this.ref,e);return new r(this._node.getChild(t),n,Re)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,i)=>e(new r(i,Vn(this.ref,n),Re)))}hasChild(e){let t=new Ee(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Yv(r,e){return r=fe(r),r._checkNotDeleted("ref"),e!==void 0?Vn(r._root,e):r._root}function Jv(r,e){r=fe(r),r._checkNotDeleted("refFromURL");let t=cv(e,r._repo.repoInfo_.nodeAdmin);KO("refFromURL",t);let n=t.repoInfo;return!r._repo.repoInfo_.isCustomHost()&&n.host!==r._repo.repoInfo_.host&&Nr("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+r._repo.repoInfo_.host+")"),Yv(r,t.path.toString())}function Vn(r,e){return r=fe(r),le(r._path)===null?Jj("child","path",e,!1):so("child","path",e,!1),new $t(r._repo,Fe(r._path,e))}function e1(r,e){r=fe(r),Gt("push",r._path),xr("push",e,r._path,!0);let t=HO(r._repo),n=g2(t),i=Vn(r,n),s=Vn(r,n),o;return e!=null?o=Yh(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function t1(r){return Gt("remove",r._path),Yh(r,null)}function Yh(r,e){r=fe(r),Gt("set",r._path),xr("set",e,r._path,!1);let t=new Ot;return Qv(r._repo,r._path,e,null,t.wrapCallback(()=>{})),t.promise}function r1(r,e){r=fe(r),Gt("setPriority",r._path),Kv("setPriority",e,!1);let t=new Ot;return Qv(r._repo,Fe(r._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function n1(r,e,t){if(Gt("setWithPriority",r._path),xr("setWithPriority",e,r._path,!1),Kv("setWithPriority",t,!1),r.key===".length"||r.key===".keys")throw"setWithPriority failed: "+r.key+" is a read-only object.";let n=new Ot;return Qv(r._repo,r._path,e,t,n.wrapCallback(()=>{})),n.promise}function i1(r,e){zO("update",e,r._path,!1);let t=new Ot;return n2(r._repo,r._path,e,t.wrapCallback(()=>{})),t.promise}function s1(r){r=fe(r);let e=new xu(()=>{}),t=new ku(e);return r2(r._repo,r,t).then(n=>new to(n,new $t(r._repo,r._path),r._queryParams.getIndex()))}var ku=class r{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let n=t._queryParams.getIndex();return new Ch("value",this,new to(e.snapshotNode,new $t(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Oh(this,e,t):null}matches(e){return e instanceof r?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Nh=class r{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Oh(this,e,t):null}createEvent(e,t){U(e.childName!=null,"Child events should have a childName.");let n=Vn(new $t(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Ch(e.type,this,new to(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof r?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Wu(r,e,t,n,i){let s;if(typeof n=="object"&&(s=void 0,i=n),typeof n=="function"&&(s=n),i&&i.onlyOnce){let u=t,c=(h,f)=>{lv(r._repo,r,a),u(h,f)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new xu(t,s||void 0),a=e==="value"?new ku(o):new Nh(e,o);return u2(r._repo,r,a),()=>lv(r._repo,r,a)}function Jh(r,e,t,n){return Wu(r,"value",e,t,n)}function Xv(r,e,t,n){return Wu(r,"child_added",e,t,n)}function Zv(r,e,t,n){return Wu(r,"child_changed",e,t,n)}function eb(r,e,t,n){return Wu(r,"child_moved",e,t,n)}function tb(r,e,t,n){return Wu(r,"child_removed",e,t,n)}function rb(r,e,t){let n=null,i=t?new xu(t):null;e==="value"?n=new ku(i):e&&(n=new Nh(e,i)),lv(r._repo,r,n)}var Ht=class{},Dh=class extends Ht{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){xr("endAt",this._value,e._path,!0);let t=jy(e._queryParams,this._value,this._key);if(Hh(t),Ln(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function o1(r,e){return Uu("endAt","key",e,!0),new Dh(r,e)}var hv=class extends Ht{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){xr("endBefore",this._value,e._path,!1);let t=BL(e._queryParams,this._value,this._key);if(Hh(t),Ln(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function a1(r,e){return Uu("endBefore","key",e,!0),new hv(r,e)}var xh=class extends Ht{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){xr("startAt",this._value,e._path,!0);let t=Ly(e._queryParams,this._value,this._key);if(Hh(t),Ln(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function u1(r=null,e){return Uu("startAt","key",e,!0),new xh(r,e)}var dv=class extends Ht{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){xr("startAfter",this._value,e._path,!1);let t=UL(e._queryParams,this._value,this._key);if(Hh(t),Ln(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Dt(e._repo,e._path,t,e._orderByCalled)}};function l1(r,e){return Uu("startAfter","key",e,!0),new dv(r,e)}var fv=class extends Ht{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Dt(e._repo,e._path,LL(e._queryParams,this._limit),e._orderByCalled)}};function c1(r){if(typeof r!="number"||Math.floor(r)!==r||r<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new fv(r)}var pv=class extends Ht{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Dt(e._repo,e._path,jL(e._queryParams,this._limit),e._orderByCalled)}};function h1(r){if(typeof r!="number"||Math.floor(r)!==r||r<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new pv(r)}var mv=class extends Ht{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){$h(e,"orderByChild");let t=new Ee(this._path);if(ce(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new Su(t),i=Mh(e._queryParams,n);return Ln(i),new Dt(e._repo,e._path,i,!0)}};function d1(r){if(r==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(r==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(r==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return so("orderByChild","path",r,!1),new mv(r)}var gv=class extends Ht{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){$h(e,"orderByKey");let t=Mh(e._queryParams,Rr);return Ln(t),new Dt(e._repo,e._path,t,!0)}};function f1(){return new gv}var _v=class extends Ht{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){$h(e,"orderByPriority");let t=Mh(e._queryParams,Re);return Ln(t),new Dt(e._repo,e._path,t,!0)}};function p1(){return new _v}var yv=class extends Ht{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){$h(e,"orderByValue");let t=Mh(e._queryParams,Nv);return Ln(t),new Dt(e._repo,e._path,t,!0)}};function m1(){return new yv}var vv=class extends Ht{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(xr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Dh(this._value,this._key)._apply(new xh(this._value,this._key)._apply(e))}};function g1(r,e){return Uu("equalTo","key",e,!0),new vv(r,e)}function or(r,...e){let t=fe(r);for(let n of e)t=n._apply(t);return t}Sj($t);Cj($t);var _2="FIREBASE_DATABASE_EMULATOR_HOST",bv={},y2=!1;function v2(r,e,t,n){r.repoInfo_=new lh(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function nb(r,e,t,n,i){let s=n||r.options.databaseURL;s===void 0&&(r.options.projectId||Nr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),dt("Using default host for project ",r.options.projectId),s=`${r.options.projectId}-default-rtdb.firebaseio.com`);let o=cv(s,i),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[_2]),c?(u=!0,s=`http://${c}?ns=${a.namespace}`,o=cv(s,i),a=o.repoInfo):u=!o.repoInfo.secure;let h=i&&u?new _u(_u.OWNER):new Ty(r.name,r.options,e);KO("Invalid Firebase Database URL",o),ce(o.path)||Nr("Database URL must point to the root of a Firebase Database (not including a child path).");let f=w2(a,r,h,new Sy(r.name,t));return new wv(f,r)}function b2(r,e){let t=bv[e];(!t||t[r.key]!==r)&&Nr(`Database ${e}(${r.repoInfo_}) has already been deleted.`),YO(r),delete t[r.key]}function w2(r,e,t,n){let i=bv[e.name];i||(i={},bv[e.name]=i);let s=i[r.toURLString()];return s&&Nr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new uv(r,y2,t,n),i[r.toURLString()]=s,s}var wv=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(e2(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $t(this._repo,we())),this._rootInternal}_delete(){return this._rootInternal!==null&&(b2(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Nr("Cannot call "+e+" on a deleted database.")}};function _1(){mO.IS_TRANSPORT_INITIALIZED&&Tt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function y1(){_1(),wu.forceDisallow()}function v1(){_1(),Ks.forceDisallow(),wu.forceAllow()}function b1(r,e,t,n={}){r=fe(r),r._checkNotDeleted("useEmulator"),r._instanceStarted&&Nr("Cannot call useEmulator() after instance has already been initialized.");let i=r._repoInternal,s;if(i.repoInfo_.nodeAdmin)n.mockUserToken&&Nr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new _u(_u.OWNER);else if(n.mockUserToken){let o=typeof n.mockUserToken=="string"?n.mockUserToken:yc(n.mockUserToken,r.app.options.projectId);s=new _u(o)}v2(i,e,t,s)}function w1(r){r=fe(r),r._checkNotDeleted("goOffline"),YO(r._repo)}function E1(r){r=fe(r),r._checkNotDeleted("goOnline"),l2(r._repo)}function S1(r,e){JC(r,e)}function E2(r){Tv(Sc),Ec(new Pr("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return nb(n,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Us(gC,_C,r),Us(gC,_C,"esm2017")}var S2={".sv":"timestamp"};function T1(){return S2}function I1(r){return{".sv":{increment:r}}}var Ev=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function A1(r,e,t){var n;if(r=fe(r),Gt("Reference.transaction",r._path),r.key===".length"||r.key===".keys")throw"Reference.transaction failed: "+r.key+" is a read-only object.";let i=(n=t?.applyLocally)!==null&&n!==void 0?n:!0,s=new Ot,o=(u,c,h)=>{let f=null;u?s.reject(u):(f=new to(h,new $t(r._repo,r._path),Re),s.resolve(new Ev(c,f)))},a=Jh(r,()=>{});return c2(r._repo,r._path,e,o,a,i),s.promise}Ov.prototype.simpleListen=function(r,e){this.sendRequest("q",{p:r},e)};Ov.prototype.echo=function(r,e){this.sendRequest("echo",{d:r},e)};E2();var T2="@firebase/database-compat",I2="1.0.8";var A2=new js("@firebase/database-compat"),P1=function(r){let e="FIREBASE WARNING: "+r;A2.warn(e)};var P2=function(r,e,t,n){if(!(n&&t===void 0)&&typeof t!="boolean")throw new Error(Vt(r,e)+"must be a boolean.")},C2=function(r,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Vt(r,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var ib=class{constructor(e){this._delegate=e}cancel(e){ne("OnDisconnect.cancel",0,1,arguments.length),at("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),n=>e(n)),t}remove(e){ne("OnDisconnect.remove",0,1,arguments.length),at("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),n=>e(n)),t}set(e,t){ne("OnDisconnect.set",1,2,arguments.length),at("OnDisconnect.set","onComplete",t,!0);let n=this._delegate.set(e);return t&&n.then(()=>t(null),i=>t(i)),n}setWithPriority(e,t,n){ne("OnDisconnect.setWithPriority",2,3,arguments.length),at("OnDisconnect.setWithPriority","onComplete",n,!0);let i=this._delegate.setWithPriority(e,t);return n&&i.then(()=>n(null),s=>n(s)),i}update(e,t){if(ne("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,P1("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}at("OnDisconnect.update","onComplete",t,!0);let n=this._delegate.update(e);return t&&n.then(()=>t(null),i=>t(i)),n}};var sb=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return ne("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var $i=class r{constructor(e,t){this._database=e,this._delegate=t}val(){return ne("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return ne("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return ne("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return ne("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return ne("DataSnapshot.child",0,1,arguments.length),e=String(e),so("DataSnapshot.child","path",e,!1),new r(this._database,this._delegate.child(e))}hasChild(e){return ne("DataSnapshot.hasChild",1,1,arguments.length),so("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return ne("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return ne("DataSnapshot.forEach",1,1,arguments.length),at("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new r(this._database,t)))}hasChildren(){return ne("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return ne("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return ne("DataSnapshot.ref",0,0,arguments.length),new nn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Xh=class r{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,i){var s;ne("Query.on",2,4,arguments.length),at("Query.on","callback",t,!1);let o=r.getCancelAndContextArgs_("Query.on",n,i),a=(c,h)=>{t.call(o.context,new $i(this.database,c),h)};a.userCallback=t,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Jh(this._delegate,a,u),t;case"child_added":return Xv(this._delegate,a,u),t;case"child_removed":return tb(this._delegate,a,u),t;case"child_changed":return Zv(this._delegate,a,u),t;case"child_moved":return eb(this._delegate,a,u),t;default:throw new Error(Vt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(ne("Query.off",0,3,arguments.length),C2("Query.off",e,!0),at("Query.off","callback",t,!0),R_("Query.off","context",n,!0),t){let i=()=>{};i.userCallback=t,i.context=n,rb(this._delegate,e,i)}else rb(this._delegate,e)}get(){return s1(this._delegate).then(e=>new $i(this.database,e))}once(e,t,n,i){ne("Query.once",1,4,arguments.length),at("Query.once","callback",t,!0);let s=r.getCancelAndContextArgs_("Query.once",n,i),o=new Ot,a=(c,h)=>{let f=new $i(this.database,c);t&&t.call(s.context,f,h),o.resolve(f)};a.userCallback=t,a.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":Jh(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":Xv(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":tb(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":Zv(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":eb(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Vt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return ne("Query.limitToFirst",1,1,arguments.length),new r(this.database,or(this._delegate,c1(e)))}limitToLast(e){return ne("Query.limitToLast",1,1,arguments.length),new r(this.database,or(this._delegate,h1(e)))}orderByChild(e){return ne("Query.orderByChild",1,1,arguments.length),new r(this.database,or(this._delegate,d1(e)))}orderByKey(){return ne("Query.orderByKey",0,0,arguments.length),new r(this.database,or(this._delegate,f1()))}orderByPriority(){return ne("Query.orderByPriority",0,0,arguments.length),new r(this.database,or(this._delegate,p1()))}orderByValue(){return ne("Query.orderByValue",0,0,arguments.length),new r(this.database,or(this._delegate,m1()))}startAt(e=null,t){return ne("Query.startAt",0,2,arguments.length),new r(this.database,or(this._delegate,u1(e,t)))}startAfter(e=null,t){return ne("Query.startAfter",0,2,arguments.length),new r(this.database,or(this._delegate,l1(e,t)))}endAt(e=null,t){return ne("Query.endAt",0,2,arguments.length),new r(this.database,or(this._delegate,o1(e,t)))}endBefore(e=null,t){return ne("Query.endBefore",0,2,arguments.length),new r(this.database,or(this._delegate,a1(e,t)))}equalTo(e,t){return ne("Query.equalTo",1,2,arguments.length),new r(this.database,or(this._delegate,g1(e,t)))}toString(){return ne("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return ne("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(ne("Query.isEqual",1,1,arguments.length),!(e instanceof r)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){let i={cancel:void 0,context:void 0};if(t&&n)i.cancel=t,at(e,"cancel",i.cancel,!0),i.context=n,R_(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(Vt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new nn(this.database,new $t(this._delegate._repo,this._delegate._path))}},nn=class r extends Xh{constructor(e,t){super(e,new Dt(t._repo,t._path,new Pu,!1)),this.database=e,this._delegate=t}getKey(){return ne("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return ne("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new r(this.database,Vn(this._delegate,e))}getParent(){ne("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new r(this.database,e):null}getRoot(){return ne("Reference.root",0,0,arguments.length),new r(this.database,this._delegate.root)}set(e,t){ne("Reference.set",1,2,arguments.length),at("Reference.set","onComplete",t,!0);let n=Yh(this._delegate,e);return t&&n.then(()=>t(null),i=>t(i)),n}update(e,t){if(ne("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,P1("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Gt("Reference.update",this._delegate._path),at("Reference.update","onComplete",t,!0);let n=i1(this._delegate,e);return t&&n.then(()=>t(null),i=>t(i)),n}setWithPriority(e,t,n){ne("Reference.setWithPriority",2,3,arguments.length),at("Reference.setWithPriority","onComplete",n,!0);let i=n1(this._delegate,e,t);return n&&i.then(()=>n(null),s=>n(s)),i}remove(e){ne("Reference.remove",0,1,arguments.length),at("Reference.remove","onComplete",e,!0);let t=t1(this._delegate);return e&&t.then(()=>e(null),n=>e(n)),t}transaction(e,t,n){ne("Reference.transaction",1,3,arguments.length),at("Reference.transaction","transactionUpdate",e,!1),at("Reference.transaction","onComplete",t,!0),P2("Reference.transaction","applyLocally",n,!0);let i=A1(this._delegate,e,{applyLocally:n}).then(s=>new sb(s.committed,new $i(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){ne("Reference.setPriority",1,2,arguments.length),at("Reference.setPriority","onComplete",t,!0);let n=r1(this._delegate,e);return t&&n.then(()=>t(null),i=>t(i)),n}push(e,t){ne("Reference.push",0,2,arguments.length),at("Reference.push","onComplete",t,!0);let n=e1(this._delegate,e),i=n.then(o=>new r(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new r(this.database,n);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Gt("Reference.onDisconnect",this._delegate._path),new ib(new Rh(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Hi=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:y1,forceLongPolling:v1}}useEmulator(e,t,n={}){b1(this._delegate,e,t,n)}ref(e){if(ne("database.ref",0,1,arguments.length),e instanceof nn){let t=Jv(this._delegate,e.toString());return new nn(this,t)}else{let t=Yv(this._delegate,e);return new nn(this,t)}}refFromURL(e){ne("database.refFromURL",1,1,arguments.length);let n=Jv(this._delegate,e);return new nn(this,n)}goOffline(){return ne("database.goOffline",0,0,arguments.length),w1(this._delegate)}goOnline(){return ne("database.goOnline",0,0,arguments.length),E1(this._delegate)}};Hi.ServerValue={TIMESTAMP:T1(),increment:r=>I1(r)};function O2({app:r,url:e,version:t,customAuthImpl:n,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){Tv(t);let a=new N_("database-standalone"),u=new wc("auth-internal",a);u.setComponent(new Pr("auth-internal",()=>n,"PRIVATE"));let c;return i&&(c=new wc("app-check-internal",a),c.setComponent(new Pr("app-check-internal",()=>i,"PRIVATE"))),{instance:new Hi(nb(r,u,c,e,o),r),namespace:s}}var R2=Object.freeze({__proto__:null,initStandalone:O2});var N2=Hi.ServerValue;function D2(r){r.INTERNAL.registerComponent(new Pr("database-compat",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Hi(i,n)},"PUBLIC").setServiceProps({Reference:nn,Query:Xh,Database:Hi,DataSnapshot:$i,enableLogging:S1,INTERNAL:R2,ServerValue:N2}).setMultipleInstances(!0)),r.registerVersion(T2,I2)}D2(On);function zu(r,e,t="on",n=uc){return new ac(i=>{let s=null;return s=r[t](e,(o,a)=>{n.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&n.schedule(()=>i.complete())},o=>{n.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&r.off(e,s)}}:{unsubscribe(){}}}).pipe(ht(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),QI())}function q2(r){return typeof r=="string"}function F2(r){return typeof r.exportVal=="function"}function D1(r){return r==null}function x1(r){return typeof r.set=="function"}function C1(r,e){return x1(e)?e:r.ref(e)}function k1(r,e){if(q2(r))return e.stringCase();if(x1(r))return e.firebaseCase();if(F2(r))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof r}`)}function M1(r){return(D1(r)||r.length===0)&&(r=["child_added","child_removed","child_changed","child_moved"]),r}function q1(r,e,t){e=M1(e);let n=e.map(i=>zu(r,i,"on",t));return E_(...n)}function V2(r,e,t){let n=q1(r,e).pipe(ki((i,s)=>[...i,s],[]));return j2(r,n,t)}function L2(r,e){return zu(r,"value","on",e).pipe(ht(t=>{let n;return t.payload.forEach(i=>(n=i.key,!1)),{data:t,lastKeyToLoad:n}}))}function j2(r,e,t){return L2(r,t).pipe(YI(e),ht(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),$I(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),ht(i=>i.actions))}function O1(r,e){return function(n,i){return k1(n,{stringCase:()=>r.child(n)[e](i),firebaseCase:()=>n[e](i),snapshotCase:()=>n.ref[e](i)})}}function U2(r){return function(t){return t?k1(t,{stringCase:()=>r.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):r.remove()}}function B2(r,e,t){return zu(r,"value","once",t).pipe(HI(n=>{let i=[tu(n)];return e.forEach(s=>i.push(zu(r,s,"on",t))),E_(...i).pipe(ki(z2,[]))}),lc())}function F1(r,e){let t=r.length;for(let n=0;n<t;n++)if(r[n].payload.key===e)return n;return-1}function W2(r,e){if(D1(e))return 0;{let t=F1(r,e);return t===-1?r.length:t+1}}function z2(r,e){let{payload:t,prevKey:n,key:i}=e,s=F1(r,i),o=W2(r,n);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,r=[...r,c],!1})}return r;case"child_added":if(s>-1)(r[s-1]?.key||null)!==n&&(r=r.filter(u=>u.payload.key!==t.key),r.splice(o,0,e));else{if(n==null)return[e,...r];r=r.slice(),r.splice(o,0,e)}return r;case"child_removed":return r.filter(a=>a.payload.key!==t.key);case"child_changed":return r.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=r.splice(s,1)[0];return r=r.slice(),r.splice(o,0,a),r}return r;default:return r}}function R1(r,e,t){return e=M1(e),B2(r,e,t)}function K2(r,e){let t=e.schedulers.outsideAngular,n=e.schedulers.ngZone.run(()=>r.ref);return{query:r,update:O1(n,"update"),set:O1(n,"set"),push:i=>n.push(i),remove:U2(n),snapshotChanges(i){return R1(r,i,t).pipe(ut)},stateChanges(i){return q1(r,i,t).pipe(ut)},auditTrail(i){return V2(r,i,t).pipe(ut)},valueChanges(i,s){return R1(r,i,t).pipe(ht(a=>a.map(u=>s&&s.idField?Xa(Sr({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),ut)}}}function N1(r,e){return function(){return zu(r,"value","on",e)}}function G2(r,e){return{query:r,snapshotChanges(){return N1(r,e.schedulers.outsideAngular)().pipe(ut)},update(t){return r.ref.update(t)},set(t){return r.ref.set(t)},remove(){return r.ref.remove()},valueChanges(){return N1(r,e.schedulers.outsideAngular)().pipe(ut,ht(n=>n.payload.exists()?n.payload.val():null))}}}var Q2=new Pn("angularfire2.realtimeDatabaseURL"),$2=new Pn("angularfire2.database.use-emulator"),H2=(()=>{class r{schedulers;database;constructor(t,n,i,s,o,a,u,c,h,f,m,_,v,w,A){this.schedulers=a;let M=u,V=Oc(t,o,n);c&&Fc(V,o,h,m,_,v,f,w),this.database=Rc(`${V.name}.database.${i}`,"AngularFireDatabase",V.name,()=>{let j=o.runOutsideAngular(()=>V.database(i||void 0));return M&&j.useEmulator(...M),j},[M])}list(t,n){let i=this.schedulers.ngZone.runOutsideAngular(()=>C1(this.database,t)),s=i;return n&&(s=n(i)),K2(s,this)}object(t){let n=this.schedulers.ngZone.runOutsideAngular(()=>C1(this.database,t));return G2(n,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(n){return new(n||r)(ue(Pc),ue(Cc,8),ue(Q2,8),ue(dc),ue(Fs),ue(Ac),ue($2,8),ue(Vc,8),ue(Nc,8),ue(Dc,8),ue(xc,8),ue(kc,8),ue(Mc,8),ue(qc,8),ue(Ic,8))};static \u0275prov=Tr({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),V1=(()=>{class r{constructor(){On.registerVersion("angularfire",Tc.full,"rtdb-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Be({type:r});static \u0275inj=Ue({providers:[H2]})}return r})();Me();Me();JI();XI();var L1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},j1={};var jn,ob;(function(){var r;function e(P,b){function I(){}I.prototype=b.prototype,P.D=b.prototype,P.prototype=new I,P.prototype.constructor=P,P.C=function(C,O,N){for(var T=Array(arguments.length-2),Zt=2;Zt<arguments.length;Zt++)T[Zt-2]=arguments[Zt];return b.prototype[O].apply(C,T)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(P,b,I){I||(I=0);var C=Array(16);if(typeof b=="string")for(var O=0;16>O;++O)C[O]=b.charCodeAt(I++)|b.charCodeAt(I++)<<8|b.charCodeAt(I++)<<16|b.charCodeAt(I++)<<24;else for(O=0;16>O;++O)C[O]=b[I++]|b[I++]<<8|b[I++]<<16|b[I++]<<24;b=P.g[0],I=P.g[1],O=P.g[2];var N=P.g[3],T=b+(N^I&(O^N))+C[0]+3614090360&4294967295;b=I+(T<<7&4294967295|T>>>25),T=N+(O^b&(I^O))+C[1]+3905402710&4294967295,N=b+(T<<12&4294967295|T>>>20),T=O+(I^N&(b^I))+C[2]+606105819&4294967295,O=N+(T<<17&4294967295|T>>>15),T=I+(b^O&(N^b))+C[3]+3250441966&4294967295,I=O+(T<<22&4294967295|T>>>10),T=b+(N^I&(O^N))+C[4]+4118548399&4294967295,b=I+(T<<7&4294967295|T>>>25),T=N+(O^b&(I^O))+C[5]+1200080426&4294967295,N=b+(T<<12&4294967295|T>>>20),T=O+(I^N&(b^I))+C[6]+2821735955&4294967295,O=N+(T<<17&4294967295|T>>>15),T=I+(b^O&(N^b))+C[7]+4249261313&4294967295,I=O+(T<<22&4294967295|T>>>10),T=b+(N^I&(O^N))+C[8]+1770035416&4294967295,b=I+(T<<7&4294967295|T>>>25),T=N+(O^b&(I^O))+C[9]+2336552879&4294967295,N=b+(T<<12&4294967295|T>>>20),T=O+(I^N&(b^I))+C[10]+4294925233&4294967295,O=N+(T<<17&4294967295|T>>>15),T=I+(b^O&(N^b))+C[11]+2304563134&4294967295,I=O+(T<<22&4294967295|T>>>10),T=b+(N^I&(O^N))+C[12]+1804603682&4294967295,b=I+(T<<7&4294967295|T>>>25),T=N+(O^b&(I^O))+C[13]+4254626195&4294967295,N=b+(T<<12&4294967295|T>>>20),T=O+(I^N&(b^I))+C[14]+2792965006&4294967295,O=N+(T<<17&4294967295|T>>>15),T=I+(b^O&(N^b))+C[15]+1236535329&4294967295,I=O+(T<<22&4294967295|T>>>10),T=b+(O^N&(I^O))+C[1]+4129170786&4294967295,b=I+(T<<5&4294967295|T>>>27),T=N+(I^O&(b^I))+C[6]+3225465664&4294967295,N=b+(T<<9&4294967295|T>>>23),T=O+(b^I&(N^b))+C[11]+643717713&4294967295,O=N+(T<<14&4294967295|T>>>18),T=I+(N^b&(O^N))+C[0]+3921069994&4294967295,I=O+(T<<20&4294967295|T>>>12),T=b+(O^N&(I^O))+C[5]+3593408605&4294967295,b=I+(T<<5&4294967295|T>>>27),T=N+(I^O&(b^I))+C[10]+38016083&4294967295,N=b+(T<<9&4294967295|T>>>23),T=O+(b^I&(N^b))+C[15]+3634488961&4294967295,O=N+(T<<14&4294967295|T>>>18),T=I+(N^b&(O^N))+C[4]+3889429448&4294967295,I=O+(T<<20&4294967295|T>>>12),T=b+(O^N&(I^O))+C[9]+568446438&4294967295,b=I+(T<<5&4294967295|T>>>27),T=N+(I^O&(b^I))+C[14]+3275163606&4294967295,N=b+(T<<9&4294967295|T>>>23),T=O+(b^I&(N^b))+C[3]+4107603335&4294967295,O=N+(T<<14&4294967295|T>>>18),T=I+(N^b&(O^N))+C[8]+1163531501&4294967295,I=O+(T<<20&4294967295|T>>>12),T=b+(O^N&(I^O))+C[13]+2850285829&4294967295,b=I+(T<<5&4294967295|T>>>27),T=N+(I^O&(b^I))+C[2]+4243563512&4294967295,N=b+(T<<9&4294967295|T>>>23),T=O+(b^I&(N^b))+C[7]+1735328473&4294967295,O=N+(T<<14&4294967295|T>>>18),T=I+(N^b&(O^N))+C[12]+2368359562&4294967295,I=O+(T<<20&4294967295|T>>>12),T=b+(I^O^N)+C[5]+4294588738&4294967295,b=I+(T<<4&4294967295|T>>>28),T=N+(b^I^O)+C[8]+2272392833&4294967295,N=b+(T<<11&4294967295|T>>>21),T=O+(N^b^I)+C[11]+1839030562&4294967295,O=N+(T<<16&4294967295|T>>>16),T=I+(O^N^b)+C[14]+4259657740&4294967295,I=O+(T<<23&4294967295|T>>>9),T=b+(I^O^N)+C[1]+2763975236&4294967295,b=I+(T<<4&4294967295|T>>>28),T=N+(b^I^O)+C[4]+1272893353&4294967295,N=b+(T<<11&4294967295|T>>>21),T=O+(N^b^I)+C[7]+4139469664&4294967295,O=N+(T<<16&4294967295|T>>>16),T=I+(O^N^b)+C[10]+3200236656&4294967295,I=O+(T<<23&4294967295|T>>>9),T=b+(I^O^N)+C[13]+681279174&4294967295,b=I+(T<<4&4294967295|T>>>28),T=N+(b^I^O)+C[0]+3936430074&4294967295,N=b+(T<<11&4294967295|T>>>21),T=O+(N^b^I)+C[3]+3572445317&4294967295,O=N+(T<<16&4294967295|T>>>16),T=I+(O^N^b)+C[6]+76029189&4294967295,I=O+(T<<23&4294967295|T>>>9),T=b+(I^O^N)+C[9]+3654602809&4294967295,b=I+(T<<4&4294967295|T>>>28),T=N+(b^I^O)+C[12]+3873151461&4294967295,N=b+(T<<11&4294967295|T>>>21),T=O+(N^b^I)+C[15]+530742520&4294967295,O=N+(T<<16&4294967295|T>>>16),T=I+(O^N^b)+C[2]+3299628645&4294967295,I=O+(T<<23&4294967295|T>>>9),T=b+(O^(I|~N))+C[0]+4096336452&4294967295,b=I+(T<<6&4294967295|T>>>26),T=N+(I^(b|~O))+C[7]+1126891415&4294967295,N=b+(T<<10&4294967295|T>>>22),T=O+(b^(N|~I))+C[14]+2878612391&4294967295,O=N+(T<<15&4294967295|T>>>17),T=I+(N^(O|~b))+C[5]+4237533241&4294967295,I=O+(T<<21&4294967295|T>>>11),T=b+(O^(I|~N))+C[12]+1700485571&4294967295,b=I+(T<<6&4294967295|T>>>26),T=N+(I^(b|~O))+C[3]+2399980690&4294967295,N=b+(T<<10&4294967295|T>>>22),T=O+(b^(N|~I))+C[10]+4293915773&4294967295,O=N+(T<<15&4294967295|T>>>17),T=I+(N^(O|~b))+C[1]+2240044497&4294967295,I=O+(T<<21&4294967295|T>>>11),T=b+(O^(I|~N))+C[8]+1873313359&4294967295,b=I+(T<<6&4294967295|T>>>26),T=N+(I^(b|~O))+C[15]+4264355552&4294967295,N=b+(T<<10&4294967295|T>>>22),T=O+(b^(N|~I))+C[6]+2734768916&4294967295,O=N+(T<<15&4294967295|T>>>17),T=I+(N^(O|~b))+C[13]+1309151649&4294967295,I=O+(T<<21&4294967295|T>>>11),T=b+(O^(I|~N))+C[4]+4149444226&4294967295,b=I+(T<<6&4294967295|T>>>26),T=N+(I^(b|~O))+C[11]+3174756917&4294967295,N=b+(T<<10&4294967295|T>>>22),T=O+(b^(N|~I))+C[2]+718787259&4294967295,O=N+(T<<15&4294967295|T>>>17),T=I+(N^(O|~b))+C[9]+3951481745&4294967295,P.g[0]=P.g[0]+b&4294967295,P.g[1]=P.g[1]+(O+(T<<21&4294967295|T>>>11))&4294967295,P.g[2]=P.g[2]+O&4294967295,P.g[3]=P.g[3]+N&4294967295}n.prototype.u=function(P,b){b===void 0&&(b=P.length);for(var I=b-this.blockSize,C=this.B,O=this.h,N=0;N<b;){if(O==0)for(;N<=I;)i(this,P,N),N+=this.blockSize;if(typeof P=="string"){for(;N<b;)if(C[O++]=P.charCodeAt(N++),O==this.blockSize){i(this,C),O=0;break}}else for(;N<b;)if(C[O++]=P[N++],O==this.blockSize){i(this,C),O=0;break}}this.h=O,this.o+=b},n.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var b=1;b<P.length-8;++b)P[b]=0;var I=8*this.o;for(b=P.length-8;b<P.length;++b)P[b]=I&255,I/=256;for(this.u(P),P=Array(16),b=I=0;4>b;++b)for(var C=0;32>C;C+=8)P[I++]=this.g[b]>>>C&255;return P};function s(P,b){var I=a;return Object.prototype.hasOwnProperty.call(I,P)?I[P]:I[P]=b(P)}function o(P,b){this.h=b;for(var I=[],C=!0,O=P.length-1;0<=O;O--){var N=P[O]|0;C&&N==b||(I[O]=N,C=!1)}this.g=I}var a={};function u(P){return-128<=P&&128>P?s(P,function(b){return new o([b|0],0>b?-1:0)}):new o([P|0],0>P?-1:0)}function c(P){if(isNaN(P)||!isFinite(P))return f;if(0>P)return A(c(-P));for(var b=[],I=1,C=0;P>=I;C++)b[C]=P/I|0,I*=4294967296;return new o(b,0)}function h(P,b){if(P.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(P.charAt(0)=="-")return A(h(P.substring(1),b));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(b,8)),C=f,O=0;O<P.length;O+=8){var N=Math.min(8,P.length-O),T=parseInt(P.substring(O,O+N),b);8>N?(N=c(Math.pow(b,N)),C=C.j(N).add(c(T))):(C=C.j(I),C=C.add(c(T)))}return C}var f=u(0),m=u(1),_=u(16777216);r=o.prototype,r.m=function(){if(w(this))return-A(this).m();for(var P=0,b=1,I=0;I<this.g.length;I++){var C=this.i(I);P+=(0<=C?C:4294967296+C)*b,b*=4294967296}return P},r.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(v(this))return"0";if(w(this))return"-"+A(this).toString(P);for(var b=c(Math.pow(P,6)),I=this,C="";;){var O=G(I,b).g;I=M(I,O.j(b));var N=((0<I.g.length?I.g[0]:I.h)>>>0).toString(P);if(I=O,v(I))return N+C;for(;6>N.length;)N="0"+N;C=N+C}},r.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function v(P){if(P.h!=0)return!1;for(var b=0;b<P.g.length;b++)if(P.g[b]!=0)return!1;return!0}function w(P){return P.h==-1}r.l=function(P){return P=M(this,P),w(P)?-1:v(P)?0:1};function A(P){for(var b=P.g.length,I=[],C=0;C<b;C++)I[C]=~P.g[C];return new o(I,~P.h).add(m)}r.abs=function(){return w(this)?A(this):this},r.add=function(P){for(var b=Math.max(this.g.length,P.g.length),I=[],C=0,O=0;O<=b;O++){var N=C+(this.i(O)&65535)+(P.i(O)&65535),T=(N>>>16)+(this.i(O)>>>16)+(P.i(O)>>>16);C=T>>>16,N&=65535,T&=65535,I[O]=T<<16|N}return new o(I,I[I.length-1]&-2147483648?-1:0)};function M(P,b){return P.add(A(b))}r.j=function(P){if(v(this)||v(P))return f;if(w(this))return w(P)?A(this).j(A(P)):A(A(this).j(P));if(w(P))return A(this.j(A(P)));if(0>this.l(_)&&0>P.l(_))return c(this.m()*P.m());for(var b=this.g.length+P.g.length,I=[],C=0;C<2*b;C++)I[C]=0;for(C=0;C<this.g.length;C++)for(var O=0;O<P.g.length;O++){var N=this.i(C)>>>16,T=this.i(C)&65535,Zt=P.i(O)>>>16,wn=P.i(O)&65535;I[2*C+2*O]+=T*wn,V(I,2*C+2*O),I[2*C+2*O+1]+=N*wn,V(I,2*C+2*O+1),I[2*C+2*O+1]+=T*Zt,V(I,2*C+2*O+1),I[2*C+2*O+2]+=N*Zt,V(I,2*C+2*O+2)}for(C=0;C<b;C++)I[C]=I[2*C+1]<<16|I[2*C];for(C=b;C<2*b;C++)I[C]=0;return new o(I,0)};function V(P,b){for(;(P[b]&65535)!=P[b];)P[b+1]+=P[b]>>>16,P[b]&=65535,b++}function j(P,b){this.g=P,this.h=b}function G(P,b){if(v(b))throw Error("division by zero");if(v(P))return new j(f,f);if(w(P))return b=G(A(P),b),new j(A(b.g),A(b.h));if(w(b))return b=G(P,A(b)),new j(A(b.g),b.h);if(30<P.g.length){if(w(P)||w(b))throw Error("slowDivide_ only works with positive integers.");for(var I=m,C=b;0>=C.l(P);)I=te(I),C=te(C);var O=H(I,1),N=H(C,1);for(C=H(C,2),I=H(I,2);!v(C);){var T=N.add(C);0>=T.l(P)&&(O=O.add(I),N=T),C=H(C,1),I=H(I,1)}return b=M(P,O.j(b)),new j(O,b)}for(O=f;0<=P.l(b);){for(I=Math.max(1,Math.floor(P.m()/b.m())),C=Math.ceil(Math.log(I)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),N=c(I),T=N.j(b);w(T)||0<T.l(P);)I-=C,N=c(I),T=N.j(b);v(N)&&(N=m),O=O.add(N),P=M(P,T)}return new j(O,P)}r.A=function(P){return G(this,P).h},r.and=function(P){for(var b=Math.max(this.g.length,P.g.length),I=[],C=0;C<b;C++)I[C]=this.i(C)&P.i(C);return new o(I,this.h&P.h)},r.or=function(P){for(var b=Math.max(this.g.length,P.g.length),I=[],C=0;C<b;C++)I[C]=this.i(C)|P.i(C);return new o(I,this.h|P.h)},r.xor=function(P){for(var b=Math.max(this.g.length,P.g.length),I=[],C=0;C<b;C++)I[C]=this.i(C)^P.i(C);return new o(I,this.h^P.h)};function te(P){for(var b=P.g.length+1,I=[],C=0;C<b;C++)I[C]=P.i(C)<<1|P.i(C-1)>>>31;return new o(I,P.h)}function H(P,b){var I=b>>5;b%=32;for(var C=P.g.length-I,O=[],N=0;N<C;N++)O[N]=0<b?P.i(N+I)>>>b|P.i(N+I+1)<<32-b:P.i(N+I);return new o(O,P.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,ob=j1.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,jn=j1.Integer=o}).apply(typeof L1<"u"?L1:typeof self<"u"?self:typeof window<"u"?window:{});var Zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},sn={};var ab,Y2,ao,ub,Ku,ed,lb,cb,hb;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,d,p){return l==Array.prototype||l==Object.prototype||(l[d]=p.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zh=="object"&&Zh];for(var d=0;d<l.length;++d){var p=l[d];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var n=t(this);function i(l,d){if(d)e:{var p=n;l=l.split(".");for(var y=0;y<l.length-1;y++){var R=l[y];if(!(R in p))break e;p=p[R]}l=l[l.length-1],y=p[l],d=d(y),d!=y&&d!=null&&e(p,l,{configurable:!0,writable:!0,value:d})}}function s(l,d){l instanceof String&&(l+="");var p=0,y=!1,R={next:function(){if(!y&&p<l.length){var x=p++;return{value:d(x,l[x]),done:!1}}return y=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}i("Array.prototype.values",function(l){return l||function(){return s(this,function(d,p){return p})}});var o=o||{},a=this||self;function u(l){var d=typeof l;return d=d!="object"?d:l?Array.isArray(l)?"array":d:"null",d=="array"||d=="object"&&typeof l.length=="number"}function c(l){var d=typeof l;return d=="object"&&l!=null||d=="function"}function h(l,d,p){return l.call.apply(l.bind,arguments)}function f(l,d,p){if(!l)throw Error();if(2<arguments.length){var y=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,y),l.apply(d,R)}}return function(){return l.apply(d,arguments)}}function m(l,d,p){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function _(l,d){var p=Array.prototype.slice.call(arguments,1);return function(){var y=p.slice();return y.push.apply(y,arguments),l.apply(this,y)}}function v(l,d){function p(){}p.prototype=d.prototype,l.aa=d.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(y,R,x){for(var B=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)B[Ae-2]=arguments[Ae];return d.prototype[R].apply(y,B)}}function w(l){let d=l.length;if(0<d){let p=Array(d);for(let y=0;y<d;y++)p[y]=l[y];return p}return[]}function A(l,d){for(let p=1;p<arguments.length;p++){let y=arguments[p];if(u(y)){let R=l.length||0,x=y.length||0;l.length=R+x;for(let B=0;B<x;B++)l[R+B]=y[B]}else l.push(y)}}class M{constructor(d,p){this.i=d,this.j=p,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function V(l){return/^[\s\xa0]*$/.test(l)}function j(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function G(l){return G[" "](l),l}G[" "]=function(){};var te=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function H(l,d,p){for(let y in l)d.call(p,l[y],y,l)}function P(l,d){for(let p in l)d.call(void 0,l[p],p,l)}function b(l){let d={};for(let p in l)d[p]=l[p];return d}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(l,d){let p,y;for(let R=1;R<arguments.length;R++){y=arguments[R];for(p in y)l[p]=y[p];for(let x=0;x<I.length;x++)p=I[x],Object.prototype.hasOwnProperty.call(y,p)&&(l[p]=y[p])}}function O(l){var d=1;l=l.split(":");let p=[];for(;0<d&&l.length;)p.push(l.shift()),d--;return l.length&&p.push(l.join(":")),p}function N(l){a.setTimeout(()=>{throw l},0)}function T(){var l=de;let d=null;return l.g&&(d=l.g,l.g=l.g.next,l.g||(l.h=null),d.next=null),d}class Zt{constructor(){this.h=this.g=null}add(d,p){let y=wn.get();y.set(d,p),this.h?this.h.next=y:this.g=y,this.h=y}}var wn=new M(()=>new $,l=>l.reset());class ${constructor(){this.next=this.g=this.h=null}set(d,p){this.h=d,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let X,ee=!1,de=new Zt,Ye=()=>{let l=a.Promise.resolve(void 0);X=()=>{l.then(er)}};var er=()=>{for(var l;l=T();){try{l.h.call(l.g)}catch(p){N(p)}var d=wn;d.j(l),100>d.h&&(d.h++,l.next=d.g,d.g=l)}ee=!1};function Ge(){this.s=this.s,this.C=this.C}Ge.prototype.s=!1,Ge.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ge.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(l,d){this.type=l,this.g=this.target=d,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,d=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let p=()=>{};a.addEventListener("test",p,d),a.removeEventListener("test",p,d)}catch{}return l}();function En(l,d){if(De.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,y=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=d,d=l.relatedTarget){if(te){e:{try{G(d.nodeName);var R=!0;break e}catch{}R=!1}R||(d=null)}}else p=="mouseover"?d=l.fromElement:p=="mouseout"&&(d=l.toElement);this.relatedTarget=d,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Hg[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&En.aa.h.call(this)}}v(En,De);var Hg={2:"touch",3:"pen",4:"mouse"};En.prototype.h=function(){En.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Qe="closure_listenable_"+(1e6*Math.random()|0),Jr=0;function qt(l,d,p,y,R){this.listener=l,this.proxy=null,this.src=d,this.type=p,this.capture=!!y,this.ha=R,this.key=++Jr,this.da=this.fa=!1}function Xr(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Sn(l){this.src=l,this.g={},this.h=0}Sn.prototype.add=function(l,d,p,y,R){var x=l.toString();l=this.g[x],l||(l=this.g[x]=[],this.h++);var B=Jg(l,d,y,R);return-1<B?(d=l[B],p||(d.fa=!1)):(d=new qt(d,this.src,x,!!y,R),d.fa=p,l.push(d)),d};function Yg(l,d){var p=d.type;if(p in l.g){var y=l.g[p],R=Array.prototype.indexOf.call(y,d,void 0),x;(x=0<=R)&&Array.prototype.splice.call(y,R,1),x&&(Xr(d),l.g[p].length==0&&(delete l.g[p],l.h--))}}function Jg(l,d,p,y){for(var R=0;R<l.length;++R){var x=l[R];if(!x.da&&x.listener==d&&x.capture==!!p&&x.ha==y)return R}return-1}var Xg="closure_lm_"+(1e6*Math.random()|0),Zg={};function G0(l,d,p,y,R){if(y&&y.once)return $0(l,d,p,y,R);if(Array.isArray(d)){for(var x=0;x<d.length;x++)G0(l,d[x],p,y,R);return null}return p=n_(p),l&&l[Qe]?l.K(d,p,c(y)?!!y.capture:!!y,R):Q0(l,d,p,!1,y,R)}function Q0(l,d,p,y,R,x){if(!d)throw Error("Invalid event type");var B=c(R)?!!R.capture:!!R,Ae=t_(l);if(Ae||(l[Xg]=Ae=new Sn(l)),p=Ae.add(d,p,y,B,x),p.proxy)return p;if(y=Mq(),p.proxy=y,y.src=l,y.listener=p,l.addEventListener)xe||(R=B),R===void 0&&(R=!1),l.addEventListener(d.toString(),y,R);else if(l.attachEvent)l.attachEvent(Y0(d.toString()),y);else if(l.addListener&&l.removeListener)l.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Mq(){function l(p){return d.call(l.src,l.listener,p)}let d=qq;return l}function $0(l,d,p,y,R){if(Array.isArray(d)){for(var x=0;x<d.length;x++)$0(l,d[x],p,y,R);return null}return p=n_(p),l&&l[Qe]?l.L(d,p,c(y)?!!y.capture:!!y,R):Q0(l,d,p,!0,y,R)}function H0(l,d,p,y,R){if(Array.isArray(d))for(var x=0;x<d.length;x++)H0(l,d[x],p,y,R);else y=c(y)?!!y.capture:!!y,p=n_(p),l&&l[Qe]?(l=l.i,d=String(d).toString(),d in l.g&&(x=l.g[d],p=Jg(x,p,y,R),-1<p&&(Xr(x[p]),Array.prototype.splice.call(x,p,1),x.length==0&&(delete l.g[d],l.h--)))):l&&(l=t_(l))&&(d=l.g[d.toString()],l=-1,d&&(l=Jg(d,p,y,R)),(p=-1<l?d[l]:null)&&e_(p))}function e_(l){if(typeof l!="number"&&l&&!l.da){var d=l.src;if(d&&d[Qe])Yg(d.i,l);else{var p=l.type,y=l.proxy;d.removeEventListener?d.removeEventListener(p,y,l.capture):d.detachEvent?d.detachEvent(Y0(p),y):d.addListener&&d.removeListener&&d.removeListener(y),(p=t_(d))?(Yg(p,l),p.h==0&&(p.src=null,d[Xg]=null)):Xr(l)}}}function Y0(l){return l in Zg?Zg[l]:Zg[l]="on"+l}function qq(l,d){if(l.da)l=!0;else{d=new En(d,this);var p=l.listener,y=l.ha||l.src;l.fa&&e_(l),l=p.call(y,d)}return l}function t_(l){return l=l[Xg],l instanceof Sn?l:null}var r_="__closure_events_fn_"+(1e9*Math.random()>>>0);function n_(l){return typeof l=="function"?l:(l[r_]||(l[r_]=function(d){return l.handleEvent(d)}),l[r_])}function wt(){Ge.call(this),this.i=new Sn(this),this.M=this,this.F=null}v(wt,Ge),wt.prototype[Qe]=!0,wt.prototype.removeEventListener=function(l,d,p,y){H0(this,l,d,p,y)};function Pt(l,d){var p,y=l.F;if(y)for(p=[];y;y=y.F)p.push(y);if(l=l.M,y=d.type||d,typeof d=="string")d=new De(d,l);else if(d instanceof De)d.target=d.target||l;else{var R=d;d=new De(y,l),C(d,R)}if(R=!0,p)for(var x=p.length-1;0<=x;x--){var B=d.g=p[x];R=Gl(B,y,!0,d)&&R}if(B=d.g=l,R=Gl(B,y,!0,d)&&R,R=Gl(B,y,!1,d)&&R,p)for(x=0;x<p.length;x++)B=d.g=p[x],R=Gl(B,y,!1,d)&&R}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var l=this.i,d;for(d in l.g){for(var p=l.g[d],y=0;y<p.length;y++)Xr(p[y]);delete l.g[d],l.h--}}this.F=null},wt.prototype.K=function(l,d,p,y){return this.i.add(String(l),d,!1,p,y)},wt.prototype.L=function(l,d,p,y){return this.i.add(String(l),d,!0,p,y)};function Gl(l,d,p,y){if(d=l.i.g[String(d)],!d)return!0;d=d.concat();for(var R=!0,x=0;x<d.length;++x){var B=d[x];if(B&&!B.da&&B.capture==p){var Ae=B.listener,pt=B.ha||B.src;B.fa&&Yg(l.i,B),R=Ae.call(pt,y)!==!1&&R}}return R&&!y.defaultPrevented}function J0(l,d,p){if(typeof l=="function")p&&(l=m(l,p));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:a.setTimeout(l,d||0)}function X0(l){l.g=J0(()=>{l.g=null,l.i&&(l.i=!1,X0(l))},l.l);let d=l.h;l.h=null,l.m.apply(null,d)}class Fq extends Ge{constructor(d,p){super(),this.m=d,this.l=p,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:X0(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Va(l){Ge.call(this),this.h=l,this.g={}}v(Va,Ge);var Z0=[];function eI(l){H(l.g,function(d,p){this.g.hasOwnProperty(p)&&e_(d)},l),l.g={}}Va.prototype.N=function(){Va.aa.N.call(this),eI(this)},Va.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var i_=a.JSON.stringify,Vq=a.JSON.parse,Lq=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function s_(){}s_.prototype.h=null;function tI(l){return l.h||(l.h=l.i())}function rI(){}var La={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function o_(){De.call(this,"d")}v(o_,De);function a_(){De.call(this,"c")}v(a_,De);var Ri={},nI=null;function Ql(){return nI=nI||new wt}Ri.La="serverreachability";function iI(l){De.call(this,Ri.La,l)}v(iI,De);function ja(l){let d=Ql();Pt(d,new iI(d))}Ri.STAT_EVENT="statevent";function sI(l,d){De.call(this,Ri.STAT_EVENT,l),this.stat=d}v(sI,De);function Ct(l){let d=Ql();Pt(d,new sI(d,l))}Ri.Ma="timingevent";function oI(l,d){De.call(this,Ri.Ma,l),this.size=d}v(oI,De);function Ua(l,d){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},d)}function Ba(){this.g=!0}Ba.prototype.xa=function(){this.g=!1};function jq(l,d,p,y,R,x){l.info(function(){if(l.g)if(x)for(var B="",Ae=x.split("&"),pt=0;pt<Ae.length;pt++){var be=Ae[pt].split("=");if(1<be.length){var Et=be[0];be=be[1];var St=Et.split("_");B=2<=St.length&&St[1]=="type"?B+(Et+"="+be+"&"):B+(Et+"=redacted&")}}else B=null;else B=x;return"XMLHTTP REQ ("+y+") [attempt "+R+"]: "+d+`
`+p+`
`+B})}function Uq(l,d,p,y,R,x,B){l.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+R+"]: "+d+`
`+p+`
`+x+" "+B})}function xs(l,d,p,y){l.info(function(){return"XMLHTTP TEXT ("+d+"): "+Wq(l,p)+(y?" "+y:"")})}function Bq(l,d){l.info(function(){return"TIMEOUT: "+d})}Ba.prototype.info=function(){};function Wq(l,d){if(!l.g)return d;if(!d)return null;try{var p=JSON.parse(d);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var y=p[l];if(!(2>y.length)){var R=y[1];if(Array.isArray(R)&&!(1>R.length)){var x=R[0];if(x!="noop"&&x!="stop"&&x!="close")for(var B=1;B<R.length;B++)R[B]=""}}}}return i_(p)}catch{return d}}var $l={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},aI={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},u_;function Hl(){}v(Hl,s_),Hl.prototype.g=function(){return new XMLHttpRequest},Hl.prototype.i=function(){return{}},u_=new Hl;function Tn(l,d,p,y){this.j=l,this.i=d,this.l=p,this.R=y||1,this.U=new Va(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new uI}function uI(){this.i=null,this.g="",this.h=!1}var lI={},l_={};function c_(l,d,p){l.L=1,l.v=Zl(Zr(d)),l.m=p,l.P=!0,cI(l,null)}function cI(l,d){l.F=Date.now(),Yl(l),l.A=Zr(l.v);var p=l.A,y=l.R;Array.isArray(y)||(y=[String(y)]),TI(p.i,"t",y),l.C=0,p=l.j.J,l.h=new uI,l.g=BI(l.j,p?d:null,!l.m),0<l.O&&(l.M=new Fq(m(l.Y,l,l.g),l.O)),d=l.U,p=l.g,y=l.ca;var R="readystatechange";Array.isArray(R)||(R&&(Z0[0]=R.toString()),R=Z0);for(var x=0;x<R.length;x++){var B=G0(p,R[x],y||d.handleEvent,!1,d.h||d);if(!B)break;d.g[B.key]=B}d=l.H?b(l.H):{},l.m?(l.u||(l.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,d)):(l.u="GET",l.g.ea(l.A,l.u,null,d)),ja(),jq(l.i,l.u,l.A,l.l,l.R,l.m)}Tn.prototype.ca=function(l){l=l.target;let d=this.M;d&&en(l)==3?d.j():this.Y(l)},Tn.prototype.Y=function(l){try{if(l==this.g)e:{let St=en(this.g);var d=this.g.Ba();let qs=this.g.Z();if(!(3>St)&&(St!=3||this.g&&(this.h.h||this.g.oa()||NI(this.g)))){this.J||St!=4||d==7||(d==8||0>=qs?ja(3):ja(2)),h_(this);var p=this.g.Z();this.X=p;t:if(hI(this)){var y=NI(this.g);l="";var R=y.length,x=en(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ni(this),Wa(this);var B="";break t}this.h.i=new a.TextDecoder}for(d=0;d<R;d++)this.h.h=!0,l+=this.h.i.decode(y[d],{stream:!(x&&d==R-1)});y.length=0,this.h.g+=l,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=p==200,Uq(this.i,this.u,this.A,this.l,this.R,St,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Ae,pt=this.g;if((Ae=pt.g?pt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(Ae)){var be=Ae;break t}}be=null}if(p=be)xs(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,d_(this,p);else{this.o=!1,this.s=3,Ct(12),Ni(this),Wa(this);break e}}if(this.P){p=!0;let hr;for(;!this.J&&this.C<B.length;)if(hr=zq(this,B),hr==l_){St==4&&(this.s=4,Ct(14),p=!1),xs(this.i,this.l,null,"[Incomplete Response]");break}else if(hr==lI){this.s=4,Ct(15),xs(this.i,this.l,B,"[Invalid Chunk]"),p=!1;break}else xs(this.i,this.l,hr,null),d_(this,hr);if(hI(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),St!=4||B.length!=0||this.h.h||(this.s=1,Ct(16),p=!1),this.o=this.o&&p,!p)xs(this.i,this.l,B,"[Invalid Chunked Response]"),Ni(this),Wa(this);else if(0<B.length&&!this.W){this.W=!0;var Et=this.j;Et.g==this&&Et.ba&&!Et.M&&(Et.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),y_(Et),Et.M=!0,Ct(11))}}else xs(this.i,this.l,B,null),d_(this,B);St==4&&Ni(this),this.o&&!this.J&&(St==4?VI(this.j,this):(this.o=!1,Yl(this)))}else aF(this.g),p==400&&0<B.indexOf("Unknown SID")?(this.s=3,Ct(12)):(this.s=0,Ct(13)),Ni(this),Wa(this)}}}catch{}finally{}};function hI(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function zq(l,d){var p=l.C,y=d.indexOf(`
`,p);return y==-1?l_:(p=Number(d.substring(p,y)),isNaN(p)?lI:(y+=1,y+p>d.length?l_:(d=d.slice(y,y+p),l.C=y+p,d)))}Tn.prototype.cancel=function(){this.J=!0,Ni(this)};function Yl(l){l.S=Date.now()+l.I,dI(l,l.I)}function dI(l,d){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ua(m(l.ba,l),d)}function h_(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Tn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(Bq(this.i,this.A),this.L!=2&&(ja(),Ct(17)),Ni(this),this.s=2,Wa(this)):dI(this,this.S-l)};function Wa(l){l.j.G==0||l.J||VI(l.j,l)}function Ni(l){h_(l);var d=l.M;d&&typeof d.ma=="function"&&d.ma(),l.M=null,eI(l.U),l.g&&(d=l.g,l.g=null,d.abort(),d.ma())}function d_(l,d){try{var p=l.j;if(p.G!=0&&(p.g==l||f_(p.h,l))){if(!l.K&&f_(p.h,l)&&p.G==3){try{var y=p.Da.g.parse(d)}catch{y=null}if(Array.isArray(y)&&y.length==3){var R=y;if(R[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)ic(p),rc(p);else break e;__(p),Ct(18)}}else p.za=R[1],0<p.za-p.T&&37500>R[2]&&p.F&&p.v==0&&!p.C&&(p.C=Ua(m(p.Za,p),6e3));if(1>=mI(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else xi(p,11)}else if((l.K||p.g==l)&&ic(p),!V(d))for(R=p.Da.g.parse(d),d=0;d<R.length;d++){let be=R[d];if(p.T=be[0],be=be[1],p.G==2)if(be[0]=="c"){p.K=be[1],p.ia=be[2];let Et=be[3];Et!=null&&(p.la=Et,p.j.info("VER="+p.la));let St=be[4];St!=null&&(p.Aa=St,p.j.info("SVER="+p.Aa));let qs=be[5];qs!=null&&typeof qs=="number"&&0<qs&&(y=1.5*qs,p.L=y,p.j.info("backChannelRequestTimeoutMs_="+y)),y=p;let hr=l.g;if(hr){let oc=hr.g?hr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(oc){var x=y.h;x.g||oc.indexOf("spdy")==-1&&oc.indexOf("quic")==-1&&oc.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(p_(x,x.h),x.h=null))}if(y.D){let v_=hr.g?hr.g.getResponseHeader("X-HTTP-Session-Id"):null;v_&&(y.ya=v_,ke(y.I,y.D,v_))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),y=p;var B=l;if(y.qa=UI(y,y.J?y.ia:null,y.W),B.K){gI(y.h,B);var Ae=B,pt=y.L;pt&&(Ae.I=pt),Ae.B&&(h_(Ae),Yl(Ae)),y.g=B}else qI(y);0<p.i.length&&nc(p)}else be[0]!="stop"&&be[0]!="close"||xi(p,7);else p.G==3&&(be[0]=="stop"||be[0]=="close"?be[0]=="stop"?xi(p,7):g_(p):be[0]!="noop"&&p.l&&p.l.ta(be),p.v=0)}}ja(4)}catch{}}var Kq=class{constructor(l,d){this.g=l,this.map=d}};function fI(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function pI(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function mI(l){return l.h?1:l.g?l.g.size:0}function f_(l,d){return l.h?l.h==d:l.g?l.g.has(d):!1}function p_(l,d){l.g?l.g.add(d):l.h=d}function gI(l,d){l.h&&l.h==d?l.h=null:l.g&&l.g.has(d)&&l.g.delete(d)}fI.prototype.cancel=function(){if(this.i=_I(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function _I(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let d=l.i;for(let p of l.g.values())d=d.concat(p.D);return d}return w(l.i)}function Gq(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var d=[],p=l.length,y=0;y<p;y++)d.push(l[y]);return d}d=[],p=0;for(y in l)d[p++]=l[y];return d}function Qq(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var d=[];l=l.length;for(var p=0;p<l;p++)d.push(p);return d}d=[],p=0;for(let y in l)d[p++]=y;return d}}}function yI(l,d){if(l.forEach&&typeof l.forEach=="function")l.forEach(d,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,d,void 0);else for(var p=Qq(l),y=Gq(l),R=y.length,x=0;x<R;x++)d.call(void 0,y[x],p&&p[x],l)}var vI=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $q(l,d){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var y=l[p].indexOf("="),R=null;if(0<=y){var x=l[p].substring(0,y);R=l[p].substring(y+1)}else x=l[p];d(x,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Di(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Di){this.h=l.h,Jl(this,l.j),this.o=l.o,this.g=l.g,Xl(this,l.s),this.l=l.l;var d=l.i,p=new Ga;p.i=d.i,d.g&&(p.g=new Map(d.g),p.h=d.h),bI(this,p),this.m=l.m}else l&&(d=String(l).match(vI))?(this.h=!1,Jl(this,d[1]||"",!0),this.o=za(d[2]||""),this.g=za(d[3]||"",!0),Xl(this,d[4]),this.l=za(d[5]||"",!0),bI(this,d[6]||"",!0),this.m=za(d[7]||"")):(this.h=!1,this.i=new Ga(null,this.h))}Di.prototype.toString=function(){var l=[],d=this.j;d&&l.push(Ka(d,wI,!0),":");var p=this.g;return(p||d=="file")&&(l.push("//"),(d=this.o)&&l.push(Ka(d,wI,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Ka(p,p.charAt(0)=="/"?Jq:Yq,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Ka(p,Zq)),l.join("")};function Zr(l){return new Di(l)}function Jl(l,d,p){l.j=p?za(d,!0):d,l.j&&(l.j=l.j.replace(/:$/,""))}function Xl(l,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);l.s=d}else l.s=null}function bI(l,d,p){d instanceof Ga?(l.i=d,eF(l.i,l.h)):(p||(d=Ka(d,Xq)),l.i=new Ga(d,l.h))}function ke(l,d,p){l.i.set(d,p)}function Zl(l){return ke(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function za(l,d){return l?d?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ka(l,d,p){return typeof l=="string"?(l=encodeURI(l).replace(d,Hq),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function Hq(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var wI=/[#\/\?@]/g,Yq=/[#\?:]/g,Jq=/[#\?]/g,Xq=/[#\?@]/g,Zq=/#/g;function Ga(l,d){this.h=this.g=null,this.i=l||null,this.j=!!d}function In(l){l.g||(l.g=new Map,l.h=0,l.i&&$q(l.i,function(d,p){l.add(decodeURIComponent(d.replace(/\+/g," ")),p)}))}r=Ga.prototype,r.add=function(l,d){In(this),this.i=null,l=ks(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(d),this.h+=1,this};function EI(l,d){In(l),d=ks(l,d),l.g.has(d)&&(l.i=null,l.h-=l.g.get(d).length,l.g.delete(d))}function SI(l,d){return In(l),d=ks(l,d),l.g.has(d)}r.forEach=function(l,d){In(this),this.g.forEach(function(p,y){p.forEach(function(R){l.call(d,R,y,this)},this)},this)},r.na=function(){In(this);let l=Array.from(this.g.values()),d=Array.from(this.g.keys()),p=[];for(let y=0;y<d.length;y++){let R=l[y];for(let x=0;x<R.length;x++)p.push(d[y])}return p},r.V=function(l){In(this);let d=[];if(typeof l=="string")SI(this,l)&&(d=d.concat(this.g.get(ks(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)d=d.concat(l[p])}return d},r.set=function(l,d){return In(this),this.i=null,l=ks(this,l),SI(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[d]),this.h+=1,this},r.get=function(l,d){return l?(l=this.V(l),0<l.length?String(l[0]):d):d};function TI(l,d,p){EI(l,d),0<p.length&&(l.i=null,l.g.set(ks(l,d),w(p)),l.h+=p.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],d=Array.from(this.g.keys());for(var p=0;p<d.length;p++){var y=d[p];let x=encodeURIComponent(String(y)),B=this.V(y);for(y=0;y<B.length;y++){var R=x;B[y]!==""&&(R+="="+encodeURIComponent(String(B[y]))),l.push(R)}}return this.i=l.join("&")};function ks(l,d){return d=String(d),l.j&&(d=d.toLowerCase()),d}function eF(l,d){d&&!l.j&&(In(l),l.i=null,l.g.forEach(function(p,y){var R=y.toLowerCase();y!=R&&(EI(this,y),TI(this,R,p))},l)),l.j=d}function tF(l,d){let p=new Ba;if(a.Image){let y=new Image;y.onload=_(An,p,"TestLoadImage: loaded",!0,d,y),y.onerror=_(An,p,"TestLoadImage: error",!1,d,y),y.onabort=_(An,p,"TestLoadImage: abort",!1,d,y),y.ontimeout=_(An,p,"TestLoadImage: timeout",!1,d,y),a.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=l}else d(!1)}function rF(l,d){let p=new Ba,y=new AbortController,R=setTimeout(()=>{y.abort(),An(p,"TestPingServer: timeout",!1,d)},1e4);fetch(l,{signal:y.signal}).then(x=>{clearTimeout(R),x.ok?An(p,"TestPingServer: ok",!0,d):An(p,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(R),An(p,"TestPingServer: error",!1,d)})}function An(l,d,p,y,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),y(p)}catch{}}function nF(){this.g=new Lq}function iF(l,d,p){let y=p||"";try{yI(l,function(R,x){let B=R;c(R)&&(B=i_(R)),d.push(y+x+"="+encodeURIComponent(B))})}catch(R){throw d.push(y+"type="+encodeURIComponent("_badmap")),R}}function Qa(l){this.l=l.Ub||null,this.j=l.eb||!1}v(Qa,s_),Qa.prototype.g=function(){return new ec(this.l,this.j)},Qa.prototype.i=function(l){return function(){return l}}({});function ec(l,d){wt.call(this),this.D=l,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(ec,wt),r=ec.prototype,r.open=function(l,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=d,this.readyState=1,Ha(this)},r.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(d.body=l),(this.D||a).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,$a(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ha(this)),this.g&&(this.readyState=3,Ha(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;II(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function II(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var d=l.value?l.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!l.done}))&&(this.response=this.responseText+=d)}l.done?$a(this):Ha(this),this.readyState==3&&II(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,$a(this))},r.Qa=function(l){this.g&&(this.response=l,$a(this))},r.ga=function(){this.g&&$a(this)};function $a(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ha(l)}r.setRequestHeader=function(l,d){this.u.append(l,d)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],d=this.h.entries();for(var p=d.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=d.next();return l.join(`\r
`)};function Ha(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ec.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function AI(l){let d="";return H(l,function(p,y){d+=y,d+=":",d+=p,d+=`\r
`}),d}function m_(l,d,p){e:{for(y in p){var y=!1;break e}y=!0}y||(p=AI(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):ke(l,d,p))}function $e(l){wt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v($e,wt);var sF=/^https?$/i,oF=["POST","PUT"];r=$e.prototype,r.Ha=function(l){this.J=l},r.ea=function(l,d,p,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);d=d?d.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():u_.g(),this.v=this.o?tI(this.o):tI(u_),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(d,String(l),!0),this.B=!1}catch(x){PI(this,x);return}if(l=p||"",p=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var R in y)p.set(R,y[R]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(let x of y.keys())p.set(x,y.get(x));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(p.keys()).find(x=>x.toLowerCase()=="content-type"),R=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(oF,d,void 0))||y||R||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[x,B]of p)this.g.setRequestHeader(x,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{RI(this),this.u=!0,this.g.send(l),this.u=!1}catch(x){PI(this,x)}};function PI(l,d){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=d,l.m=5,CI(l),tc(l)}function CI(l){l.A||(l.A=!0,Pt(l,"complete"),Pt(l,"error"))}r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Pt(this,"complete"),Pt(this,"abort"),tc(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tc(this,!0)),$e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?OI(this):this.bb())},r.bb=function(){OI(this)};function OI(l){if(l.h&&typeof o<"u"&&(!l.v[1]||en(l)!=4||l.Z()!=2)){if(l.u&&en(l)==4)J0(l.Ea,0,l);else if(Pt(l,"readystatechange"),en(l)==4){l.h=!1;try{let B=l.Z();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var p;if(!(p=d)){var y;if(y=B===0){var R=String(l.D).match(vI)[1]||null;!R&&a.self&&a.self.location&&(R=a.self.location.protocol.slice(0,-1)),y=!sF.test(R?R.toLowerCase():"")}p=y}if(p)Pt(l,"complete"),Pt(l,"success");else{l.m=6;try{var x=2<en(l)?l.g.statusText:""}catch{x=""}l.l=x+" ["+l.Z()+"]",CI(l)}}finally{tc(l)}}}}function tc(l,d){if(l.g){RI(l);let p=l.g,y=l.v[0]?()=>{}:null;l.g=null,l.v=null,d||Pt(l,"ready");try{p.onreadystatechange=y}catch{}}}function RI(l){l.I&&(a.clearTimeout(l.I),l.I=null)}r.isActive=function(){return!!this.g};function en(l){return l.g?l.g.readyState:0}r.Z=function(){try{return 2<en(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var d=this.g.responseText;return l&&d.indexOf(l)==0&&(d=d.substring(l.length)),Vq(d)}};function NI(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function aF(l){let d={};l=(l.g&&2<=en(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<l.length;y++){if(V(l[y]))continue;var p=O(l[y]);let R=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let x=d[R]||[];d[R]=x,x.push(p)}P(d,function(y){return y.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ya(l,d,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||d}function DI(l){this.Aa=0,this.i=[],this.j=new Ba,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ya("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ya("baseRetryDelayMs",5e3,l),this.cb=Ya("retryDelaySeedMs",1e4,l),this.Wa=Ya("forwardChannelMaxRetries",2,l),this.wa=Ya("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new fI(l&&l.concurrentRequestLimit),this.Da=new nF,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=DI.prototype,r.la=8,r.G=1,r.connect=function(l,d,p,y){Ct(0),this.W=l,this.H=d||{},p&&y!==void 0&&(this.H.OSID=p,this.H.OAID=y),this.F=this.X,this.I=UI(this,null,this.W),nc(this)};function g_(l){if(xI(l),l.G==3){var d=l.U++,p=Zr(l.I);if(ke(p,"SID",l.K),ke(p,"RID",d),ke(p,"TYPE","terminate"),Ja(l,p),d=new Tn(l,l.j,d),d.L=2,d.v=Zl(Zr(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(d.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=d.v,p=!0),p||(d.g=BI(d.j,null),d.g.ea(d.v)),d.F=Date.now(),Yl(d)}jI(l)}function rc(l){l.g&&(y_(l),l.g.cancel(),l.g=null)}function xI(l){rc(l),l.u&&(a.clearTimeout(l.u),l.u=null),ic(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function nc(l){if(!pI(l.h)&&!l.s){l.s=!0;var d=l.Ga;X||Ye(),ee||(X(),ee=!0),de.add(d,l),l.B=0}}function uF(l,d){return mI(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=d.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ua(m(l.Ga,l,d),LI(l,l.B)),l.B++,!0)}r.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let R=new Tn(this,this.j,l),x=this.o;if(this.S&&(x?(x=b(x),C(x,this.S)):x=this.S),this.m!==null||this.O||(R.H=x,x=null),this.P)e:{for(var d=0,p=0;p<this.i.length;p++){t:{var y=this.i[p];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(d+=y,4096<d){d=p;break e}if(d===4096||p===this.i.length-1){d=p+1;break e}}d=1e3}else d=1e3;d=MI(this,R,d),p=Zr(this.I),ke(p,"RID",l),ke(p,"CVER",22),this.D&&ke(p,"X-HTTP-Session-Id",this.D),Ja(this,p),x&&(this.O?d="headers="+encodeURIComponent(String(AI(x)))+"&"+d:this.m&&m_(p,this.m,x)),p_(this.h,R),this.Ua&&ke(p,"TYPE","init"),this.P?(ke(p,"$req",d),ke(p,"SID","null"),R.T=!0,c_(R,p,null)):c_(R,p,d),this.G=2}}else this.G==3&&(l?kI(this,l):this.i.length==0||pI(this.h)||kI(this))};function kI(l,d){var p;d?p=d.l:p=l.U++;let y=Zr(l.I);ke(y,"SID",l.K),ke(y,"RID",p),ke(y,"AID",l.T),Ja(l,y),l.m&&l.o&&m_(y,l.m,l.o),p=new Tn(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),d&&(l.i=d.D.concat(l.i)),d=MI(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),p_(l.h,p),c_(p,y,d)}function Ja(l,d){l.H&&H(l.H,function(p,y){ke(d,y,p)}),l.l&&yI({},function(p,y){ke(d,y,p)})}function MI(l,d,p){p=Math.min(l.i.length,p);var y=l.l?m(l.l.Na,l.l,l):null;e:{var R=l.i;let x=-1;for(;;){let B=["count="+p];x==-1?0<p?(x=R[0].g,B.push("ofs="+x)):x=0:B.push("ofs="+x);let Ae=!0;for(let pt=0;pt<p;pt++){let be=R[pt].g,Et=R[pt].map;if(be-=x,0>be)x=Math.max(0,R[pt].g-100),Ae=!1;else try{iF(Et,B,"req"+be+"_")}catch{y&&y(Et)}}if(Ae){y=B.join("&");break e}}}return l=l.i.splice(0,p),d.D=l,y}function qI(l){if(!l.g&&!l.u){l.Y=1;var d=l.Fa;X||Ye(),ee||(X(),ee=!0),de.add(d,l),l.v=0}}function __(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ua(m(l.Fa,l),LI(l,l.v)),l.v++,!0)}r.Fa=function(){if(this.u=null,FI(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ua(m(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ct(10),rc(this),FI(this))};function y_(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function FI(l){l.g=new Tn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var d=Zr(l.qa);ke(d,"RID","rpc"),ke(d,"SID",l.K),ke(d,"AID",l.T),ke(d,"CI",l.F?"0":"1"),!l.F&&l.ja&&ke(d,"TO",l.ja),ke(d,"TYPE","xmlhttp"),Ja(l,d),l.m&&l.o&&m_(d,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=Zl(Zr(d)),p.m=null,p.P=!0,cI(p,l)}r.Za=function(){this.C!=null&&(this.C=null,rc(this),__(this),Ct(19))};function ic(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function VI(l,d){var p=null;if(l.g==d){ic(l),y_(l),l.g=null;var y=2}else if(f_(l.h,d))p=d.D,gI(l.h,d),y=1;else return;if(l.G!=0){if(d.o)if(y==1){p=d.m?d.m.length:0,d=Date.now()-d.F;var R=l.B;y=Ql(),Pt(y,new oI(y,p)),nc(l)}else qI(l);else if(R=d.s,R==3||R==0&&0<d.X||!(y==1&&uF(l,d)||y==2&&__(l)))switch(p&&0<p.length&&(d=l.h,d.i=d.i.concat(p)),R){case 1:xi(l,5);break;case 4:xi(l,10);break;case 3:xi(l,6);break;default:xi(l,2)}}}function LI(l,d){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*d}function xi(l,d){if(l.j.info("Error code "+d),d==2){var p=m(l.fb,l),y=l.Xa;let R=!y;y=new Di(y||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Jl(y,"https"),Zl(y),R?tF(y.toString(),p):rF(y.toString(),p)}else Ct(2);l.G=0,l.l&&l.l.sa(d),jI(l),xI(l)}r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Ct(2)):(this.j.info("Failed to ping google.com"),Ct(1))};function jI(l){if(l.G=0,l.ka=[],l.l){let d=_I(l.h);(d.length!=0||l.i.length!=0)&&(A(l.ka,d),A(l.ka,l.i),l.h.i.length=0,w(l.i),l.i.length=0),l.l.ra()}}function UI(l,d,p){var y=p instanceof Di?Zr(p):new Di(p);if(y.g!="")d&&(y.g=d+"."+y.g),Xl(y,y.s);else{var R=a.location;y=R.protocol,d=d?d+"."+R.hostname:R.hostname,R=+R.port;var x=new Di(null);y&&Jl(x,y),d&&(x.g=d),R&&Xl(x,R),p&&(x.l=p),y=x}return p=l.D,d=l.ya,p&&d&&ke(y,p,d),ke(y,"VER",l.la),Ja(l,y),y}function BI(l,d,p){if(d&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=l.Ca&&!l.pa?new $e(new Qa({eb:p})):new $e(l.pa),d.Ha(l.J),d}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function WI(){}r=WI.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function sc(){}sc.prototype.g=function(l,d){return new Wt(l,d)};function Wt(l,d){wt.call(this),this.g=new DI(d),this.l=l,this.h=d&&d.messageUrlParams||null,l=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(l?l["X-WebChannel-Content-Type"]=d.messageContentType:l={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(l?l["X-WebChannel-Client-Profile"]=d.va:l={"X-WebChannel-Client-Profile":d.va}),this.g.S=l,(l=d&&d.Sb)&&!V(l)&&(this.g.m=l),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!V(d)&&(this.g.D=d,l=this.h,l!==null&&d in l&&(l=this.h,d in l&&delete l[d])),this.j=new Ms(this)}v(Wt,wt),Wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Wt.prototype.close=function(){g_(this.g)},Wt.prototype.o=function(l){var d=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=i_(l),l=p);d.i.push(new Kq(d.Ya++,l)),d.G==3&&nc(d)},Wt.prototype.N=function(){this.g.l=null,delete this.j,g_(this.g),delete this.g,Wt.aa.N.call(this)};function zI(l){o_.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var d=l.__sm__;if(d){e:{for(let p in d){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,d=d!==null&&l in d?d[l]:void 0),this.data=d}else this.data=l}v(zI,o_);function KI(){a_.call(this),this.status=1}v(KI,a_);function Ms(l){this.g=l}v(Ms,WI),Ms.prototype.ua=function(){Pt(this.g,"a")},Ms.prototype.ta=function(l){Pt(this.g,new zI(l))},Ms.prototype.sa=function(l){Pt(this.g,new KI)},Ms.prototype.ra=function(){Pt(this.g,"b")},sc.prototype.createWebChannel=sc.prototype.g,Wt.prototype.send=Wt.prototype.o,Wt.prototype.open=Wt.prototype.m,Wt.prototype.close=Wt.prototype.close,hb=sn.createWebChannelTransport=function(){return new sc},cb=sn.getStatEventTarget=function(){return Ql()},lb=sn.Event=Ri,ed=sn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},$l.NO_ERROR=0,$l.TIMEOUT=8,$l.HTTP_ERROR=6,Ku=sn.ErrorCode=$l,aI.COMPLETE="complete",ub=sn.EventType=aI,rI.EventType=La,La.OPEN="a",La.CLOSE="b",La.ERROR="c",La.MESSAGE="d",wt.prototype.listen=wt.prototype.K,ao=sn.WebChannel=rI,Y2=sn.FetchXmlHttpFactory=Qa,$e.prototype.listenOnce=$e.prototype.L,$e.prototype.getLastError=$e.prototype.Ka,$e.prototype.getLastErrorCode=$e.prototype.Ba,$e.prototype.getStatus=$e.prototype.Z,$e.prototype.getResponseJson=$e.prototype.Oa,$e.prototype.getResponseText=$e.prototype.oa,$e.prototype.send=$e.prototype.ea,$e.prototype.setWithCredentials=$e.prototype.Ha,ab=sn.XhrIo=$e}).apply(typeof Zh<"u"?Zh:typeof self<"u"?self:typeof window<"u"?window:{});var U1="@firebase/firestore";var st=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};st.UNAUTHENTICATED=new st(null),st.GOOGLE_CREDENTIALS=new st("google-credentials-uid"),st.FIRST_PARTY=new st("first-party-uid"),st.MOCK_USER=new st("mock-user");var Lo="10.14.0";var Qn=new js("@firebase/firestore");function fo(){return Qn.logLevel}function zR(r){Qn.setLogLevel(r)}function L(r,...e){if(Qn.logLevel<=rr.DEBUG){let t=e.map(gE);Qn.debug(`Firestore (${Lo}): ${r}`,...t)}}function Je(r,...e){if(Qn.logLevel<=rr.ERROR){let t=e.map(gE);Qn.error(`Firestore (${Lo}): ${r}`,...t)}}function mr(r,...e){if(Qn.logLevel<=rr.WARN){let t=e.map(gE);Qn.warn(`Firestore (${Lo}): ${r}`,...t)}}function gE(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function Q(r="Unexpected state"){let e=`FIRESTORE (${Lo}) INTERNAL ASSERTION FAILED: `+r;throw Je(e),new Error(e)}function Y(r,e){r||Q()}function KR(r,e){r||Q()}function W(r,e){return r}var k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},F=class extends qA{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var lt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var cd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},_b=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(st.UNAUTHENTICATED))}shutdown(){}},yb=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},vb=class{constructor(e){this.t=e,this.currentUser=st.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0);let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new lt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>q(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new lt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Y(typeof n.accessToken=="string"),new cd(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string"),new st(e)}},bb=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=st.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},wb=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new bb(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Eb=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Sb=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Y(this.o===void 0);let n=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string"),this.R=t.token,new Eb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function J2(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var hd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=J2(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function ie(r,e){return r<e?-1:r>e?1:0}function Eo(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function GR(r){return r+"\0"}var ze=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new F(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var Z=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new ze(0,0))}static max(){return new r(new ze(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var dd=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&Q(),n===void 0?n=e.length-t:n>e.length-t&&Q(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},_e=class r extends dd{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new F(k.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},X2=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xe=class r extends dd{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return X2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new F(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new F(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new F(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(n+=a,i++):(s(),i++)}if(s(),o)throw new F(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var z=class r{constructor(e){this.path=e}static fromPath(e){return new r(_e.fromString(e))}static fromName(e){return new r(_e.fromString(e).popFirst(5))}static empty(){return new r(_e.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_e.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _e.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new _e(e.slice()))}};var So=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function Tb(r){return r.fields.find(e=>e.kind===2)}function Ji(r){return r.fields.filter(e=>e.kind!==2)}So.UNKNOWN_ID=-1;var vo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var nl=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,ur.min())}};function QR(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=Z.fromTimestamp(n===1e9?new ze(t+1,0):new ze(t,n));return new ur(i,z.empty(),e)}function $R(r){return new ur(r.readTime,r.key,-1)}var ur=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(Z.min(),z.empty(),-1)}static max(){return new r(Z.max(),z.empty(),-1)}};function _E(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=z.comparator(r.documentKey,e.documentKey),t!==0?t:ie(r.largestBatchId,e.largestBatchId))}var HR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",fd=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ni(r){return q(this,null,function*(){if(r.code!==k.FAILED_PRECONDITION||r.message!==HR)throw r;L("LocalStore","Unexpectedly lost primary lease")})}var D=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(h=>{o[c]=h,++a,a===s&&n(o)},h=>i(h))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var pd=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new lt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ns(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=yE(n.target.error);this.V.reject(new ns(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new ns(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(L("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Ab(t)}},$n=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(nu())===12.2&&Je("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return L("SimpleDb","Removing database:",e),Xi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!MA())return!1;if(r.v())return!0;let e=nu(),t=r.S(e),n=0<t&&t<10,i=YR(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return q(this,null,function*(){return this.db||(L("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new ns(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new F(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new F(k.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new ns(e,o))},i.onupgradeneeded=s=>{L("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{L("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return q(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=pd.open(this.db,e,s?"readonly":"readwrite",n),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),D.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(L("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function YR(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Ib=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Xi(this.B.delete())}},ns=class extends F{constructor(e,t){super(k.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ii(r){return r.name==="IndexedDbTransactionError"}var Ab=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(L("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(L("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Xi(n)}add(e){return L("SimpleDb","ADD",this.store.name,e,e),Xi(this.store.add(e))}get(e){return Xi(this.store.get(e)).next(t=>(t===void 0&&(t=null),L("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return L("SimpleDb","DELETE",this.store.name,e),Xi(this.store.delete(e))}count(){return L("SimpleDb","COUNT",this.store.name),Xi(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new D((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(n),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new D((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}j(e,t){L("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new D((n,i)=>{t.onerror=s=>{let o=yE(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():n()}):n()}})}W(e,t){let n=[];return new D((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Ib(a),c=t(a.primaryKey,a.value,u);if(c instanceof D){let h=c.catch(f=>(u.done(),D.reject(f)));n.push(h)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>D.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Xi(r){return new D((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=yE(n.target.error);t(i)}})}var B1=!1;function yE(r){let e=$n.S(nu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new F("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return B1||(B1=!0,setTimeout(()=>{throw n},0)),n}}return r}var Pb=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){L("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>q(this,null,function*(){this.task=null;try{L("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ii(t)?L("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield ni(t)}yield this.X(6e4)}))}},Cb=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return q(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return D.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return L("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,n.add(o)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(L("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=$R(s);_E(o,n)>0&&(n=o)}),new ur(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Yt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Tl(r){return r==null}function il(r){return r===0&&1/r==-1/0}function JR(r){return typeof r=="number"&&Number.isInteger(r)&&!il(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function xt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=W1(e)),e=Z2(r.get(t),e);return W1(e)}function Z2(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function W1(r){return r+""}function kr(r){let e=r.length;if(Y(e>=2),e===2)return Y(r.charAt(0)===""&&r.charAt(1)===""),_e.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf("",s);switch((o<0||o>t)&&Q(),r.charAt(o+1)){case"":let a=r.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:Q()}s=o+2}return new _e(n)}var z1=["userId","batchId"];function sd(r,e){return[r,xt(e)]}function XR(r,e,t){return[r,xt(e),t]}var eU={},tU=["prefixPath","collectionGroup","readTime","documentId"],rU=["prefixPath","collectionGroup","documentId"],nU=["collectionGroup","readTime","prefixPath","documentId"],iU=["canonicalId","targetId"],sU=["targetId","path"],oU=["path","targetId"],aU=["collectionId","parent"],uU=["indexId","uid"],lU=["uid","sequenceNumber"],cU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],hU=["indexId","uid","orderedDocumentKey"],dU=["userId","collectionPath","documentId"],fU=["userId","collectionPath","largestBatchId"],pU=["userId","collectionGroup","largestBatchId"],ZR=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],mU=[...ZR,"documentOverlays"],eN=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],tN=eN,vE=[...tN,"indexConfiguration","indexState","indexEntries"],gU=vE,_U=[...vE,"globals"];var sl=class extends fd{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function ct(r,e){let t=W(r);return $n.F(t._e,e)}function K1(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function ms(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function rN(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var qe=class r{constructor(e,t){this.comparator=e,this.root=t||qr.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qr.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yo(this.root,e,this.comparator,!1)}getReverseIterator(){return new yo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yo(this.root,e,this.comparator,!0)}},yo=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},qr=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Q();let e=this.left.check();if(e!==this.right.check())throw Q();return e+(this.isRed()?0:1)}};qr.EMPTY=null,qr.RED=!0,qr.BLACK=!1;qr.EMPTY=new class{constructor(){this.size=0}get key(){throw Q()}get value(){throw Q()}get color(){throw Q()}get left(){throw Q()}get right(){throw Q()}copy(e,t,n,i,s){return this}insert(e,t,n){return new qr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Oe=class r{constructor(e){this.comparator=e,this.data=new qe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new md(this.data.getIterator())}getIteratorFrom(e){return new md(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},md=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function uo(r){return r.hasNext()?r.getNext():void 0}var Jt=class r{constructor(e){this.fields=e,e.sort(Xe.comparator)}static empty(){return new r([])}unionWith(e){let t=new Oe(Xe.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Eo(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var gd=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function nN(){return typeof atob<"u"}var et=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new gd("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};et.EMPTY_BYTE_STRING=new et("");var yU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function un(r){if(Y(!!r),typeof r=="string"){let e=0,t=yU.exec(r);if(Y(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ve(r.seconds),nanos:Ve(r.nanos)}}function Ve(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Hn(r){return typeof r=="string"?et.fromBase64String(r):et.fromUint8Array(r)}function uf(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bE(r){let e=r.mapValue.fields.__previous_value__;return uf(e)?bE(e):e}function ol(r){let e=un(r.mapValue.fields.__local_write_time__.timestampValue);return new ze(e.seconds,e.nanos)}var Ob=class{constructor(e,t,n,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Yn=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var Kn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},od={nullValue:"NULL_VALUE"};function is(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?uf(r)?4:iN(r)?9007199254740991:lf(r)?10:11:Q()}function Lr(r,e){if(r===e)return!0;let t=is(r);if(t!==is(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ol(r).isEqual(ol(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=un(i.timestampValue),a=un(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return Hn(i.bytesValue).isEqual(Hn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Ve(i.geoPointValue.latitude)===Ve(s.geoPointValue.latitude)&&Ve(i.geoPointValue.longitude)===Ve(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ve(i.integerValue)===Ve(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ve(i.doubleValue),a=Ve(s.doubleValue);return o===a?il(o)===il(a):isNaN(o)&&isNaN(a)}return!1}(r,e);case 9:return Eo(r.arrayValue.values||[],e.arrayValue.values||[],Lr);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(K1(o)!==K1(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Lr(o[u],a[u])))return!1;return!0}(r,e);default:return Q()}}function al(r,e){return(r.values||[]).find(t=>Lr(t,e))!==void 0}function Jn(r,e){if(r===e)return 0;let t=is(r),n=is(e);if(t!==n)return ie(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(r.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Ve(s.integerValue||s.doubleValue),u=Ve(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(r,e);case 3:return G1(r.timestampValue,e.timestampValue);case 4:return G1(ol(r),ol(e));case 5:return ie(r.stringValue,e.stringValue);case 6:return function(s,o){let a=Hn(s),u=Hn(o);return a.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let h=ie(a[c],u[c]);if(h!==0)return h}return ie(a.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){let a=ie(Ve(s.latitude),Ve(o.latitude));return a!==0?a:ie(Ve(s.longitude),Ve(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Q1(r.arrayValue,e.arrayValue);case 10:return function(s,o){var a,u,c,h;let f=s.fields||{},m=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(u=m.value)===null||u===void 0?void 0:u.arrayValue,w=ie(((c=_?.values)===null||c===void 0?void 0:c.length)||0,((h=v?.values)===null||h===void 0?void 0:h.length)||0);return w!==0?w:Q1(_,v)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===Kn.mapValue&&o===Kn.mapValue)return 0;if(s===Kn.mapValue)return 1;if(o===Kn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},h=Object.keys(c);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){let m=ie(u[f],h[f]);if(m!==0)return m;let _=Jn(a[u[f]],c[h[f]]);if(_!==0)return _}return ie(u.length,h.length)}(r.mapValue,e.mapValue);default:throw Q()}}function G1(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ie(r,e);let t=un(r),n=un(e),i=ie(t.seconds,n.seconds);return i!==0?i:ie(t.nanos,n.nanos)}function Q1(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=Jn(t[i],n[i]);if(s)return s}return ie(t.length,n.length)}function To(r){return Rb(r)}function Rb(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=un(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Hn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return z.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=Rb(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${Rb(t.fields[o])}`;return i+"}"}(r.mapValue):Q()}function ss(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Nb(r){return!!r&&"integerValue"in r}function ul(r){return!!r&&"arrayValue"in r}function $1(r){return!!r&&"nullValue"in r}function H1(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ad(r){return!!r&&"mapValue"in r}function lf(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Xu(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return ms(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Xu(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xu(r.arrayValue.values[t]);return e}return Object.assign({},r)}function iN(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var sN={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function vU(r){return"nullValue"in r?od:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?ss(Yn.empty(),z.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?lf(r)?sN:{mapValue:{}}:Q()}function bU(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?ss(Yn.empty(),z.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?sN:"mapValue"in r?lf(r)?{mapValue:{}}:Kn:Q()}function Y1(r,e){let t=Jn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function J1(r,e){let t=Jn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var At=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ad(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xu(t)}setAll(e){let t=Xe.emptyPath(),n={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=a.popLast()}o?n[a.lastSegment()]=Xu(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());ad(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Lr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];ad(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){ms(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(Xu(this.value))}};function oN(r){let e=[];return ms(r.fields,(t,n)=>{let i=new Xe([t]);if(ad(n)){let s=oN(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Jt(e)}var ot=class r{constructor(e,t,n,i,s,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new r(e,0,Z.min(),Z.min(),Z.min(),At.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,Z.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,Z.min(),Z.min(),At.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,Z.min(),Z.min(),At.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var jr=class{constructor(e,t){this.position=e,this.inclusive=t}};function X1(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=z.comparator(z.fromName(o.referenceValue),t.key):n=Jn(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Z1(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Lr(r.position[t],e.position[t]))return!1;return!0}var os=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function wU(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var _d=class{},pe=class r extends _d{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new kb(e,t,n):t==="array-contains"?new Fb(e,n):t==="in"?new yd(e,n):t==="not-in"?new Vb(e,n):t==="array-contains-any"?new Lb(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Mb(e,n):new qb(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Jn(t,this.value)):t!==null&&is(this.value)===is(t)&&this.matchesComparison(Jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Q()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Se=class r extends _d{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return Io(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Io(r){return r.op==="and"}function Db(r){return r.op==="or"}function wE(r){return aN(r)&&Io(r)}function aN(r){for(let e of r.filters)if(e instanceof Se)return!1;return!0}function xb(r){if(r instanceof pe)return r.field.canonicalString()+r.op.toString()+To(r.value);if(wE(r))return r.filters.map(e=>xb(e)).join(",");{let e=r.filters.map(t=>xb(t)).join(",");return`${r.op}(${e})`}}function uN(r,e){return r instanceof pe?function(n,i){return i instanceof pe&&n.op===i.op&&n.field.isEqual(i.field)&&Lr(n.value,i.value)}(r,e):r instanceof Se?function(n,i){return i instanceof Se&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,a)=>s&&uN(o,i.filters[a]),!0):!1}(r,e):void Q()}function lN(r,e){let t=r.filters.concat(e);return Se.create(t,r.op)}function cN(r){return r instanceof pe?function(t){return`${t.field.canonicalString()} ${t.op} ${To(t.value)}`}(r):r instanceof Se?function(t){return t.op.toString()+" {"+t.getFilters().map(cN).join(" ,")+"}"}(r):"Filter"}var kb=class extends pe{constructor(e,t,n){super(e,t,n),this.key=z.fromName(n.referenceValue)}matches(e){let t=z.comparator(e.key,this.key);return this.matchesComparison(t)}},Mb=class extends pe{constructor(e,t){super(e,"in",t),this.keys=hN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},qb=class extends pe{constructor(e,t){super(e,"not-in",t),this.keys=hN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function hN(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>z.fromName(n.referenceValue))}var Fb=class extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ul(t)&&al(t.arrayValue,this.value)}},yd=class extends pe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&al(this.value.arrayValue,t)}},Vb=class extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(al(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!al(this.value.arrayValue,t)}},Lb=class extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ul(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>al(this.value.arrayValue,n))}};var jb=class{constructor(e,t=null,n=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Ub(r,e=null,t=[],n=[],i=null,s=null,o=null){return new jb(r,e,t,n,i,s,o)}function as(r){let e=W(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>xb(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Tl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>To(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>To(n)).join(",")),e.ue=t}return e.ue}function Il(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!wU(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!uN(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Z1(r.startAt,e.startAt)&&Z1(r.endAt,e.endAt)}function vd(r){return z.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function bd(r,e){return r.filters.filter(t=>t instanceof pe&&t.field.isEqual(e))}function eR(r,e,t){let n=od,i=!0;for(let s of bd(r,e)){let o=od,a=!0;switch(s.op){case"<":case"<=":o=vU(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=od}Y1({value:n,inclusive:i},{value:o,inclusive:a})<0&&(n=o,i=a)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];Y1({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function tR(r,e,t){let n=Kn,i=!0;for(let s of bd(r,e)){let o=Kn,a=!0;switch(s.op){case">=":case">":o=bU(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Kn}J1({value:n,inclusive:i},{value:o,inclusive:a})>0&&(n=o,i=a)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];J1({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}var gr=class{constructor(e,t=null,n=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function dN(r,e,t,n,i,s,o,a){return new gr(r,e,t,n,i,s,o,a)}function jo(r){return new gr(r)}function rR(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function EE(r){return r.collectionGroup!==null}function bo(r){let e=W(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Oe(Xe.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new os(s,n))}),t.has(Xe.keyField().canonicalString())||e.ce.push(new os(Xe.keyField(),n))}return e.ce}function kt(r){let e=W(r);return e.le||(e.le=EU(e,bo(r))),e.le}function EU(r,e){if(r.limitType==="F")return Ub(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new os(i.field,s)});let t=r.endAt?new jr(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new jr(r.startAt.position,r.startAt.inclusive):null;return Ub(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Bb(r,e){let t=r.filters.concat([e]);return new gr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function wd(r,e,t){return new gr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Al(r,e){return Il(kt(r),kt(e))&&r.limitType===e.limitType}function fN(r){return`${as(kt(r))}|lt:${r.limitType}`}function po(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>cN(i)).join(", ")}]`),Tl(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>To(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>To(i)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function Pl(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):z.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of bo(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,a,u){let c=X1(o,a,u);return o.inclusive?c<=0:c<0}(n.startAt,bo(n),i)||n.endAt&&!function(o,a,u){let c=X1(o,a,u);return o.inclusive?c>=0:c>0}(n.endAt,bo(n),i))}(r,e)}function pN(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function mN(r){return(e,t)=>{let n=!1;for(let i of bo(r)){let s=SU(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function SU(r,e,t){let n=r.field.isKeyField()?z.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Jn(u,c):Q()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Q()}}var Ur=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ms(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return rN(this.inner)}size(){return this.innerSize}};var TU=new qe(z.comparator);function Lt(){return TU}var gN=new qe(z.comparator);function Yu(...r){let e=gN;for(let t of r)e=e.insert(t.key,t);return e}function _N(r){let e=gN;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Mr(){return Zu()}function yN(){return Zu()}function Zu(){return new Ur(r=>r.toString(),(r,e)=>r.isEqual(e))}var IU=new qe(z.comparator),AU=new Oe(z.comparator);function oe(...r){let e=AU;for(let t of r)e=e.add(t);return e}var PU=new Oe(ie);function SE(){return PU}function TE(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:il(e)?"-0":e}}function vN(r){return{integerValue:""+r}}function bN(r,e){return JR(e)?vN(e):TE(r,e)}var Ao=class{constructor(){this._=void 0}};function CU(r,e,t){return r instanceof Xn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&uf(s)&&(s=bE(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):r instanceof ln?EN(r,e):r instanceof cn?SN(r,e):function(i,s){let o=wN(i,s),a=nR(o)+nR(i.Pe);return Nb(o)&&Nb(i.Pe)?vN(a):TE(i.serializer,a)}(r,e)}function OU(r,e,t){return r instanceof ln?EN(r,e):r instanceof cn?SN(r,e):t}function wN(r,e){return r instanceof Zn?function(n){return Nb(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var Xn=class extends Ao{},ln=class extends Ao{constructor(e){super(),this.elements=e}};function EN(r,e){let t=TN(e);for(let n of r.elements)t.some(i=>Lr(i,n))||t.push(n);return{arrayValue:{values:t}}}var cn=class extends Ao{constructor(e){super(),this.elements=e}};function SN(r,e){let t=TN(e);for(let n of r.elements)t=t.filter(i=>!Lr(i,n));return{arrayValue:{values:t}}}var Zn=class extends Ao{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function nR(r){return Ve(r.integerValue||r.doubleValue)}function TN(r){return ul(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var us=class{constructor(e,t){this.field=e,this.transform=t}};function RU(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof ln&&i instanceof ln||n instanceof cn&&i instanceof cn?Eo(n.elements,i.elements,Lr):n instanceof Zn&&i instanceof Zn?Lr(n.Pe,i.Pe):n instanceof Xn&&i instanceof Xn}(r.transform,e.transform)}var Wb=class{constructor(e,t){this.version=e,this.transformResults=t}},He=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ud(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var Po=class{};function IN(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new ti(r.key,He.none()):new ei(r.key,r.data,He.none());{let t=r.data,n=At.empty(),i=new Oe(Xe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new _r(r.key,n,new Jt(i.toArray()),He.none())}}function NU(r,e,t){r instanceof ei?function(i,s,o){let a=i.value.clone(),u=sR(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(r,e,t):r instanceof _r?function(i,s,o){if(!ud(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=sR(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(AN(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function el(r,e,t,n){return r instanceof ei?function(s,o,a,u){if(!ud(s.precondition,o))return a;let c=s.value.clone(),h=oR(s.fieldTransforms,u,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(r,e,t,n):r instanceof _r?function(s,o,a,u){if(!ud(s.precondition,o))return a;let c=oR(s.fieldTransforms,u,o),h=o.data;return h.setAll(AN(s)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(r,e,t,n):function(s,o,a){return ud(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(r,e,t)}function DU(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=wN(n.transform,i||null);s!=null&&(t===null&&(t=At.empty()),t.set(n.field,s))}return t||null}function iR(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Eo(n,i,(s,o)=>RU(s,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var ei=class extends Po{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},_r=class extends Po{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function AN(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function sR(r,e,t){let n=new Map;Y(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,a=e.data.field(s.field);n.set(s.field,OU(o,a,t[i]))}return n}function oR(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,CU(s,o,e))}return n}var ti=class extends Po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ll=class extends Po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var cl=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&NU(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=el(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=el(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=yN();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=IN(o,a);u!==null&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(Z.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&Eo(this.mutations,e.mutations,(t,n)=>iR(t,n))&&Eo(this.baseMutations,e.baseMutations,(t,n)=>iR(t,n))}},zb=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Y(e.mutations.length===n.length);let i=function(){return IU}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};var hl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Kb=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var nt,ge;function PN(r){switch(r){default:return Q();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0}}function CN(r){if(r===void 0)return Je("GRPC error has no .code"),k.UNKNOWN;switch(r){case nt.OK:return k.OK;case nt.CANCELLED:return k.CANCELLED;case nt.UNKNOWN:return k.UNKNOWN;case nt.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case nt.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case nt.INTERNAL:return k.INTERNAL;case nt.UNAVAILABLE:return k.UNAVAILABLE;case nt.UNAUTHENTICATED:return k.UNAUTHENTICATED;case nt.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case nt.NOT_FOUND:return k.NOT_FOUND;case nt.ALREADY_EXISTS:return k.ALREADY_EXISTS;case nt.PERMISSION_DENIED:return k.PERMISSION_DENIED;case nt.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case nt.ABORTED:return k.ABORTED;case nt.OUT_OF_RANGE:return k.OUT_OF_RANGE;case nt.UNIMPLEMENTED:return k.UNIMPLEMENTED;case nt.DATA_LOSS:return k.DATA_LOSS;default:return Q()}}(ge=nt||(nt={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";var aR=null;function ON(){return new TextEncoder}var xU=new jn([4294967295,4294967295],0);function uR(r){let e=ON().encode(r),t=new ob;return t.update(e),new Uint8Array(t.digest())}function lR(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new jn([t,n],0),new jn([i,s],0)]}var Gb=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new rs(`Invalid padding: ${t}`);if(n<0)throw new rs(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new rs(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new rs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=jn.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(jn.fromNumber(n)));return i.compare(xU)===1&&(i=new jn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=uR(e),[n,i]=lR(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);if(!this.de(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=uR(e),[n,i]=lR(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(n,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},rs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var dl=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,fl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(Z.min(),i,new qe(ie),Lt(),oe())}},fl=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,oe(),oe(),oe())}};var wo=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},Ed=class{constructor(e,t){this.targetId=e,this.me=t}},Sd=class{constructor(e,t,n=et.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},Td=class{constructor(){this.fe=0,this.ge=hR(),this.pe=et.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=oe(),t=oe(),n=oe();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Q()}}),new fl(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=hR()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Y(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Qb=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Lt(),this.qe=cR(),this.Qe=new qe(ie)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Q()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(vd(s))if(n===0){let o=new z(s.path);this.Ue(t,o,ot.newNoDocument(o,Z.min()))}else Y(n===1);else{let o=this.Ye(t);if(o!==n){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}aR?.et(function(h,f,m,_,v){var w,A,M,V,j,G;let te={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},H=f.unchangedNames;return H&&(te.bloomFilter={applied:v===0,hashCount:(w=H?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(V=(M=(A=H?.bits)===null||A===void 0?void 0:A.bitmap)===null||M===void 0?void 0:M.length)!==null&&V!==void 0?V:0,padding:(G=(j=H?.bits)===null||j===void 0?void 0:j.padding)!==null&&G!==void 0?G:0,mightContain:P=>{var b;return(b=_?.mightContain(P))!==null&&b!==void 0&&b}}),te}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Hn(n).toUint8Array()}catch(u){if(u instanceof gd)return mr("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Gb(o,i,s)}catch(u){return mr(u instanceof rs?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&vd(a.target)){let u=new z(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,ot.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let n=oe();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new dl(e,t,this.Qe,this.ke,n);return this.ke=Lt(),this.qe=cR(),this.Qe=new qe(ie),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Td,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Oe(ie),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Td),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function cR(){return new qe(z.comparator)}function hR(){return new qe(z.comparator)}var kU={asc:"ASCENDING",desc:"DESCENDING"},MU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qU={and:"AND",or:"OR"},$b=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Hb(r,e){return r.useProto3Json||Tl(e)?e:{value:e}}function Co(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function RN(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function FU(r,e){return Co(r,e.toTimestamp())}function Ze(r){return Y(!!r),Z.fromTimestamp(function(t){let n=un(t);return new ze(n.seconds,n.nanos)}(r))}function IE(r,e){return Yb(r,e).canonicalString()}function Yb(r,e){let t=function(i){return new _e(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function NN(r){let e=_e.fromString(r);return Y(UN(e)),e}function pl(r,e){return IE(r.databaseId,e.path)}function Fr(r,e){let t=NN(e);if(t.get(1)!==r.databaseId.projectId)throw new F(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new F(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new z(kN(t))}function DN(r,e){return IE(r.databaseId,e)}function xN(r){let e=NN(r);return e.length===4?_e.emptyPath():kN(e)}function Jb(r){return new _e(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function kN(r){return Y(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function dR(r,e,t){return{name:pl(r,e),fields:t.value.mapValue.fields}}function MN(r,e,t){let n=Fr(r,e.name),i=Ze(e.updateTime),s=e.createTime?Ze(e.createTime):Z.min(),o=new At({mapValue:{fields:e.fields}}),a=ot.newFoundDocument(n,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function VU(r,e){return"found"in e?function(n,i){Y(!!i.found),i.found.name,i.found.updateTime;let s=Fr(n,i.found.name),o=Ze(i.found.updateTime),a=i.found.createTime?Ze(i.found.createTime):Z.min(),u=new At({mapValue:{fields:i.found.fields}});return ot.newFoundDocument(s,o,a,u)}(r,e):"missing"in e?function(n,i){Y(!!i.missing),Y(!!i.readTime);let s=Fr(n,i.missing),o=Ze(i.readTime);return ot.newNoDocument(s,o)}(r,e):Q()}function LU(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Q()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,h){return c.useProto3Json?(Y(h===void 0||typeof h=="string"),et.fromBase64String(h||"")):(Y(h===void 0||h instanceof Buffer||h instanceof Uint8Array),et.fromUint8Array(h||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let h=c.code===void 0?k.UNKNOWN:CN(c.code);return new F(h,c.message||"")}(o);t=new Sd(n,i,s,a||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=Fr(r,n.document.name),s=Ze(n.document.updateTime),o=n.document.createTime?Ze(n.document.createTime):Z.min(),a=new At({mapValue:{fields:n.document.fields}}),u=ot.newFoundDocument(i,s,o,a),c=n.targetIds||[],h=n.removedTargetIds||[];t=new wo(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=Fr(r,n.document),s=n.readTime?Ze(n.readTime):Z.min(),o=ot.newNoDocument(i,s),a=n.removedTargetIds||[];t=new wo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=Fr(r,n.document),s=n.removedTargetIds||[];t=new wo([],s,i,null)}else{if(!("filter"in e))return Q();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new Kb(i,s),a=n.targetId;t=new Ed(a,o)}}return t}function ml(r,e){let t;if(e instanceof ei)t={update:dR(r,e.key,e.value)};else if(e instanceof ti)t={delete:pl(r,e.key)};else if(e instanceof _r)t={update:dR(r,e.key,e.data),updateMask:KU(e.fieldMask)};else{if(!(e instanceof ll))return Q();t={verify:pl(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){let a=o.transform;if(a instanceof Xn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ln)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof cn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Zn)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Q()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:FU(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Q()}(r,e.precondition)),t}function Xb(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?He.updateTime(Ze(s.updateTime)):s.exists!==void 0?He.exists(s.exists):He.none()}(e.currentDocument):He.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)Y(a.setToServerValue==="REQUEST_TIME"),u=new Xn;else if("appendMissingElements"in a){let h=a.appendMissingElements.values||[];u=new ln(h)}else if("removeAllFromArray"in a){let h=a.removeAllFromArray.values||[];u=new cn(h)}else"increment"in a?u=new Zn(o,a.increment):Q();let c=Xe.fromServerFormat(a.fieldPath);return new us(c,u)}(r,i)):[];if(e.update){e.update.name;let i=Fr(r,e.update.name),s=new At({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Jt(c.map(h=>Xe.fromServerFormat(h)))}(e.updateMask);return new _r(i,s,o,t,n)}return new ei(i,s,t,n)}if(e.delete){let i=Fr(r,e.delete);return new ti(i,t)}if(e.verify){let i=Fr(r,e.verify);return new ll(i,t)}return Q()}function jU(r,e){return r&&r.length>0?(Y(e!==void 0),r.map(t=>function(i,s){let o=i.updateTime?Ze(i.updateTime):Ze(s);return o.isEqual(Z.min())&&(o=Ze(s)),new Wb(o,i.transformResults||[])}(t,e))):[]}function qN(r,e){return{documents:[DN(r,e.path)]}}function FN(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=DN(r,i);let s=function(c){if(c.length!==0)return jN(Se.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(h=>function(m){return{field:mo(m.field),direction:BU(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Hb(r,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function VN(r){let e=xN(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){Y(n===1);let h=t.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(f){let m=LN(f);return m instanceof Se&&wE(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new os(go(v.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Tl(m)?null:m}(t.limit));let u=null;t.startAt&&(u=function(f){let m=!!f.before,_=f.values||[];return new jr(_,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){let m=!f.before,_=f.values||[];return new jr(_,m)}(t.endAt)),dN(e,i,o,s,a,"F",u,c)}function UU(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function LN(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=go(t.unaryFilter.field);return pe.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=go(t.unaryFilter.field);return pe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=go(t.unaryFilter.field);return pe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=go(t.unaryFilter.field);return pe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Q()}}(r):r.fieldFilter!==void 0?function(t){return pe.create(go(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Q()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return Se.create(t.compositeFilter.filters.map(n=>LN(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Q()}}(t.compositeFilter.op))}(r):Q()}function BU(r){return kU[r]}function WU(r){return MU[r]}function zU(r){return qU[r]}function mo(r){return{fieldPath:r.canonicalString()}}function go(r){return Xe.fromServerFormat(r.fieldPath)}function jN(r){return r instanceof pe?function(t){if(t.op==="=="){if(H1(t.value))return{unaryFilter:{field:mo(t.field),op:"IS_NAN"}};if($1(t.value))return{unaryFilter:{field:mo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(H1(t.value))return{unaryFilter:{field:mo(t.field),op:"IS_NOT_NAN"}};if($1(t.value))return{unaryFilter:{field:mo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mo(t.field),op:WU(t.op),value:t.value}}}(r):r instanceof Se?function(t){let n=t.getFilters().map(i=>jN(i));return n.length===1?n[0]:{compositeFilter:{op:zU(t.op),filters:n}}}(r):Q()}function KU(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function UN(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Oo=class r{constructor(e,t,n,i,s=Z.min(),o=Z.min(),a=et.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Id=class{constructor(e){this.ct=e}};function GU(r,e){let t;if(e.document)t=MN(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=z.fromSegments(e.noDocument.path),i=cs(e.noDocument.readTime);t=ot.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Q();{let n=z.fromSegments(e.unknownDocument.path),i=cs(e.unknownDocument.version);t=ot.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ze(i[0],i[1]);return Z.fromTimestamp(s)}(e.readTime)),t}function fR(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ad(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,o){return{name:pl(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Co(s,o.version.toTimestamp()),createTime:Co(s,o.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:ls(e.version)};else{if(!e.isUnknownDocument())return Q();n.unknownDocument={path:t.path.toArray(),version:ls(e.version)}}return n}function Ad(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function ls(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function cs(r){let e=new ze(r.seconds,r.nanoseconds);return Z.fromTimestamp(e)}function Zi(r,e){let t=(e.baseMutations||[]).map(s=>Xb(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Xb(r.ct,s)),i=ze.fromMillis(e.localWriteTimeMs);return new cl(e.batchId,i,t,n)}function Ju(r){let e=cs(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?cs(r.lastLimboFreeSnapshotVersion):Z.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return Y(s.documents.length===1),kt(jo(xN(s.documents[0])))}(r.query):function(s){return kt(VN(s))}(r.query),new Oo(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,et.fromBase64String(r.resumeToken))}function BN(r,e){let t=ls(e.snapshotVersion),n=ls(e.lastLimboFreeSnapshotVersion),i;i=vd(e.target)?qN(r.ct,e.target):FN(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:as(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function AE(r){let e=VN({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?wd(e,e.limit,"L"):e}function db(r,e){return new hl(e.largestBatchId,Xb(r.ct,e.overlayMutation))}function pR(r,e){let t=e.path.lastSegment();return[r,xt(e.path.popLast()),t]}function mR(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:ls(n.readTime),documentKey:xt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Zb=class{getBundleMetadata(e,t){return gR(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:cs(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return gR(e).put(function(i){return{bundleId:i.id,createTime:ls(Ze(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return _R(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:AE(s.bundledQuery),readTime:cs(s.readTime)}}(n)})}saveNamedQuery(e,t){return _R(e).put(function(i){return{name:i.name,readTime:ls(Ze(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function gR(r){return ct(r,"bundles")}function _R(r){return ct(r,"namedQueries")}var Pd=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Gu(e).get(pR(this.userId,t)).next(n=>n?db(this.serializer,n):null)}getOverlays(e,t){let n=Mr();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let a=new hl(t,o);i.push(this.ht(e,a))}),D.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(xt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(Gu(e).j("collectionPathOverlayIndex",a))}),D.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Mr(),s=xt(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Gu(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=db(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Mr(),o,a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Gu(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,h)=>{let f=db(this.serializer,c);s.size()<i||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>s)}ht(e,t){return Gu(e).put(function(i,s,o){let[a,u,c]=pR(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ml(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Gu(r){return ct(r,"documentOverlays")}var ew=class{Pt(e){return ct(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?et.fromUint8Array(n):et.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var on=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ve(e.integerValue));else if("doubleValue"in e){let n=Ve(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),il(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=un(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Hn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?iN(e)?this.dt(t,Number.MAX_SAFE_INTEGER):lf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Q()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(n=s[o].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(Ve(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),z.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};on.vt=new on;function QU(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function yR(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let o=QU(255&n[s]);if(i+=o,o!==8)break}return i}(r);return Math.ceil(e/8)}var tw=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),n=yR(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),n=yR(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},rw=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},nw=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},es=class{constructor(){this.jt=new tw,this.Ht=new rw(this.jt),this.Jt=new nw(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var ts=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function Un(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=vR(r.arrayValue,e.arrayValue),t!==0?t:(t=vR(r.directionalValue,e.directionalValue),t!==0?t:z.comparator(r.documentKey,e.documentKey)))}function vR(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var Cd=class{constructor(e){this.Xt=new Oe((t,n)=>Xe.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(Y(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Tb(e);if(t!==void 0&&!this.sn(t))return!1;let n=Ji(e),i=new Set,s=0,o=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=n[s];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++s}for(;s<n.length;++s){let a=n[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Oe(Xe.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new vo(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new vo(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new vo(n.field,n.dir==="asc"?0:1)));return new So(So.UNKNOWN_ID,this.collectionId,t,nl.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function WN(r){var e,t;if(Y(r instanceof pe||r instanceof Se),r instanceof pe){if(r instanceof yd){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>pe.create(r.field,"==",s)))||[];return Se.create(i,"or")}return r}let n=r.filters.map(i=>WN(i));return Se.create(n,r.op)}function $U(r){if(r.getFilters().length===0)return[];let e=ow(WN(r));return Y(zN(e)),iw(e)||sw(e)?[e]:e.getFilters()}function iw(r){return r instanceof pe}function sw(r){return r instanceof Se&&wE(r)}function zN(r){return iw(r)||sw(r)||function(t){if(t instanceof Se&&Db(t)){for(let n of t.getFilters())if(!iw(n)&&!sw(n))return!1;return!0}return!1}(r)}function ow(r){if(Y(r instanceof pe||r instanceof Se),r instanceof pe)return r;if(r.filters.length===1)return ow(r.filters[0]);let e=r.filters.map(n=>ow(n)),t=Se.create(e,r.op);return t=Od(t),zN(t)?t:(Y(t instanceof Se),Y(Io(t)),Y(t.filters.length>1),t.filters.reduce((n,i)=>PE(n,i)))}function PE(r,e){let t;return Y(r instanceof pe||r instanceof Se),Y(e instanceof pe||e instanceof Se),t=r instanceof pe?e instanceof pe?function(i,s){return Se.create([i,s],"and")}(r,e):bR(r,e):e instanceof pe?bR(e,r):function(i,s){if(Y(i.filters.length>0&&s.filters.length>0),Io(i)&&Io(s))return lN(i,s.getFilters());let o=Db(i)?i:s,a=Db(i)?s:i,u=o.filters.map(c=>PE(c,a));return Se.create(u,"or")}(r,e),Od(t)}function bR(r,e){if(Io(e))return lN(e,r.getFilters());{let t=e.filters.map(n=>PE(r,n));return Se.create(t,"or")}}function Od(r){if(Y(r instanceof pe||r instanceof Se),r instanceof pe)return r;let e=r.getFilters();if(e.length===1)return Od(e[0]);if(aN(r))return r;let t=e.map(i=>Od(i)),n=[];return t.forEach(i=>{i instanceof pe?n.push(i):i instanceof Se&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:Se.create(n,r.op)}var aw=class{constructor(){this.un=new gl}addToCollectionParentIndex(e,t){return this.un.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(ur.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(ur.min())}updateCollectionGroup(e,t,n){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},gl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Oe(_e.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Oe(_e.comparator)).toArray()}};var td=new Uint8Array(0),uw=class{constructor(e,t){this.databaseId=t,this.cn=new gl,this.ln=new Ur(n=>as(n),(n,i)=>Il(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:xt(i)};return wR(e).put(s)}return D.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[GR(t),""],!1,!0);return wR(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(kr(o.parent))}return n})}addFieldIndex(e,t){let n=Qu(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=co(e);return s.next(a=>{o.put(mR(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Qu(e),i=co(e),s=lo(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Qu(e),n=lo(e),i=co(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return D.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Cd(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=lo(e),i=!0,s=new Map;return D.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=oe(),a=[];return D.forEach(s,(u,c)=>{L("IndexedDbIndexManager",`Using index ${function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`}(u)} to execute ${as(t)}`);let h=function(j,G){let te=Tb(G);if(te===void 0)return null;for(let H of bd(j,te.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(c,u),f=function(j,G){let te=new Map;for(let H of Ji(G))for(let P of bd(j,H.fieldPath))switch(P.op){case"==":case"in":te.set(H.fieldPath.canonicalString(),P.value);break;case"not-in":case"!=":return te.set(H.fieldPath.canonicalString(),P.value),Array.from(te.values())}return null}(c,u),m=function(j,G){let te=[],H=!0;for(let P of Ji(G)){let b=P.kind===0?eR(j,P.fieldPath,j.startAt):tR(j,P.fieldPath,j.startAt);te.push(b.value),H&&(H=b.inclusive)}return new jr(te,H)}(c,u),_=function(j,G){let te=[],H=!0;for(let P of Ji(G)){let b=P.kind===0?tR(j,P.fieldPath,j.endAt):eR(j,P.fieldPath,j.endAt);te.push(b.value),H&&(H=b.inclusive)}return new jr(te,H)}(c,u),v=this.In(u,c,m),w=this.In(u,c,_),A=this.Tn(u,c,f),M=this.En(u.indexId,h,v,m.inclusive,w,_.inclusive,A);return D.forEach(M,V=>n.G(V,t.limit).next(j=>{j.forEach(G=>{let te=z.fromSegments(G.documentKey);o.has(te)||(o=o.add(te),a.push(te))})}))}).next(()=>a)}return D.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=$U(Se.create(e.filters,"and")).map(n=>Ub(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(n.length,s.length),c=u/(t!=null?t.length:1),h=[];for(let f=0;f<u;++f){let m=t?this.dn(t[f/c]):td,_=this.An(e,m,n[f%c],i),v=this.Rn(e,m,s[f%c],o),w=a.map(A=>this.An(e,m,A,!0));h.push(...this.createRange(_,v,w))}return h}An(e,t,n,i){let s=new ts(e,z.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){let s=new ts(e,z.empty(),t,n);return i?s.Zt():s}Pn(e,t){let n=new Cd(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)n.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let n=2,i=this.hn(t);return D.forEach(i,s=>this.Pn(e,s).next(o=>{o?n!==0&&o.fields.length<function(u){let c=new Oe(Xe.comparator),h=!1;for(let f of u.filters)for(let m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:c=c.add(m.field));for(let f of u.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(s)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&n===2?1:n)}Vn(e,t){let n=new es;for(let i of Ji(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Yt(i.kind);on.vt.It(s,o)}return n.zt()}dn(e){let t=new es;return on.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new es;return on.vt.It(ss(this.databaseId,t),n.Yt(function(s){let o=Ji(s);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let i=[];i.push(new es);let s=0;for(let o of Ji(e)){let a=n[s++];for(let u of i)if(this.fn(t,o.fieldPath)&&ul(a))i=this.gn(i,o,a);else{let c=u.Yt(o.kind);on.vt.It(a,c)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let a of i){let u=new es;u.seed(a.zt()),on.vt.It(o,u.Yt(t.kind)),s.push(u)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof pe&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Qu(e),i=co(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let o=[];return D.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(h,f){let m=f?new nl(f.sequenceNumber,new ur(cs(f.readTime),new z(kr(f.documentKey)),f.largestBatchId)):nl.empty(),_=h.fields.map(([v,w])=>new vo(Xe.fromServerFormat(v),w));return new So(h.indexId,h.collectionGroup,_,m)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ie(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Qu(e),s=co(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>D.forEach(a,u=>s.put(mR(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return D.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?D.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(n.set(i.collectionGroup,a),D.forEach(a,u=>this.wn(e,i,u).next(c=>{let h=this.Sn(s,u);return c.isEqual(h)?D.resolve():this.bn(e,s,u,c,h)}))))})}Dn(e,t,n,i){return lo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return lo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let i=lo(e),s=new Oe(Un);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,a)=>{s=s.add(new ts(n.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let n=new Oe(Un),i=this.Vn(t,e);if(i==null)return n;let s=Tb(t);if(s!=null){let o=e.data.field(s.fieldPath);if(ul(o))for(let a of o.arrayValue.values||[])n=n.add(new ts(t.indexId,e.key,this.dn(a),i))}else n=n.add(new ts(t.indexId,e.key,td,i));return n}bn(e,t,n,i,s){L("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,h,f,m){let _=u.getIterator(),v=c.getIterator(),w=uo(_),A=uo(v);for(;w||A;){let M=!1,V=!1;if(w&&A){let j=h(w,A);j<0?V=!0:j>0&&(M=!0)}else w!=null?V=!0:M=!0;M?(f(A),A=uo(v)):V?(m(w),w=uo(_)):(w=uo(_),A=uo(v))}}(i,s,Un,a=>{o.push(this.Dn(e,t,n,a))},a=>{o.push(this.vn(e,t,n,a))}),D.waitFor(o)}yn(e){let t=1;return co(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,a)=>Un(o,a)).filter((o,a,u)=>!a||Un(o,u[a-1])!==0);let i=[];i.push(e);for(let o of n){let a=Un(o,e),u=Un(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&u<0)i.push(o),i.push(o.Zt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,td,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,td,[]];s.push(IDBKeyRange.bound(a,u))}return s}Cn(e,t){return Un(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ER)}getMinOffset(e,t){return D.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||Q())).next(ER)}};function wR(r){return ct(r,"collectionParents")}function lo(r){return ct(r,"indexEntries")}function Qu(r){return ct(r,"indexConfiguration")}function co(r){return ct(r,"indexState")}function ER(r){Y(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;_E(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ur(e.readTime,e.documentKey,t)}var SR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ar=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function KN(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=n.J({range:o},(h,f,m)=>(a++,m.delete()));s.push(u.next(()=>{Y(a===1)}));let c=[];for(let h of t.mutations){let f=XR(e,h.key.path,t.batchId);s.push(i.delete(f)),c.push(h.key)}return D.waitFor(s).next(()=>c)}function Rd(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw Q();e=r.noDocument}return JSON.stringify(e).length}ar.DEFAULT_COLLECTION_PERCENTILE=10,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ar.DEFAULT=new ar(41943040,ar.DEFAULT_COLLECTION_PERCENTILE,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ar.DISABLED=new ar(-1,0,0);var Nd=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){Y(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bn(e).J({index:"userMutationsIndex",range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=_o(e),o=Bn(e);return o.add({}).next(a=>{Y(typeof a=="number");let u=new cl(a,t,n,i),c=function(_,v,w){let A=w.baseMutations.map(V=>ml(_.ct,V)),M=w.mutations.map(V=>ml(_.ct,V));return{userId:v,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:A,mutations:M}}(this.serializer,this.userId,u),h=[],f=new Oe((m,_)=>ie(m.canonicalString(),_.canonicalString()));for(let m of i){let _=XR(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(c)),h.push(s.put(_,eU))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),D.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return Bn(e).get(t).next(n=>n?(Y(n.userId===this.userId),Zi(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?D.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Bn(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(Y(a.batchId>=n),s=Zi(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Bn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bn(e).U("userMutationsIndex",t).next(n=>n.map(i=>Zi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=sd(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return _o(e).J({range:i},(o,a,u)=>{let[c,h,f]=o,m=kr(h);if(c===this.userId&&t.path.isEqual(m))return Bn(e).get(f).next(_=>{if(!_)throw Q();Y(_.userId===this.userId),s.push(Zi(this.serializer,_))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Oe(ie),i=[];return t.forEach(s=>{let o=sd(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=_o(e).J({range:a},(c,h,f)=>{let[m,_,v]=c,w=kr(_);m===this.userId&&s.path.isEqual(w)?n=n.add(v):f.done()});i.push(u)}),D.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=sd(this.userId,n),o=IDBKeyRange.lowerBound(s),a=new Oe(ie);return _o(e).J({range:o},(u,c,h)=>{let[f,m,_]=u,v=kr(m);f===this.userId&&n.isPrefixOf(v)?v.length===i&&(a=a.add(_)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(Bn(e).get(s).next(o=>{if(o===null)throw Q();Y(o.userId===this.userId),n.push(Zi(this.serializer,o))}))}),D.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return KN(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),D.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return D.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return _o(e).J({range:n},(s,o,a)=>{if(s[0]===this.userId){let u=kr(s[1]);i.push(u)}else a.done()}).next(()=>{Y(i.length===0)})})}containsKey(e,t){return GN(e,this.userId,t)}Nn(e){return QN(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function GN(r,e,t){let n=sd(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return _o(r).J({range:s,H:!0},(a,u,c)=>{let[h,f,m]=a;h===e&&f===i&&(o=!0),c.done()}).next(()=>o)}function Bn(r){return ct(r,"mutations")}function _o(r){return ct(r,"documentMutations")}function QN(r){return ct(r,"mutationQueues")}var Ro=class r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var lw=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new Ro(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Z.fromTimestamp(new ze(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ho(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(Y(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return ho(e).J((o,a)=>{let u=Ju(a);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>D.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ho(e).J((n,i)=>{let s=Ju(i);t(s)})}qn(e){return TR(e).get("targetGlobalKey").next(t=>(Y(t!==null),t))}Qn(e,t){return TR(e).put("targetGlobalKey",t)}Kn(e,t){return ho(e).put(BN(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=as(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return ho(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=Ju(a);Il(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Wn(e);return t.forEach(o=>{let a=xt(o.path);i.push(s.put({targetId:n,path:a})),i.push(this.referenceDelegate.addReference(e,n,o))}),D.waitFor(i)}removeMatchingKeys(e,t,n){let i=Wn(e);return D.forEach(t,s=>{let o=xt(s.path);return D.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Wn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Wn(e),s=oe();return i.J({range:n,H:!0},(o,a,u)=>{let c=kr(o[1]),h=new z(c);s=s.add(h)}).next(()=>s)}containsKey(e,t){let n=xt(t.path),i=IDBKeyRange.bound([n],[GR(n)],!1,!0),s=0;return Wn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return ho(e).get(t).next(n=>n?Ju(n):null)}};function ho(r){return ct(r,"targets")}function TR(r){return ct(r,"targetGlobal")}function Wn(r){return ct(r,"targetDocuments")}function IR([r,e],[t,n]){let i=ie(r,t);return i===0?ie(e,n):i}var cw=class{constructor(e){this.Un=e,this.buffer=new Oe(IR),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();IR(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},hw=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){L("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>q(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ii(t)?L("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield ni(t)}yield this.Hn(3e5)}))}},dw=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return D.resolve(Yt.oe);let n=new cw(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(SR)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),SR):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,o,a,u,c,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(n=f,a=Date.now(),this.removeTargets(e,n,t))).next(f=>(s=f,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(c=Date.now(),fo()<=rr.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(c-u)+`ms
Total Duration: ${c-h}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}};function HU(r,e){return new dw(r,e)}var fw=class{constructor(e,t){this.db=e,this.garbageCollector=HU(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return rd(e,n)}removeReference(e,t,n){return rd(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return rd(e,t)}nr(e,t){return function(i,s){let o=!1;return QN(i).Y(a=>GN(i,a,s).next(u=>(u&&(o=!0),D.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let u=this.nr(e,o).next(c=>{if(!c)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,Z.min()),Wn(e).delete(function(f){return[0,xt(f.path)]}(o))))});i.push(u)}}).next(()=>D.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return rd(e,t)}tr(e,t){let n=Wn(e),i,s=Yt.oe;return n.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Yt.oe&&t(new z(kr(i)),s),s=c,i=u):s=Yt.oe}).next(()=>{s!==Yt.oe&&t(new z(kr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function rd(r,e){return Wn(r).put(function(n,i){return{targetId:0,path:xt(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var Dd=class{constructor(){this.changes=new Ur(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?D.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var pw=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Yi(e).put(n)}removeEntry(e,t,n){return Yi(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ad(o),a[a.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ot.newInvalidDocument(t);return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only($u(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:ot.newInvalidDocument(t)};return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only($u(t))},(i,s)=>{n={document:this.ir(t,s),size:Rd(s)}}).next(()=>n)}getEntries(e,t){let n=Lt();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);n=n.insert(i,o)}).next(()=>n)}ar(e,t){let n=Lt(),i=new qe(z.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);n=n.insert(s,a),i=i.insert(s,Rd(o))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return D.resolve();let i=new Oe(CR);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound($u(i.first()),$u(i.last())),o=i.getIterator(),a=o.getNext();return Yi(e).J({index:"documentKeyIndex",range:s},(u,c,h)=>{let f=z.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&CR(a,f)<0;)n(a,null),a=o.getNext();a&&a.isEqual(f)&&(n(a,c),a=o.hasNext()?o.getNext():null),a?h.$($u(a)):h.done()}).next(()=>{for(;a;)n(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Ad(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yi(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let h=Lt();for(let f of c){let m=this.ir(z.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(Pl(t,m)||i.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,n,i){let s=Lt(),o=PR(t,n),a=PR(t,ur.max());return Yi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,h)=>{let f=this.ir(z.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(f.key,f),s.size===i&&h.done()}).next(()=>s)}newChangeBuffer(e){return new mw(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return AR(e).get("remoteDocumentGlobalKey").next(t=>(Y(!!t),t))}rr(e,t){return AR(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=GU(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Z.min())))return n}return ot.newInvalidDocument(e)}};function $N(r){return new pw(r)}var mw=class extends Dd{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Ur(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new Oe((s,o)=>ie(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=fR(this.cr.serializer,o);i=i.add(s.path.popLast());let c=Rd(u);n+=c-a.size,t.push(this.cr.addEntry(e,s,u))}else if(n-=a.size,this.trackRemovals){let u=fR(this.cr.serializer,o.convertToNoDocument(Z.min()));t.push(this.cr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),D.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function AR(r){return ct(r,"remoteDocumentGlobal")}function Yi(r){return ct(r,"remoteDocumentsV14")}function $u(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function PR(r,e){let t=e.documentKey.path.toArray();return[r,Ad(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function CR(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=ie(t[s],n[s]),i)return i;return i=ie(t.length,n.length),i||(i=ie(t[t.length-2],n[n.length-2]),i||ie(t[t.length-1],n[n.length-1]))}var gw=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var xd=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&el(n.mutation,i,Jt.empty(),ze.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,oe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=oe()){let i=Mr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Yu();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Mr();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,oe()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,i){let s=Lt(),o=Zu(),a=function(){return Zu()}();return t.forEach((u,c)=>{let h=n.get(c.key);i.has(c.key)&&(h===void 0||h.mutation instanceof _r)?s=s.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),el(h.mutation,c,h.mutation.getFieldMask(),ze.now())):o.set(c.key,Jt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new gw(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let n=Zu(),i=new qe((o,a)=>o-a),s=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let h=n.get(u)||Jt.empty();h=a.applyToLocalView(c,h),n.set(u,h);let f=(i.get(a.batchId)||oe()).add(u);i=i.insert(a.batchId,f)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,h=u.value,f=yN();h.forEach(m=>{if(!s.has(m)){let _=IN(t.get(m),n.get(m));_!==null&&f.set(m,_),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return D.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return z.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):EE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):D.resolve(Mr()),a=-1,u=s;return o.next(c=>D.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(h)?D.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{u=u.insert(h,m)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,oe())).next(h=>({batchId:a,changes:_N(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next(n=>{let i=Yu();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=Yu();return this.indexManager.getCollectionParents(e,s).next(a=>D.forEach(a,u=>{let c=function(f,m){return new gr(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,n,i).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((u,c)=>{let h=c.getKey();o.get(h)===null&&(o=o.insert(h,ot.newInvalidDocument(h)))});let a=Yu();return o.forEach((u,c)=>{let h=s.get(u);h!==void 0&&el(h.mutation,c,Jt.empty(),ze.now()),Pl(t,c)&&(a=a.insert(u,c))}),a})}};var _w=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return D.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ze(i.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:AE(i.bundledQuery),readTime:Ze(i.readTime)}}(t)),D.resolve()}};var yw=class{constructor(){this.overlays=new qe(z.comparator),this.Ir=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Mr();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),D.resolve()}getOverlaysForCollection(e,t,n){let i=Mr(),s=t.length+1,o=new z(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new qe((c,h)=>c-h),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>n){let h=s.get(c.largestBatchId);h===null&&(h=Mr(),s=s.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}let a=Mr(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=i)););return D.resolve(a)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new hl(t,n));let s=this.Ir.get(t);s===void 0&&(s=oe(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var vw=class{constructor(){this.sessionToken=et.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}};var _l=class{constructor(){this.Tr=new Oe(it.Er),this.dr=new Oe(it.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new it(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new it(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new z(new _e([])),n=new it(t,e),i=new it(t,e+1),s=[];return this.dr.forEachInRange([n,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new z(new _e([])),n=new it(t,e),i=new it(t,e+1),s=oe();return this.dr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new it(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},it=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return z.comparator(e.key,t.key)||ie(e.wr,t.wr)}static Ar(e,t){return ie(e.wr,t.wr)||z.comparator(e.key,t.key)}};var bw=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Oe(it.Er)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new cl(s,t,n,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new it(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return D.resolve(o)}lookupMutationBatch(e,t){return D.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.vr(n),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new it(t,0),i=new it(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],o=>{let a=this.Dr(o.wr);s.push(a)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Oe(ie);return t.forEach(i=>{let s=new it(i,0),o=new it(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{n=n.add(a.wr)})}),D.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;z.isDocumentKey(s)||(s=s.child(""));let o=new it(new z(s),0),a=new Oe(ie);return this.br.forEachWhile(u=>{let c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.wr)),!0)},o),D.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(n=>{let i=this.Dr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return D.forEach(t.mutations,i=>{let s=new it(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new it(t,0),i=this.br.firstAfterOrEqual(n);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ww=class{constructor(e){this.Mr=e,this.docs=function(){return new qe(z.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return D.resolve(n?n.document.mutableCopy():ot.newInvalidDocument(t))}getEntries(e,t){let n=Lt();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ot.newInvalidDocument(i))}),D.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Lt(),o=t.path,a=new z(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:h}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||_E($R(h),n)<=0||(i.has(h.key)||Pl(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,n,i){Q()}Or(e,t){return D.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Ew(this)}getSize(e){return D.resolve(this.size)}},Ew=class extends Dd{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),D.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Sw=class{constructor(e){this.persistence=e,this.Nr=new Ur(t=>as(t),Il),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _l,this.targetCount=0,this.kr=Ro.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),D.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Ro(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Kn(t),D.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&n.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return D.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),D.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return D.resolve(n)}containsKey(e,t){return D.resolve(this.Br.containsKey(t))}};var kd=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Yt(0),this.Kr=!1,this.Kr=!0,this.$r=new vw,this.referenceDelegate=e(this),this.Ur=new Sw(this),this.indexManager=new aw,this.remoteDocumentCache=function(i){return new ww(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Id(t),this.Gr=new _w(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new bw(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){L("MemoryPersistence","Starting transaction:",e);let i=new Tw(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return D.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},Tw=class extends fd{constructor(e){super(),this.currentSequenceNumber=e}},Md=class r{constructor(e){this.persistence=e,this.Jr=new _l,this.Yr=null}static Zr(e){return new r(e)}get Xr(){if(this.Yr)return this.Yr;throw Q()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),D.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),D.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Xr,n=>{let i=z.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,Z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return D.or([()=>D.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Iw=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new pd("createOrUpgrade",t);n<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",z1,{unique:!0}),u.createObjectStore("documentMutations")}(e),OR(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=D.resolve();return n<3&&i>=3&&(n!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),OR(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Z.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(h=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",z1,{unique:!0});let f=c.store("mutations"),m=h.map(_=>f.put(_));return D.waitFor(m)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.ni(s))),n<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(o=o.next(()=>this.ii(s))),n<8&&i>=8&&(o=o.next(()=>this.si(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.oi(s))),n<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:dU});c.createIndex("collectionPathOverlayIndex",fU,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",pU,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:tU});c.createIndex("documentKeyIndex",rU),c.createIndex("collectionGroupIndex",nU)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),n<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:uU}).createIndex("sequenceNumberIndex",lU,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:cU}).createIndex("documentKeyIndex",hU,{unique:!1})}(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Rd(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>D.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(a=>D.forEach(a,u=>{Y(u.userId===s.userId);let c=Zi(this.serializer,u);return KN(e,s.userId,c).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((o,a)=>{let u=new _e(o),c=function(f){return[0,xt(f)]}(u);s.push(t.get(c).next(h=>h?D.resolve():(f=>t.put({targetId:0,path:xt(f),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>D.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:aU});let n=t.store("collectionParents"),i=new gl,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return n.put({collectionId:a,parent:xt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new _e(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let h=kr(a);return s(h.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,i)=>{let s=Ju(i),o=BN(this.serializer,s);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new z(_e.fromString(f.document.name).popFirst(5)):f.noDocument?z.fromSegments(f.noDocument.path):f.unknownDocument?z.fromSegments(f.unknownDocument.path):Q()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>D.waitFor(i))}ai(e,t){let n=t.store("mutations"),i=$N(this.serializer),s=new kd(Md.Zr,this.serializer.ct);return n.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let h=(c=a.get(u.userId))!==null&&c!==void 0?c:oe();Zi(this.serializer,u).keys().forEach(f=>h=h.add(f)),a.set(u.userId,h)}),D.forEach(a,(u,c)=>{let h=new st(c),f=Pd.lt(this.serializer,h),m=s.getIndexManager(h),_=Nd.lt(h,this.serializer,m,s.referenceDelegate);return new xd(i,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new sl(t,Yt.oe),u).next()})})}};function OR(r){r.createObjectStore("targetDocuments",{keyPath:sU}).createIndex("documentTargetsIndex",oU,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",iU,{unique:!0}),r.createObjectStore("targetGlobal")}var fb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Aw=class r{constructor(e,t,n,i,s,o,a,u,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!r.D())throw new F(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fw(this,i),this.Ai=t+"main",this.serializer=new Id(u),this.Ri=new $n(this.Ai,this.hi,new Iw(this.serializer)),this.$r=new ew,this.Ur=new lw(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$N(this.serializer),this.Gr=new Zb,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Je("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new F(k.FAILED_PRECONDITION,fb);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Yt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>q(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>q(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>q(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>nd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ii(e))return L("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return L("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Hu(e).get("owner").next(t=>D.resolve(this.vi(t)))}Ci(e){return nd(e).delete(this.clientId)}Fi(){return q(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=ct(t,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return D.forEach(o,a=>n.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?D.resolve(!0):Hu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new F(k.FAILED_PRECONDITION,fb);return!1}}return!(!this.networkEnabled||!this.inForeground)||nd(e).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&L("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return q(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new sl(e,Yt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>nd(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Nd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uw(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Pd.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){L("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?_U:u===16?gU:u===15?vE:u===14?tN:u===13?eN:u===12?mU:u===11?ZR:void Q()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new sl(a,this.Qr?this.Qr.next():Yt.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw Je(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new F(k.FAILED_PRECONDITION,HR);return n(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>n(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Hu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new F(k.FAILED_PRECONDITION,fb)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Hu(e).put("owner",t)}static D(){return $n.D()}bi(e){let t=Hu(e);return t.get("owner").next(n=>this.vi(n)?(L("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):D.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(Je(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;C_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return L("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Je("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Je("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Hu(r){return ct(r,"owner")}function nd(r){return ct(r,"clientMetadata")}function CE(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var Pw=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=oe(),i=oe();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var Cw=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var qd=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return C_()?8:YR(nu())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Cw;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(fo()<=rr.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",po(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),D.resolve()):(fo()<=rr.DEBUG&&L("QueryEngine","Query:",po(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(fo()<=rr.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",po(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,kt(t))):D.resolve())}Yi(e,t){if(rR(t))return D.resolve(null);let n=kt(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=wd(t,null,"F"),n=kt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=oe(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(u=>{let c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,wd(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,n,i){return rR(t)||i.isEqual(Z.min())?D.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let o=this.ts(t,s);return this.ns(t,o,n,i)?D.resolve(null):(fo()<=rr.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),po(t)),this.rs(e,o,t,QR(i,-1)).next(a=>a))})}ts(e,t){let n=new Oe(mN(e));return t.forEach((i,s)=>{Pl(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return fo()<=rr.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",po(t)),this.Ji.getDocumentsMatchingQuery(e,t,ur.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Ow=class{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new qe(ie),this._s=new Ur(s=>as(s),Il),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new xd(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function HN(r,e,t,n){return new Ow(r,e,t,n)}function YN(r,e){return q(this,null,function*(){let t=W(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],a=[],u=oe();for(let c of i){o.push(c.batchId);for(let h of c.mutations)u=u.add(h.key)}for(let c of s){a.push(c.batchId);for(let h of c.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(n,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})})}function YU(r,e){let t=W(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,h){let f=c.batch,m=f.keys(),_=D.resolve();return m.forEach(v=>{_=_.next(()=>h.getEntry(u,v)).next(w=>{let A=c.docVersions.get(v);Y(A!==null),w.version.compareTo(A)<0&&(f.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),h.addEntry(w)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let u=oe();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function JN(r){let e=W(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function JU(r,e){let t=W(r),n=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((h,f)=>{let m=i.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,h.addedDocuments,f)));let _=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(et.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,n)),i=i.insert(f,_),function(w,A,M){return w.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0}(m,_,h)&&a.push(t.Ur.updateTargetData(s,_))});let u=Lt(),c=oe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(XN(s,o,e.documentUpdates).next(h=>{u=h.Ps,c=h.Is})),!n.isEqual(Z.min())){let h=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));a.push(h)}return D.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.os=i,s))}function XN(r,e,t){let n=oe(),i=oe();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=Lt();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(Z.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):L("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function XU(r,e){let t=W(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function No(r,e){let t=W(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,D.resolve(i)):t.Ur.allocateTargetId(n).next(o=>(i=new Oo(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function Do(r,e,t){return q(this,null,function*(){let n=W(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ii(o))throw o;L("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(i.target)})}function Fd(r,e,t){let n=W(r),i=Z.min(),s=oe();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,h){let f=W(u),m=f._s.get(h);return m!==void 0?D.resolve(f.os.get(m)):f.Ur.getTargetData(c,h)}(n,o,kt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?i:Z.min(),t?s:oe())).next(a=>(tD(n,pN(e),a),{documents:a,Ts:s})))}function ZN(r,e){let t=W(r),n=W(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(o=>o?o.target:null))}function eD(r,e){let t=W(r),n=t.us.get(e)||Z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,QR(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(tD(t,e,i),i))}function tD(r,e,t){let n=r.us.get(e)||Z.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function ZU(r,e,t,n){return q(this,null,function*(){let i=W(r),s=oe(),o=Lt();for(let c of t){let h=e.Es(c.metadata.name);c.document&&(s=s.add(h));let f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),u=yield No(i,function(h){return kt(jo(_e.fromString(`__bundle__/docs/${h}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>XN(c,a,o).next(h=>(a.apply(c),h)).next(h=>i.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Ur.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))})}function eB(n,i){return q(this,arguments,function*(r,e,t=oe()){let s=yield No(r,kt(AE(e.bundledQuery))),o=W(r);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=Ze(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(a,e);let c=s.withResumeToken(et.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(c.targetId,c),o.Ur.updateTargetData(a,c).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function RR(r,e){return`firestore_clients_${r}_${e}`}function NR(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function pb(r,e){return`firestore_targets_${r}_${e}`}var Vd=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){let i=JSON.parse(n),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new F(i.error.code,i.error.message))),o?new r(e,t,i.state,s):(Je("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},tl=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new F(n.error.code,n.error.message))),s?new r(e,n.state,i):(Je("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ld=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=SE();for(let o=0;i&&o<n.activeTargetIds.length;++o)i=JR(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return i?new r(e,s):(Je("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Rw=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(Je("SharedClientState",`Failed to parse online state: ${e}`),null)}},yl=class{constructor(){this.activeTargetIds=SE()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},rl=class{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new qe(ie),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=RR(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new yl),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return q(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let i=this.getItem(RR(this.persistenceKey,n));if(i){let s=Ld.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(pb(this.persistenceKey,e));if(i){let s=tl.Rs(e,i);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(pb(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return L("SharedClientState","READ",e,t),t}setItem(e,t){L("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){L("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(L("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Je("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>q(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let o=Yt.oe;if(s!=null)try{let a=JSON.parse(s);Y(typeof a=="number"),o=a}catch(a){Je("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);n!==Yt.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let i=new Vd(this.currentUser,e,t,n),s=NR(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=NR(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let i=pb(this.persistenceKey,e),s=new tl(e,t,n);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Ld.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Vd.Rs(new st(s),i,t)}Ys(e,t){let n=this.Ms.exec(e),i=Number(n[1]);return tl.Rs(i,t)}Ls(e){return Rw.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return q(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);L("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.io(o,a).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=SE();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},jd=class{constructor(){this.so=new yl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new yl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Nw=class{_o(e){}shutdown(){}};var Ud=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var id=null;function mb(){return id===null?id=function(){return 268435456+Math.round(2147483648*Math.random())}():id++,"0x"+id.toString(16)}var tB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Dw=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var It="WebChannelConnection",xw=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,o){let a=mb(),u=this.xo(t,n.toUriEncodedString());L("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,s,o),this.No(t,u,c,i).then(h=>(L("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw mr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",u,"request:",i),h})}Lo(t,n,i,s,o,a){return this.Mo(t,n,i,s,o)}Oo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Lo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,n){let i=tB[t];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){let s=mb();return new Promise((o,a)=>{let u=new ab;u.setWithCredentials(!0),u.listenOnce(ub.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ku.NO_ERROR:let h=u.getResponseJson();L(It,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),o(h);break;case Ku.TIMEOUT:L(It,`RPC '${e}' ${s} timed out`),a(new F(k.DEADLINE_EXCEEDED,"Request time out"));break;case Ku.HTTP_ERROR:let f=u.getStatus();if(L(It,`RPC '${e}' ${s} failed with status:`,f,"response text:",u.getResponseText()),f>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);let _=m?.error;if(_&&_.status&&_.message){let v=function(A){let M=A.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(M)>=0?M:k.UNKNOWN}(_.status);a(new F(v,_.message))}else a(new F(k.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new F(k.UNAVAILABLE,"Connection failed."));break;default:Q()}}finally{L(It,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);L(It,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,n,15)})}Bo(e,t,n){let i=mb(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=hb(),a=cb(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let h=s.join("");L(It,`Creating RPC '${e}' stream ${i}: ${h}`,u);let f=o.createWebChannel(h,u),m=!1,_=!1,v=new Dw({Io:A=>{_?L(It,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(m||(L(It,`Opening RPC '${e}' stream ${i} transport.`),f.open(),m=!0),L(It,`RPC '${e}' stream ${i} sending:`,A),f.send(A))},To:()=>f.close()}),w=(A,M,V)=>{A.listen(M,j=>{try{V(j)}catch(G){setTimeout(()=>{throw G},0)}})};return w(f,ao.EventType.OPEN,()=>{_||(L(It,`RPC '${e}' stream ${i} transport opened.`),v.yo())}),w(f,ao.EventType.CLOSE,()=>{_||(_=!0,L(It,`RPC '${e}' stream ${i} transport closed`),v.So())}),w(f,ao.EventType.ERROR,A=>{_||(_=!0,mr(It,`RPC '${e}' stream ${i} transport errored:`,A),v.So(new F(k.UNAVAILABLE,"The operation could not be completed")))}),w(f,ao.EventType.MESSAGE,A=>{var M;if(!_){let V=A.data[0];Y(!!V);let j=V,G=j.error||((M=j[0])===null||M===void 0?void 0:M.error);if(G){L(It,`RPC '${e}' stream ${i} received error:`,G);let te=G.status,H=function(I){let C=nt[I];if(C!==void 0)return CN(C)}(te),P=G.message;H===void 0&&(H=k.INTERNAL,P="Unknown error status: "+te+" with message "+G.message),_=!0,v.So(new F(H,P)),f.close()}else L(It,`RPC '${e}' stream ${i} received:`,V),v.bo(V)}}),w(a,lb.STAT_EVENT,A=>{A.stat===ed.PROXY?L(It,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===ed.NOPROXY&&L(It,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function rD(){return typeof window<"u"?window:null}function ld(){return typeof document<"u"?document:null}function Cl(r){return new $b(r,!0)}var vl=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Bd=class{constructor(e,t,n,i,s,o,a,u){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new vl(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return q(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return q(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return q(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(Je(t.toString()),Je("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{let i=new F(k.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>q(this,null,function*(){this.state=0,this.start()}))}I_(e){return L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},kw=class extends Bd{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=LU(this.serializer,e),n=function(s){if(!("targetChange"in s))return Z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?Z.min():o.readTime?Ze(o.readTime):Z.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Jb(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=vd(u)?{documents:qN(s,u)}:{query:FN(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=RN(s,o.resumeToken);let c=Hb(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Z.min())>0){a.readTime=Co(s,o.snapshotVersion.toTimestamp());let c=Hb(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let n=UU(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Jb(this.serializer),t.removeTarget=e,this.a_(t)}},Mw=class extends Bd{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Y(!!e.streamToken),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=jU(e.writeResults,e.commitTime),n=Ze(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Jb(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>ml(this.serializer,n))};this.a_(t)}};var qw=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new F(k.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,Yb(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new F(k.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Yb(t,n),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(k.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Fw=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Je(t),this.D_=!1):L("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Vw=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{n.enqueueAndForget(()=>q(this,null,function*(){si(this)&&(L("RemoteStore","Restarting streams for network reachability change."),yield function(u){return q(this,null,function*(){let c=W(u);c.L_.add(4),yield Uo(c),c.q_.set("Unknown"),c.L_.delete(4),yield Ol(c)})}(this))}))}),this.q_=new Fw(n,i)}};function Ol(r){return q(this,null,function*(){if(si(r))for(let e of r.B_)yield e(!0)})}function Uo(r){return q(this,null,function*(){for(let e of r.B_)yield e(!1)})}function cf(r,e){let t=W(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),NE(t)?RE(t):Wo(t).r_()&&OE(t,e))}function xo(r,e){let t=W(r),n=Wo(t);t.N_.delete(e),n.r_()&&nD(t,e),t.N_.size===0&&(n.r_()?n.o_():si(t)&&t.q_.set("Unknown"))}function OE(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Z.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wo(r).A_(e)}function nD(r,e){r.Q_.xe(e),Wo(r).R_(e)}function RE(r){r.Q_=new Qb({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Wo(r).start(),r.q_.v_()}function NE(r){return si(r)&&!Wo(r).n_()&&r.N_.size>0}function si(r){return W(r).L_.size===0}function iD(r){r.Q_=void 0}function rB(r){return q(this,null,function*(){r.q_.set("Online")})}function nB(r){return q(this,null,function*(){r.N_.forEach((e,t)=>{OE(r,e)})})}function iB(r,e){return q(this,null,function*(){iD(r),NE(r)?(r.q_.M_(e),RE(r)):r.q_.set("Unknown")})}function sB(r,e,t){return q(this,null,function*(){if(r.q_.set("Online"),e instanceof Sd&&e.state===2&&e.cause)try{yield function(i,s){return q(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(r,e)}catch(n){L("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Wd(r,n)}else if(e instanceof wo?r.Q_.Ke(e):e instanceof Ed?r.Q_.He(e):r.Q_.We(e),!t.isEqual(Z.min()))try{let n=yield JN(r.localStore);t.compareTo(n)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let h=s.N_.get(c);h&&s.N_.set(c,h.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let h=s.N_.get(u);if(!h)return;s.N_.set(u,h.withResumeToken(et.EMPTY_BYTE_STRING,h.snapshotVersion)),nD(s,u);let f=new Oo(h.target,u,c,h.sequenceNumber);OE(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(r,t))}catch(n){L("RemoteStore","Failed to raise snapshot:",n),yield Wd(r,n)}})}function Wd(r,e,t){return q(this,null,function*(){if(!ii(e))throw e;r.L_.add(1),yield Uo(r),r.q_.set("Offline"),t||(t=()=>JN(r.localStore)),r.asyncQueue.enqueueRetryable(()=>q(this,null,function*(){L("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Ol(r)}))})}function sD(r,e){return e().catch(t=>Wd(r,t,e))}function Bo(r){return q(this,null,function*(){let e=W(r),t=ri(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;oB(e);)try{let i=yield XU(e.localStore,n);if(i===null){e.O_.length===0&&t.o_();break}n=i.batchId,aB(e,i)}catch(i){yield Wd(e,i)}oD(e)&&aD(e)})}function oB(r){return si(r)&&r.O_.length<10}function aB(r,e){r.O_.push(e);let t=ri(r);t.r_()&&t.V_&&t.m_(e.mutations)}function oD(r){return si(r)&&!ri(r).n_()&&r.O_.length>0}function aD(r){ri(r).start()}function uB(r){return q(this,null,function*(){ri(r).p_()})}function lB(r){return q(this,null,function*(){let e=ri(r);for(let t of r.O_)e.m_(t.mutations)})}function cB(r,e,t){return q(this,null,function*(){let n=r.O_.shift(),i=zb.from(n,e,t);yield sD(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Bo(r)})}function hB(r,e){return q(this,null,function*(){e&&ri(r).V_&&(yield function(n,i){return q(this,null,function*(){if(function(o){return PN(o)&&o!==k.ABORTED}(i.code)){let s=n.O_.shift();ri(n).s_(),yield sD(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Bo(n)}})}(r,e)),oD(r)&&aD(r)})}function DR(r,e){return q(this,null,function*(){let t=W(r);t.asyncQueue.verifyOperationInProgress(),L("RemoteStore","RemoteStore received new credentials");let n=si(t);t.L_.add(3),yield Uo(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ol(t)})}function Lw(r,e){return q(this,null,function*(){let t=W(r);e?(t.L_.delete(2),yield Ol(t)):e||(t.L_.add(2),yield Uo(t),t.q_.set("Unknown"))})}function Wo(r){return r.K_||(r.K_=function(t,n,i){let s=W(t);return s.w_(),new kw(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:rB.bind(null,r),Ro:nB.bind(null,r),mo:iB.bind(null,r),d_:sB.bind(null,r)}),r.B_.push(e=>q(this,null,function*(){e?(r.K_.s_(),NE(r)?RE(r):r.q_.set("Unknown")):(yield r.K_.stop(),iD(r))}))),r.K_}function ri(r){return r.U_||(r.U_=function(t,n,i){let s=W(t);return s.w_(),new Mw(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:uB.bind(null,r),mo:hB.bind(null,r),f_:lB.bind(null,r),g_:cB.bind(null,r)}),r.B_.push(e=>q(this,null,function*(){e?(r.U_.s_(),yield Bo(r)):(yield r.U_.stop(),r.O_.length>0&&(L("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var jw=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,a=new r(e,t,o,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function zo(r,e){if(Je("AsyncQueue",`${e}: ${r}`),ii(r))return new F(k.UNAVAILABLE,`${e}: ${r}`);throw r}var zd=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||z.comparator(t.key,n.key):(t,n)=>z.comparator(t.key,n.key),this.keyedMap=Yu(),this.sortedSet=new qe(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Kd=class{constructor(){this.W_=new qe(z.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Q():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},ko=class r{constructor(e,t,n,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new r(e,t,zd.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Al(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var Uw=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Bw=class{constructor(){this.queries=xR(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let i=W(t),s=i.queries;i.queries=xR(),s.forEach((o,a)=>{for(let u of a.j_)u.onError(n)})})(this,new F(k.ABORTED,"Firestore shutting down"))}};function xR(){return new Ur(r=>fN(r),Al)}function DE(r,e){return q(this,null,function*(){let t=W(r),n=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new Uw,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=zo(o,`Initialization of query '${po(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&kE(t)})}function xE(r,e){return q(this,null,function*(){let t=W(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function dB(r,e){let t=W(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(n=!0);o.z_=i}}n&&kE(t)}function fB(r,e,t){let n=W(r),i=n.queries.get(e);if(i)for(let s of i.j_)s.onError(t);n.queries.delete(e)}function kE(r){r.Y_.forEach(e=>{e.next()})}var Ww,kR;(kR=Ww||(Ww={})).ea="default",kR.Cache="cache";var bl=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new ko(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ko.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ww.Cache}};var zw=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Gd=class{constructor(e){this.serializer=e}Es(e){return Fr(this.serializer,e)}ds(e){return e.metadata.exists?MN(this.serializer,e.document,!1):ot.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ze(e)}},Kw=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=uD(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=_e.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new Gd(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||oe()).add(s);t.set(o,a)}}return t}complete(){return q(this,null,function*(){let e=yield ZU(this.localStore,new Gd(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield eB(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function uD(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Qd=class{constructor(e){this.key=e}},$d=class{constructor(e){this.key=e}},Hd=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=oe(),this.mutatedKeys=oe(),this.Aa=mN(e),this.Ra=new zd(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new Kd,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{let m=i.get(h),_=Pl(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),w=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),A=!1;m&&_?m.data.isEqual(_.data)?v!==w&&(n.track({type:3,doc:_}),A=!0):this.ga(m,_)||(n.track({type:2,doc:_}),A=!0,(u&&this.Aa(_,u)>0||c&&this.Aa(_,c)<0)&&(a=!0)):!m&&_?(n.track({type:0,doc:_}),A=!0):m&&!_&&(n.track({type:1,doc:m}),A=!0,(u||c)&&(a=!0)),A&&(_?(o=o.add(_),s=w?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),n.track({type:1,doc:h})}return{Ra:o,fa:n,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((h,f)=>function(_,v){let w=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Q()}};return w(_)-w(v)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(n),i=i!=null&&i;let a=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new ko(this.query,e.Ra,s,o,e.mutatedKeys,u===0,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Kd,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=oe(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new $d(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Qd(n))}),t}ba(e){this.Ta=e.Ts,this.da=oe();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ko.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Gw=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Qw=class{constructor(e){this.key=e,this.va=!1}},$w=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ur(a=>fN(a),Al),this.Ma=new Map,this.xa=new Set,this.Oa=new qe(z.comparator),this.Na=new Map,this.La=new _l,this.Ba={},this.ka=new Map,this.qa=Ro.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function pB(r,e,t=!0){return q(this,null,function*(){let n=hf(r),i,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield lD(n,e,t,!0),i})}function mB(r,e){return q(this,null,function*(){let t=hf(r);yield lD(t,e,!0,!1)})}function lD(r,e,t,n){return q(this,null,function*(){let i=yield No(r.localStore,kt(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t),a;return n&&(a=yield ME(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&cf(r.remoteStore,i),a})}function ME(r,e,t,n,i){return q(this,null,function*(){r.Ka=(f,m,_)=>function(w,A,M,V){return q(this,null,function*(){let j=A.view.ma(M);j.ns&&(j=yield Fd(w.localStore,A.query,!1).then(({documents:P})=>A.view.ma(P,j)));let G=V&&V.targetChanges.get(A.targetId),te=V&&V.targetMismatches.get(A.targetId)!=null,H=A.view.applyChanges(j,w.isPrimaryClient,G,te);return Hw(w,A.targetId,H.wa),H.snapshot})}(r,f,m,_);let s=yield Fd(r.localStore,e,!0),o=new Hd(e,s.Ts),a=o.ma(s.documents),u=fl.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),c=o.applyChanges(a,r.isPrimaryClient,u);Hw(r,t,c.wa);let h=new Gw(e,t,o);return r.Fa.set(e,h),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),c.snapshot})}function gB(r,e,t){return q(this,null,function*(){let n=W(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(o=>!Al(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Do(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&xo(n.remoteStore,i.targetId),Mo(n,i.targetId)}).catch(ni))):(Mo(n,i.targetId),yield Do(n.localStore,i.targetId,!0))})}function _B(r,e){return q(this,null,function*(){let t=W(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),xo(t.remoteStore,n.targetId))})}function yB(r,e,t){return q(this,null,function*(){let n=LE(r);try{let i=yield function(o,a){let u=W(o),c=ze.now(),h=a.reduce((_,v)=>_.add(v.key),oe()),f,m;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let v=Lt(),w=oe();return u.cs.getEntries(_,h).next(A=>{v=A,v.forEach((M,V)=>{V.isValidDocument()||(w=w.add(M))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,v)).next(A=>{f=A;let M=[];for(let V of a){let j=DU(V,f.get(V.key).overlayedDocument);j!=null&&M.push(new _r(V.key,j,oN(j.value.mapValue),He.exists(!0)))}return u.mutationQueue.addMutationBatch(_,c,M,a)}).next(A=>{m=A;let M=A.applyToLocalDocumentSet(f,w);return u.documentOverlayCache.saveOverlays(_,A.batchId,M)})}).then(()=>({batchId:m.batchId,changes:_N(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new qe(ie)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(n,i.batchId,t),yield fn(n,i.changes),yield Bo(n.remoteStore)}catch(i){let s=zo(i,"Failed to persist write");t.reject(s)}})}function cD(r,e){return q(this,null,function*(){let t=W(r);try{let n=yield JU(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?Y(o.va):i.removedDocuments.size>0&&(Y(o.va),o.va=!1))}),yield fn(t,n,e)}catch(n){yield ni(n)}})}function MR(r,e,t){let n=W(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=W(o);u.onlineState=a;let c=!1;u.queries.forEach((h,f)=>{for(let m of f.j_)m.Z_(a)&&(c=!0)}),c&&kE(u)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function vB(r,e,t){return q(this,null,function*(){let n=W(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Na.get(e),s=i&&i.key;if(s){let o=new qe(z.comparator);o=o.insert(s,ot.newNoDocument(s,Z.min()));let a=oe().add(s),u=new dl(Z.min(),new Map,new qe(ie),o,a);yield cD(n,u),n.Oa=n.Oa.remove(s),n.Na.delete(e),VE(n)}else yield Do(n.localStore,e,!1).then(()=>Mo(n,e,t)).catch(ni)})}function bB(r,e){return q(this,null,function*(){let t=W(r),n=e.batch.batchId;try{let i=yield YU(t.localStore,e);FE(t,n,null),qE(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield fn(t,i)}catch(i){yield ni(i)}})}function wB(r,e,t){return q(this,null,function*(){let n=W(r);try{let i=yield function(o,a){let u=W(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return u.mutationQueue.lookupMutationBatch(c,a).next(f=>(Y(f!==null),h=f.keys(),u.mutationQueue.removeMutationBatch(c,f))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>u.localDocuments.getDocuments(c,h))})}(n.localStore,e);FE(n,e,t),qE(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield fn(n,i)}catch(i){yield ni(i)}})}function EB(r,e){return q(this,null,function*(){let t=W(r);si(t.remoteStore)||L("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let a=W(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(n===-1)return void e.resolve();let i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){let i=zo(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function qE(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function FE(r,e,t){let n=W(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function Mo(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||hD(r,n)})}function hD(r,e){r.xa.delete(e.path.canonicalString());let t=r.Oa.get(e);t!==null&&(xo(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),VE(r))}function Hw(r,e,t){for(let n of t)n instanceof Qd?(r.La.addReference(n.key,e),SB(r,n)):n instanceof $d?(L("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||hD(r,n.key)):Q()}function SB(r,e){let t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(L("SyncEngine","New document in limbo: "+t),r.xa.add(n),VE(r))}function VE(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let e=r.xa.values().next().value;r.xa.delete(e);let t=new z(_e.fromString(e)),n=r.qa.next();r.Na.set(n,new Qw(t)),r.Oa=r.Oa.insert(t,n),cf(r.remoteStore,new Oo(kt(jo(t.path)),n,"TargetPurposeLimboResolution",Yt.oe))}}function fn(r,e,t){return q(this,null,function*(){let n=W(r),i=[],s=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((a,u)=>{o.push(n.Ka(u,e,t).then(c=>{var h;if((c||t)&&n.isPrimaryClient){let f=c?!c.fromCache:(h=t?.targetChanges.get(u.targetId))===null||h===void 0?void 0:h.current;n.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(c){i.push(c);let f=Pw.Wi(u.targetId,c);s.push(f)}}))}),yield Promise.all(o),n.Ca.d_(i),yield function(u,c){return q(this,null,function*(){let h=W(u);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>D.forEach(c,m=>D.forEach(m.$i,_=>h.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>D.forEach(m.Ui,_=>h.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!ii(f))throw f;L("LocalStore","Failed to update sequence numbers: "+f)}for(let f of c){let m=f.targetId;if(!f.fromCache){let _=h.os.get(m),v=_.snapshotVersion,w=_.withLastLimboFreeSnapshotVersion(v);h.os=h.os.insert(m,w)}}})}(n.localStore,s))})}function TB(r,e){return q(this,null,function*(){let t=W(r);if(!t.currentUser.isEqual(e)){L("SyncEngine","User change. New user:",e.toKey());let n=yield YN(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(u=>{u.reject(new F(k.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield fn(t,n.hs)}})}function IB(r,e){let t=W(r),n=t.Na.get(e);if(n&&n.va)return oe().add(n.key);{let i=oe(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function AB(r,e){return q(this,null,function*(){let t=W(r),n=yield Fd(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Hw(t,e.targetId,i.wa),i})}function PB(r,e){return q(this,null,function*(){let t=W(r);return eD(t.localStore,e).then(n=>fn(t,n))})}function CB(r,e,t,n){return q(this,null,function*(){let i=W(r),s=yield function(a,u){let c=W(a),h=W(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,u).next(m=>m?c.localDocuments.getDocuments(f,m):D.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Bo(i.remoteStore):t==="acknowledged"||t==="rejected"?(FE(i,e,n||null),qE(i,e),function(a,u){W(W(a).mutationQueue).On(u)}(i.localStore,e)):Q(),yield fn(i,s)):L("SyncEngine","Cannot apply mutation batch with id: "+e)})}function OB(r,e){return q(this,null,function*(){let t=W(r);if(hf(t),LE(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield qR(t,n.toArray());t.Qa=!0,yield Lw(t.remoteStore,!0);for(let s of i)cf(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):i=i.then(()=>(Mo(t,o),Do(t.localStore,o,!0))),xo(t.remoteStore,o)}),yield i,yield qR(t,n),function(o){let a=W(o);a.Na.forEach((u,c)=>{xo(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new qe(z.comparator)}(t),t.Qa=!1,yield Lw(t.remoteStore,!1)}})}function qR(r,e,t){return q(this,null,function*(){let n=W(r),i=[],s=[];for(let o of e){let a,u=n.Ma.get(o);if(u&&u.length!==0){a=yield No(n.localStore,kt(u[0]));for(let c of u){let h=n.Fa.get(c),f=yield AB(n,h);f.snapshot&&s.push(f.snapshot)}}else{let c=yield ZN(n.localStore,o);a=yield No(n.localStore,c),yield ME(n,dD(c),o,!1,a.resumeToken)}i.push(a)}return n.Ca.d_(s),i})}function dD(r){return dN(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function RB(r){return function(t){return W(W(t).persistence).Qi()}(W(r).localStore)}function NB(r,e,t,n){return q(this,null,function*(){let i=W(r);if(i.Qa)return void L("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield eD(i.localStore,pN(s[0])),a=dl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",et.EMPTY_BYTE_STRING);yield fn(i,o,a);break}case"rejected":yield Do(i.localStore,e,!0),Mo(i,e,n);break;default:Q()}})}function DB(r,e,t){return q(this,null,function*(){let n=hf(r);if(n.Qa){for(let i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){L("SyncEngine","Adding an already active target "+i);continue}let s=yield ZN(n.localStore,i),o=yield No(n.localStore,s);yield ME(n,dD(s),o.targetId,!1,o.resumeToken),cf(n.remoteStore,o)}for(let i of t)n.Ma.has(i)&&(yield Do(n.localStore,i,!1).then(()=>{xo(n.remoteStore,i),Mo(n,i)}).catch(ni))}})}function hf(r){let e=W(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=cD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=IB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vB.bind(null,e),e.Ca.d_=dB.bind(null,e.eventManager),e.Ca.$a=fB.bind(null,e.eventManager),e}function LE(r){let e=W(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wB.bind(null,e),e}function xB(r,e,t){let n=W(r);(function(s,o,a){return q(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(_,v){let w=W(_),A=Ze(v.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",M=>w.Gr.getBundleMetadata(M,v.id)).then(M=>!!M&&M.createTime.compareTo(A)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(uD(u));let c=new Kw(u,s.localStore,o.serializer),h=yield o.Ua();for(;h;){let m=yield c.la(h);m&&a._updateProgress(m),h=yield o.Ua()}let f=yield c.complete();return yield fn(s,f.Ia,void 0),yield function(_,v){let w=W(_);return w.persistence.runTransaction("Save bundle","readwrite",A=>w.Gr.saveBundleMetadata(A,v))}(s.localStore,u),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(u){return mr("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Yw=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return q(this,null,function*(){this.serializer=Cl(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return HN(this.persistence,new qd,t.initialUser,this.serializer)}Ga(t){return new kd(Md.Zr,this.serializer)}Wa(t){return new jd}terminate(){return q(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})();var Yd=class r extends Yw{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return q(this,null,function*(){yield b_(r.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield LE(this.Ja.syncEngine),yield Bo(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return HN(this.persistence,new qd,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new hw(n,e.asyncQueue,t)}Ha(e,t){let n=new Cb(t,this.persistence);return new Pb(e.asyncQueue,n)}Ga(e){let t=CE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?ar.withCacheSize(this.cacheSizeBytes):ar.DEFAULT;return new Aw(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,rD(),ld(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new jd}},Jw=class r extends Yd{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return q(this,null,function*(){yield b_(r.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof rl&&(this.sharedClientState.syncEngine={no:CB.bind(null,t),ro:NB.bind(null,t),io:DB.bind(null,t),Qi:RB.bind(null,t),eo:PB.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>q(this,null,function*(){yield OB(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=rD();if(!rl.D(t))throw new F(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=CE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rl(t,e.asyncQueue,n,e.clientId,e.initialUser)}},jE=(()=>{class r{initialize(t,n){return q(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>MR(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=TB.bind(null,this.syncEngine),yield Lw(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Bw}()}createDatastore(t){let n=Cl(t.databaseInfo.databaseId),i=function(o){return new xw(o)}(t.databaseInfo);return function(o,a,u,c){return new qw(o,a,u,c)}(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return function(i,s,o,a,u){return new Vw(i,s,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,n=>MR(this.syncEngine,n,0),function(){return Ud.D()?new Ud:new Nw}())}createSyncEngine(t,n){return function(s,o,a,u,c,h,f){let m=new $w(s,o,a,u,c,h);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return q(this,null,function*(){var t,n;yield function(s){return q(this,null,function*(){let o=W(s);L("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield Uo(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function FR(r,e=10240){let t=0;return{read(){return q(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return q(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var qo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Je("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Xw=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new lt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return q(this,null,function*(){return this.metadata.promise})}Ua(){return q(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return q(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let i=yield this.iu(n);return new zw(JSON.parse(i),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return q(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return q(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return q(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Zw=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return q(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new F(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return q(this,null,function*(){let o=W(i),a={documents:s.map(f=>pl(o.serializer,f))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,_e.emptyPath(),a,s.length),c=new Map;u.forEach(f=>{let m=VU(o.serializer,f);c.set(m.key.toString(),m)});let h=[];return s.forEach(f=>{let m=c.get(f.toString());Y(!!m),h.push(m)}),h})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new ti(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return q(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=z.fromPath(n);this.mutations.push(new ll(i,this.precondition(i)))}),yield function(n,i){return q(this,null,function*(){let s=W(n),o={writes:i.map(a=>ml(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,_e.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Q();t=Z.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new F(k.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Z.min())?He.exists(!1):He.updateTime(t):He.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Z.min()))throw new F(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return He.updateTime(t)}return He.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var eE=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new vl(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>q(this,null,function*(){let e=new Zw(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.lu(i)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!Tl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!PN(t)}return!1}};var tE=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=st.UNAUTHENTICATED,this.clientId=hd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>q(this,null,function*(){L("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(L("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>q(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=zo(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function gb(r,e){return q(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),L("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>q(this,null,function*(){n.isEqual(i)||(yield YN(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function VR(r,e){return q(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield UE(r);L("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>DR(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>DR(e.remoteStore,i)),r._onlineComponents=e})}function UE(r){return q(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){L("FirestoreClient","Using user provided OfflineComponentProvider");try{yield gb(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===k.FAILED_PRECONDITION||i.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;mr("Error using user provided cache. Falling back to memory cache: "+t),yield gb(r,new Yw)}}else L("FirestoreClient","Using default OfflineComponentProvider"),yield gb(r,new Yw);return r._offlineComponents})}function df(r){return q(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(L("FirestoreClient","Using user provided OnlineComponentProvider"),yield VR(r,r._uninitializedComponentsProvider._online)):(L("FirestoreClient","Using default OnlineComponentProvider"),yield VR(r,new jE))),r._onlineComponents})}function fD(r){return UE(r).then(e=>e.persistence)}function BE(r){return UE(r).then(e=>e.localStore)}function pD(r){return df(r).then(e=>e.remoteStore)}function WE(r){return df(r).then(e=>e.syncEngine)}function kB(r){return df(r).then(e=>e.datastore)}function Fo(r){return q(this,null,function*(){let e=yield df(r),t=e.eventManager;return t.onListen=pB.bind(null,e.syncEngine),t.onUnlisten=gB.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=mB.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=_B.bind(null,e.syncEngine),t})}function MB(r){return r.asyncQueue.enqueue(()=>q(this,null,function*(){let e=yield fD(r),t=yield pD(r);return e.setNetworkEnabled(!0),function(i){let s=W(i);return s.L_.delete(0),Ol(s)}(t)}))}function qB(r){return r.asyncQueue.enqueue(()=>q(this,null,function*(){let e=yield fD(r),t=yield pD(r);return e.setNetworkEnabled(!1),function(i){return q(this,null,function*(){let s=W(i);s.L_.add(0),yield Uo(s),s.q_.set("Offline")})}(t)}))}function FB(r,e){let t=new lt;return r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(i,s,o){return q(this,null,function*(){try{let a=yield function(c,h){let f=W(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new F(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=zo(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield BE(r),e,t)})),t.promise}function mD(r,e,t={}){let n=new lt;return r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(s,o,a,u,c){let h=new qo({next:m=>{h.Za(),o.enqueueAndForget(()=>xE(s,f));let _=m.docs.has(a);!_&&m.fromCache?c.reject(new F(k.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&u&&u.source==="server"?c.reject(new F(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new bl(jo(a.path),h,{includeMetadataChanges:!0,_a:!0});return DE(s,f)}(yield Fo(r),r.asyncQueue,e,t,n)})),n.promise}function VB(r,e){let t=new lt;return r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(i,s,o){return q(this,null,function*(){try{let a=yield Fd(i,s,!0),u=new Hd(s,a.Ts),c=u.ma(a.documents),h=u.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){let u=zo(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield BE(r),e,t)})),t.promise}function gD(r,e,t={}){let n=new lt;return r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(s,o,a,u,c){let h=new qo({next:m=>{h.Za(),o.enqueueAndForget(()=>xE(s,f)),m.fromCache&&u.source==="server"?c.reject(new F(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new bl(a,h,{includeMetadataChanges:!0,_a:!0});return DE(s,f)}(yield Fo(r),r.asyncQueue,e,t,n)})),n.promise}function LB(r,e){let t=new qo(e);return r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(i,s){W(i).Y_.add(s),s.next()}(yield Fo(r),t)})),()=>{t.Za(),r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return function(i,s){W(i).Y_.delete(s)}(yield Fo(r),t)}))}}function jB(r,e,t,n){let i=function(o,a){let u;return u=typeof o=="string"?ON().encode(o):o,function(h,f){return new Xw(h,f)}(function(h,f){if(h instanceof Uint8Array)return FR(h,f);if(h instanceof ArrayBuffer)return FR(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Cl(e));r.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){xB(yield WE(r),i,n)}))}function UB(r,e){return r.asyncQueue.enqueue(()=>q(this,null,function*(){return function(n,i){let s=W(n);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield BE(r),e)}))}function _D(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var LR=new Map;function zE(r,e,t){if(!t)throw new F(k.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function KE(r,e,t,n){if(e===!0&&n===!0)throw new F(k.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function jR(r){if(!z.isDocumentKey(r))throw new F(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function UR(r){if(z.isDocumentKey(r))throw new F(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ff(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Q()}function ve(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new F(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ff(r);throw new F(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function yD(r,e){if(e<=0)throw new F(k.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var Jd=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new F(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new F(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}KE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_D((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},hs=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jd({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new F(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jd(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new _b;switch(n.type){case"firstParty":return new wb(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new F(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return q(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=LR.get(t);n&&(L("ComponentProvider","Removing Datastore"),LR.delete(t),n.terminate())}(this),Promise.resolve()}};function vD(r,e,t,n={}){var i;let s=(r=ve(r,hs))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&mr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),n.mockUserToken){let a,u;if(typeof n.mockUserToken=="string")a=n.mockUserToken,u=st.MOCK_USER;else{a=yc(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let c=n.mockUserToken.sub||n.mockUserToken.user_id;if(!c)throw new F(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new st(c)}r._authCredentials=new yb(new cd(a,u))}}var mt=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},Ne=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},Vr=class r extends mt{constructor(e,t,n){super(e,t,jo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ne(this.firestore,null,new z(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function GE(r,e,...t){if(r=fe(r),zE("collection","path",e),r instanceof hs){let n=_e.fromString(e,...t);return UR(n),new Vr(r,null,n)}{if(!(r instanceof Ne||r instanceof Vr))throw new F(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(_e.fromString(e,...t));return UR(n),new Vr(r.firestore,null,n)}}function bD(r,e){if(r=ve(r,hs),zE("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new F(k.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new mt(r,null,function(n){return new gr(_e.emptyPath(),n)}(e))}function Rl(r,e,...t){if(r=fe(r),arguments.length===1&&(e=hd.newId()),zE("doc","path",e),r instanceof hs){let n=_e.fromString(e,...t);return jR(n),new Ne(r,null,new z(n))}{if(!(r instanceof Ne||r instanceof Vr))throw new F(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(_e.fromString(e,...t));return jR(n),new Ne(r.firestore,r instanceof Vr?r.converter:null,new z(n))}}function QE(r,e){return r=fe(r),e=fe(e),(r instanceof Ne||r instanceof Vr)&&(e instanceof Ne||e instanceof Vr)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function $E(r,e){return r=fe(r),e=fe(e),r instanceof mt&&e instanceof mt&&r.firestore===e.firestore&&Al(r._query,e._query)&&r.converter===e.converter}var Xd=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new vl(this,"async_queue_retry"),this.Vu=()=>{let n=ld();n&&L("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=ld();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=ld();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new lt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return q(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ii(e))throw e;L("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(n);throw Je("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=jw.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&Q()}verifyOperationInProgress(){}wu(){return q(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function rE(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var nE=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new lt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var wD=-1,Ke=class extends hs{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Xd,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return q(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Xd(e),this._firestoreClient=void 0,yield e}})}};function gt(r){if(r._terminated)throw new F(k.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||ED(r),r._firestoreClient}function ED(r){var e,t,n;let i=r._freezeSettings(),s=function(a,u,c,h){return new Ob(a,u,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,_D(h.experimentalLongPollingOptions),h.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new tE(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(a){let u=a?._online.build();return{_offline:a?._offline.build(u),_online:u}}(r._componentsProvider))}function SD(r,e){mr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();return ID(r,jE.provider,{build:n=>new Yd(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function TD(r){return q(this,null,function*(){mr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();ID(r,jE.provider,{build:t=>new Jw(t,e.cacheSizeBytes)})})}function ID(r,e,t){if((r=ve(r,Ke))._firestoreClient||r._terminated)throw new F(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new F(k.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},ED(r)}function AD(r){if(r._initialized&&!r._terminated)throw new F(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new lt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>q(this,null,function*(){try{yield function(n){return q(this,null,function*(){if(!$n.D())return Promise.resolve();let i=n+"main";yield $n.delete(i)})}(CE(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function PD(r){return function(t){let n=new lt;return t.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return EB(yield WE(t),n)})),n.promise}(gt(r=ve(r,Ke)))}function CD(r){return MB(gt(r=ve(r,Ke)))}function OD(r){return qB(gt(r=ve(r,Ke)))}function RD(r,e){let t=gt(r=ve(r,Ke)),n=new nE;return jB(t,r._databaseId,e,n),n}function ND(r,e){return UB(gt(r=ve(r,Ke)),e).then(t=>t?new mt(r,null,t.query):null)}var Br=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(et.fromBase64String(e))}catch(t){throw new F(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(et.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var yr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var hn=class{constructor(e){this._methodName=e}};var ds=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}};var wl=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};var BB=/^__.*__$/,iE=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new _r(e,this.data,this.fieldMask,t,this.fieldTransforms):new ei(e,this.data,t,this.fieldTransforms)}},Zd=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new _r(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function DD(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q()}}var ef=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return tf(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(DD(this.Cu)&&BB.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},sE=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Cl(e)}Qu(e,t,n,i=!1){return new ef({Cu:e,methodName:t,qu:n,path:Xe.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function gs(r){let e=r._freezeSettings(),t=Cl(r._databaseId);return new sE(r._databaseId,!!e.ignoreUndefinedProperties,t)}function pf(r,e,t,n,i,s={}){let o=r.Qu(s.merge||s.mergeFields?2:0,e,t,i);JE("Data must be an object, but it was:",o,n);let a=MD(n,o),u,c;if(s.merge)u=new Jt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let h=[];for(let f of s.mergeFields){let m=cE(e,f,t);if(!o.contains(m))throw new F(k.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);FD(h,m)||h.push(m)}u=new Jt(h),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new iE(new At(a),u,c)}var El=class r extends hn{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function xD(r,e,t){return new ef({Cu:3,qu:e.settings.qu,methodName:r._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var oE=class r extends hn{_toFieldTransform(e){return new us(e.path,new Xn)}isEqual(e){return e instanceof r}},aE=class r extends hn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=xD(this,e,!0),n=this.Ku.map(s=>_s(s,t)),i=new ln(n);return new us(e.path,i)}isEqual(e){return e instanceof r&&O_(this.Ku,e.Ku)}},uE=class r extends hn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=xD(this,e,!0),n=this.Ku.map(s=>_s(s,t)),i=new cn(n);return new us(e.path,i)}isEqual(e){return e instanceof r&&O_(this.Ku,e.Ku)}},lE=class r extends hn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new Zn(e.serializer,bN(e.serializer,this.$u));return new us(e.path,t)}isEqual(e){return e instanceof r&&this.$u===e.$u}};function HE(r,e,t,n){let i=r.Qu(1,e,t);JE("Data must be an object, but it was:",i,n);let s=[],o=At.empty();ms(n,(u,c)=>{let h=XE(e,u,t);c=fe(c);let f=i.Nu(h);if(c instanceof El)s.push(h);else{let m=_s(c,f);m!=null&&(s.push(h),o.set(h,m))}});let a=new Jt(s);return new Zd(o,a,i.fieldTransforms)}function YE(r,e,t,n,i,s){let o=r.Qu(1,e,t),a=[cE(e,n,t)],u=[i];if(s.length%2!=0)throw new F(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(cE(e,s[m])),u.push(s[m+1]);let c=[],h=At.empty();for(let m=a.length-1;m>=0;--m)if(!FD(c,a[m])){let _=a[m],v=u[m];v=fe(v);let w=o.Nu(_);if(v instanceof El)c.push(_);else{let A=_s(v,w);A!=null&&(c.push(_),h.set(_,A))}}let f=new Jt(c);return new Zd(h,f,o.fieldTransforms)}function kD(r,e,t,n=!1){return _s(t,r.Qu(n?4:3,e))}function _s(r,e){if(qD(r=fe(r)))return JE("Unsupported field value:",e,r),MD(r,e);if(r instanceof hn)return function(n,i){if(!DD(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,i){let s=[],o=0;for(let a of n){let u=_s(a,i.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=fe(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return bN(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ze.fromDate(n);return{timestampValue:Co(i.serializer,s)}}if(n instanceof ze){let s=new ze(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Co(i.serializer,s)}}if(n instanceof ds)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Br)return{bytesValue:RN(i.serializer,n._byteString)};if(n instanceof Ne){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:IE(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof wl)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Bu("VectorValues must only contain numeric values.");return TE(a.serializer,u)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${ff(n)}`)}(r,e)}function MD(r,e){let t={};return rN(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ms(r,(n,i)=>{let s=_s(i,e.Mu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function qD(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ze||r instanceof ds||r instanceof Br||r instanceof Ne||r instanceof hn||r instanceof wl)}function JE(r,e,t){if(!qD(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=ff(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function cE(r,e,t){if((e=fe(e))instanceof yr)return e._internalPath;if(typeof e=="string")return XE(r,e);throw tf("Field path arguments must be of type string or ",r,!1,void 0,t)}var WB=new RegExp("[~\\*/\\[\\]]");function XE(r,e,t){if(e.search(WB)>=0)throw tf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new yr(...e.split("."))._internalPath}catch{throw tf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function tf(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new F(k.INVALID_ARGUMENT,a+r+u)}function FD(r,e){return r.some(t=>t.isEqual(e))}var fs=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new hE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(mf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},hE=class extends fs{data(){return super.data()}};function mf(r,e){return typeof e=="string"?XE(r,e):e instanceof yr?e._internalPath:e._delegate._internalPath}function VD(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new F(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Sl=class{},ps=class extends Sl{};function pn(r,e,...t){let n=[];e instanceof Sl&&n.push(e),n=n.concat(t),function(s){let o=s.filter(u=>u instanceof dE).length,a=s.filter(u=>u instanceof rf).length;if(o>1||o>0&&a>0)throw new F(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var rf=class r extends ps{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return $D(e._query,t),new mt(e.firestore,e.converter,Bb(e._query,t))}_parse(e){let t=gs(e.firestore);return function(s,o,a,u,c,h,f){let m;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new F(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){WR(f,h);let _=[];for(let v of f)_.push(BR(u,s,v));m={arrayValue:{values:_}}}else m=BR(u,s,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||WR(f,h),m=kD(a,o,f,h==="in"||h==="not-in");return pe.create(c,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function LD(r,e,t){let n=e,i=mf("where",r);return rf._create(i,n,t)}var dE=class r extends Sl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Se.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)$D(o,u),o=Bb(o,u)}(e._query,t),new mt(e.firestore,e.converter,Bb(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var fE=class r extends ps{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new F(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new F(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new os(s,o)}(e._query,this._field,this._direction);return new mt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new gr(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function jD(r,e="asc"){let t=e,n=mf("orderBy",r);return fE._create(n,t)}var nf=class r extends ps{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new mt(e.firestore,e.converter,wd(e._query,this._limit,this._limitType))}};function UD(r){return yD("limit",r),nf._create("limit",r,"F")}function BD(r){return yD("limitToLast",r),nf._create("limitToLast",r,"L")}var sf=class r extends ps{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=QD(e,this.type,this._docOrFields,this._inclusive);return new mt(e.firestore,e.converter,function(i,s){return new gr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function WD(...r){return sf._create("startAt",r,!0)}function zD(...r){return sf._create("startAfter",r,!1)}var of=class r extends ps{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=QD(e,this.type,this._docOrFields,this._inclusive);return new mt(e.firestore,e.converter,function(i,s){return new gr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function KD(...r){return of._create("endBefore",r,!1)}function GD(...r){return of._create("endAt",r,!0)}function QD(r,e,t,n){if(t[0]=fe(t[0]),t[0]instanceof fs)return function(s,o,a,u,c){if(!u)throw new F(k.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let h=[];for(let f of bo(s))if(f.field.isKeyField())h.push(ss(o,u.key));else{let m=u.data.field(f.field);if(uf(m))throw new F(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let _=f.field.canonicalString();throw new F(k.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(m)}return new jr(h,c)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=gs(r.firestore);return function(o,a,u,c,h,f){let m=o.explicitOrderBy;if(h.length>m.length)throw new F(k.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let v=0;v<h.length;v++){let w=h[v];if(m[v].field.isKeyField()){if(typeof w!="string")throw new F(k.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!EE(o)&&w.indexOf("/")!==-1)throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let A=o.path.child(_e.fromString(w));if(!z.isDocumentKey(A))throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);let M=new z(A);_.push(ss(a,M))}else{let A=kD(u,c,w);_.push(A)}}return new jr(_,f)}(r._query,r.firestore._databaseId,i,e,t,n)}}function BR(r,e,t){if(typeof(t=fe(t))=="string"){if(t==="")throw new F(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!EE(e)&&t.indexOf("/")!==-1)throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(_e.fromString(t));if(!z.isDocumentKey(n))throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ss(r,new z(n))}if(t instanceof Ne)return ss(r,t._key);throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ff(t)}.`)}function WR(r,e){if(!Array.isArray(r)||r.length===0)throw new F(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $D(r,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new F(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new F(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Vo=class{convertValue(e,t="none"){switch(is(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Q()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return ms(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>Ve(o.doubleValue));return new wl(s)}convertGeoPoint(e){return new ds(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=bE(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ol(e));default:return null}}convertTimestamp(e){let t=un(e);return new ze(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=_e.fromString(e);Y(UN(n));let i=new Yn(n.get(1),n.get(3)),s=new z(n.popFirst(5));return i.isEqual(t)||Je(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function gf(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var pE=class extends Vo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Br(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ne(this.firestore,null,t)}};var an=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},lr=class extends fs{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Gn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(mf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Gn=class extends lr{data(e={}){return super.data(e)}},vr=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Gn(this._firestore,this._userDataWriter,n.key,n,new an(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new an(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new an(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:zB(a.type),doc:u,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function zB(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q()}}function ZE(r,e){return r instanceof lr&&e instanceof lr?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof vr&&e instanceof vr&&r._firestore===e._firestore&&$E(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function HD(r){r=ve(r,Ne);let e=ve(r.firestore,Ke);return mD(gt(e),r._key).then(t=>nS(e,r,t))}var dn=class extends Vo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Br(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ne(this.firestore,null,t)}};function YD(r){r=ve(r,Ne);let e=ve(r.firestore,Ke),t=gt(e),n=new dn(e);return FB(t,r._key).then(i=>new lr(e,n,r._key,i,new an(i!==null&&i.hasLocalMutations,!0),r.converter))}function JD(r){r=ve(r,Ne);let e=ve(r.firestore,Ke);return mD(gt(e),r._key,{source:"server"}).then(t=>nS(e,r,t))}function XD(r){r=ve(r,mt);let e=ve(r.firestore,Ke),t=gt(e),n=new dn(e);return VD(r._query),gD(t,r._query).then(i=>new vr(e,n,r,i))}function ZD(r){r=ve(r,mt);let e=ve(r.firestore,Ke),t=gt(e),n=new dn(e);return VB(t,r._query).then(i=>new vr(e,n,r,i))}function ex(r){r=ve(r,mt);let e=ve(r.firestore,Ke),t=gt(e),n=new dn(e);return gD(t,r._query,{source:"server"}).then(i=>new vr(e,n,r,i))}function eS(r,e,t){r=ve(r,Ne);let n=ve(r.firestore,Ke),i=gf(r.converter,e,t);return Ko(n,[pf(gs(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,He.none())])}function tS(r,e,t,...n){r=ve(r,Ne);let i=ve(r.firestore,Ke),s=gs(i),o;return o=typeof(e=fe(e))=="string"||e instanceof yr?YE(s,"updateDoc",r._key,e,t,n):HE(s,"updateDoc",r._key,e),Ko(i,[o.toMutation(r._key,He.exists(!0))])}function tx(r){return Ko(ve(r.firestore,Ke),[new ti(r._key,He.none())])}function rx(r,e){let t=ve(r.firestore,Ke),n=Rl(r),i=gf(r.converter,e);return Ko(t,[pf(gs(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,He.exists(!1))]).then(()=>n)}function rS(r,...e){var t,n,i;r=fe(r);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||rE(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(rE(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let u,c,h;if(r instanceof Ne)c=ve(r.firestore,Ke),h=jo(r._key.path),u={next:f=>{e[o]&&e[o](nS(c,r,f))},error:e[o+1],complete:e[o+2]};else{let f=ve(r,mt);c=ve(f.firestore,Ke),h=f._query;let m=new dn(c);u={next:_=>{e[o]&&e[o](new vr(c,m,f,_))},error:e[o+1],complete:e[o+2]},VD(r._query)}return function(m,_,v,w){let A=new qo(w),M=new bl(_,A,v);return m.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return DE(yield Fo(m),M)})),()=>{A.Za(),m.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return xE(yield Fo(m),M)}))}}(gt(c),h,a,u)}function nx(r,e){return LB(gt(r=ve(r,Ke)),rE(e)?e:{next:e})}function Ko(r,e){return function(n,i){let s=new lt;return n.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){return yB(yield WE(n),i,s)})),s.promise}(gt(r),e)}function nS(r,e,t){let n=t.docs.get(e._key),i=new dn(r);return new lr(r,i,e._key,n,new an(t.hasPendingWrites,t.fromCache),e.converter)}var KB={maxAttempts:5};var af=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gs(e)}set(e,t,n){this._verifyNotCommitted();let i=zn(e,this._firestore),s=gf(i.converter,t,n),o=pf(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,He.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=zn(e,this._firestore),o;return o=typeof(t=fe(t))=="string"||t instanceof yr?YE(this._dataReader,"WriteBatch.update",s._key,t,n,i):HE(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,He.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=zn(e,this._firestore);return this._mutations=this._mutations.concat(new ti(t._key,He.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function zn(r,e){if((r=fe(r)).firestore!==e)throw new F(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var mE=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=gs(t)}get(t){let n=zn(t,this._firestore),i=new pE(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return Q();let o=s[0];if(o.isFoundDocument())return new fs(this._firestore,i,o.key,o,n.converter);if(o.isNoDocument())return new fs(this._firestore,i,n._key,null,n.converter);throw Q()})}set(t,n,i){let s=zn(t,this._firestore),o=gf(s.converter,n,i),a=pf(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,n,i,...s){let o=zn(t,this._firestore),a;return a=typeof(n=fe(n))=="string"||n instanceof yr?YE(this._dataReader,"Transaction.update",o._key,n,i,s):HE(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,a),this}delete(t){let n=zn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=zn(e,this._firestore),n=new dn(this._firestore);return super.get(e).then(i=>new lr(this._firestore,n,t._key,i._document,new an(!1,!1),t.converter))}};function ix(r,e,t){r=ve(r,Ke);let n=Object.assign(Object.assign({},KB),t);return function(s){if(s.maxAttempts<1)throw new F(k.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,o,a){let u=new lt;return s.asyncQueue.enqueueAndForget(()=>q(this,null,function*(){let c=yield kB(s);new eE(s.asyncQueue,c,a,o,u).au()})),u.promise}(gt(r),i=>e(new mE(r,i)),n)}function sx(){return new El("deleteField")}function ox(){return new oE("serverTimestamp")}function ax(...r){return new aE("arrayUnion",r)}function ux(...r){return new uE("arrayRemove",r)}function lx(r){return new lE("increment",r)}(function(e,t=!0){(function(i){Lo=i})(Sc),Ec(new Pr("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),a=new Ke(new vb(n.getProvider("auth-internal")),new Sb(n.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new F(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yn(c.options.projectId,h)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Us(U1,"4.7.3",e),Us(U1,"4.7.3","esm2017")})();var GB="@firebase/firestore-compat",QB="0.3.38";function lS(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new F("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function cx(){if(typeof Uint8Array>"u")throw new F("unimplemented","Uint8Arrays are not available in this environment.")}function hx(){if(!nN())throw new F("unimplemented","Blobs are unavailable in Firestore in this environment.")}var _f=class r{constructor(e){this._delegate=e}static fromBase64String(e){return hx(),new r(Br.fromBase64String(e))}static fromUint8Array(e){return cx(),new r(Br.fromUint8Array(e))}toBase64(){return hx(),this._delegate.toBase64()}toUint8Array(){return cx(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function iS(r){return $B(r,["next","error","complete"])}function $B(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var sS=class{enableIndexedDbPersistence(e,t){return SD(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return TD(e._delegate)}clearIndexedDbPersistence(e){return AD(e._delegate)}},yf=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Yn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&mr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){vD(this._delegate,e,t,n)}enableNetwork(){return CD(this._delegate)}disableNetwork(){return OD(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,KE("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return PD(this._delegate)}onSnapshotsInSync(e){return nx(this._delegate,e)}get app(){if(!this._appCompat)throw new F("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new $o(this,GE(this._delegate,e))}catch(t){throw Mt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Wr(this,Rl(this._delegate,e))}catch(t){throw Mt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ws(this,bD(this._delegate,e))}catch(t){throw Mt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return ix(this._delegate,t=>e(new vf(this,t)))}batch(){return gt(this._delegate),new bf(new af(this._delegate,e=>Ko(this._delegate,e)))}loadBundle(e){return RD(this._delegate,e)}namedQuery(e){return ND(this._delegate,e).then(t=>t?new ws(this,t):null)}},Go=class extends Vo{constructor(e){super(),this.firestore=e}convertBytes(e){return new _f(new Br(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Wr.forKey(t,this.firestore,null)}};function HB(r){zR(r)}var vf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Go(e)}get(e){let t=ys(e);return this._delegate.get(t).then(n=>new vs(this._firestore,new lr(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=ys(e);return n?(lS("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=ys(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=ys(e);return this._delegate.delete(t),this}},bf=class{constructor(e){this._delegate=e}set(e,t,n){let i=ys(e);return n?(lS("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=ys(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=ys(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Qo=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Gn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new bs(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new Go(e),t),i.set(t,s)),s}};Qo.INSTANCES=new WeakMap;var Wr=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Go(e)}static forPath(e,t,n){if(e.length%2!==0)throw new F("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new Ne(t._delegate,n,new z(e)))}static forKey(e,t,n){return new r(t,new Ne(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new $o(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new $o(this.firestore,GE(this._delegate,e))}catch(t){throw Mt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=fe(e),e instanceof Ne?QE(this._delegate,e):!1}set(e,t){t=lS("DocumentReference.set",t);try{return t?eS(this._delegate,e,t):eS(this._delegate,e)}catch(n){throw Mt(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?tS(this._delegate,e):tS(this._delegate,e,t,...n)}catch(i){throw Mt(i,"updateDoc()","DocumentReference.update()")}}delete(){return tx(this._delegate)}onSnapshot(...e){let t=dx(e),n=fx(e,i=>new vs(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return rS(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=YD(this._delegate):e?.source==="server"?t=JD(this._delegate):t=HD(this._delegate),t.then(n=>new vs(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Mt(r,e,t){return r.message=r.message.replace(e,t),r}function dx(r){for(let e of r)if(typeof e=="object"&&!iS(e))return e;return{}}function fx(r,e){var t,n;let i;return iS(r[0])?i=r[0]:iS(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var vs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Wr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ZE(this._delegate,e._delegate)}},bs=class extends vs{data(e){let t=this._delegate.data(e);return this._delegate._converter||KR(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ws=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Go(e)}where(e,t,n){try{return new r(this.firestore,pn(this._delegate,LD(e,t,n)))}catch(i){throw Mt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,pn(this._delegate,jD(e,t)))}catch(n){throw Mt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,pn(this._delegate,UD(e)))}catch(t){throw Mt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,pn(this._delegate,BD(e)))}catch(t){throw Mt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,pn(this._delegate,WD(...e)))}catch(t){throw Mt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,pn(this._delegate,zD(...e)))}catch(t){throw Mt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,pn(this._delegate,KD(...e)))}catch(t){throw Mt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,pn(this._delegate,GD(...e)))}catch(t){throw Mt(t,"endAt()","Query.endAt()")}}isEqual(e){return $E(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=ZD(this._delegate):e?.source==="server"?t=ex(this._delegate):t=XD(this._delegate),t.then(n=>new Nl(this.firestore,new vr(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=dx(e),n=fx(e,i=>new Nl(this.firestore,new vr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return rS(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},oS=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new bs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Nl=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ws(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new bs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new oS(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new bs(this._firestore,n))})}isEqual(e){return ZE(this._delegate,e._delegate)}},$o=class r extends ws{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Wr(this.firestore,e):null}doc(e){try{return e===void 0?new Wr(this.firestore,Rl(this._delegate)):new Wr(this.firestore,Rl(this._delegate,e))}catch(t){throw Mt(t,"doc()","CollectionReference.doc()")}}add(e){return rx(this._delegate,e).then(t=>new Wr(this.firestore,t))}isEqual(e){return QE(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Qo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ys(r){return ve(r,Ne)}var aS=class r{constructor(...e){this._delegate=new yr(...e)}static documentId(){return new r(Xe.keyField().canonicalString())}isEqual(e){return e=fe(e),e instanceof yr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var uS=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=ox();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=sx();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=ax(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=ux(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=lx(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var YB={Firestore:yf,GeoPoint:ds,Timestamp:ze,Blob:_f,Transaction:vf,WriteBatch:bf,DocumentReference:Wr,DocumentSnapshot:vs,Query:ws,QueryDocumentSnapshot:bs,QuerySnapshot:Nl,CollectionReference:$o,FieldPath:aS,FieldValue:uS,setLogLevel:HB,CACHE_SIZE_UNLIMITED:wD};function JB(r,e){r.INTERNAL.registerComponent(new Pr("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},YB)))}function XB(r){JB(r,(e,t)=>new yf(e,t,new sS)),r.registerVersion(GB,QB)}XB(On);function ZB(r,e=uc){return new ac(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function px(r,e){return ZB(r,e)}function eW(r,e){return px(r,e).pipe(hc(void 0),cc(),ht(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function dS(r,e){return px(r,e).pipe(ht(t=>({payload:t,type:"query"})))}var wf=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=vx(n,t);return new Sf(i,s,this.afs)}snapshotChanges(){return eW(this.ref,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return this.snapshotChanges().pipe(ht(({payload:t})=>e.idField?Xa(Sr({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return eu(this.ref.get(e)).pipe(ut)}};function Ef(r,e){return dS(r,e).pipe(hc(void 0),cc(),ht(t=>{let[n,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(f=>f.doc.ref.isEqual(a.ref)),h=n?.payload.docs.find(f=>f.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&h&&JSON.stringify(h.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function mx(r,e,t){return Ef(r,t).pipe(ki((n,i)=>tW(n,i.map(s=>s.payload),e),[]),lc(),ht(n=>n.map(i=>({type:i.type,payload:i}))))}function tW(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=rW(r,n))}),r}function cS(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function rW(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return cS(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return cS(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cS(r,e.oldIndex,1);break}return r}function gx(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Sf=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Ef(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ht(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(hc(void 0),cc(),S_(([n,i])=>i.length>0||!n),ht(([,n])=>n),ut)}auditTrail(e){return this.stateChanges(e).pipe(ki((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=gx(e);return mx(this.query,t,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return dS(this.query,this.afs.schedulers.outsideAngular).pipe(ht(t=>t.payload.docs.map(n=>e.idField?Xa(Sr({},n.data()),{[e.idField]:n.id}):n.data())),ut)}get(e){return eu(this.query.get(e)).pipe(ut)}add(e){return this.ref.add(e)}doc(e){return new wf(this.ref.doc(e),this.afs)}},hS=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Ef(this.query,this.afs.schedulers.outsideAngular).pipe(ut):Ef(this.query,this.afs.schedulers.outsideAngular).pipe(ht(t=>t.filter(n=>e.indexOf(n.type)>-1)),S_(t=>t.length>0),ut)}auditTrail(e){return this.stateChanges(e).pipe(ki((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=gx(e);return mx(this.query,t,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return dS(this.query,this.afs.schedulers.outsideAngular).pipe(ht(n=>n.payload.docs.map(i=>e.idField?Sr({[e.idField]:i.id},i.data()):i.data())),ut)}get(e){return eu(this.query.get(e)).pipe(ut)}},_x=new Pn("angularfire2.enableFirestorePersistence"),yx=new Pn("angularfire2.firestore.persistenceSettings"),nW=new Pn("angularfire2.firestore.settings"),iW=new Pn("angularfire2.firestore.use-emulator");function vx(r,e=t=>t){return{query:e(r),ref:r}}var sW=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,o,a,u,c,h,f,m,_,v,w,A,M,V){this.schedulers=u;let j=Oc(t,a,n),G=h;f&&Fc(j,a,m,v,w,A,_,M),[this.firestore,this.persistenceEnabled$]=Rc(`${j.name}.firestore`,"AngularFirestore",j.name,()=>{let te=a.runOutsideAngular(()=>j.firestore());if(s&&te.settings(s),G&&te.useEmulator(...G),i&&!lA(o)){let H=()=>{try{return eu(te.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(P){return typeof console<"u"&&console.warn(P),tu(!1)}};return[te,a.runOutsideAngular(H)]}else return[te,tu(!1)]},[s,G,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=vx(i,n),a=this.schedulers.ngZone.run(()=>s);return new Sf(a,o,this)}collectionGroup(t,n){let i=n||(o=>o),s=this.firestore.collectionGroup(t);return new hS(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new wf(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(ue(Pc),ue(Cc,8),ue(_x,8),ue(nW,8),ue(dc),ue(Fs),ue(Ac),ue(yx,8),ue(iW,8),ue(Vc,8),ue(Nc,8),ue(Dc,8),ue(xc,8),ue(kc,8),ue(Mc,8),ue(qc,8),ue(Ic,8))};static \u0275prov=Tr({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),bx=(()=>{class r{constructor(){On.registerVersion("angularfire",Tc.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:_x,useValue:!0},{provide:yx,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Be({type:r});static \u0275inj=Ue({providers:[sW]})}return r})();var Dq=lF(Nq()),xq={providers:[fA(FP),fc,gA,mA,_P(),D_,V1,bx,BA,tA(bA.forRoot({provide:vA,useFactory:pC}),D_.initializeApp(mC.firebase),RA.forRoot({timeOut:15e3,closeButton:!0,progressBar:!0}),Dq.NgDragDropModule.forRoot())]};Me();var kq=(()=>{class r{ngOnInit(){}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=eA({type:r,selectors:[["app-root"]],standalone:!0,features:[oA],decls:1,vars:0,template:function(n,i){n&1&&sA(0,"router-outlet")},dependencies:[uA,fc],data:{animation:[]}})}}return r})();hA(kq,xq).catch(r=>console.error(r));
